import{a as Q}from"./chunk-UKJURZ5U.js";import{$a as S,$b as R,Fb as N,Gb as j,Hb as s,Ia as u,Ib as v,Jb as y,Kb as K,Lb as W,Vb as h,Xa as A,Xb as _,ga as P,ha as w,hb as T,ib as M,nb as x,ob as o,pb as a,qc as J,ra as $,rc as X,vb as V,vc as Y,wc as q,xb as k,zb as p}from"./chunk-6LA4YLFZ.js";import{a as b,b as C}from"./chunk-A3ECCK3J.js";function E(e){return typeof e=="function"}function te(e){return typeof e=="string"}function O(e){return typeof e=="object"&&e!==null}function ne(e){if(e===void 0)return!0;if(E(e))try{return e()}catch{return!0}return e}function ie(e){let t=e;return E(t.addTap)&&E(t.removeTap)}function re(e){let t=globalThis.structuredClone;if(E(t))try{return t(e)}catch{}return e}function ae(){return __DEV__!==void 0?__DEV__:!1}var oe=1e3,se=1e3;function z(e={}){return t=>{let n=ne(e.enabled);if(!ae()||!n)return t;if(!ie(t))return console.warn("[Guardrails] Tree does not expose middleware hooks; guardrails disabled."),t;let i=de(),r={tree:t,config:e,stats:i,issues:[],hotPaths:[],currentUpdate:null,suppressed:!1,timings:[],hotPathData:new Map,issueMap:new Map,signalUsage:new Map,memoryHistory:[],recomputationLog:[],disposed:!1},d=`guardrails:${e.treeId??"tree"}:${Math.random().toString(36).slice(2)}`;r.middlewareId=d;let l=le(r);t.addTap(l);let c=ye(r),g=()=>{if(!r.disposed){r.disposed=!0,c();try{t.removeTap(d)}catch{}}},m=t.destroy?.bind(t);return t.destroy=()=>{g(),m&&m()},t.__guardrails=Oe(r,g),t}}function de(){return{updateCount:0,totalUpdateTime:0,avgUpdateTime:0,p50UpdateTime:0,p95UpdateTime:0,p99UpdateTime:0,maxUpdateTime:0,recomputationCount:0,recomputationsPerSecond:0,signalCount:0,signalRetention:0,unreadSignalCount:0,memoryGrowthRate:0,hotPathCount:0,violationCount:0}}function le(e){return{id:e.middlewareId??"guardrails",before:(t,n,i)=>{if(e.suppressed)return e.currentUpdate=null,!e.disposed;let r=Ge(n);if(ve(e,r))return e.currentUpdate=null,!e.disposed;let d=Ee(n,i);e.currentUpdate={action:t,startTime:performance.now(),metadata:r,details:d};for(let l of d)ge(e,l,r);return!e.disposed},after:(t,n,i,r)=>{let d=e.currentUpdate;if(!d)return;let l=Math.max(0,performance.now()-d.startTime),c=Date.now(),g=Math.max(0,d.details.length-1);De(e,l);for(let[m,f]of d.details.entries()){let D=Ie(r,f.segments),G=ce(f.oldValue,D);pe(e,f,l,G,m===0),me(e,f.path,l),fe(e,f.path,c)}he(e,c),_e(e,g,c),e.currentUpdate=null}}}function ue(e){if(e.timings.length===0)return;let t=[...e.timings].sort((n,i)=>n-i);e.stats.p50UpdateTime=t[Math.floor(t.length*.5)]||0,e.stats.p95UpdateTime=t[Math.floor(t.length*.95)]||0,e.stats.p99UpdateTime=t[Math.floor(t.length*.99)]||0}function ce(e,t){if(!Z(e)||!Z(t))return Object.is(e,t)?0:1;if(e===t)return 0;let n=new Set(Object.keys(e)),i=new Set(Object.keys(t)),r=new Set([...n,...i]),d=0;for(let l of r)(!n.has(l)||!i.has(l)||e[l]!==t[l])&&d++;return r.size===0?0:d/r.size}function ge(e,t,n){if(e.config.customRules)for(let i of e.config.customRules)Ce(e,i,{path:t.segments,value:t.newValue,oldValue:t.oldValue,metadata:n,tree:e.tree,stats:e.stats})}function pe(e,t,n,i,r){r&&e.config.budgets?.maxUpdateTime&&n>e.config.budgets.maxUpdateTime&&I(e,{type:"budget",severity:"error",message:`Update took ${n.toFixed(2)}ms (budget: ${e.config.budgets.maxUpdateTime}ms)`,path:t.path,count:1});let d=e.config.analysis?.minDiffForParentReplace??.8;e.config.analysis?.warnParentReplace&&i>d&&I(e,{type:"analysis",severity:"warning",message:`High diff ratio (${(i*100).toFixed(0)}%) - consider scoped updates`,path:t.path,count:1,diffRatio:i})}function me(e,t,n){if(!e.config.hotPaths?.enabled)return;let i=Array.isArray(t)?t.join("."):t,r=Date.now(),d=e.config.hotPaths.windowMs||1e3,l=e.hotPathData.get(i);l||(l={count:0,lastUpdate:r,durations:[]},e.hotPathData.set(i,l)),r-l.lastUpdate>d&&(l.count=0,l.durations=[]),l.count++,l.durations.push(n),l.lastUpdate=r;let c=e.config.hotPaths.threshold||10,g=l.count/d*1e3;if(g>c){let m=[...l.durations].sort((G,B)=>G-B),f=m[Math.floor(m.length*.95)]||0,D=l.durations.reduce((G,B)=>G+B,0)/l.durations.length;be(e,{path:i,updatesPerSecond:g,heatScore:Math.min(100,g/c*50),downstreamEffects:0,avgDuration:D,p95Duration:f})}}function fe(e,t,n){let i=Array.isArray(t)?t.join("."):t,r=e.signalUsage.get(i)??{updates:0,lastSeen:n};r.updates+=1,r.lastSeen=n,e.signalUsage.set(i,r)}function he(e,t){let n=e.config.memoryLeaks?.checkInterval??5e3,i=Math.max(n,1e3),r=e.signalUsage.size;e.stats.signalCount=r;let d=[...e.signalUsage.values()].filter(g=>t-g.lastSeen>n).length;e.stats.signalRetention=d,e.stats.unreadSignalCount=0,e.memoryHistory.push({timestamp:t,count:r}),e.memoryHistory=e.memoryHistory.filter(g=>t-g.timestamp<=i);let l=e.memoryHistory[0]?.count??r,c=l===0?0:(r-l)/Math.max(1,l);e.stats.memoryGrowthRate=c}function _e(e,t,n){if(t>0){e.stats.recomputationCount+=t;for(let i=0;i<t;i++)e.recomputationLog.push(n)}e.recomputationLog.length&&(e.recomputationLog=e.recomputationLog.filter(i=>n-i<=se)),e.stats.recomputationsPerSecond=e.recomputationLog.length}function be(e,t){let n=e.hotPaths.find(i=>i.path===t.path);if(n)Object.assign(n,t);else{e.hotPaths.push(t);let i=e.config.hotPaths?.topN||5;e.hotPaths.length>i&&(e.hotPaths.sort((r,d)=>d.heatScore-r.heatScore),e.hotPaths.length=i)}e.stats.hotPathCount=e.hotPaths.length}function Ce(e,t,n){let i=()=>{let r=typeof t.message=="function"?t.message(n):t.message;I(e,{type:"rule",severity:t.severity||"warning",message:r,path:n.path.join("."),count:1,metadata:{rule:t.name}})};try{let r=t.test(n);if(r instanceof Promise){r.then(d=>{d||i()}).catch(d=>{console.warn(`[Guardrails] Rule ${t.name} rejected:`,d)});return}r||i()}catch(r){console.warn(`[Guardrails] Rule ${t.name} threw error:`,r)}}function I(e,t){if(!e.suppressed){if(e.config.reporting?.aggregateWarnings!==!1){let n=`${t.type}:${t.path}:${t.message}`,i=e.issueMap.get(n);if(i){i.count++;return}e.issueMap.set(n,t)}if(e.issues.push(t),e.stats.violationCount++,e.config.mode==="throw")throw new Error(`[Guardrails] ${t.message}`)}}function ve(e,t){if(e.suppressed)return!0;if(!t)return!1;if(t.suppressGuardrails&&e.config.suppression?.respectMetadata!==!1)return!0;let n=new Set(e.config.suppression?.autoSuppress??[]);return[t.intent,t.source].some(i=>te(i)&&n.has(i))}function ye(e){let t=setInterval(()=>{if(e.disposed){clearInterval(t);return}Pe(e),we(e)},e.config.reporting?.interval||5e3);return()=>clearInterval(t)}function Pe(e){if(!e.config.memoryLeaks?.enabled)return;let t=Date.now(),n=e.config.memoryLeaks?.checkInterval??5e3,i=e.config.memoryLeaks?.retentionThreshold??100,r=e.config.memoryLeaks?.growthRate??.2,d=[...e.signalUsage.values()].filter(g=>t-g.lastSeen>n).length;e.stats.signalRetention=d;let l=e.stats.signalRetention>i,c=e.stats.memoryGrowthRate>r;(l||c)&&I(e,{type:"memory",severity:"warning",message:`Potential memory leak detected (signals: ${e.stats.signalCount}, growth ${(e.stats.memoryGrowthRate*100).toFixed(1)}%)`,path:"root",count:1,metadata:{signalCount:e.stats.signalCount,growth:e.stats.memoryGrowthRate}})}function we(e){if(e.config.reporting?.console===!1)return;let t=L(e);e.config.reporting?.customReporter&&e.config.reporting.customReporter(t),e.config.reporting?.console&&e.issues.length>0&&Te(t,e.config.reporting.console==="verbose"),e.issues=[],e.issueMap.clear()}function Te(e,t){console.group("[Guardrails] Performance Report"),Me(e.issues),ke(e.hotPaths),t&&Se(e),console.groupEnd()}function Me(e){if(e.length!==0){console.warn(`${e.length} issues detected:`);for(let t of e){let n=xe(t.severity),i=t.count>1?` (x${t.count})`:"",r=`${n} [${t.type}] ${t.message}${i}`;console.log(`  ${r}`)}}}function ke(e){if(e.length!==0){console.log(`
Hot Paths (${e.length}):`);for(let t of e){let n=`  \u{1F525} ${t.path}: ${t.updatesPerSecond.toFixed(1)}/s (heat: ${t.heatScore.toFixed(0)})`;console.log(n)}}}function Se(e){console.log(`
Stats:`,e.stats),console.log("Budgets:",e.budgets)}function xe(e){return e==="error"?"\u274C":e==="warning"?"\u26A0\uFE0F":"\u2139\uFE0F"}function L(e){let t=e.stats.signalCount,n=e.config.budgets?.maxMemory??50,i=e.stats.recomputationsPerSecond,r=e.config.budgets?.maxRecomputations??100,d={updateTime:F(e.stats.avgUpdateTime,e.config.budgets?.maxUpdateTime||16),memory:F(t,n),recomputations:F(i,r)};return{timestamp:Date.now(),treeId:e.config.treeId,issues:Array.from(e.issueMap.values()),hotPaths:e.hotPaths,budgets:d,stats:e.stats,recommendations:Re(e)}}function F(e,t){if(t<=0)return{current:e,limit:t,usage:0,status:"ok"};let n=e/t*100,i=80,r;return n>100?r="exceeded":n>i?r="warning":r="ok",{current:e,limit:t,usage:n,status:r}}function Re(e){let t=[];return e.hotPaths.length>0&&t.push("Consider batching or debouncing updates to hot paths"),e.stats.avgUpdateTime>10&&t.push("Average update time is high - review update logic"),t}function Oe(e,t){return{getReport:()=>L(e),getStats:()=>e.stats,suppress:n=>{let i=e.suppressed;e.suppressed=!0;try{n()}finally{e.suppressed=i}},dispose:()=>{t();let n=L(e);e.config.reporting?.console!==!1&&console.log("[Guardrails] Final report on disposal:",n),e.config.reporting?.customReporter&&e.config.reporting.customReporter(n)}}}function Ge(e){if(!O(e))return;let t=e.metadata;return O(t)?t:void 0}function Ee(e,t){let n=[],i=(r,d,l)=>{let c=d.length?d.join("."):"root",g=H(l);if(O(r)){n.push({path:c,segments:[...d],newValue:r,oldValue:g});for(let[m,f]of Object.entries(r))i(f,[...d,m],O(l)?l[m]:void 0);return}n.push({path:c,segments:[...d],newValue:r,oldValue:g})};return O(e)?i(e,[],t):n.push({path:"root",segments:[],newValue:e,oldValue:H(t)}),n.length===0&&n.push({path:"root",segments:[],newValue:e,oldValue:H(t)}),n}function Ie(e,t){let n=e;for(let i of t){if(!O(n))return;n=n[i]}return n}function H(e){return re(e)}function Ue(e){if(!e||typeof e!="object")return!1;let t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}function De(e,t){e.timings.push(t),e.timings.length>oe&&e.timings.shift(),e.stats.updateCount++,e.stats.totalUpdateTime+=t,e.stats.avgUpdateTime=e.stats.totalUpdateTime/e.stats.updateCount,e.stats.maxUpdateTime=Math.max(e.stats.maxUpdateTime,t),ue(e)}function Z(e){return Ue(e)}var U={noDeepNesting:(e=5)=>({name:"no-deep-nesting",description:`Prevents nesting deeper than ${e} levels`,test:t=>t.path.length<=e,message:t=>`Path too deep: ${t.path.join(".")} (${t.path.length} levels, max: ${e})`,severity:"warning",tags:["architecture","complexity"]}),noFunctionsInState:()=>({name:"no-functions",description:"Functions break serialization",test:e=>typeof e.value!="function",message:"Functions cannot be stored in state (breaks serialization)",severity:"error",tags:["serialization","data"]}),noCacheInPersistence:()=>({name:"no-cache-persistence",description:"Prevent cache from being persisted",test:e=>!(e.metadata?.source==="serialization"&&e.path.includes("cache")),message:"Cache should not be persisted",severity:"warning",tags:["persistence","cache"]}),maxPayloadSize:(e=100)=>({name:"max-payload-size",description:`Limit payload size to ${e}KB`,test:t=>{try{return JSON.stringify(t.value).length<e*1024}catch{return!0}},message:t=>`Payload size ${(JSON.stringify(t.value).length/1024).toFixed(1)}KB exceeds limit of ${e}KB`,severity:"warning",tags:["performance","data"]}),noSensitiveData:(e=["password","token","secret","apiKey"])=>({name:"no-sensitive-data",description:"Prevents storing sensitive data",test:t=>!t.path.some(n=>e.some(i=>typeof n=="string"&&n.toLowerCase().includes(i.toLowerCase()))),message:t=>`Sensitive data detected in path: ${t.path.join(".")}`,severity:"error",tags:["security","data"]})};function Be(e,t){if(e&1&&(o(0,"p",6),s(1," Last report generated at "),o(2,"strong"),s(3),a()()),e&2){let n=t.ngIf;u(3),v(n)}}function $e(e,t){if(e&1&&(o(0,"div",21)(1,"div",22),s(2),a(),o(3,"div",23),s(4),h(5,"number"),a(),o(6,"div",24),s(7),h(8,"number"),h(9,"number"),a()()),e&2){let n=t.$implicit;N("budget-warning",n.status==="warning")("budget-error",n.status==="error"),u(2),v(n.label),u(2),y("",_(5,8,n.usage,"1.0-0"),"%"),u(3),K(" ",_(8,11,n.current,"1.0-2")," / ",_(9,14,n.limit,"1.0-2")," ")}}function Fe(e,t){if(e&1&&(o(0,"section",14)(1,"h2"),s(2,"Budget Usage"),a(),o(3,"div",19),S(4,$e,10,17,"div",20),a()()),e&2){let n=p(2);u(4),x("ngForOf",n.budgetEntries())("ngForTrackBy",n.trackBudget)}}function He(e,t){if(e&1&&s(0),e&2){let n=p().$implicit;y(" \xB7 Rule: ",n.metadata==null?null:n.metadata.rule," ")}}function Le(e,t){if(e&1&&(o(0,"li")(1,"div",26)(2,"span",27),s(3),a(),o(4,"span",28),s(5),a()(),o(6,"div",29),s(7),T(8,He,1,1),a()()),e&2){let n=t.$implicit,i=p(3);j(i.issueSeverityClass(n)),u(3),v(n.message),u(2),y("\xD7",n.count),u(2),y(" Path: ",n.path||"root"," "),u(),M(n.metadata!=null&&n.metadata.rule?8:-1)}}function ze(e,t){if(e&1&&(o(0,"ul",16),S(1,Le,9,6,"li",25),a()),e&2){let n=p(2);u(),x("ngForOf",n.issues())("ngForTrackBy",n.trackIssue)}}function Ae(e,t){e&1&&(o(0,"p",5),s(1," No violations detected \u2014 run a scenario to generate insights. "),a())}function Ve(e,t){if(e&1&&(o(0,"li")(1,"div",31),s(2),a(),o(3,"div",32),s(4),h(5,"number"),h(6,"number"),h(7,"number"),a()()),e&2){let n=t.$implicit,i=p(3);u(2),v(i.formatHotPathLabel(n)),u(2),W(" Heat: ",_(5,4,n.heatScore,"1.0-0")," \xB7 Avg: ",_(6,7,n.avgDuration,"1.0-2")," ms \xB7 P95: ",_(7,10,n.p95Duration,"1.0-2")," ms ")}}function Ne(e,t){if(e&1&&(o(0,"ul",18),S(1,Ve,8,13,"li",30),a()),e&2){let n=p(2);u(),x("ngForOf",n.hotPaths())("ngForTrackBy",n.trackHotPath)}}function je(e,t){e&1&&(o(0,"p",5),s(1," No hot paths yet \u2014 try the hot path scenario above. "),a())}function Ke(e,t){if(e&1){let n=V();o(0,"section",7)(1,"button",8),k("click",function(){P(n);let r=p();return w(r.runHealthyScenario())}),s(2," Record Baseline Update "),a(),o(3,"button",8),k("click",function(){P(n);let r=p();return w(r.triggerHotPath())}),s(4,"Trigger Hot Path"),a(),o(5,"button",8),k("click",function(){P(n);let r=p();return w(r.triggerBudgetBreach())}),s(6," Stress Budgets "),a(),o(7,"button",8),k("click",function(){P(n);let r=p();return w(r.triggerRuleViolation())}),s(8," Trigger Sensitive Data Rule "),a(),o(9,"button",8),k("click",function(){P(n);let r=p();return w(r.runSuppressedScenario())}),s(10," Run Suppressed Hydrate "),a(),o(11,"button",9),k("click",function(){P(n);let r=p();return w(r.resetDemo())}),s(12," Reset Demo "),a()(),o(13,"section",10)(14,"div",11)(15,"span",12),s(16,"Total Updates"),a(),o(17,"span",13),s(18),a()(),o(19,"div",11)(20,"span",12),s(21,"Avg Update Time"),a(),o(22,"span",13),s(23),h(24,"number"),a()(),o(25,"div",11)(26,"span",12),s(27,"P95 Update Time"),a(),o(28,"span",13),s(29),h(30,"number"),a()(),o(31,"div",11)(32,"span",12),s(33,"Violations"),a(),o(34,"span",13),s(35),a()(),o(36,"div",11)(37,"span",12),s(38,"Hot Paths"),a(),o(39,"span",13),s(40),a()()(),T(41,Fe,5,2,"section",14),o(42,"section",15)(43,"h2"),s(44,"Active Issues"),a(),T(45,ze,2,2,"ul",16)(46,Ae,2,0,"p",5),a(),o(47,"section",17)(48,"h2"),s(49,"Hot Paths"),a(),T(50,Ne,2,2,"ul",18)(51,je,2,0,"p",5),a()}if(e&2){let n,i,r,d,l,c=p();u(18),v(((n=c.stats())==null?null:n.updateCount)??0),u(5),y("",_(24,8,((i=c.stats())==null?null:i.avgUpdateTime)??0,"1.0-2")," ms"),u(6),y("",_(30,11,((r=c.stats())==null?null:r.p95UpdateTime)??0,"1.0-2")," ms"),u(6),v(((d=c.stats())==null?null:d.violationCount)??0),u(5),v(((l=c.stats())==null?null:l.hotPathCount)??0),u(),M(c.budgetEntries().length?41:-1),u(4),M(c.issues().length?45:46),u(5),M(c.hotPaths().length?50:51)}}function We(e,t){e&1&&(o(0,"section",3)(1,"p"),s(2," Guardrails is disabled in production builds. Run "),o(3,"code"),s(4,"pnpm nx serve demo --configuration=development"),a(),s(5," and open "),o(6,"code"),s(7,"/guardrails"),a(),s(8," to explore the live monitoring experience. "),a()())}function Je(e,t){if(e&1&&(o(0,"li"),s(1),a()),e&2){let n=t.$implicit;u(),y(" ",n," ")}}function Xe(e,t){if(e&1&&(o(0,"ul"),S(1,Je,2,1,"li",30),a()),e&2){let n=p();u(),x("ngForOf",n.scenarioLog())("ngForTrackBy",n.trackScenario)}}function Ye(e,t){e&1&&(o(0,"p",5),s(1," Use the controls above to start generating telemetry. "),a())}var ee=class e{config={treeId:"demo-guardrails",mode:"warn",budgets:{maxUpdateTime:6,maxRecomputations:20},hotPaths:{enabled:!0,threshold:3,topN:3,windowMs:1e3},memoryLeaks:{enabled:!1},customRules:[U.noDeepNesting(5),U.noSensitiveData()],reporting:{console:!1,interval:3e3},suppression:{autoSuppress:["hydrate","bulk"]}};initialState={performance:{totalUpdates:0,hotPathCounter:0,lastDuration:0,history:[]},forms:{signup:{email:"jane.doe@example.com"}},events:[]};tree=Q(this.initialState).with(z(this.config));guardrails=this.tree.__guardrails;refreshTimerId;pendingRefresh;nextEventId=1;report=$(this.guardrails?.getReport()??null);issues=R(()=>this.report()?.issues??[]);hotPaths=R(()=>this.report()?.hotPaths??[]);stats=R(()=>this.report()?.stats);budgets=R(()=>this.report()?.budgets??null);guardrailsAvailable=R(()=>!!this.guardrails);scenarioLog=$([]);constructor(){this.guardrails?(this.refreshTimerId=setInterval(()=>this.refreshReport(),this.config.reporting?.interval??3e3),this.refreshReport()):(this.refreshTimerId=void 0,this.recordScenario("Guardrails enhancer runs only in dev builds."))}ngOnDestroy(){this.refreshTimerId&&clearInterval(this.refreshTimerId),this.pendingRefresh&&clearTimeout(this.pendingRefresh),this.guardrails?.dispose()}runHealthyScenario(){if(!this.guardrails){this.recordScenario("Guardrails API unavailable in production builds.");return}let t=Number((Math.random()*2+1).toFixed(2));this.tree(n=>C(b({},n),{performance:{totalUpdates:n.performance.totalUpdates+1,hotPathCounter:n.performance.hotPathCounter,lastDuration:t,history:[...n.performance.history.slice(-9),t]},events:this.appendEvent(n.events,`Baseline update captured (${t.toFixed(2)}ms)`,"info")})),this.recordScenario("Captured baseline update for reference."),this.scheduleRefresh()}triggerHotPath(){if(!this.guardrails){this.recordScenario("Guardrails API unavailable in production builds.");return}for(let t=0;t<6;t++)this.tree(n=>C(b({},n),{performance:{totalUpdates:n.performance.totalUpdates+1,hotPathCounter:n.performance.hotPathCounter+1,lastDuration:1,history:[...n.performance.history.slice(-9),1]},events:this.appendEvent(n.events,`Hot path tick ${n.performance.hotPathCounter+1}`,"warning")}));this.recordScenario("Triggered hot path by firing repeated updates."),this.scheduleRefresh()}triggerBudgetBreach(){if(!this.guardrails){this.recordScenario("Guardrails API unavailable in production builds.");return}let t=12,n=performance.now();for(;performance.now()-n<t;);let i=Number((performance.now()-n).toFixed(2));this.tree(r=>C(b({},r),{performance:{totalUpdates:r.performance.totalUpdates+1,hotPathCounter:r.performance.hotPathCounter,lastDuration:i,history:[...r.performance.history.slice(-9),i]},events:this.appendEvent(r.events,`Budget stress test (${i.toFixed(2)}ms)`,"warning")})),this.recordScenario("Simulated a heavy update to exceed budget thresholds."),this.scheduleRefresh()}triggerRuleViolation(){if(!this.guardrails){this.recordScenario("Guardrails API unavailable in production builds.");return}this.tree(t=>C(b({},t),{forms:{signup:C(b({},t.forms.signup),{authToken:`token-${Math.random().toString(36).slice(2)}`})},events:this.appendEvent(t.events,"Injected sensitive token to demonstrate rule enforcement.","error")})),this.recordScenario("Triggered custom rule violation (noSensitiveData)."),this.scheduleRefresh()}runSuppressedScenario(){if(!this.guardrails){this.recordScenario("Guardrails API unavailable in production builds.");return}this.guardrails.suppress(()=>{this.tree(t=>C(b({},t),{forms:{signup:C(b({},t.forms.signup),{email:`bulk-${Date.now()}@example.com`})},events:this.appendEvent(t.events,"Bulk hydrate executed with guardrails suppressed.","info")}))}),this.recordScenario("Ran hydrate workflow with guardrails suppressed."),this.scheduleRefresh()}resetDemo(){if(!this.guardrails){this.recordScenario("Guardrails API unavailable in production builds.");return}this.tree(()=>({performance:{totalUpdates:0,hotPathCounter:0,lastDuration:0,history:[]},forms:{signup:{email:this.initialState.forms.signup.email}},events:[]})),this.nextEventId=1,this.scenarioLog.set([]),this.recordScenario("Reset demo state and cleared events."),this.scheduleRefresh()}reportTimestamp(){let t=this.report()?.timestamp;return t?new Date(t).toLocaleTimeString():null}budgetEntries(){let t=this.budgets();return t?[{key:"updateTime",label:"Update Time",status:this.statusFromBudget(t.updateTime.status),usage:t.updateTime.usage,current:t.updateTime.current,limit:t.updateTime.limit},{key:"recomputations",label:"Recomputations",status:this.statusFromBudget(t.recomputations.status),usage:t.recomputations.usage,current:t.recomputations.current,limit:t.recomputations.limit},{key:"memory",label:"Memory",status:this.statusFromBudget(t.memory.status),usage:t.memory.usage,current:t.memory.current,limit:t.memory.limit}]:[]}issueSeverityClass(t){return`issue-${t.severity}`}formatHotPathLabel(t){return`${t.path} \xB7 ${t.updatesPerSecond.toFixed(1)} updates/s`}refreshReport(){this.guardrails&&this.report.set(this.guardrails.getReport())}scheduleRefresh(){this.guardrails&&(this.pendingRefresh&&clearTimeout(this.pendingRefresh),this.pendingRefresh=setTimeout(()=>{this.refreshReport(),this.pendingRefresh=void 0},120))}appendEvent(t,n,i){let r={id:this.nextEventId++,description:n,level:i,timestamp:Date.now()};return[...t.slice(-5),r]}recordScenario(t){this.scenarioLog.update(n=>[t,...n].slice(0,6))}statusFromBudget(t){return t==="ok"?"ok":t==="exceeded"?"error":"warning"}trackBudget(t,n){return n.key}trackIssue(t,n){return`${n.type}:${n.path??"root"}:${n.message}`}trackHotPath(t,n){return n.path}trackScenario(t,n){return n}static \u0275fac=function(n){return new(n||e)};static \u0275cmp=A({type:e,selectors:[["app-guardrails-monitoring"]],decls:14,vars:3,consts:[[1,"guardrails-page"],[1,"page-header"],["class","report-timestamp",4,"ngIf"],[1,"prod-message"],[1,"scenario-log"],[1,"empty-state"],[1,"report-timestamp"],[1,"action-panel"],["type","button",3,"click"],["type","button",1,"secondary",3,"click"],[1,"metrics-grid"],[1,"metric-card"],[1,"metric-label"],[1,"metric-value"],[1,"budget-section"],[1,"issues-section"],[1,"issues-list"],[1,"hotpaths-section"],[1,"hotpaths-list"],[1,"budget-grid"],["class","budget-card",3,"budget-warning","budget-error",4,"ngFor","ngForOf","ngForTrackBy"],[1,"budget-card"],[1,"budget-label"],[1,"budget-usage"],[1,"budget-detail"],[3,"class",4,"ngFor","ngForOf","ngForTrackBy"],[1,"issue-header"],[1,"issue-message"],[1,"issue-count"],[1,"issue-meta"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"hotpath-title"],[1,"hotpath-meta"]],template:function(n,i){n&1&&(o(0,"div",0)(1,"header",1)(2,"h1"),s(3,"\u{1F6E1}\uFE0F Guardrails Monitoring"),a(),o(4,"p"),s(5," Guardrails is a development-only enhancer that surfaces performance budgets, hot paths, and custom rule violations without impacting production builds. Use the controls below to generate activity and watch the live telemetry update. "),a(),S(6,Be,4,1,"p",2),a(),T(7,Ke,52,14)(8,We,9,0,"section",3),o(9,"section",4)(10,"h2"),s(11,"Scenario Log"),a(),T(12,Xe,2,2,"ul")(13,Ye,2,0,"p",5),a()()),n&2&&(u(6),x("ngIf",i.reportTimestamp()),u(),M(i.guardrailsAvailable()?7:8),u(5),M(i.scenarioLog().length?12:13))},dependencies:[q,J,X,Y],styles:[".guardrails-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;padding:2rem 1.5rem 4rem;max-width:1200px;margin:0 auto;color:#0f172a}.page-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;margin:0}.page-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#334155;line-height:1.6}.page-header[_ngcontent-%COMP%]   .report-timestamp[_ngcontent-%COMP%]{font-size:.9rem;color:#1d4ed8}.action-panel[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.75rem}.action-panel[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.6rem 1.2rem;border-radius:.6rem;border:1px solid #1d4ed8;background:#1d4ed8;color:#fff;font-weight:600;cursor:pointer;transition:transform .1s ease,box-shadow .1s ease}.action-panel[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 8px 20px #1d4ed826}.action-panel[_ngcontent-%COMP%]   button.secondary[_ngcontent-%COMP%]{background:#e2e8f0;color:#0f172a;border-color:#cbd5f5}.metrics-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:1rem}.metrics-grid[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]{background:#f8fafc;border-radius:.9rem;padding:1.1rem;border:1px solid #e2e8f0;display:flex;flex-direction:column;gap:.4rem}.metrics-grid[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .metric-label[_ngcontent-%COMP%]{font-size:.85rem;text-transform:uppercase;color:#475569;letter-spacing:.03em}.metrics-grid[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .metric-value[_ngcontent-%COMP%]{font-size:1.6rem;font-weight:700;color:#0f172a}.budget-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:.75rem;font-size:1.4rem}.budget-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem}.budget-card[_ngcontent-%COMP%]{background:#f1f5f9;border-radius:.85rem;padding:1rem;border:1px solid #e2e8f0;display:flex;flex-direction:column;gap:.4rem}.budget-card.budget-warning[_ngcontent-%COMP%]{border-color:#fbbf24;background:#fef3c7}.budget-card.budget-error[_ngcontent-%COMP%]{border-color:#f87171;background:#fee2e2}.budget-card[_ngcontent-%COMP%]   .budget-label[_ngcontent-%COMP%]{font-weight:600;color:#0f172a}.budget-card[_ngcontent-%COMP%]   .budget-usage[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700}.budget-card[_ngcontent-%COMP%]   .budget-detail[_ngcontent-%COMP%]{font-size:.85rem;color:#475569}.issues-section[_ngcontent-%COMP%], .hotpaths-section[_ngcontent-%COMP%], .scenario-log[_ngcontent-%COMP%]{background:#f8fafc;border-radius:1rem;padding:1.25rem;border:1px solid #e2e8f0}.issues-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .hotpaths-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .scenario-log[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:0;margin-bottom:1rem;font-size:1.3rem}.issues-list[_ngcontent-%COMP%], .hotpaths-list[_ngcontent-%COMP%], .scenario-log[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding-left:1.1rem;display:flex;flex-direction:column;gap:.75rem}.issues-list[_ngcontent-%COMP%]{list-style:none;padding-left:0}.issues-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{border-radius:.75rem;padding:.9rem 1rem;border:1px solid transparent;background:#fff;box-shadow:0 1px 3px #0f172a0d}.issues-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .issue-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.4rem}.issues-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .issue-message[_ngcontent-%COMP%]{font-weight:600}.issues-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .issue-count[_ngcontent-%COMP%], .issues-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .issue-meta[_ngcontent-%COMP%]{font-size:.85rem;color:#475569}.issues-list[_ngcontent-%COMP%]   .issue-warning[_ngcontent-%COMP%]{border-color:#fbbf24;background:#fefce8}.issues-list[_ngcontent-%COMP%]   .issue-error[_ngcontent-%COMP%]{border-color:#f87171;background:#fef2f2}.issues-list[_ngcontent-%COMP%]   .issue-info[_ngcontent-%COMP%]{border-color:#93c5fd;background:#eff6ff}.hotpaths-list[_ngcontent-%COMP%]{list-style:none;padding-left:0}.hotpaths-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:.85rem 1rem;border-radius:.75rem;border:1px solid #e2e8f0;background:#fff}.hotpaths-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .hotpath-title[_ngcontent-%COMP%]{font-weight:600;margin-bottom:.3rem}.hotpaths-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .hotpath-meta[_ngcontent-%COMP%]{font-size:.9rem;color:#475569}.prod-message[_ngcontent-%COMP%]{background:#eff6ff;border:1px dashed #60a5fa;border-radius:.9rem;padding:1.2rem;color:#1d4ed8;line-height:1.6}.prod-message[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background:#3b82f61f;padding:.15rem .35rem;border-radius:.4rem;font-family:Fira Code,monospace;font-size:.85rem}.empty-state[_ngcontent-%COMP%]{margin:0;color:#64748b;font-style:italic}.scenario-log[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding-left:0}.scenario-log[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:.6rem .75rem;border-left:3px solid #1d4ed8;background:#fff;border-radius:.5rem;margin-left:0;box-shadow:0 1px 2px #0f172a0d}@media (max-width: 768px){.guardrails-page[_ngcontent-%COMP%]{padding:1.5rem 1rem 3rem}.action-panel[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 100%}}"],changeDetection:0})};export{ee as GuardrailsMonitoringComponent};
