import{a as Y,c as Z,i as Q}from"./chunk-3DDI6FWM.js";import{Ab as S,Cb as g,Gc as J,Hc as X,Ja as c,Jb as V,Kb as z,Lb as o,Mb as v,Nb as C,Ob as j,Pb as q,Ya as H,ab as G,ac as f,cc as h,ha as P,hc as x,ia as T,ib as M,jb as w,ob as O,pb as s,qb as a,sa as F,yb as L,yc as K,zc as W}from"./chunk-YYEXL5C7.js";import{a as b,b as _}from"./chunk-A3ECCK3J.js";function ne(e){return typeof e=="function"}function A(e){return typeof e=="object"&&e!==null}function ge(e){if(e===void 0)return!0;if(ne(e))try{return e()}catch{return!0}return e}function E(e){let t=globalThis.structuredClone;if(ne(t))try{return t(e)}catch{}try{return JSON.parse(JSON.stringify(e))}catch{return e}}function me(){return __DEV__!==void 0?__DEV__:!1}var fe=1e3,he=1e3,be=50;function I(e={}){return function(t){let n=ge(e.enabled);if(!me()||!n)return t;let r=ye(),i={tree:t,config:e,stats:r,issues:[],hotPaths:[],currentUpdate:null,suppressed:!1,timings:[],hotPathData:new Map,issueMap:new Map,signalUsage:new Map,pathRecomputations:new Map,memoryHistory:[],recomputationLog:[],previousState:E(t()),disposed:!1};t.__devHooks={onRecompute:(m,k)=>{if(!i.disposed&&!i.suppressed){Te(m,i,k,Date.now());let y=e.budgets?.maxRecomputations;y&&i.stats.recomputationCount>y&&R(i,{type:"budget",severity:"error",message:`Recomputation budget exceeded: ${i.stats.recomputationCount} > ${y}`,path:m,count:1})}}};let u=_e(i),l=Se(i),d=()=>{i.disposed||(i.disposed=!0,u(),l())},p=t.destroy?.bind(t);return t.destroy=()=>{d(),p&&p()},t.__guardrails=Ue(i,d),t}}var et=Object.assign(I,{});function _e(e){if(!e.config.changeDetection?.disablePathNotifier)try{let t=Z();if(t)return t.subscribe("**",(r,i,u)=>{ve(e,u,r,i)})}catch{}try{let t=e.tree.subscribe;if(typeof t=="function")return t.call(e.tree,()=>{ie(e)})}catch{}return Ce(e)}function ve(e,t,n,r){if(e.disposed||e.suppressed)return;let i=performance.now(),u=Date.now(),l={path:t,segments:t.split("."),oldValue:r,newValue:n};oe(e,l,{});let d=performance.now()-i,p=ae(r,n);se(e,l,d,p,!0),ue(e,t,d),le(e,t,u),ce(e,d),de(e,u),e.previousState=E(e.tree())}function ie(e){if(e.disposed||e.suppressed)return;let t=e.tree(),n=e.previousState;if(!n){e.previousState=E(t);return}if(!Y(t,n)){let i=performance.now(),u=Date.now(),l=re(n,t);for(let p of l){let m={path:p,segments:p.split("."),oldValue:ee(n,p.split(".")),newValue:ee(t,p.split("."))};oe(e,m,{});let k=performance.now()-i,y=ae(m.oldValue,m.newValue);se(e,m,k,y,!0),ue(e,p,k),le(e,p,u)}let d=performance.now()-i;ce(e,d),de(e,u),e.previousState=E(t)}}function Ce(e){let t=()=>{ie(e)};return e.pollingIntervalId=setInterval(t,be),()=>{e.pollingIntervalId&&(clearInterval(e.pollingIntervalId),e.pollingIntervalId=void 0)}}function re(e,t,n=""){let r=[],i=new Set([...Object.keys(e||{}),...Object.keys(t||{})]);for(let u of i){let l=n?`${n}.${u}`:u,d=e?.[u],p=t?.[u];d!==p&&(A(d)&&A(p)&&!Array.isArray(d)&&!Array.isArray(p)?r.push(...re(d,p,l)):r.push(l))}return r}function ye(){return{updateCount:0,totalUpdateTime:0,avgUpdateTime:0,p50UpdateTime:0,p95UpdateTime:0,p99UpdateTime:0,maxUpdateTime:0,recomputationCount:0,recomputationsPerSecond:0,signalCount:0,signalRetention:0,unreadSignalCount:0,memoryGrowthRate:0,hotPathCount:0,violationCount:0}}function Pe(e){if(e.timings.length===0)return;let t=[...e.timings].sort((n,r)=>n-r);e.stats.p50UpdateTime=t[Math.floor(t.length*.5)]||0,e.stats.p95UpdateTime=t[Math.floor(t.length*.95)]||0,e.stats.p99UpdateTime=t[Math.floor(t.length*.99)]||0}function ae(e,t){if(!te(e)||!te(t))return Object.is(e,t)?0:1;if(e===t)return 0;let n=new Set(Object.keys(e)),r=new Set(Object.keys(t)),i=new Set([...n,...r]),u=0;for(let l of i)(!n.has(l)||!r.has(l)||e[l]!==t[l])&&u++;return i.size===0?0:u/i.size}function oe(e,t,n){if(e.config.customRules)for(let r of e.config.customRules)we(e,r,{path:t.segments,value:t.newValue,oldValue:t.oldValue,metadata:n,tree:e.tree,stats:e.stats})}function se(e,t,n,r,i){i&&e.config.budgets?.maxUpdateTime&&n>e.config.budgets.maxUpdateTime&&R(e,{type:"budget",severity:"error",message:`Update took ${n.toFixed(2)}ms (budget: ${e.config.budgets.maxUpdateTime}ms)`,path:t.path,count:1});let u=e.config.analysis?.minDiffForParentReplace??.8;e.config.analysis?.warnParentReplace&&r>u&&R(e,{type:"analysis",severity:"warning",message:`High diff ratio (${(r*100).toFixed(0)}%) - consider scoped updates`,path:t.path,count:1,diffRatio:r})}function ue(e,t,n){if(!e.config.hotPaths?.enabled)return;let r=Array.isArray(t)?t.join("."):t,i=Date.now(),u=e.config.hotPaths.windowMs||1e3,l=e.hotPathData.get(r);l||(l={count:0,lastUpdate:i,durations:[]},e.hotPathData.set(r,l)),i-l.lastUpdate>u&&(l.count=0,l.durations=[]),l.count++,l.durations.push(n),l.lastUpdate=i;let d=e.config.hotPaths.threshold||10,p=l.count/u*1e3;if(p>d){let m=[...l.durations].sort((U,$)=>U-$),k=m[Math.floor(m.length*.95)]||0,y=l.durations.reduce((U,$)=>U+$,0)/l.durations.length;Me(e,{path:r,updatesPerSecond:p,heatScore:Math.min(100,p/d*50),downstreamEffects:0,avgDuration:y,p95Duration:k})}}function le(e,t,n){let r=Array.isArray(t)?t.join("."):t,i=e.signalUsage.get(r)??{updates:0,lastSeen:n};i.updates+=1,i.lastSeen=n,e.signalUsage.set(r,i)}function de(e,t){let n=e.config.memoryLeaks?.checkInterval??5e3,r=Math.max(n,1e3),i=e.signalUsage.size;e.stats.signalCount=i;let u=[...e.signalUsage.values()].filter(p=>t-p.lastSeen>n).length;e.stats.signalRetention=u,e.stats.unreadSignalCount=0,e.memoryHistory.push({timestamp:t,count:i}),e.memoryHistory=e.memoryHistory.filter(p=>t-p.timestamp<=r);let l=e.memoryHistory[0]?.count??i,d=l===0?0:(i-l)/Math.max(1,l);e.stats.memoryGrowthRate=d}function Te(e,t,n,r){let i=t.pathRecomputations.get(e)??0;if(t.pathRecomputations.set(e,i+n),n>0){t.stats.recomputationCount+=n;for(let u=0;u<n;u++)t.recomputationLog.push(r)}t.recomputationLog.length&&(t.recomputationLog=t.recomputationLog.filter(u=>r-u<=he)),t.stats.recomputationsPerSecond=t.recomputationLog.length}function Me(e,t){let n=e.hotPaths.find(r=>r.path===t.path);if(n)Object.assign(n,t);else{e.hotPaths.push(t);let r=e.config.hotPaths?.topN||5;e.hotPaths.length>r&&(e.hotPaths.sort((i,u)=>u.heatScore-i.heatScore),e.hotPaths.length=r)}e.stats.hotPathCount=e.hotPaths.length}function we(e,t,n){let r=()=>{let i=typeof t.message=="function"?t.message(n):t.message;R(e,{type:"rule",severity:t.severity||"warning",message:i,path:n.path.join("."),count:1,metadata:{rule:t.name}})};try{let i=t.test(n);if(i instanceof Promise){i.then(u=>{u||r()}).catch(u=>{console.warn(`[Guardrails] Rule ${t.name} rejected:`,u)});return}i||r()}catch(i){console.warn(`[Guardrails] Rule ${t.name} threw error:`,i)}}function R(e,t){if(!e.suppressed){if(e.config.reporting?.aggregateWarnings!==!1){let n=`${t.type}:${t.path}:${t.message}`,r=e.issueMap.get(n);if(r){r.count++;return}e.issueMap.set(n,t)}else{let n=`${t.type}:${t.path}:${t.message}:${Date.now()}:${Math.random()}`;e.issueMap.set(n,t)}if(e.config.mode==="throw")throw new Error(`[Guardrails] ${t.message}`)}}function Se(e){let t=setInterval(()=>{if(e.disposed){clearInterval(t);return}ke(e),Ge(e)},e.config.reporting?.interval||5e3);return()=>clearInterval(t)}function ke(e){if(!e.config.memoryLeaks?.enabled)return;let t=Date.now(),n=e.config.memoryLeaks?.checkInterval??5e3,r=e.config.memoryLeaks?.retentionThreshold??100,i=e.config.memoryLeaks?.growthRate??.2,u=[...e.signalUsage.values()].filter(p=>t-p.lastSeen>n).length;e.stats.signalRetention=u;let l=e.stats.signalRetention>r,d=e.stats.memoryGrowthRate>i;(l||d)&&R(e,{type:"memory",severity:"warning",message:`Potential memory leak detected (signals: ${e.stats.signalCount}, growth ${(e.stats.memoryGrowthRate*100).toFixed(1)}%)`,path:"root",count:1,metadata:{signalCount:e.stats.signalCount,growth:e.stats.memoryGrowthRate}})}function Ge(e){if(e.config.reporting?.console===!1)return;let t=N(e);e.config.reporting?.customReporter&&e.config.reporting.customReporter(t),e.config.reporting?.console&&e.issues.length>0&&Oe(t,e.config.reporting.console==="verbose"),e.issues=[],e.issueMap.clear()}function Oe(e,t){console.group("[Guardrails] Performance Report"),xe(e.issues),Re(e.hotPaths),t&&Ee(e),console.groupEnd()}function xe(e){if(e.length!==0){console.warn(`${e.length} issues detected:`);for(let t of e){let n=Ie(t.severity),r=t.count>1?` (x${t.count})`:"",i=`${n} [${t.type}] ${t.message}${r}`;console.log(`  ${i}`)}}}function Re(e){if(e.length!==0){console.log(`
Hot Paths (${e.length}):`);for(let t of e){let n=`  \u{1F525} ${t.path}: ${t.updatesPerSecond.toFixed(1)}/s (heat: ${t.heatScore.toFixed(0)})`;console.log(n)}}}function Ee(e){console.log(`
Stats:`,e.stats),console.log("Budgets:",e.budgets)}function Ie(e){return e==="error"?"\u274C":e==="warning"?"\u26A0\uFE0F":"\u2139\uFE0F"}function N(e){let t=e.stats.signalCount,n=e.config.budgets?.maxMemory??50,r=e.stats.recomputationsPerSecond,i=e.config.budgets?.maxRecomputations??100,u={updateTime:B(e.stats.avgUpdateTime,e.config.budgets?.maxUpdateTime||16),memory:B(t,n),recomputations:B(r,i)};return{timestamp:Date.now(),treeId:e.config.treeId,issues:Array.from(e.issueMap.values()),hotPaths:e.hotPaths,budgets:u,stats:e.stats,recommendations:De(e)}}function B(e,t){if(t<=0)return{current:e,limit:t,usage:0,status:"ok"};let n=e/t*100,r=80,i;return n>100?i="exceeded":n>r?i="warning":i="ok",{current:e,limit:t,usage:n,status:i}}function De(e){let t=[];return e.hotPaths.length>0&&t.push("Consider batching or debouncing updates to hot paths"),e.stats.avgUpdateTime>10&&t.push("Average update time is high - review update logic"),t}function Ue(e,t){return{getReport:()=>N(e),getStats:()=>e.stats,suppress:n=>{let r=e.suppressed;e.suppressed=!0;try{n()}finally{e.suppressed=r}},dispose:()=>{t();let n=N(e);e.config.reporting?.console!==!1&&console.log("[Guardrails] Final report on disposal:",n),e.config.reporting?.customReporter&&e.config.reporting.customReporter(n)}}}function ee(e,t){let n=e;for(let r of t){if(!A(n))return;n=n[r]}return n}function $e(e){if(!e||typeof e!="object")return!1;let t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}function ce(e,t){e.timings.push(t),e.timings.length>fe&&e.timings.shift(),e.stats.updateCount++,e.stats.totalUpdateTime+=t,e.stats.avgUpdateTime=e.stats.totalUpdateTime/e.stats.updateCount,e.stats.maxUpdateTime=Math.max(e.stats.maxUpdateTime,t),Pe(e)}function te(e){return $e(e)}var D={noDeepNesting:(e=5)=>({name:"no-deep-nesting",description:`Prevents nesting deeper than ${e} levels`,test:t=>t.path.length<=e,message:t=>`Path too deep: ${t.path.join(".")} (${t.path.length} levels, max: ${e})`,severity:"warning",tags:["architecture","complexity"]}),noFunctionsInState:()=>({name:"no-functions",description:"Functions break serialization",test:e=>typeof e.value!="function",message:"Functions cannot be stored in state (breaks serialization)",severity:"error",tags:["serialization","data"]}),noCacheInPersistence:()=>({name:"no-cache-persistence",description:"Prevent cache from being persisted",test:e=>!(e.metadata?.source==="serialization"&&e.path.includes("cache")),message:"Cache should not be persisted",severity:"warning",tags:["persistence","cache"]}),maxPayloadSize:(e=100)=>({name:"max-payload-size",description:`Limit payload size to ${e}KB`,test:t=>{try{return JSON.stringify(t.value).length<e*1024}catch{return!0}},message:t=>`Payload size ${(JSON.stringify(t.value).length/1024).toFixed(1)}KB exceeds limit of ${e}KB`,severity:"warning",tags:["performance","data"]}),noSensitiveData:(e=["password","token","secret","apiKey"])=>({name:"no-sensitive-data",description:"Prevents storing sensitive data",test:t=>!t.path.some(n=>e.some(r=>typeof n=="string"&&n.toLowerCase().includes(r.toLowerCase()))),message:t=>`Sensitive data detected in path: ${t.path.join(".")}`,severity:"error",tags:["security","data"]})};function Fe(e,t){if(e&1&&(s(0,"p",10),o(1," Last report generated at "),s(2,"strong"),o(3),a()()),e&2){let n=t.ngIf;c(3),v(n)}}function Be(e,t){if(e&1&&(s(0,"div",25)(1,"div",26),o(2),a(),s(3,"div",27),o(4),f(5,"number"),a(),s(6,"div",28),o(7),f(8,"number"),f(9,"number"),a()()),e&2){let n=t.$implicit;V("budget-warning",n.status==="warning")("budget-error",n.status==="error"),c(2),v(n.label),c(2),C("",h(5,8,n.usage,"1.0-0"),"%"),c(3),j(" ",h(8,11,n.current,"1.0-2")," / ",h(9,14,n.limit,"1.0-2")," ")}}function Ae(e,t){if(e&1&&(s(0,"section",18)(1,"h2"),o(2,"Budget Usage"),a(),s(3,"div",23),G(4,Be,10,17,"div",24),a()()),e&2){let n=g(2);c(4),O("ngForOf",n.budgetEntries())("ngForTrackBy",n.trackBudget)}}function Ne(e,t){if(e&1&&o(0),e&2){let n=g().$implicit;C(" \xB7 Rule: ",n.metadata==null?null:n.metadata.rule," ")}}function He(e,t){if(e&1&&(s(0,"li")(1,"div",30)(2,"span",31),o(3),a(),s(4,"span",32),o(5),a()(),s(6,"div",33),o(7),M(8,Ne,1,1),a()()),e&2){let n=t.$implicit,r=g(3);z(r.issueSeverityClass(n)),c(3),v(n.message),c(2),C("\xD7",n.count),c(2),C(" Path: ",n.path||"root"," "),c(),w(n.metadata!=null&&n.metadata.rule?8:-1)}}function Le(e,t){if(e&1&&(s(0,"ul",20),G(1,He,9,6,"li",29),a()),e&2){let n=g(2);c(),O("ngForOf",n.issues())("ngForTrackBy",n.trackIssue)}}function Ve(e,t){e&1&&(s(0,"p",9),o(1," No violations detected \u2014 run a scenario to generate insights. "),a())}function ze(e,t){if(e&1&&(s(0,"li")(1,"div",35),o(2),a(),s(3,"div",36),o(4),f(5,"number"),f(6,"number"),f(7,"number"),a()()),e&2){let n=t.$implicit,r=g(3);c(2),v(r.formatHotPathLabel(n)),c(2),q(" Heat: ",h(5,4,n.heatScore,"1.0-0")," \xB7 Avg: ",h(6,7,n.avgDuration,"1.0-2")," ms \xB7 P95: ",h(7,10,n.p95Duration,"1.0-2")," ms ")}}function je(e,t){if(e&1&&(s(0,"ul",22),G(1,ze,8,13,"li",34),a()),e&2){let n=g(2);c(),O("ngForOf",n.hotPaths())("ngForTrackBy",n.trackHotPath)}}function qe(e,t){e&1&&(s(0,"p",9),o(1," No hot paths yet \u2014 try the hot path scenario above. "),a())}function Ke(e,t){if(e&1){let n=L();s(0,"section",11)(1,"button",12),S("click",function(){P(n);let i=g();return T(i.runHealthyScenario())}),o(2," Record Baseline Update "),a(),s(3,"button",12),S("click",function(){P(n);let i=g();return T(i.triggerHotPath())}),o(4,"Trigger Hot Path"),a(),s(5,"button",12),S("click",function(){P(n);let i=g();return T(i.triggerBudgetBreach())}),o(6," Stress Budgets "),a(),s(7,"button",12),S("click",function(){P(n);let i=g();return T(i.triggerRuleViolation())}),o(8," Trigger Sensitive Data Rule "),a(),s(9,"button",12),S("click",function(){P(n);let i=g();return T(i.runSuppressedScenario())}),o(10," Run Suppressed Hydrate "),a(),s(11,"button",13),S("click",function(){P(n);let i=g();return T(i.resetDemo())}),o(12," Reset Demo "),a()(),s(13,"section",14)(14,"div",15)(15,"span",16),o(16,"Total Updates"),a(),s(17,"span",17),o(18),a()(),s(19,"div",15)(20,"span",16),o(21,"Avg Update Time"),a(),s(22,"span",17),o(23),f(24,"number"),a()(),s(25,"div",15)(26,"span",16),o(27,"P95 Update Time"),a(),s(28,"span",17),o(29),f(30,"number"),a()(),s(31,"div",15)(32,"span",16),o(33,"Violations"),a(),s(34,"span",17),o(35),a()(),s(36,"div",15)(37,"span",16),o(38,"Hot Paths"),a(),s(39,"span",17),o(40),a()()(),M(41,Ae,5,2,"section",18),s(42,"section",19)(43,"h2"),o(44,"Active Issues"),a(),M(45,Le,2,2,"ul",20)(46,Ve,2,0,"p",9),a(),s(47,"section",21)(48,"h2"),o(49,"Hot Paths"),a(),M(50,je,2,2,"ul",22)(51,qe,2,0,"p",9),a()}if(e&2){let n,r,i,u,l,d=g();c(18),v(((n=d.stats())==null?null:n.updateCount)??0),c(5),C("",h(24,8,((r=d.stats())==null?null:r.avgUpdateTime)??0,"1.0-2")," ms"),c(6),C("",h(30,11,((i=d.stats())==null?null:i.p95UpdateTime)??0,"1.0-2")," ms"),c(6),v(((u=d.stats())==null?null:u.violationCount)??0),c(5),v(((l=d.stats())==null?null:l.hotPathCount)??0),c(),w(d.budgetEntries().length?41:-1),c(4),w(d.issues().length?45:46),c(5),w(d.hotPaths().length?50:51)}}function We(e,t){e&1&&(s(0,"section",7)(1,"p"),o(2," Guardrails is disabled in production builds. Run "),s(3,"code"),o(4,"pnpm nx serve demo --configuration=development"),a(),o(5," and open "),s(6,"code"),o(7,"/guardrails"),a(),o(8," to explore the live monitoring experience. "),a()())}function Je(e,t){if(e&1&&(s(0,"li"),o(1),a()),e&2){let n=t.$implicit;c(),C(" ",n," ")}}function Xe(e,t){if(e&1&&(s(0,"ul"),G(1,Je,2,1,"li",34),a()),e&2){let n=g();c(),O("ngForOf",n.scenarioLog())("ngForTrackBy",n.trackScenario)}}function Ye(e,t){e&1&&(s(0,"p",9),o(1," Use the controls above to start generating telemetry. "),a())}var pe=class e{config={treeId:"demo-guardrails",mode:"warn",budgets:{maxUpdateTime:6,maxRecomputations:20},hotPaths:{enabled:!0,threshold:3,topN:3,windowMs:1e3},memoryLeaks:{enabled:!1},customRules:[D.noDeepNesting(5),D.noSensitiveData()],reporting:{console:!1,interval:3e3},suppression:{autoSuppress:["hydrate","bulk"]}};initialState={performance:{totalUpdates:0,hotPathCounter:0,lastDuration:0,history:[]},forms:{signup:{email:"jane.doe@example.com"}},events:[]};tree=Q(this.initialState).with(I(this.config));guardrails=this.tree.__guardrails;refreshTimerId;pendingRefresh;nextEventId=1;report=F(this.guardrails?.getReport()??null);issues=x(()=>this.report()?.issues??[]);hotPaths=x(()=>this.report()?.hotPaths??[]);stats=x(()=>this.report()?.stats);budgets=x(()=>this.report()?.budgets??null);guardrailsAvailable=x(()=>!!this.guardrails);scenarioLog=F([]);constructor(){this.guardrails?(this.refreshTimerId=setInterval(()=>this.refreshReport(),this.config.reporting?.interval??3e3),this.refreshReport()):(this.refreshTimerId=void 0,this.recordScenario("Guardrails enhancer runs only in dev builds."))}ngOnDestroy(){this.refreshTimerId&&clearInterval(this.refreshTimerId),this.pendingRefresh&&clearTimeout(this.pendingRefresh),this.guardrails?.dispose()}runHealthyScenario(){if(!this.guardrails){this.recordScenario("Guardrails API unavailable in production builds.");return}let t=Number((Math.random()*2+1).toFixed(2));this.tree(n=>_(b({},n),{performance:{totalUpdates:n.performance.totalUpdates+1,hotPathCounter:n.performance.hotPathCounter,lastDuration:t,history:[...n.performance.history.slice(-9),t]},events:this.appendEvent(n.events,`Baseline update captured (${t.toFixed(2)}ms)`,"info")})),this.recordScenario("Captured baseline update for reference."),this.scheduleRefresh()}triggerHotPath(){if(!this.guardrails){this.recordScenario("Guardrails API unavailable in production builds.");return}for(let t=0;t<6;t++)this.tree(n=>_(b({},n),{performance:{totalUpdates:n.performance.totalUpdates+1,hotPathCounter:n.performance.hotPathCounter+1,lastDuration:1,history:[...n.performance.history.slice(-9),1]},events:this.appendEvent(n.events,`Hot path tick ${n.performance.hotPathCounter+1}`,"warning")}));this.recordScenario("Triggered hot path by firing repeated updates."),this.scheduleRefresh()}triggerBudgetBreach(){if(!this.guardrails){this.recordScenario("Guardrails API unavailable in production builds.");return}let t=12,n=performance.now();for(;performance.now()-n<t;);let r=Number((performance.now()-n).toFixed(2));this.tree(i=>_(b({},i),{performance:{totalUpdates:i.performance.totalUpdates+1,hotPathCounter:i.performance.hotPathCounter,lastDuration:r,history:[...i.performance.history.slice(-9),r]},events:this.appendEvent(i.events,`Budget stress test (${r.toFixed(2)}ms)`,"warning")})),this.recordScenario("Simulated a heavy update to exceed budget thresholds."),this.scheduleRefresh()}triggerRuleViolation(){if(!this.guardrails){this.recordScenario("Guardrails API unavailable in production builds.");return}this.tree(t=>_(b({},t),{forms:{signup:_(b({},t.forms.signup),{authToken:`token-${Math.random().toString(36).slice(2)}`})},events:this.appendEvent(t.events,"Injected sensitive token to demonstrate rule enforcement.","error")})),this.recordScenario("Triggered custom rule violation (noSensitiveData)."),this.scheduleRefresh()}runSuppressedScenario(){if(!this.guardrails){this.recordScenario("Guardrails API unavailable in production builds.");return}this.guardrails.suppress(()=>{this.tree(t=>_(b({},t),{forms:{signup:_(b({},t.forms.signup),{email:`bulk-${Date.now()}@example.com`})},events:this.appendEvent(t.events,"Bulk hydrate executed with guardrails suppressed.","info")}))}),this.recordScenario("Ran hydrate workflow with guardrails suppressed."),this.scheduleRefresh()}resetDemo(){if(!this.guardrails){this.recordScenario("Guardrails API unavailable in production builds.");return}this.tree(()=>({performance:{totalUpdates:0,hotPathCounter:0,lastDuration:0,history:[]},forms:{signup:{email:this.initialState.forms.signup.email}},events:[]})),this.nextEventId=1,this.scenarioLog.set([]),this.recordScenario("Reset demo state and cleared events."),this.scheduleRefresh()}reportTimestamp(){let t=this.report()?.timestamp;return t?new Date(t).toLocaleTimeString():null}budgetEntries(){let t=this.budgets();return t?[{key:"updateTime",label:"Update Time",status:this.statusFromBudget(t.updateTime.status),usage:t.updateTime.usage,current:t.updateTime.current,limit:t.updateTime.limit},{key:"recomputations",label:"Recomputations",status:this.statusFromBudget(t.recomputations.status),usage:t.recomputations.usage,current:t.recomputations.current,limit:t.recomputations.limit},{key:"memory",label:"Memory",status:this.statusFromBudget(t.memory.status),usage:t.memory.usage,current:t.memory.current,limit:t.memory.limit}]:[]}issueSeverityClass(t){return`issue-${t.severity}`}formatHotPathLabel(t){return`${t.path} \xB7 ${t.updatesPerSecond.toFixed(1)} updates/s`}refreshReport(){this.guardrails&&this.report.set(this.guardrails.getReport())}scheduleRefresh(){this.guardrails&&(this.pendingRefresh&&clearTimeout(this.pendingRefresh),this.pendingRefresh=setTimeout(()=>{this.refreshReport(),this.pendingRefresh=void 0},120))}appendEvent(t,n,r){let i={id:this.nextEventId++,description:n,level:r,timestamp:Date.now()};return[...t.slice(-5),i]}recordScenario(t){this.scenarioLog.update(n=>[t,...n].slice(0,6))}statusFromBudget(t){return t==="ok"?"ok":t==="exceeded"?"error":"warning"}trackBudget(t,n){return n.key}trackIssue(t,n){return`${n.type}:${n.path??"root"}:${n.message}`}trackHotPath(t,n){return n.path}trackScenario(t,n){return n}static \u0275fac=function(n){return new(n||e)};static \u0275cmp=H({type:e,selectors:[["app-guardrails-monitoring"]],decls:41,vars:3,consts:[[1,"guardrails-page"],[1,"page-header"],[1,"value-proposition"],[1,"key-benefits"],[1,"benefit"],[1,"zero-cost"],["class","report-timestamp",4,"ngIf"],[1,"prod-message"],[1,"scenario-log"],[1,"empty-state"],[1,"report-timestamp"],[1,"action-panel"],["type","button",3,"click"],["type","button",1,"secondary",3,"click"],[1,"metrics-grid"],[1,"metric-card"],[1,"metric-label"],[1,"metric-value"],[1,"budget-section"],[1,"issues-section"],[1,"issues-list"],[1,"hotpaths-section"],[1,"hotpaths-list"],[1,"budget-grid"],["class","budget-card",3,"budget-warning","budget-error",4,"ngFor","ngForOf","ngForTrackBy"],[1,"budget-card"],[1,"budget-label"],[1,"budget-usage"],[1,"budget-detail"],[3,"class",4,"ngFor","ngForOf","ngForTrackBy"],[1,"issue-header"],[1,"issue-message"],[1,"issue-count"],[1,"issue-meta"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"hotpath-title"],[1,"hotpath-meta"]],template:function(n,r){n&1&&(s(0,"div",0)(1,"header",1)(2,"h1"),o(3,"\u{1F6E1}\uFE0F Guardrails Monitoring"),a(),s(4,"p"),o(5," Guardrails is a development-only enhancer that surfaces performance budgets, hot paths, and custom rule violations without impacting production builds. Use the controls below to generate activity and watch the live telemetry update. "),a(),s(6,"div",2)(7,"h2"),o(8,"\u{1F3AF} Why Development Guardrails Matter"),a(),s(9,"p")(10,"strong"),o(11,"Catch performance issues during development, not in production."),a(),o(12," Most state management libraries provide zero visibility into hot paths, budget violations, or architectural anti-patterns until users complain. Guardrails gives you real-time feedback. "),a(),s(13,"div",3)(14,"div",4)(15,"h3"),o(16,"\u26A1 Performance Budgets"),a(),s(17,"p"),o(18," Set thresholds for update frequency, computation time, and state size. Get warnings before issues reach production. "),a()(),s(19,"div",4)(20,"h3"),o(21,"\u{1F525} Hot Path Detection"),a(),s(22,"p"),o(23," Automatically identify code paths that update too frequently. NgRx/Redux require custom profiling; guardrails show it live. "),a()(),s(24,"div",4)(25,"h3"),o(26,"\u{1F6E1}\uFE0F Custom Rules"),a(),s(27,"p"),o(28," Enforce team conventions (no PII in state, max nesting depth, naming patterns). Violations surface immediately in dev tools. "),a()()(),s(29,"p",5)(30,"strong"),o(31,"Zero production overhead:"),a(),o(32," Guardrails is automatically excluded from production bundles. Akita/Elf DevTools stay in bundles; NgRx requires manual plugin exclusion. Guardrails is 100% dev-only by design. "),a()(),G(33,Fe,4,1,"p",6),a(),M(34,Ke,52,14)(35,We,9,0,"section",7),s(36,"section",8)(37,"h2"),o(38,"Scenario Log"),a(),M(39,Xe,2,2,"ul")(40,Ye,2,0,"p",9),a()()),n&2&&(c(33),O("ngIf",r.reportTimestamp()),c(),w(r.guardrailsAvailable()?34:35),c(5),w(r.scenarioLog().length?39:40))},dependencies:[X,K,W,J],styles:[".guardrails-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;padding:2rem 1.5rem 4rem;max-width:1200px;margin:0 auto;color:#0f172a}.page-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;margin:0}.page-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#334155;line-height:1.6}.page-header[_ngcontent-%COMP%]   .report-timestamp[_ngcontent-%COMP%]{font-size:.9rem;color:#1d4ed8}.action-panel[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.75rem}.action-panel[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.6rem 1.2rem;border-radius:.6rem;border:1px solid #1d4ed8;background:#1d4ed8;color:#fff;font-weight:600;cursor:pointer;transition:transform .1s ease,box-shadow .1s ease}.action-panel[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 8px 20px #1d4ed826}.action-panel[_ngcontent-%COMP%]   button.secondary[_ngcontent-%COMP%]{background:#e2e8f0;color:#0f172a;border-color:#cbd5f5}.metrics-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:1rem}.metrics-grid[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]{background:#f8fafc;border-radius:.9rem;padding:1.1rem;border:1px solid #e2e8f0;display:flex;flex-direction:column;gap:.4rem}.metrics-grid[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .metric-label[_ngcontent-%COMP%]{font-size:.85rem;text-transform:uppercase;color:#475569;letter-spacing:.03em}.metrics-grid[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .metric-value[_ngcontent-%COMP%]{font-size:1.6rem;font-weight:700;color:#0f172a}.budget-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:.75rem;font-size:1.4rem}.budget-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem}.budget-card[_ngcontent-%COMP%]{background:#f1f5f9;border-radius:.85rem;padding:1rem;border:1px solid #e2e8f0;display:flex;flex-direction:column;gap:.4rem}.budget-card.budget-warning[_ngcontent-%COMP%]{border-color:#fbbf24;background:#fef3c7}.budget-card.budget-error[_ngcontent-%COMP%]{border-color:#f87171;background:#fee2e2}.budget-card[_ngcontent-%COMP%]   .budget-label[_ngcontent-%COMP%]{font-weight:600;color:#0f172a}.budget-card[_ngcontent-%COMP%]   .budget-usage[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700}.budget-card[_ngcontent-%COMP%]   .budget-detail[_ngcontent-%COMP%]{font-size:.85rem;color:#475569}.issues-section[_ngcontent-%COMP%], .hotpaths-section[_ngcontent-%COMP%], .scenario-log[_ngcontent-%COMP%]{background:#f8fafc;border-radius:1rem;padding:1.25rem;border:1px solid #e2e8f0}.issues-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .hotpaths-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .scenario-log[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:0;margin-bottom:1rem;font-size:1.3rem}.issues-list[_ngcontent-%COMP%], .hotpaths-list[_ngcontent-%COMP%], .scenario-log[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding-left:1.1rem;display:flex;flex-direction:column;gap:.75rem}.issues-list[_ngcontent-%COMP%]{list-style:none;padding-left:0}.issues-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{border-radius:.75rem;padding:.9rem 1rem;border:1px solid transparent;background:#fff;box-shadow:0 1px 3px #0f172a0d}.issues-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .issue-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.4rem}.issues-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .issue-message[_ngcontent-%COMP%]{font-weight:600}.issues-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .issue-count[_ngcontent-%COMP%], .issues-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .issue-meta[_ngcontent-%COMP%]{font-size:.85rem;color:#475569}.issues-list[_ngcontent-%COMP%]   .issue-warning[_ngcontent-%COMP%]{border-color:#fbbf24;background:#fefce8}.issues-list[_ngcontent-%COMP%]   .issue-error[_ngcontent-%COMP%]{border-color:#f87171;background:#fef2f2}.issues-list[_ngcontent-%COMP%]   .issue-info[_ngcontent-%COMP%]{border-color:#93c5fd;background:#eff6ff}.hotpaths-list[_ngcontent-%COMP%]{list-style:none;padding-left:0}.hotpaths-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:.85rem 1rem;border-radius:.75rem;border:1px solid #e2e8f0;background:#fff}.hotpaths-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .hotpath-title[_ngcontent-%COMP%]{font-weight:600;margin-bottom:.3rem}.hotpaths-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .hotpath-meta[_ngcontent-%COMP%]{font-size:.9rem;color:#475569}.prod-message[_ngcontent-%COMP%]{background:#eff6ff;border:1px dashed #60a5fa;border-radius:.9rem;padding:1.2rem;color:#1d4ed8;line-height:1.6}.prod-message[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background:#3b82f61f;padding:.15rem .35rem;border-radius:.4rem;font-family:Fira Code,monospace;font-size:.85rem}.empty-state[_ngcontent-%COMP%]{margin:0;color:#64748b;font-style:italic}.scenario-log[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding-left:0}.scenario-log[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:.6rem .75rem;border-left:3px solid #1d4ed8;background:#fff;border-radius:.5rem;margin-left:0;box-shadow:0 1px 2px #0f172a0d}@media (max-width: 768px){.guardrails-page[_ngcontent-%COMP%]{padding:1.5rem 1rem 3rem}.action-panel[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 100%}}"],changeDetection:0})};export{pe as GuardrailsMonitoringComponent};
