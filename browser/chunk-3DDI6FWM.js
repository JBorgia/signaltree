import{ga as Ne,gc as te,hc as _,ic as H,ra as I,sa as R}from"./chunk-YYEXL5C7.js";import{a as x,b as L,d as Pe,j as ne}from"./chunk-A3ECCK3J.js";var Se=class{subscribers=new Map;interceptors=new Map;batchingEnabled=!0;pendingFlush=!1;pending=new Map;firstValues=new Map;flushCallbacks=new Set;constructor(e){e&&e.batching===!1&&(this.batchingEnabled=!1)}setBatchingEnabled(e){this.batchingEnabled=e}isBatchingEnabled(){return this.batchingEnabled}subscribe(e,r){this.subscribers.has(e)||this.subscribers.set(e,new Set);let t=this.subscribers.get(e);return t?(t.add(r),()=>{t.delete(r),t.size===0&&this.subscribers.delete(e)}):()=>{}}intercept(e,r){this.interceptors.has(e)||this.interceptors.set(e,new Set);let t=this.interceptors.get(e);return t?(t.add(r),()=>{t.delete(r),t.size===0&&this.interceptors.delete(e)}):()=>{}}notify(e,r,t){return this.batchingEnabled?(this.pending.has(e)||this.firstValues.set(e,t),this.pending.set(e,{newValue:r,oldValue:this.firstValues.get(e)}),this.pendingFlush||(this.pendingFlush=!0,queueMicrotask(()=>this.flush())),{blocked:!1,value:r}):this._runNotify(e,r,t)}_runNotify(e,r,t){let o=!1,i=r;for(let[a,s]of this.interceptors)if(this.matches(a,e))for(let c of s){let u=c(i,t,e);u.block&&(o=!0),u.transform!==void 0&&(i=u.transform)}if(o)return{blocked:!0,value:t};for(let[a,s]of this.subscribers)if(this.matches(a,e))for(let c of s)c(i,t,e);return{blocked:!1,value:i}}flush(){let e=new Map(this.pending);this.pending.clear(),this.firstValues.clear(),this.pendingFlush=!1;for(let[r,{newValue:t,oldValue:o}]of e){if(t===o)continue;this._runNotify(r,t,o).blocked}for(let r of Array.from(this.flushCallbacks))try{r()}catch{}}flushSync(){for(;this.pending.size>0||this.pendingFlush;){if(this.pendingFlush&&this.pending.size===0){this.pendingFlush=!1;break}this.flush()}}onFlush(e){return this.flushCallbacks.add(e),()=>this.flushCallbacks.delete(e)}hasPending(){return this.pending.size>0}matches(e,r){if(e==="**"||e===r)return!0;if(e.endsWith(".*")){let t=e.slice(0,-2);return r.startsWith(t+".")}return!1}clear(){this.subscribers.clear(),this.interceptors.clear(),this.pending.clear(),this.firstValues.clear(),this.pendingFlush=!1}getSubscriberCount(){let e=0;for(let r of this.subscribers.values())e+=r.size;return e}getInterceptorCount(){let e=0;for(let r of this.interceptors.values())e+=r.size;return e}},me=null;function X(){return me||(me=new Se),me}var mn=Object.freeze({PATH_CACHE_SIZE:1e3}),re=mn.PATH_CACHE_SIZE;function K(n,e){if(n===e)return!0;if(n==null||e==null)return n===e;let r=typeof n;if(r!==typeof e||r!=="object")return!1;if(n instanceof Date&&e instanceof Date)return n.getTime()===e.getTime();if(n instanceof RegExp&&e instanceof RegExp)return n.source===e.source&&n.flags===e.flags;if(n instanceof Map&&e instanceof Map){if(n.size!==e.size)return!1;for(let[c,u]of n)if(!e.has(c)||!K(u,e.get(c)))return!1;return!0}if(n instanceof Set&&e instanceof Set){if(n.size!==e.size)return!1;for(let c of n)if(!e.has(c))return!1;return!0}if(Array.isArray(n))return!Array.isArray(e)||n.length!==e.length?!1:n.every((c,u)=>K(c,e[u]));if(Array.isArray(e))return!1;let o=n,i=e,a=Object.keys(o),s=Object.keys(i);return a.length!==s.length?!1:a.every(c=>c in i&&K(o[c],i[c]))}function P(n){if(n==null)return!1;if(n instanceof Date||n instanceof RegExp||typeof n=="function"||n instanceof Map||n instanceof Set||n instanceof WeakMap||n instanceof WeakSet||n instanceof ArrayBuffer||n instanceof DataView||n instanceof Error||n instanceof Promise||n instanceof Int8Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray||n instanceof Int16Array||n instanceof Uint16Array||n instanceof Int32Array||n instanceof Uint32Array||n instanceof Float32Array||n instanceof Float64Array||n instanceof BigInt64Array||n instanceof BigUint64Array||typeof window<"u"&&(n instanceof URL||n instanceof URLSearchParams||n instanceof FormData||n instanceof Blob||typeof File<"u"&&n instanceof File||typeof FileList<"u"&&n instanceof FileList||typeof Headers<"u"&&n instanceof Headers||typeof Request<"u"&&n instanceof Request||typeof Response<"u"&&n instanceof Response||typeof AbortController<"u"&&n instanceof AbortController||typeof AbortSignal<"u"&&n instanceof AbortSignal))return!0;try{let e=globalThis?.Buffer;if(e&&n instanceof e)return!0}catch{}return!1}var V=class{constructor(e){this.maxSize=e;if(!Number.isFinite(e)||e<=0)throw new Error("LRUCache maxSize must be a positive, finite number")}cache=new Map;set(e,r){if(this.cache.has(e)&&this.cache.delete(e),this.cache.set(e,r),this.cache.size>this.maxSize){let t=this.cache.keys().next().value;t!==void 0&&this.cache.delete(t)}}get(e){if(!this.cache.has(e))return;let r=this.cache.get(e);return r!==void 0&&(this.cache.delete(e),this.cache.set(e,r)),r}delete(e){this.cache.delete(e)}has(e){return this.cache.has(e)}clear(){this.cache.clear()}size(){return this.cache.size}forEach(e){this.cache.forEach((r,t)=>e(r,t))}entries(){return this.cache.entries()}keys(){return this.cache.keys()}resize(e){if(!Number.isFinite(e)||e<=0)throw new Error("LRUCache newSize must be a positive, finite number");for(this.maxSize=e;this.cache.size>this.maxSize;){let r=this.cache.keys().next().value;if(r===void 0)break;this.cache.delete(r)}}};var _e=new V(re);function De(n){let e=_e.get(n);if(e)return e;let r=n.split(".");return _e.set(n,r),r}var Sn=Symbol.for("SignalTree:NodeAccessor");function be(n){return!!(n&&typeof n=="object"&&n.__isEntityMap===!0)}function z(n){return typeof n=="function"&&n&&Sn in n}function bn(n,e){let r=R(n()),t=r.set.bind(r),o=()=>{t(n())};if(e)Ne(e,()=>H(o));else try{H(o)}catch{console.warn("[SignalTree] toWritableSignal called without injection context; pass Injector for reactivity.")}return r.set=i=>{n(i),t(i)},r.update=i=>{r.set(i(r()))},r}function oe(n,e,r="",t){let o=new Map,i=new Map,a=new Map,s=()=>{a.forEach(u=>{try{u()}catch(T){console.warn("Error during nested cleanup:",T)}}),a.clear(),o.clear(),i.clear(),t&&t.dispose()};return new Proxy(n,{get(u,T){if(T==="__cleanup__")return s;if(typeof T=="symbol"||T==="valueOf"||T==="toString")return u[T];let d=T,E=r?`${r}.${d}`:d;if(!(d in u))return;let p=u[d];if(I(p)||p&&typeof p=="object"&&typeof p.addOne=="function"&&typeof p.all=="function"||be(p))return p;if(t){let g=t.getSignal(E);if(g)return g}if(o.has(E))return o.get(E);if(i.has(E))return i.get(E);if(p&&typeof p=="object"&&!Array.isArray(p)&&!I(p)&&!P(p))try{let g=oe(p,e,E,t);i.set(E,g);let b=g;return typeof b.__cleanup__=="function"&&a.set(E,b.__cleanup__),g}catch(g){console.warn(`Failed to create lazy proxy for path "${E}":`,g);let b=R(p,{equal:e});return o.set(E,b),t&&t.cacheSignal(E,b),b}try{let g=R(p,{equal:e});return o.set(E,g),t&&t.cacheSignal(E,g),g}catch(g){return console.warn(`Failed to create signal for path "${E}":`,g),p}},set(u,T,d){if(typeof T=="symbol")return u[T]=d,!0;let E=T,p=r?`${r}.${E}`:E;try{u[E]=d;let g=o.get(p);if(g&&"set"in g&&g.set(d),i.has(p)){let b=a.get(p);b&&(b(),a.delete(p)),i.delete(p)}return!0}catch(g){return console.warn(`Failed to set value for path "${p}":`,g),!1}},has(u,T){return T in u},ownKeys(u){return Reflect.ownKeys(u)},getOwnPropertyDescriptor(u,T){return Reflect.getOwnPropertyDescriptor(u,T)}})}function N(n){if(n==null)return n;if(z(n)){let t={};for(let o in n){if(!Object.prototype.hasOwnProperty.call(n,o)||o==="length"||o==="prototype")continue;if(o==="name"){let a=n[o];if(!I(a)&&!z(a))continue}let i=n[o];if(z(i))t[o]=N(i);else if(I(i)){let a=i();typeof a=="object"&&a!==null&&!Array.isArray(a)&&!P(a)?t[o]=N(a):t[o]=a}else typeof i=="object"&&i!==null&&!Array.isArray(i)&&!P(i)?t[o]=N(i):t[o]=i}return t}if(I(n)){let t=n();return typeof t=="object"&&t!==null&&!Array.isArray(t)&&!P(t)?N(t):t}if(typeof n!="object"||Array.isArray(n)||P(n))return n;let e={};for(let t in n){if(!Object.prototype.hasOwnProperty.call(n,t)||(t==="set"||t==="update")&&typeof n[t]=="function")continue;let o=n[t];if(z(o)){let i=o();typeof i=="object"&&i!==null&&!Array.isArray(i)&&!P(i)?e[t]=N(i):e[t]=i}else if(I(o)){let i=o();typeof i=="object"&&i!==null&&!Array.isArray(i)&&!P(i)?e[t]=N(i):e[t]=i}else typeof o=="object"&&o!==null&&!Array.isArray(o)&&!P(o)?e[t]=N(o):e[t]=o}let r=Object.getOwnPropertySymbols(n);for(let t of r){let o=n[t];if(z(o)){let i=o();typeof i=="object"&&i!==null&&!Array.isArray(i)&&!P(i)?e[t]=N(i):e[t]=i}else if(I(o)){let i=o();typeof i=="object"&&i!==null&&!Array.isArray(i)&&!P(i)?e[t]=N(i):e[t]=i}else typeof o=="object"&&o!==null&&!Array.isArray(o)&&!P(o)?e[t]=N(o):e[t]=o}return e}function Oe(n){return N(n)}var ie=[];function ze(n){if(n===null||typeof n!="object"||Object.getOwnPropertySymbols(n).length===0)return!1;for(let e of ie)if(e.check(n))return!0;return!1}function F(n,e){ie.some(t=>t.check===n)||ie.push({check:n,create:e})}function Z(n,e,r=[]){if(n==null||typeof n!="object"&&typeof n!="function"||I(n))return;let t=typeof n=="function"&&z(n);if(typeof n=="function"&&!t)return;let o=()=>(e||(e=X()),e),i=Object.keys(n);for(let a of i){let s=n[a],c=[...r,a],u=c.join("."),T=!1;for(let d of ie)if(d.check(s)){try{let E=d.create(s,o(),u);n[a]=E,T=!0}catch{}break}!T&&s!=null&&(z(s)||typeof s=="object"&&!Array.isArray(s)&&!I(s))&&Z(s,e,c)}}var Ee=Symbol("STATUS_MARKER"),Ke=(o=>(o.NotLoaded="NOT_LOADED",o.Loading="LOADING",o.Loaded="LOADED",o.Error="ERROR",o))(Ke||{}),je=!1;function En(n="NOT_LOADED"){return je||(je=!0,F(ae,wn)),{[Ee]:!0,initialState:n}}function ae(n){return n!==null&&typeof n=="object"&&Ee in n&&n[Ee]===!0}function wn(n){let e=R(n.initialState),r=R(null),t=null,o=null,i=null,a=null;return{state:e,error:r,get isNotLoaded(){return t??=_(()=>e()==="NOT_LOADED")},get isLoading(){return o??=_(()=>e()==="LOADING")},get isLoaded(){return i??=_(()=>e()==="LOADED")},get isError(){return a??=_(()=>e()==="ERROR")},setNotLoaded(){e.set("NOT_LOADED"),r.set(null)},setLoading(){e.set("LOADING"),r.set(null)},setLoaded(){e.set("LOADED"),r.set(null)},setError(s){e.set("ERROR"),r.set(s)},reset(){e.set("NOT_LOADED"),r.set(null)}}}var we=Symbol("STORED_MARKER"),Le=!1;function kn(n,e,r={}){return Le||(Le=!0,F(se,vn)),{[we]:!0,key:n,defaultValue:e,options:r}}function se(n){return n!==null&&typeof n=="object"&&we in n&&n[we]===!0}function vn(n){let{key:e,defaultValue:r,options:{serialize:t=JSON.stringify,deserialize:o=JSON.parse,debounceMs:i=100}}=n,a=n.options.storage!==void 0?n.options.storage:typeof localStorage<"u"?localStorage:null,s=r;if(a)try{let p=a.getItem(e);p!==null&&(s=o(p))}catch{}let c=R(s),u=null,T,d=p=>{if(a){if(i===0){queueMicrotask(()=>{try{a.setItem(e,t(p))}catch{}});return}T=p,u!==null&&clearTimeout(u),u=setTimeout(()=>{u=null,queueMicrotask(()=>{try{a.setItem(e,t(T))}catch{}})},i)}},E=(()=>c());return E.set=p=>{c.set(p),d(p)},E.update=p=>{let g=p(c());c.set(g),d(g)},E.clear=()=>{c.set(r),a&&a.removeItem(e)},E.reload=()=>{if(a)try{let p=a.getItem(e);p!==null?c.set(o(p)):c.set(r)}catch{c.set(r)}},E}var Q={MAX_PATH_CACHE_SIZE:re,LAZY_THRESHOLD:50,ESTIMATE_MAX_DEPTH:3,ESTIMATE_SAMPLE_SIZE_ARRAY:3,ESTIMATE_SAMPLE_SIZE_OBJECT:5,DEFAULT_CACHE_SIZE:100,DEFAULT_BATCH_SIZE:10},Ue={NULL_OR_UNDEFINED:"null/undefined",CIRCULAR_REF:"circular ref",UPDATER_INVALID:"updater invalid",LAZY_FALLBACK:"lazy fallback",SIGNAL_CREATION_FAILED:"signal creation failed",UPDATE_PATH_NOT_FOUND:"update path not found",UPDATE_FAILED:"update failed",ROLLBACK_FAILED:"rollback failed",CLEANUP_ERROR:"cleanup error",PRESET_UNKNOWN:"unknown preset",STRATEGY_SELECTION:"strategy select",TREE_DESTROYED:"destroyed",UPDATE_TRANSACTION:"update tx",BATCH_NOT_ENABLED:"batching disabled",MEMOIZE_NOT_ENABLED:"memoize disabled",MIDDLEWARE_NOT_AVAILABLE:"middleware missing",ENTITY_HELPERS_NOT_AVAILABLE:"entity helpers missing",TIME_TRAVEL_NOT_AVAILABLE:"time travel missing",OPTIMIZE_NOT_AVAILABLE:"optimize missing",UPDATE_OPTIMIZED_NOT_AVAILABLE:"update optimized missing",CACHE_NOT_AVAILABLE:"cache missing",PERFORMANCE_NOT_ENABLED:"performance disabled",ENHANCER_ORDER_FAILED:"enhancer order failed",ENHANCER_CYCLE_DETECTED:"enhancer cycle",ENHANCER_REQUIREMENT_MISSING:"enhancer req missing",ENHANCER_PROVIDES_MISSING:"enhancer provides missing",ENHANCER_FAILED:"enhancer failed",ENHANCER_NOT_FUNCTION:"enhancer not function",EFFECT_NO_CONTEXT:"no angular context",SUBSCRIBE_NO_CONTEXT:"no angular context"},Mn=(()=>{let n={},e=0;for(let r of Object.keys(Ue))n[r]=String(e++);return n})(),Ct=typeof globalThis=="object"&&globalThis!==null&&"process"in globalThis&&typeof globalThis.process=="object"&&"env"in globalThis.process&&globalThis.process.env.NODE_ENV==="production",An=!1,q=Object.freeze(An?Ue:Mn);var Be=0;function ke(n){Be++;try{n()}finally{Be--}}var $e=Symbol.for("signaltree:derived");function Fe(n){return n!==null&&typeof n=="object"&&$e in n&&n[$e]===!0}function ce(n){return I(n)}function ve(n,e){if(!e)return n;let r=e.split("."),t=n;for(let o of r)o in t||(t[o]={}),t=t[o];return t}function We(n,e,r=""){if(!(!e||typeof e!="object"))for(let[t,o]of Object.entries(e)){let i=r?`${r}.${t}`:t;if(Fe(o)){let a=ve(n,r);t in a&&ce(a[t]),a[t]=_(o.factory)}else if(ce(o)){let a=ve(n,r);t in a&&ce(a[t]),a[t]=o}else if(typeof o=="object"&&o!==null){let a=ve(n,r);if(!(t in a))a[t]={};else if(ce(a[t]))throw new Error(`SignalTree: Cannot merge derived object into "${i}" because source is a signal. Either make source an object or use a different key.`);We(n,o,i)}}}function He(n,e){for(let r of e){let t=r(n);We(n,t)}}var le=class{cache=new Map;registry=null;config;stats={cleanedUpSignals:0,peakCachedSignals:0,manualDisposes:0};constructor(e={}){this.config={enableAutoCleanup:e.enableAutoCleanup??!0,debugMode:e.debugMode??!1,onCleanup:e.onCleanup??(()=>{})},this.config.enableAutoCleanup&&typeof FinalizationRegistry<"u"&&(this.registry=new FinalizationRegistry(r=>{this.handleCleanup(r)})),this.config.debugMode&&console.log("[SignalMemoryManager] Initialized",{autoCleanup:this.config.enableAutoCleanup,hasRegistry:!!this.registry})}cacheSignal(e,r){let o={ref:new WeakRef(r),path:e,cachedAt:Date.now()};this.cache.set(e,o),this.registry&&this.registry.register(r,e,r);let i=this.cache.size;i>this.stats.peakCachedSignals&&(this.stats.peakCachedSignals=i),this.config.debugMode&&console.log(`[SignalMemoryManager] Cached signal: ${e}`,{cacheSize:i,peak:this.stats.peakCachedSignals})}getSignal(e){let r=this.cache.get(e);if(!r)return;let t=r.ref.deref();if(!t){this.cache.delete(e),this.config.debugMode&&console.log(`[SignalMemoryManager] Signal GC'd: ${e}`);return}return t}hasSignal(e){return this.cache.has(e)}removeSignal(e){let r=this.cache.get(e);if(!r)return!1;let t=r.ref.deref();return t&&this.registry&&this.registry.unregister(t),this.cache.delete(e),this.config.debugMode&&console.log(`[SignalMemoryManager] Removed signal: ${e}`),!0}handleCleanup(e){this.cache.delete(e),this.stats.cleanedUpSignals++;let r=this.getStats();this.config.debugMode&&console.log(`[SignalMemoryManager] Auto cleanup: ${e}`,r),this.config.onCleanup(e,r)}getStats(){let e=0;for(let[t,o]of this.cache.entries())o.ref.deref()?e++:this.cache.delete(t);let r=e*100;return{cachedSignals:e,cleanedUpSignals:this.stats.cleanedUpSignals,peakCachedSignals:this.stats.peakCachedSignals,manualDisposes:this.stats.manualDisposes,estimatedMemoryBytes:r}}dispose(){if(this.config.debugMode&&console.log("[SignalMemoryManager] Disposing",{cachedSignals:this.cache.size}),this.registry)for(let e of this.cache.values()){let r=e.ref.deref();r&&this.registry.unregister(r)}this.cache.clear(),this.stats.manualDisposes++,this.config.debugMode&&console.log("[SignalMemoryManager] Disposed",this.getStats())}getCachedPaths(){let e=[];for(let[r,t]of this.cache.entries())t.ref.deref()&&e.push(r);return e}clearStale(){let e=0;for(let[r,t]of this.cache.entries())t.ref.deref()||(this.cache.delete(r),e++);return this.config.debugMode&&e>0&&console.log(`[SignalMemoryManager] Cleared ${e} stale entries`),e}resetStats(){this.stats={cleanedUpSignals:0,peakCachedSignals:0,manualDisposes:0},this.config.debugMode&&console.log("[SignalMemoryManager] Stats reset")}};var xn=["__proto__","constructor","prototype"],Cn=/<[^>]*>/g,Me=[/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,/on\w+\s*=/gi,/javascript:/gi,/<iframe\b/gi,/<object\b/gi,/<embed\b/gi],ue=class{config;dangerousKeys;constructor(e={}){this.config={preventPrototypePollution:e.preventPrototypePollution??!0,preventXSS:e.preventXSS??!1,preventFunctions:e.preventFunctions??!0,customDangerousKeys:e.customDangerousKeys??[],onSecurityEvent:e.onSecurityEvent??(()=>{}),sanitizationMode:e.sanitizationMode??"strict"},this.dangerousKeys=new Set([...xn,...this.config.customDangerousKeys])}validateKey(e){if(this.config.preventPrototypePollution&&this.dangerousKeys.has(e)){let r={type:"dangerous-key-blocked",key:e,reason:`Dangerous key "${e}" blocked to prevent prototype pollution`,timestamp:Date.now()};throw this.config.onSecurityEvent(r),new Error(`[SignalTree Security] Dangerous key "${e}" is not allowed. This key can lead to prototype pollution attacks. Blocked keys: ${Array.from(this.dangerousKeys).join(", ")}`)}}validateValue(e){if(this.config.preventFunctions&&typeof e=="function"){let t={type:"function-value-blocked",value:e,reason:"Function values are not allowed - state must be serializable",timestamp:Date.now()};throw this.config.onSecurityEvent(t),new Error(`[SignalTree Security] Function values are not allowed in state trees. Functions cannot be serialized, breaking features like time-travel, persistence, debugging, and SSR. 

To fix this:
  - Store function references outside the tree
  - Use method names (strings) and a function registry
  - Use computed signals for derived values

Blocked value: ${e.toString().substring(0,100)}...`)}if(!this.config.preventXSS||typeof e!="string")return e;let r=!1;for(let t of Me)if(t.lastIndex=0,t.test(e)){r=!0;break}if(r){let t={type:"xss-attempt-blocked",value:e,reason:"Dangerous HTML pattern detected and sanitized",timestamp:Date.now()};return this.config.onSecurityEvent(t),this.sanitize(e)}return this.sanitize(e)}sanitize(e){if(this.config.sanitizationMode==="strict"){let r=e;for(let t of Me)t.lastIndex=0,r=r.replace(t,"");return r.replace(Cn,"")}else{let r=e;for(let t of Me)t.lastIndex=0,r=r.replace(t,"");return r}}validateKeyValue(e,r){return this.validateKey(e),this.validateValue(r)}isDangerousKey(e){return this.dangerousKeys.has(e)}getConfig(){return x({},this.config)}};var fe=Symbol.for("SignalTree:NodeAccessor");function Ve(n){return typeof n=="function"&&n[fe]===!0}function In(n){return!!(n&&typeof n=="object"&&n.__isEntityMap===!0)}function Rn(n){return n?Object.is:K}function de(n,e=Q.ESTIMATE_MAX_DEPTH,r=0){if(r>=e)return 1;if(n==null)return 0;if(typeof n!="object")return 1;let t=0;try{if(Array.isArray(n)){t=n.length;let o=Math.min(Q.ESTIMATE_SAMPLE_SIZE_ARRAY,n.length);for(let i=0;i<o;i++)t+=de(n[i],e,r+1)*.1}else{let o=Object.keys(n);t=o.length;let i=Math.min(Q.ESTIMATE_SAMPLE_SIZE_OBJECT,o.length);for(let a=0;a<i;a++){let s=n[o[a]];t+=de(s,e,r+1)*.5}}}catch{return 1}return Math.floor(t)}function Pn(n,e,r){return e.useLazySignals!==void 0?e.useLazySignals:e.debugMode||e.enableDevTools?!1:(r??de(n))>Q.LAZY_THRESHOLD}function Nn(n,e){if(!e.security)return;let r=new ue(e.security);function t(o,i){if(o!=null){if(typeof o!="object"){r.validateValue(o);return}if(!P(o)){if(Array.isArray(o)){o.forEach((a,s)=>t(a,[...i,String(s)]));return}for(let a of Object.keys(o)){try{r.validateKey(a)}catch(c){throw new Error(`${c.message}
Path: ${[...i,a].join(".")}`)}let s=o[a];try{r.validateValue(s)}catch(c){throw new Error(`${c.message}
Path: ${[...i,a].join(".")}`)}t(s,[...i,a])}}}}t(n,[])}function _n(n){let e=function(r){if(arguments.length===0)return N(n);if(typeof r=="function"){let t=r,o=N(n);ke(()=>U(n,t(o)));return}if(typeof r=="object"&&r!==null&&!Array.isArray(r)){ke(()=>U(n,r));return}U(n,r)};e[fe]=!0;for(let r of Object.keys(n))Object.defineProperty(e,r,{value:n[r],enumerable:!0,writable:!0,configurable:!0});return e}function U(n,e){if(!e||typeof e!="object")return;let r=(Ve(n),n);for(let[t,o]of Object.entries(e)){let i=r[t];i!==void 0&&(I(i)&&"set"in i?i.set(o):Ve(i)&&(o&&typeof o=="object"?U(i,o):i(o)))}}function Ae(n,e){if(n==null||typeof n!="object")return R(n,{equal:e});if(Array.isArray(n))return R(n,{equal:e});if(P(n))return R(n,{equal:e});let r={};for(let[t,o]of Object.entries(n)){if(In(o)){r[t]=o;continue}if(ae(o)){r[t]=o;continue}if(se(o)){r[t]=o;continue}if(ze(o)){r[t]=o;continue}if(I(o)){r[t]=o;continue}if(o==null||typeof o!="object"){r[t]=R(o,{equal:e});continue}if(Array.isArray(o)||P(o)){r[t]=R(o,{equal:e});continue}let i=Ae(o,e);r[t]=_n(i)}return r}function Dn(n,e){if(n==null)throw new Error(q.NULL_OR_UNDEFINED);Nn(n,e);let r=Rn(e.useShallowComparison??!1),t=de(n),o=Pn(n,e,t),i,a;try{X().setBatchingEnabled(e.batchUpdates!==!1)}catch{}if(o&&typeof n=="object")try{a=new le,i=oe(n,r,"",a)}catch(c){console.warn(q.LAZY_FALLBACK,c),i=Ae(n,r),a=void 0}else i=Ae(n,r);let s=function(c){if(arguments.length===0)return N(i);if(typeof c=="function"){let u=c,T=N(i);U(i,u(T))}else U(i,c)};s[fe]=!0,Object.defineProperty(s,"state",{value:i,enumerable:!1,writable:!1}),Object.defineProperty(s,"$",{value:i,enumerable:!1,writable:!1}),Object.defineProperty(s,"with",{value:function(c){if(typeof c!="function")throw new Error("Enhancer must be a function");return c(s)},enumerable:!1,writable:!1,configurable:!0}),Object.defineProperty(s,"bind",{value:function(c){return Function.prototype.bind.call(s,c)},enumerable:!1,writable:!0,configurable:!0}),Object.defineProperty(s,"destroy",{value:function(){a&&a.dispose(),e.debugMode&&console.log(q.TREE_DESTROYED)},enumerable:!1,writable:!0,configurable:!0}),Object.defineProperty(s,"clearCache",{value:()=>{},enumerable:!1,writable:!0,configurable:!0}),Object.defineProperty(s,"batchUpdate",{value:function(c){if(arguments.length!==0)if(typeof c=="function"){let u=c,T=N(i);U(i,u(T))}else U(i,c)},enumerable:!1,writable:!0,configurable:!0});for(let c of Object.keys(i))c in s||Object.defineProperty(s,c,{value:i[c],enumerable:!0,configurable:!0});return s}function xe(n,e){let r=typeof e=="function",o=Dn(n,r?{}:e??{}),i=qe(o);return r?i.derived(e):i}function qe(n){let e=[],r=!1,t=()=>{r||(r=!0,Z(n.$),Z(n.state),e.length>0&&He(n.$,e))},o=function(i){return arguments.length===0?n():n(i)};return o[fe]=!0,Object.defineProperty(o,"state",{get(){return t(),n.state},enumerable:!1,configurable:!0}),Object.defineProperty(o,"$",{get(){return t(),n.$},enumerable:!1,configurable:!0}),Object.defineProperty(o,"with",{value:function(i){let a=n.with(i),s=qe(a);for(let c of Object.keys(a))if(c!=="$"&&c!=="state"&&c!=="with"&&c!=="bind"&&c!=="destroy"&&c!=="derived")try{s[c]=a[c]}catch{}for(let c of e)s.derived(c);return s},enumerable:!1,writable:!1,configurable:!0}),typeof n.bind=="function"?Object.defineProperty(o,"bind",{value:n.bind.bind(n),enumerable:!1,writable:!1,configurable:!0}):Object.defineProperty(o,"bind",{value:()=>o,enumerable:!1,writable:!1,configurable:!0}),typeof n.destroy=="function"?Object.defineProperty(o,"destroy",{value:n.destroy.bind(n),enumerable:!1,writable:!0,configurable:!0}):Object.defineProperty(o,"destroy",{value:()=>{},enumerable:!1,writable:!0,configurable:!0}),Object.defineProperty(o,"derived",{value:function(i){if(r)throw new Error("SignalTree: Cannot add derived() after tree.$ has been accessed. Chain all .derived() calls before accessing $.");return e.push(i),o},enumerable:!1,writable:!1,configurable:!0}),o}function Ge(n,e,r){let t=new Map,o=R([]),i=R(0),a=R([]),s=R(new Map),c=new Map,u=n.selectId??(l=>l.id),T=[],d=[];function E(){let l=Array.from(t.values()),h=Array.from(t.keys()),f=new Map(t);o.set(l),i.set(l.length),a.set(h),s.set(f)}function p(l,h){let f=(()=>t.get(l));for(let S of Object.keys(h))Object.defineProperty(f,S,{get:()=>{let v=t.get(l)?.[S];return()=>v},enumerable:!0,configurable:!0});return f}function g(l,h){let f=c.get(l);return f||(f=p(l,h),c.set(l,f)),f}let b=new WeakMap,y=new WeakMap,m={byId(l){let h=t.get(l);if(h)return g(l,h)},byIdOrFail(l){let h=m.byId(l);if(!h)throw new Error(`Entity with id ${String(l)} not found`);return h},get all(){return o},get count(){return i},get ids(){return a},get map(){return s},has(l){return _(()=>s().has(l))},get isEmpty(){return _(()=>i()===0)},where(l){let h=b.get(l);if(h)return h;let f=_(()=>o().filter(l));return b.set(l,f),f},find(l){let h=y.get(l);if(h)return h;let f=_(()=>o().find(l));return y.set(l,f),f},addOne(l,h){let f=h?.selectId?.(l)??u(l);if(t.has(f))throw new Error(`Entity with id ${String(f)} already exists`);let S=l;for(let w of d){let v={block:k=>{throw new Error(`Cannot add entity: ${k||"blocked by interceptor"}`)},transform:k=>{S=k},blocked:!1,blockReason:void 0};w.onAdd?.(l,v)}t.set(f,S),c.delete(f),E(),e.notify(`${r}.${String(f)}`,S,void 0);for(let w of T)w.onAdd?.(S,f);return f},addMany(l,h){let f=[];for(let w of l){let v=h?.selectId?.(w)??u(w);if(t.has(v))throw new Error(`Entity with id ${String(v)} already exists`);f.push(v)}let S=[];for(let w=0;w<l.length;w++){let v=l[w],k=f[w],A=v;for(let C of d){let O={block:D=>{throw new Error(`Cannot add entity: ${D||"blocked by interceptor"}`)},transform:D=>{A=D},blocked:!1,blockReason:void 0};C.onAdd?.(v,O)}t.set(k,A),c.delete(k),S.push({id:k,entity:A})}E();for(let{id:w,entity:v}of S)e.notify(`${r}.${String(w)}`,v,void 0);for(let{id:w,entity:v}of S)for(let k of T)k.onAdd?.(v,w);return f},updateOne(l,h){let f=t.get(l);if(!f)throw new Error(`Entity with id ${String(l)} not found`);let S=f,w=h;for(let k of d){let A={block:C=>{throw new Error(`Cannot update entity: ${C||"blocked by interceptor"}`)},transform:C=>{w=C},blocked:!1,blockReason:void 0};k.onUpdate?.(l,h,A)}let v=x(x({},f),w);t.set(l,v),c.delete(l),E(),e.notify(`${r}.${String(l)}`,v,S);for(let k of T)k.onUpdate?.(l,w,v)},updateMany(l,h){if(l.length===0)return;let f=[];for(let S of l){let w=t.get(S);if(!w)throw new Error(`Entity with id ${String(S)} not found`);let v=w,k=h;for(let C of d){let O={block:D=>{throw new Error(`Cannot update entity: ${D||"blocked by interceptor"}`)},transform:D=>{k=D},blocked:!1,blockReason:void 0};C.onUpdate?.(S,h,O)}let A=x(x({},w),k);t.set(S,A),c.delete(S),f.push({id:S,prev:v,finalUpdated:A,transformedChanges:k})}E();for(let{id:S,prev:w,finalUpdated:v}of f)e.notify(`${r}.${String(S)}`,v,w);for(let{id:S,transformedChanges:w,finalUpdated:v}of f)for(let k of T)k.onUpdate?.(S,w,v)},updateWhere(l,h){let f=[];for(let[S,w]of t)l(w)&&f.push(S);return f.length>0&&m.updateMany(f,h),f.length},removeOne(l){let h=t.get(l);if(!h)throw new Error(`Entity with id ${String(l)} not found`);for(let f of d){let S={block:w=>{throw new Error(`Cannot remove entity: ${w||"blocked by interceptor"}`)},transform:()=>{},blocked:!1,blockReason:void 0};f.onRemove?.(l,h,S)}t.delete(l),c.delete(l),E(),e.notify(`${r}.${String(l)}`,void 0,h);for(let f of T)f.onRemove?.(l,h)},removeMany(l){if(l.length===0)return;let h=[];for(let f of l){let S=t.get(f);if(!S)throw new Error(`Entity with id ${String(f)} not found`);for(let w of d){let v={block:k=>{throw new Error(`Cannot remove entity: ${k||"blocked by interceptor"}`)},transform:()=>{},blocked:!1,blockReason:void 0};w.onRemove?.(f,S,v)}h.push({id:f,entity:S})}for(let{id:f}of h)t.delete(f),c.delete(f);E();for(let{id:f,entity:S}of h)e.notify(`${r}.${String(f)}`,void 0,S);for(let{id:f,entity:S}of h)for(let w of T)w.onRemove?.(f,S)},removeWhere(l){let h=[];for(let[f,S]of t)l(S)&&h.push(f);return h.length>0&&m.removeMany(h),h.length},upsertOne(l,h){let f=h?.selectId?.(l)??u(l);return t.has(f)?m.updateOne(f,l):m.addOne(l,h),f},upsertMany(l,h){if(l.length===0)return[];let f=[],S=[];for(let k of l){let A=h?.selectId?.(k)??u(k),C=t.get(A);C!==void 0?S.push({entity:k,id:A,prev:C}):f.push({entity:k,id:A})}let w=[];for(let{entity:k,id:A}of f){let C=k;for(let O of d){let D={block:Y=>{throw new Error(`Cannot add entity: ${Y||"blocked by interceptor"}`)},transform:Y=>{C=Y},blocked:!1,blockReason:void 0};O.onAdd?.(k,D)}t.set(A,C),c.delete(A),w.push({id:A,entity:C})}let v=[];for(let{entity:k,id:A,prev:C}of S){let O=k;for(let Y of d){let hn={block:he=>{throw new Error(`Cannot update entity: ${he||"blocked by interceptor"}`)},transform:he=>{O=he},blocked:!1,blockReason:void 0};Y.onUpdate?.(A,k,hn)}let D=x(x({},C),O);t.set(A,D),c.delete(A),v.push({id:A,prev:C,finalUpdated:D,transformedChanges:O})}E();for(let{id:k,entity:A}of w)e.notify(`${r}.${String(k)}`,A,void 0);for(let{id:k,prev:A,finalUpdated:C}of v)e.notify(`${r}.${String(k)}`,C,A);for(let{id:k,entity:A}of w)for(let C of T)C.onAdd?.(A,k);for(let{id:k,transformedChanges:A,finalUpdated:C}of v)for(let O of T)O.onUpdate?.(k,A,C);return[...f.map(k=>k.id),...S.map(k=>k.id)]},clear(){t.clear(),c.clear(),E()},removeAll(){m.clear()},setAll(l,h){t.clear(),c.clear();let f=[];for(let S of l){let w=h?.selectId?.(S)??u(S),v=S;for(let k of d){let A={block:C=>{throw new Error(`Cannot add entity: ${C||"blocked by interceptor"}`)},transform:C=>{v=C},blocked:!1,blockReason:void 0};k.onAdd?.(S,A)}t.set(w,v),f.push(w)}E();for(let S=0;S<f.length;S++){let w=f[S],v=t.get(w);e.notify(`${r}.${String(w)}`,v,void 0)}for(let S=0;S<f.length;S++){let w=f[S],v=t.get(w);if(v)for(let k of T)k.onAdd?.(v,w)}},tap(l){return T.push(l),()=>{let h=T.indexOf(l);h>-1&&T.splice(h,1)}},intercept(l){return d.push(l),()=>{let h=d.indexOf(l);h>-1&&d.splice(h,1)}}};return new Proxy(m,{get:(l,h)=>typeof h=="string"&&!isNaN(Number(h))?m.byId(Number(h)):l[h]})}var Je=!1;function Ye(n){return Je||(Je=!0,F(be,(e,r,t)=>{let o=e.__entityMapConfig??{};return Ge(o,r,t)})),{__isEntityMap:!0,__entityMapConfig:n??{}}}var On=Symbol("signaltree:enhancer:meta");function ge(n,e){let r=new Set(["state","$"]);for(let t of Object.getOwnPropertyNames(n)){if(r.has(t)||Object.prototype.hasOwnProperty.call(e,t))continue;let o=Object.getOwnPropertyDescriptor(n,t);o&&o.configurable!==!1&&Object.defineProperty(e,t,o)}for(let t of Object.getOwnPropertySymbols(n)){if(Object.prototype.hasOwnProperty.call(e,t))continue;let o=Object.getOwnPropertyDescriptor(n,t);o&&o.configurable!==!1&&Object.defineProperty(e,t,o)}}function G(n={}){let e=n.enabled??!0,r=n.notificationDelayMs??0;return t=>{if(!e){let y={batch:l=>l(),coalesce:l=>l(),hasPendingNotifications:()=>!1,flushNotifications:()=>{}},m=t;return Object.assign(m,y),m.batchUpdate=l=>{typeof t.batchUpdate=="function"?t.batchUpdate(l):l(t())},m}let o=!1,i,a=!1,s=!1,c=new Map,u=()=>{o||(o=!0,r>0?i=setTimeout(T,r):queueMicrotask(T))},T=()=>{o&&(o=!1,i!==void 0&&(clearTimeout(i),i=void 0),t.__notifyChangeDetection&&t.__notifyChangeDetection())},d=()=>{let y=Array.from(c.values());c.clear(),y.forEach(m=>{try{m()}catch(l){console.error("[SignalTree] Error in coalesced update:",l)}})},E=(y,m="")=>{if(!(!y||typeof y!="object")){if(typeof y.set=="function"&&!y.__batchingWrapped){let l=y.set.bind(y);y.set=h=>{s?c.set(m,()=>l(h)):l(h),a||u()},y.__batchingWrapped=!0}if(typeof y.update=="function"&&!y.__batchingUpdateWrapped){let l=y.update.bind(y);y.update=h=>{s?c.set(`${m}:update:${Date.now()}`,()=>l(h)):l(h),a||u()},y.__batchingUpdateWrapped=!0}for(let l of Object.keys(y)){if(l.startsWith("_")||l==="set"||l==="update")continue;let h=y[l];h&&typeof h=="object"&&E(h,m?`${m}.${l}`:l)}}};t.$&&E(t.$);let p={batch(y){let m=a;a=!0;try{y()}finally{a=m,a||u()}},coalesce(y){let m=s,l=a;s=!0,a=!0;try{y()}finally{s=m,a=l,m||d(),a||u()}},hasPendingNotifications(){return o},flushNotifications(){T()}},g=t.bind(t),b=function(...y){if(y.length===0)return g();if(y.length===1){let m=y[0];g(m)}a||u()};Object.setPrototypeOf(b,Object.getPrototypeOf(t)),Object.assign(b,t);try{ge(t,b)}catch{}return Object.defineProperty(b,"with",{value:function(y){if(typeof y!="function")throw new Error("Enhancer must be a function");return y(b)},writable:!1,enumerable:!1,configurable:!0}),"state"in t&&Object.defineProperty(b,"state",{value:t.state,enumerable:!1,configurable:!0}),"$"in t&&Object.defineProperty(b,"$",{value:t.$,enumerable:!1,configurable:!0}),Object.assign(b,p),b.batchUpdate=y=>{b.batch(()=>{let m=g(),l=y(m);Object.entries(l).forEach(([h,f])=>{let S=b.state[h];S&&typeof S.set=="function"?S.set(f):typeof S=="function"&&S(f)})})},b}}function Xe(){return G({enabled:!0,notificationDelayMs:0})}var dr=Object.assign((n={})=>G(n),{highPerformance:Xe});function zn(){return typeof __DEV__<"u"?__DEV__:!1}var jn=1e3,hr=300*1e3,Kn=new Map;function Ze(n,e){if(e){let t=new V(n),o=new Map,i=()=>{for(;o.size>t.size();){let a=o.keys().next().value;if(a===void 0)break;o.delete(a)}};return{get:a=>{let s=t.get(a);return s!==void 0?o.set(a,s):o.has(a)&&o.delete(a),s},set:(a,s)=>{t.set(a,s),o.set(a,s),i()},delete:a=>{t.delete(a),o.delete(a)},clear:()=>{t.clear(),o.clear()},size:()=>o.size,forEach:a=>{o.forEach((s,c)=>a(s,c))},keys:()=>o.keys()}}let r=new Map;return{get:t=>r.get(t),set:(t,o)=>{r.set(t,o)},delete:t=>r.delete(t),clear:()=>r.clear(),size:()=>r.size,forEach:t=>{r.forEach((o,i)=>t(o,i))},keys:()=>r.keys()}}function en(n){return n._memoCleanupInterval}function nn(n,e){if(e===void 0){delete n._memoCleanupInterval;return}n._memoCleanupInterval=e}function Ln(n){let e=en(n);if(e){try{clearInterval(e)}catch{}nn(n)}}function Un(n,e){if(n===e)return!0;if(n==null||e==null||typeof n!=typeof e)return!1;if(typeof n=="object"&&typeof e=="object"){let r=n,t=e,o=0;for(let a in r)if(Object.prototype.hasOwnProperty.call(r,a)&&(o++,!(a in t)||r[a]!==t[a]))return!1;let i=0;for(let a in t)Object.prototype.hasOwnProperty.call(t,a)&&i++;return o===i}return!1}function Qe(n,e){try{return`${n.name||"anonymous"}_${JSON.stringify(e)}`}catch{return`${n.name||"anonymous"}_${e.length}`}}function Bn(n){switch(n){case"shallow":return Un;case"reference":return(e,r)=>e===r;case"deep":default:return K}}var pe={selector:{equality:"reference",maxCacheSize:10,enableLRU:!1,ttl:void 0},computed:{equality:"shallow",maxCacheSize:100,enableLRU:!1,ttl:void 0},deepState:{equality:"deep",maxCacheSize:1e3,enableLRU:!0,ttl:300*1e3},highFrequency:{equality:"reference",maxCacheSize:5,enableLRU:!1,ttl:void 0}};function tn(){return j(pe.selector)}function rn(){return j(pe.computed)}function on(){return j(pe.deepState)}function an(){return j(pe.highFrequency)}var mr=Object.assign((n={})=>j(n),{selector:tn,computed:rn,deep:on,fast:an});function j(n={}){let{enabled:e=!0,maxCacheSize:r=1e3,ttl:t,equality:o="deep",enableLRU:i=!0}=n;return s=>{let c=s.bind(s),u=g=>{Object.entries(g).forEach(([b,y])=>{let m=s.state[b];m&&"set"in m?m.set(y):z(m)&&m(y)})};if(!e){let g=s;return g.memoize=(b,y)=>_(()=>b(c())),g.memoizedUpdate=b=>{let y=c(),m=b(y);u(m)},g.clearMemoCache=()=>{},g.clearCache=g.clearMemoCache,g.getCacheStats=()=>({size:0,hitRate:0,totalHits:0,totalMisses:0,keys:[]}),g}let T=Ze(r,i);Kn.set(s,T);let d=Bn(o);s.memoizedUpdate=(g,b)=>{let y=c(),m=b||Qe(g,[y]),l=T.get(m);if(l&&d(l.deps,[y])){let f=l.value;u(f);return}let h=g(y);T.set(m,{value:h,deps:[y],timestamp:Date.now(),hitCount:1}),u(h)};let E=Ze(jn,!0);if(s.memoize=(g,b)=>_(()=>{let y=c(),m=b||Qe(g,[y]),l=E.get(m);if(l&&d(l.deps,[y]))return l.value;if(zn()&&s.__devHooks?.onRecompute)try{s.__devHooks.onRecompute(m,1)}catch{}let h=g(y);return E.set(m,{value:h,deps:[y],timestamp:Date.now(),hitCount:1}),h}),s.clearMemoCache=g=>{g?T.delete(g):T.clear()},s.clearCache=s.clearMemoCache,s.getCacheStats=()=>{let g=0,b=0;T.forEach(m=>{g+=m.hitCount||0,b+=Math.floor((m.hitCount||0)/2)});let y=g+b>0?g/(g+b):0;return{size:T.size(),hitRate:y,totalHits:g,totalMisses:b,keys:Array.from(T.keys())}},en(s)){let g=s.clearMemoCache.bind(s);s.clearMemoCache=b=>{g(b),Ln(s)}}if(s.clearCache=s.clearMemoCache,t){let b=setInterval(()=>{let y=Date.now();T.forEach((m,l)=>{m.timestamp&&y-m.timestamp>t&&T.delete(l)})},t);nn(s,b)}return s}}function $n(){return j({enabled:!0,maxCacheSize:100,ttl:void 0,equality:"reference",enableLRU:!1})}function Fn(){return j({enabled:!0,maxCacheSize:1e3,ttl:6e4,equality:"shallow",enableLRU:!0})}function Ce(n){return typeof structuredClone=="function"?structuredClone(n):JSON.parse(JSON.stringify(n))}function Te(n,e){return JSON.stringify(n)===JSON.stringify(e)}var Ie=class{constructor(e,r={},t){this.tree=e;this.config=r;this.restoreStateFn=t;this.maxHistorySize=r.maxHistorySize??50,this.includePayload=r.includePayload??!0,this.actionNames=x({update:"UPDATE",set:"SET",batch:"BATCH"},r.actionNames),this.addEntry("INIT",this.tree())}history=[];currentIndex=-1;maxHistorySize;includePayload;actionNames;addEntry(e,r,t,o=!1){this.currentIndex<this.history.length-1&&(this.history=this.history.slice(0,this.currentIndex+1));let i=Oe(this.tree.state),a;try{a=typeof structuredClone<"u"?structuredClone(i):JSON.parse(JSON.stringify(i))}catch{a=JSON.parse(JSON.stringify(i))}let s=x({state:a,timestamp:Date.now(),action:this.actionNames[e]||e},this.includePayload&&t!==void 0&&{payload:t});o&&(s.__provisional=!0);let c=this.history[this.history.length-1];if(c&&Te(c.state,s.state)){c.__provisional&&delete c.__provisional;return}this.history.push(s),this.currentIndex=this.history.length-1,this.history.length>this.maxHistorySize&&(this.history.shift(),this.currentIndex--)}undo(){if(!this.canUndo())return!1;this.currentIndex--;let e=this.history[this.currentIndex];return this.restoreState(e.state),!0}finalizeProvisional(e){let r=this.history[this.history.length-1];if(r&&r.__provisional){if(Te(r.state,e)){delete r.__provisional;return}r.state=Ce(e),r.timestamp=Date.now(),delete r.__provisional;return}this.addEntry("update",e)}redo(){if(!this.canRedo())return!1;this.currentIndex++;let e=this.history[this.currentIndex];return this.restoreState(e.state),!0}getHistory(){return this.history.map(e=>L(x({},e),{state:Ce(e.state)}))}resetHistory(){let e=this.tree();this.history=[],this.currentIndex=-1,this.addEntry("RESET",e)}jumpTo(e){if(e<0||e>=this.history.length)return!1;this.currentIndex=e;let r=this.history[e];return this.restoreState(r.state),!0}getCurrentIndex(){return this.currentIndex}canUndo(){return this.currentIndex>0}canRedo(){return this.currentIndex<this.history.length-1}restoreState(e){this.restoreStateFn?this.restoreStateFn(e):this.tree(e)}};function B(n={}){let{enabled:e=!0}=n;return r=>{if(!e)return Object.assign(r,{undo(){},redo(){},canUndo(){return!1},canRedo(){return!1},getHistory(){return[]},resetHistory(){},jumpTo(c){},getCurrentIndex(){return-1}});let t=r.bind(r),o=!1,i=new Ie(r,n,s=>{o=!0;try{t(s)}finally{o=!1}});try{let s=globalThis.require;if(typeof s=="function"){let{getPathNotifier:c}=s("../../lib/path-notifier"),u=c();u&&typeof u.onFlush=="function"&&u.onFlush(()=>{if(o)return;let T=t();i.addEntry("batch",T)})}}catch{}let a=function(...s){if(s.length===0)return t();{if(o){if(s.length===1){let d=s[0];return t(d)}return}let c=t(),u;if(s.length===1){let d=s[0];u=t(d)}let T=t();return Te(c,T)||i.addEntry("update",T),u}};return Object.setPrototypeOf(a,Object.getPrototypeOf(r)),Object.assign(a,r),Object.defineProperty(a,"with",{value:function(s){if(typeof s!="function")throw new Error("Enhancer must be a function");return s(a)},writable:!1,enumerable:!1,configurable:!0}),"state"in r&&Object.defineProperty(a,"state",{value:r.state,enumerable:!1,configurable:!0}),"$"in r&&Object.defineProperty(a,"$",{value:r.$,enumerable:!1,configurable:!0}),a.undo=()=>{i.undo()},a.redo=()=>{i.redo()},a.getHistory=()=>i.getHistory(),a.resetHistory=()=>{i.resetHistory()},a.jumpTo=s=>{i.jumpTo(s)},a.canUndo=()=>i.canUndo(),a.canRedo=()=>i.canRedo(),a.getCurrentIndex=()=>i.getCurrentIndex(),a.__timeTravel=i,a}}function Wn(n){return B({maxHistorySize:n})}var kr=Object.assign((n={})=>B(n),{minimal:()=>B({maxHistorySize:20,includePayload:!1}),debug:()=>B({maxHistorySize:200,includePayload:!0}),history:Wn});function W(n={}){let{enabled:e=!0}=n;return r=>(r.__entitiesEnabled=!0,r)}function sn(){return W()}function cn(){return W()}var Ar=Object.assign(W,{highPerformance:cn,enable:sn});var M={DATE:"\xA7d",REGEXP:"\xA7r",MAP:"\xA7m",SET:"\xA7s",UNDEFINED:"\xA7u",NAN:"\xA7n",INFINITY:"\xA7i",NEG_INFINITY:"\xA7-i",BIGINT:"\xA7b",SYMBOL:"\xA7y",FUNCTION:"\xA7f",CIRCULAR:"\xA7c"};var ln={includeMetadata:!0,replacer:void 0,reviver:void 0,preserveTypes:!0,maxDepth:50,handleCircular:!0};function J(n,e=new WeakSet,r=0,t=50,o=!0){if(r>t)return"[Max Depth Exceeded]";if(n===null||typeof n!="object")return o?n===void 0?{[M.UNDEFINED]:!0}:typeof n=="number"?Number.isNaN(n)?{[M.NAN]:!0}:n===1/0?{[M.INFINITY]:!0}:n===-1/0?{[M.NEG_INFINITY]:!0}:n:typeof n=="bigint"?{[M.BIGINT]:String(n)}:typeof n=="symbol"?{[M.SYMBOL]:String(n)}:n:n;if(typeof n=="function")try{let i=n();return J(i,e,r+1,t,o)}catch{return"[Function]"}if(e.has(n))return"[Circular Reference]";if(I(n))return n();if(o){if(n instanceof Date)return{[M.DATE]:n.toISOString()};if(n instanceof RegExp)return{[M.REGEXP]:{source:n.source,flags:n.flags}};if(n instanceof Map)return{[M.MAP]:Array.from(n.entries())};if(n instanceof Set)return{[M.SET]:Array.from(n.values())}}else if(n instanceof Date||n instanceof RegExp)return n;e.add(n);try{if(Array.isArray(n)){let a=n.map(s=>J(s,e,r+1,t,o));return e.delete(n),a}let i={};for(let[a,s]of Object.entries(n))if(!((a==="set"||a==="update")&&typeof s=="function"&&!I(s)))if(I(s))i[a]=J(s(),e,r+1,t,o);else if(typeof s=="function"&&a!=="set"&&a!=="update")try{let c=s();i[a]=J(c,e,r+1,t,o)}catch{continue}else i[a]=J(s,e,r+1,t,o);return e.delete(n),i}catch{return e.delete(n),"[Serialization Error]"}}function ye(n,e="",r=new WeakSet,t=new Map){let o=[];if(n===null||typeof n!="object")return o;if(r.has(n)){let i=t.get(n)||"";return o.push({path:e,targetPath:i}),o}if(r.add(n),t.set(n,e),Array.isArray(n)){let i=n;for(let a=0;a<i.length;a++){let s=e?`${e}[${a}]`:`[${a}]`,c=ye(i[a],s,r,t);o.push(...c)}}else for(let[i,a]of Object.entries(n)){let s=e?`${e}.${i}`:i,c=ye(a,s,r,t);o.push(...c)}return r.delete(n),o}function Hn(n){let e=new WeakSet,r=new Map;return function(o,i){if(n.replacer&&(i=n.replacer.call(this,o,i)),I(i))return i();if(i&&typeof i=="object"){if(e.has(i)){if(n.handleCircular){let s=r.get(i)||"";return{[M.CIRCULAR]:s}}return}e.add(i);let a=o||"";r.set(i,a)}return i}}function un(n,e){for(let{path:r,targetPath:t}of e){let o=r.split(/\.|\[|\]/).filter(Boolean),i=t.split(/\.|\[|\]/).filter(Boolean),a=n;for(let c=0;c<o.length-1&&(a=a[o[c]],!!a);c++);let s=n;for(let c of i)if(s=s[c],!s)break;a&&s&&(a[o[o.length-1]]=s)}}function Re(n={}){return e=>{let r=e;r.toJSON=()=>e(),r.fromJSON=(o,i)=>{let a=d=>{if(!d||typeof d!="object")return d;if(M.UNDEFINED in d)return;if(M.NAN in d)return NaN;if(M.INFINITY in d)return 1/0;if(M.NEG_INFINITY in d)return-1/0;if(M.BIGINT in d)return BigInt(d[M.BIGINT]);if(M.SYMBOL in d)return Symbol.for(d[M.SYMBOL]);if(M.DATE in d)return new Date(d[M.DATE]);if(M.REGEXP in d){let p=d[M.REGEXP];return new RegExp(p.source,p.flags)}if(M.MAP in d)return new Map(d[M.MAP]);if(M.SET in d)return new Set(d[M.SET]);if(Array.isArray(d))return d.map(a);let E={};for(let[p,g]of Object.entries(d))E[p]=a(g);return E},s=a(o);function c(d,E){let p=e.$;if(d&&p)for(let b of d.split(".")){if(!b)continue;let y=p[b];if(!y||typeof y!="object"&&typeof y!="function"){p=void 0;break}p=y}let g=p?.[E];return I(g)?g:void 0}function u(d,E,p=""){if(!(!d||!E))for(let g in E){if(!Object.prototype.hasOwnProperty.call(E,g))continue;let b=E[g],y=d[g],m=I(y)||typeof y=="function"&&"set"in y&&typeof y.set=="function"?y:c(p,g);if(m){m.set(b);continue}b&&typeof b=="object"&&!Array.isArray(b)&&y&&(typeof y=="object"||typeof y=="function"&&!("set"in y))&&!I(y)&&u(y,b,p?`${p}.${g}`:g)}}let T=i?.nodeMap;if(T&&Object.keys(T).length>0){if(T[""]==="r"){let d=e.$;d&&typeof d.set=="function"&&d.set(s)}for(let[d,E]of Object.entries(T)){if(d===""||E!=="b")continue;let p=d.split(/\.|\[|\]/).filter(Boolean),g=e.$;for(let b of p){if(!g)break;g=g[b]??void 0}if(g&&(I(g)||typeof g=="function"&&"set"in g&&typeof g.set=="function")){let b=s;for(let y of p){if(b==null){b=void 0;break}if(typeof b=="object")b=b[y];else{b=void 0;break}}try{g.set(b)}catch{}}}u(e.state,s);return}u(e.state,s)};function t(o,i){if(!i)return o;if(o===void 0)return{[M.UNDEFINED]:!0};if(typeof o=="number")return Number.isNaN(o)?{[M.NAN]:!0}:o===1/0?{[M.INFINITY]:!0}:o===-1/0?{[M.NEG_INFINITY]:!0}:o;if(typeof o=="bigint")return{[M.BIGINT]:String(o)};if(typeof o=="symbol")return{[M.SYMBOL]:String(o)};if(o instanceof Date)return{[M.DATE]:o.toISOString()};if(o instanceof RegExp)return{[M.REGEXP]:{source:o.source,flags:o.flags}};if(o instanceof Map)return{[M.MAP]:Array.from(o.entries())};if(o instanceof Set)return{[M.SET]:Array.from(o.values())};if(Array.isArray(o))return o.map(a=>t(a,i));if(o&&typeof o=="object"){let a={};for(let[s,c]of Object.entries(o))a[s]=t(c,i);return a}return o}return r.serialize=o=>{let i=x(x(x({},ln),n),o),a=J(e.state,new WeakSet,0,i.maxDepth,i.preserveTypes),s=t(a,i.preserveTypes),c=i.handleCircular?ye(s):[],u={data:s},T={};try{let p=e.$;p&&typeof p.set=="function"&&(T[""]="r");let g=new WeakSet,b=m=>I(m)||typeof m=="function"&&"set"in m&&typeof m.set=="function",y=(m,l="")=>{if(!m||typeof m!="object"&&typeof m!="function")return;let h=m;if(!g.has(h)){g.add(h),l&&b(m)&&(T[l]="b");for(let[f,S]of Object.entries(m)){let w=l?`${l}.${f}`:f;y(S,w)}}};p&&y(p)}catch{}i.includeMetadata&&(u.metadata=x(x({timestamp:Date.now(),version:"1.0.0"},c.length>0&&{circularRefs:c}),Object.keys(T).length>0&&{nodeMap:T}));let d=Hn(i);return JSON.stringify(u,d,2)},r.deserialize=(o,i)=>{let a=x(x(x({},ln),n),i);try{let s=JSON.parse(o),{data:c,metadata:u}=s;u?.circularRefs&&a.handleCircular&&un(c,u.circularRefs),r.fromJSON(c,u),e.__config?.debugMode&&console.log("[SignalTree] State restored from serialized data",{timestamp:u?.timestamp,version:u?.version})}catch(s){throw console.error("[SignalTree] Failed to deserialize:",s),new Error(`Failed to deserialize SignalTree state: ${s instanceof Error?s.message:"Unknown error"}`)}},r.snapshot=()=>{let o=r.toJSON(),i=ye(o);return{data:JSON.parse(JSON.stringify(o)),metadata:x({timestamp:Date.now(),version:"1.0.0"},i.length>0&&{circularRefs:i})}},r.restore=o=>{let{data:i,metadata:a}=o;a?.circularRefs&&un(i,a.circularRefs),r.fromJSON(i,a)},r}}var _r=Object.assign((n={})=>Re(n),{});function dn(n){let c=n,{key:e,storage:r=typeof window<"u"?window.localStorage:void 0,autoSave:t=!0,debounceMs:o=1e3,autoLoad:i=!0}=c,a=Pe(c,["key","storage","autoSave","debounceMs","autoLoad"]);if(!r)throw new Error("No storage adapter available. Provide a storage adapter in the config.");let s=r;return u=>{let d=Re(a)(u),E=null;if(d.save=()=>ne(null,null,function*(){try{let p=d.serialize(L(x({},a),{includeMetadata:!1}));if(n.skipCache||p!==E){let g=d.serialize(a);yield Promise.resolve(s.setItem(e,g)),E=p,u.__config?.debugMode&&console.log(`[SignalTree] State saved to storage key: ${e}`)}else u.__config?.debugMode&&console.log(`[SignalTree] State unchanged, skipping storage write for key: ${e}`)}catch(p){throw console.error("[SignalTree] Failed to save state:",p),p}}),d.load=()=>ne(null,null,function*(){try{let p=yield Promise.resolve(s.getItem(e));p&&(d.deserialize(p,a),E=d.serialize(L(x({},a),{includeMetadata:!1})),u.__config?.debugMode&&console.log(`[SignalTree] State loaded from storage key: ${e}`))}catch(p){throw console.error("[SignalTree] Failed to load state:",p),p}}),d.clear=()=>ne(null,null,function*(){try{yield Promise.resolve(s.removeItem(e)),E=null,u.__config?.debugMode&&console.log(`[SignalTree] State cleared from storage key: ${e}`)}catch(p){throw console.error("[SignalTree] Failed to clear state:",p),p}}),i&&setTimeout(()=>{d.load().catch(p=>{console.warn("[SignalTree] Auto-load failed:",p)})},0),t){let p,g=JSON.stringify(u()),b=!0,y=()=>{p&&clearTimeout(p),p=setTimeout(()=>{d.save().catch(m=>{console.error("[SignalTree] Auto-save failed:",m)})},o)};try{u.subscribe(()=>{let m=JSON.stringify(u());m!==g&&(g=m,y())})}catch{let m=()=>{if(!b)return;let l=JSON.stringify(u());l!==g&&(g=l,y()),setTimeout(m,100)};setTimeout(m,0)}d.__flushAutoSave=()=>(b=!1,p?(clearTimeout(p),p=void 0,d.save()):Promise.resolve())}return d}}var Dr=Object.assign(n=>dn(n),{});function Vn(){let n=new Map;return{trackMethodCall:(e,r,t)=>{let o=n.get(e);o?(o.lastActivity=new Date,o.operationCount++,o.averageExecutionTime=(o.averageExecutionTime*(o.operationCount-1)+t)/o.operationCount):n.set(e,{name:e,methods:[r],addedAt:new Date,lastActivity:new Date,operationCount:1,averageExecutionTime:t,errorCount:0})},trackError:(e,r,t)=>{let o=n.get(e);o&&o.errorCount++,console.error(`\u274C [${e}] Error${t?` in ${t}`:""}:`,r)},getModuleActivity:e=>n.get(e),getAllModules:()=>Array.from(n.values())}}function qn(){let n=[],e=(r,t,o)=>{n.push({timestamp:new Date,module:r,type:t,data:o}),n.length>1e3&&n.splice(0,n.length-1e3)};return{logComposition:(r,t)=>{e("core","composition",{modules:r,action:t}),console.log(`\u{1F517} Composition ${t}:`,r.join(" \u2192 "))},logMethodExecution:(r,t,o,i)=>{e(r,"method",{method:t,args:o,result:i}),console.debug(`\u{1F527} [${r}] ${t}`,{args:o,result:i})},logStateChange:(r,t,o,i)=>{e(r,"state",{path:t,oldValue:o,newValue:i}),console.debug(`\u{1F4DD} [${r}] State change at ${t}:`,{from:o,to:i})},logPerformanceWarning:(r,t,o,i)=>{e(r,"performance",{operation:t,duration:o,threshold:i}),console.warn(`\u26A0\uFE0F [${r}] Slow ${t}: ${o.toFixed(2)}ms (threshold: ${i}ms)`)},exportLogs:()=>[...n]}}function Gn(){return{logComposition:()=>{},logMethodExecution:()=>{},logStateChange:()=>{},logPerformanceWarning:()=>{},exportLogs:()=>[]}}function Jn(){let n=R({totalUpdates:0,moduleUpdates:{},modulePerformance:{},compositionChain:[],signalGrowth:{},memoryDelta:{},moduleCacheStats:{}});return{signal:n.asReadonly(),updateMetrics:e=>{n.update(r=>x(x({},r),e))},trackModuleUpdate:(e,r)=>{n.update(t=>L(x({},t),{totalUpdates:t.totalUpdates+1,moduleUpdates:L(x({},t.moduleUpdates),{[e]:(t.moduleUpdates[e]||0)+1}),modulePerformance:L(x({},t.modulePerformance),{[e]:r})}))}}}function $(n={}){let{enabled:e=!0,treeName:r="SignalTree",name:t,enableBrowserDevTools:o=!0,enableLogging:i=!0,performanceThreshold:a=16}=n,s=t??r;return c=>{if(!e)return Object.assign(c,{connectDevTools(){},disconnectDevTools(){}});let u=Vn(),T=i?qn():Gn(),d=Jn(),E=[],p=new Map,g=null,b=()=>{if(!(!o||typeof window>"u"||!("__REDUX_DEVTOOLS_EXTENSION__"in window)))try{g={send:window.__REDUX_DEVTOOLS_EXTENSION__.connect({name:s,features:{dispatch:!0,jump:!0,skip:!0}}).send},g.send("@@INIT",c()),console.log(`\u{1F517} Connected to Redux DevTools as "${s}"`)}catch(f){console.warn("[SignalTree] Failed to connect to Redux DevTools:",f)}},y=c.bind(c),m=function(...f){if(f.length===0)return y();let S=performance.now(),w;if(f.length===1){let A=f[0];w=y(A)}let v=performance.now()-S,k=y();return d.trackModuleUpdate("core",v),v>a&&T.logPerformanceWarning("core","update",v,a),g&&g.send("UPDATE",k),w};Object.setPrototypeOf(m,Object.getPrototypeOf(c)),ge(c,m),Object.defineProperty(m,"with",{value:function(f){if(typeof f!="function")throw new Error("Enhancer must be a function");return f(m)},writable:!1,enumerable:!1,configurable:!0}),"state"in c&&Object.defineProperty(m,"state",{value:c.state,enumerable:!1,configurable:!0}),"$"in c&&Object.defineProperty(m,"$",{value:c.$,enumerable:!1,configurable:!0});let l={activityTracker:u,logger:T,metrics:d.signal,trackComposition:f=>{E.push({timestamp:new Date,chain:[...f]}),d.updateMetrics({compositionChain:f}),T.logComposition(f,"with")},startModuleProfiling:f=>{let S=`${f}_${Date.now()}`;return p.set(S,{module:f,operation:"profile",startTime:performance.now()}),S},endModuleProfiling:f=>{let S=p.get(f);if(S){let w=performance.now()-S.startTime;u.trackMethodCall(S.module,S.operation,w),p.delete(f)}},connectDevTools:f=>{g&&(g.send("@@INIT",y()),console.log(`\u{1F517} Connected to Redux DevTools as "${f}"`))},exportDebugSession:()=>({metrics:d.signal(),modules:u.getAllModules(),logs:T.exportLogs(),compositionHistory:[...E]})},h={connectDevTools(){b()},disconnectDevTools(){g=null}};return m.__devTools=l,Object.assign(m,h)}}function fn(n="SignalTree"){return $({treeName:n,enabled:!0})}function gn(n="SignalTree"){return $({treeName:n,enabled:!0,enableBrowserDevTools:!0,enableLogging:!0,performanceThreshold:10})}function pn(){return $({enabled:!0,enableBrowserDevTools:!1,enableLogging:!1,performanceThreshold:50})}var Ur=Object.assign($,{production:pn,full:gn,enable:fn});function ee(n={}){let{enabled:e=!0}=n;return r=>{let t=[],o={effect(a){if(!e)return()=>{};let s,c=H(()=>{let T=r();s&&te(()=>s()),s=te(()=>a(T))}),u=()=>{s&&s(),c.destroy()};return t.push(u),u},subscribe(a){if(!e)return()=>{};let s=H(()=>{let u=r();te(()=>a(u))}),c=()=>{s.destroy()};return t.push(c),c}},i=r.destroy?.bind(r);return r.destroy=()=>{t.forEach(a=>a()),t.length=0,i&&i()},Object.assign(r,o)}}function Yn(){return ee({enabled:!0})}var Wr=Object.assign((n={})=>ee(n),{enable:Yn});function Tn(n,e={}){return arguments.length===0?{enhancer:i=>i.with(ee()).with(G()).with(j()).with(W()).with(B()).with($())}:xe(n,e).with(ee()).with(G(e.batching)).with(j(e.memoization)).with(W()).with(B(e.timeTravel)).with($(e.devTools))}var yn={};function Xn(n,e={}){return x({},e)}function Zn(){return Object.keys(yn)}function Qn(n,e=new Set,r=!1){let t=n.map((u,T)=>({fn:u,name:u.metadata&&u.metadata.name?String(u.metadata.name):`enhancer#${T}`,requires:new Set(u.metadata?.requires??[]),provides:new Set(u.metadata?.provides??[])})),o=new Map,i=new Map;for(let u of t)i.set(u.name,u),o.set(u.name,new Set);for(let u of t)for(let T of t)if(u!==T){for(let d of T.requires)if(!e.has(d)&&u.provides.has(d)){let E=o.get(u.name);E&&E.add(T.name)}}let a=new Map;for(let u of o.keys())a.set(u,0);for(let[,u]of o)for(let T of u)a.set(T,(a.get(T)||0)+1);let s=[];for(let[u,T]of a.entries())T===0&&s.push(u);let c=[];for(;s.length>0;){let u=s.shift();if(!u)break;c.push(u);let T=o.get(u);if(T)for(let d of T)a.set(d,(a.get(d)||0)-1),a.get(d)===0&&s.push(d)}return c.length!==t.length?(r&&console.warn(q.ENHANCER_CYCLE_DETECTED),n):c.map(u=>{let T=i.get(u);return T?T.fn:n[0]})}export{K as a,De as b,X as c,bn as d,F as e,Ke as f,En as g,kn as h,xe as i,Ye as j,On as k,Qn as l,G as m,Xe as n,tn as o,rn as p,j as q,$n as r,Fn as s,B as t,W as u,Re as v,dn as w,$ as x,Tn as y,Xn as z,Zn as A};
