import{w as N}from"./chunk-AQ5ZLTRX.js";import{i as $,j as w,m as F,u as V}from"./chunk-3DDI6FWM.js";import{Ab as u,Cb as m,Hc as R,Ja as l,Jb as y,Lb as o,Mb as b,Nb as x,Ob as U,Y as S,Ya as E,ab as P,ba as v,ha as g,hc as c,ia as f,ob as p,pb as n,qb as r,rb as I,sa as O,yb as T,yc as A,zc as D}from"./chunk-YYEXL5C7.js";import{j as h}from"./chunk-A3ECCK3J.js";function j(s,e){s&1&&(n(0,"div",21),o(1,"Loading users..."),r())}function W(s,e){if(s&1&&(n(0,"div",22),o(1),r()),s&2){let t=m();l(),b(t.usersError())}}function z(s,e){if(s&1){let t=T();n(0,"div",23),u("click",function(){let a=g(t).$implicit,d=m();return f(d.selectUser(a.id))})("keydown.enter",function(){let a=g(t).$implicit,d=m();return f(d.selectUser(a.id))})("keydown.space",function(a){let d=g(t).$implicit;return m().selectUser(d.id),f(a.preventDefault())}),n(1,"strong"),o(2),r(),o(3),I(4,"br"),n(5,"small"),o(6),r()()}if(s&2){let t=e.$implicit,i=m();y("selected",t.id===i.selectedUserId()),l(2),b(t.name),l(),x(" (",t.role,") "),l(3),b(t.email)}}function B(s,e){s&1&&(n(0,"div",21),o(1,"Loading posts..."),r())}function G(s,e){if(s&1&&(n(0,"div",22),o(1),r()),s&2){let t=m();l(),b(t.postsError())}}function H(s,e){if(s&1){let t=T();n(0,"div",24),u("click",function(){let a=g(t).$implicit,d=m();return f(d.selectPost(a.id))})("keydown.enter",function(){let a=g(t).$implicit,d=m();return f(d.selectPost(a.id))})("keydown.space",function(a){let d=g(t).$implicit;return m().selectPost(d.id),f(a.preventDefault())}),n(1,"div",25)(2,"strong"),o(3),r(),n(4,"span",26),o(5),r()(),n(6,"div",27),o(7),r(),n(8,"div",28),o(9),r()()}if(s&2){let t=e.$implicit,i=m();y("selected",t.id===i.selectedPostId()),l(3),b(t.title),l(),y("published",t.published),l(),x(" ",t.published?"Published":"Draft"," "),l(2),U(" By ",i.getAuthorName(t.authorId)," \u2022 ",t.likes," likes "),l(2),b(t.content)}}var C=class s{tree=$({users:{entities:w({selectId:e=>e.id}),loading:!1,error:null,selectedUserId:null},posts:{entities:w({selectId:e=>e.id}),loading:!1,error:null,filters:{authorId:null,published:null,search:""}},ui:{theme:"light",sidebarOpen:!1}}).with(V()).with(F());users=this.tree.$.users;posts=this.tree.$.posts;ui=this.tree.$.ui;static \u0275fac=function(t){return new(t||s)};static \u0275prov=S({token:s,factory:s.\u0275fac,providedIn:"root"})},M=class s{appTreeService=v(C);loadUserWithPosts(e){return h(this,null,function*(){try{this.appTreeService.users.loading.set(!0),this.appTreeService.posts.loading.set(!0),yield new Promise(a=>setTimeout(a,500));let t={id:e,name:`User ${e}`,email:`user${e}@example.com`,role:e===1?"admin":"user"},i=Array.from({length:3},(a,d)=>({id:e*100+d,title:`Post ${d+1} by User ${e}`,content:`This is post content ${d+1}...`,authorId:e,published:d<2,likes:Math.floor(Math.random()*50),createdAt:new Date}));this.appTreeService.tree.batch(()=>{this.appTreeService.users.entities.addOne(t),this.appTreeService.users.selectedUserId.set(e),i.forEach(a=>this.appTreeService.posts.entities.addOne(a))})}catch{this.appTreeService.users.error.set("Failed to load user"),this.appTreeService.posts.error.set("Failed to load posts")}finally{this.appTreeService.users.loading.set(!1),this.appTreeService.posts.loading.set(!1)}})}publishPost(e){return h(this,null,function*(){let t=this.appTreeService.posts.entities.byId(e),i=t?t():null;if(!i)throw new Error("Post not found");let a=this.appTreeService.users.entities.byId(i.authorId);if((a?a():null)?.role!=="admin")throw new Error("Only admins can publish posts");yield new Promise(_=>setTimeout(_,300)),this.appTreeService.posts.entities.updateOne(e,{published:!0})})}deleteUser(e){return h(this,null,function*(){let t=this.appTreeService.posts.entities.all().filter(i=>i.authorId===e);this.appTreeService.tree.batch(()=>{this.appTreeService.users.entities.removeOne(e),t.forEach(i=>this.appTreeService.posts.entities.removeOne(i.id)),this.appTreeService.users.selectedUserId()===e&&this.appTreeService.users.selectedUserId.set(null)})})}static \u0275fac=function(t){return new(t||s)};static \u0275prov=S({token:s,factory:s.\u0275fac,providedIn:"root"})},k=class s{getUsers(){return h(this,null,function*(){return yield new Promise(e=>setTimeout(e,300)),[{id:1,name:"Alice Admin",email:"alice@example.com",role:"admin"},{id:2,name:"Bob User",email:"bob@example.com",role:"user"},{id:3,name:"Carol Mod",email:"carol@example.com",role:"moderator"}]})}getPosts(){return h(this,null,function*(){return yield new Promise(e=>setTimeout(e,300)),[{id:101,title:"Welcome Post",content:"Welcome to our platform!",authorId:1,published:!0,likes:25,createdAt:new Date},{id:102,title:"Getting Started",content:"Here's how to get started...",authorId:1,published:!0,likes:15,createdAt:new Date},{id:201,title:"My First Post",content:"Hello world!",authorId:2,published:!1,likes:3,createdAt:new Date}]})}static \u0275fac=function(t){return new(t||s)};static \u0275prov=S({token:s,factory:s.\u0275fac,providedIn:"root"})},L=class s{appTreeService=v(C);facade=v(M);api=v(k);tree=this.appTreeService.tree;selectedPostId=O(null);allUsers=c(()=>this.appTreeService.users.entities.all());selectedUserId=c(()=>this.appTreeService.users.selectedUserId());selectedUser=c(()=>{let e=this.selectedUserId();if(!e)return null;let t=this.appTreeService.users.entities.byId(e);return t?t():null});allPosts=c(()=>this.appTreeService.posts.entities.all());searchTerm=c(()=>this.appTreeService.posts.filters.search());showPublishedOnly=c(()=>this.appTreeService.posts.filters.published()===!0);filteredPosts=c(()=>{let e=this.allPosts(),t=this.searchTerm().toLowerCase(),i=this.showPublishedOnly();return e.filter(a=>{let d=!t||a.title.toLowerCase().includes(t)||a.content.toLowerCase().includes(t),_=!i||a.published;return d&&_})});selectedPost=c(()=>{let e=this.selectedPostId();if(!e)return null;let t=this.tree.$.posts.entities.byId(e);return t?t():null});usersLoading=c(()=>this.appTreeService.users.loading());usersError=c(()=>this.appTreeService.users.error());postsLoading=c(()=>this.appTreeService.posts.loading());postsError=c(()=>this.appTreeService.posts.error());toggleTheme(){this.appTreeService.ui.theme.update(e=>e==="light"?"dark":"light")}toggleSidebar(){this.appTreeService.ui.sidebarOpen.update(e=>!e)}selectUser(e){this.appTreeService.users.selectedUserId.set(e)}selectPost(e){this.selectedPostId.set(e)}updateSearch(e){this.appTreeService.posts.filters.search.set(e)}togglePublishedFilter(){let e=this.appTreeService.posts.filters.published();this.appTreeService.posts.filters.published.set(e===!0?null:!0)}loadUserWithPosts(){return h(this,null,function*(){yield this.facade.loadUserWithPosts(1)})}publishPost(){return h(this,null,function*(){let e=this.selectedPost();if(e)try{yield this.facade.publishPost(e.id),alert("Post published successfully!")}catch(t){alert(`Failed to publish post: ${t}`)}})}deleteSelectedUser(){return h(this,null,function*(){let e=this.selectedUser();e&&confirm(`Delete user "${e.name}" and all their posts?`)&&(yield this.facade.deleteUser(e.id))})}getAuthorName(e){let t=this.appTreeService.users.entities.byId(e);return(t?t():null)?.name||"Unknown"}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=E({type:s,selectors:[["app-recommended-architecture"]],decls:91,vars:15,consts:[[1,"demo-container"],[1,"description"],[1,"demo-sections"],[1,"section"],[1,"controls"],[1,"btn",3,"click"],[1,"btn",3,"click","disabled"],[1,"btn","danger",3,"click","disabled"],[1,"state-grid"],[1,"state-section"],["class","loading",4,"ngIf"],["class","error",4,"ngIf"],[1,"items"],["class","item","tabindex","0","role","button",3,"selected","click","keydown.enter","keydown.space",4,"ngFor","ngForOf"],[1,"filters"],["type","text","placeholder","Search posts...",1,"search-input",3,"input","value"],["type","checkbox",3,"change","checked"],["class","item post-item","tabindex","0","role","button",3,"selected","click","keydown.enter","keydown.space",4,"ngFor","ngForOf"],[1,"section","explanation"],[1,"architecture-diagram"],[1,"layer"],[1,"loading"],[1,"error"],["tabindex","0","role","button",1,"item",3,"click","keydown.enter","keydown.space"],["tabindex","0","role","button",1,"item","post-item",3,"click","keydown.enter","keydown.space"],[1,"post-header"],[1,"status"],[1,"post-meta"],[1,"post-content"]],template:function(t,i){t&1&&(n(0,"div",0)(1,"h2"),o(2,"Recommended Architecture Demo"),r(),n(3,"p",1),o(4," This demo shows the recommended SignalTree architecture: Global tree + selective facades + direct component access. "),r(),n(5,"div",2)(6,"section",3)(7,"h3"),o(8,"1. Direct Tree Access (Simple Operations)"),r(),n(9,"div",4)(10,"button",5),u("click",function(){return i.toggleTheme()}),o(11),r(),n(12,"button",5),u("click",function(){return i.toggleSidebar()}),o(13),r()()(),n(14,"section",3)(15,"h3"),o(16,"2. Facade Orchestration (Complex Operations)"),r(),n(17,"div",4)(18,"button",6),u("click",function(){return i.loadUserWithPosts()}),o(19," Load User + Posts "),r(),n(20,"button",6),u("click",function(){return i.publishPost()}),o(21," Publish Selected Post "),r(),n(22,"button",7),u("click",function(){return i.deleteSelectedUser()}),o(23," Delete User + Posts "),r()()(),n(24,"section",3)(25,"h3"),o(26,"3. State Display (Reactive Reads)"),r(),n(27,"div",8)(28,"div",9)(29,"h4"),o(30),r(),P(31,j,2,0,"div",10)(32,W,2,1,"div",11),n(33,"div",12),P(34,z,7,5,"div",13),r()(),n(35,"div",9)(36,"h4"),o(37),r(),P(38,B,2,0,"div",10)(39,G,2,1,"div",11),n(40,"div",14)(41,"input",15),u("input",function(d){return i.updateSearch(d.target.value)}),r(),n(42,"label")(43,"input",16),u("change",function(){return i.togglePublishedFilter()}),r(),o(44," Published only "),r()(),n(45,"div",12),P(46,H,10,9,"div",17),r()()()(),n(47,"section",18)(48,"h3"),o(49,"4. Architecture Explanation"),r(),n(50,"div",19)(51,"div",20)(52,"h4"),o(53,"Components"),r(),n(54,"ul")(55,"li"),o(56,"Inject APP_TREE directly for reads"),r(),n(57,"li"),o(58,"Inject facades for orchestrated operations"),r(),n(59,"li"),o(60,"Use local signals for UI-only state"),r()()(),n(61,"div",20)(62,"h4"),o(63,"Facades (Selective)"),r(),n(64,"ul")(65,"li"),o(66,"Multi-step workflows"),r(),n(67,"li"),o(68,"Cross-domain coordination"),r(),n(69,"li"),o(70,"Business rule validation"),r()()(),n(71,"div",20)(72,"h4"),o(73,"Global Tree"),r(),n(74,"ul")(75,"li"),o(76,"All shared state"),r(),n(77,"li"),o(78,"Entities with entities()"),r(),n(79,"li"),o(80,"Unified dot notation access"),r()()(),n(81,"div",20)(82,"h4"),o(83,"API Services"),r(),n(84,"ul")(85,"li"),o(86,"HTTP calls only"),r(),n(87,"li"),o(88,"No state management"),r(),n(89,"li"),o(90,"Return typed data"),r()()()()()()()),t&2&&(l(11),x(" Toggle Theme: ",i.tree.$.ui.theme()," "),l(2),x(" Sidebar: ",i.tree.$.ui.sidebarOpen()?"Open":"Closed"," "),l(5),p("disabled",i.usersLoading()),l(2),p("disabled",!i.selectedPost()),l(2),p("disabled",!i.selectedUser()),l(8),x("Users (",i.allUsers().length,")"),l(),p("ngIf",i.usersLoading()),l(),p("ngIf",i.usersError()),l(2),p("ngForOf",i.allUsers()),l(3),x("Posts (",i.filteredPosts().length,")"),l(),p("ngIf",i.postsLoading()),l(),p("ngIf",i.postsError()),l(2),p("value",i.searchTerm()),l(2),p("checked",i.showPublishedOnly()),l(3),p("ngForOf",i.filteredPosts()))},dependencies:[R,A,D,N],styles:[".demo-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:20px}.description[_ngcontent-%COMP%]{color:#666;margin-bottom:30px;font-style:italic}.demo-sections[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:30px}.section[_ngcontent-%COMP%]{border:1px solid #ddd;border-radius:8px;padding:20px;background:#fafafa}.section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;color:#333;border-bottom:2px solid #007acc;padding-bottom:8px}.controls[_ngcontent-%COMP%]{display:flex;gap:10px;flex-wrap:wrap;margin-top:15px}.btn[_ngcontent-%COMP%]{padding:8px 16px;border:1px solid #007acc;background:#fff;color:#007acc;border-radius:4px;cursor:pointer;transition:all .2s}.btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#007acc;color:#fff}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn.danger[_ngcontent-%COMP%]{border-color:#dc3545;color:#dc3545}.btn.danger[_ngcontent-%COMP%]:hover:not(:disabled){background:#dc3545;color:#fff}.state-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px}.state-section[_ngcontent-%COMP%]{background:#fff;border:1px solid #ddd;border-radius:4px;padding:15px}.state-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-top:0;color:#555;border-bottom:1px solid #eee;padding-bottom:5px}.loading[_ngcontent-%COMP%]{color:#007acc;font-style:italic;margin-bottom:10px}.error[_ngcontent-%COMP%]{color:#dc3545;background:#f8d7da;border:1px solid #f5c6cb;padding:8px;border-radius:4px;margin-bottom:10px}.filters[_ngcontent-%COMP%]{margin-bottom:15px;display:flex;gap:15px;align-items:center}.search-input[_ngcontent-%COMP%]{padding:6px 12px;border:1px solid #ddd;border-radius:4px;flex:1}.items[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}.item[_ngcontent-%COMP%]{padding:10px;border:1px solid #eee;border-radius:4px;margin-bottom:8px;cursor:pointer;transition:background .2s}.item[_ngcontent-%COMP%]:hover{background:#f8f9fa}.item.selected[_ngcontent-%COMP%]{background:#e3f2fd;border-color:#007acc}.post-item[_ngcontent-%COMP%]{cursor:pointer}.post-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px}.status[_ngcontent-%COMP%]{font-size:.8em;padding:2px 6px;border-radius:3px;background:#dc3545;color:#fff}.status.published[_ngcontent-%COMP%]{background:#28a745}.post-meta[_ngcontent-%COMP%]{font-size:.9em;color:#666;margin-bottom:8px}.post-content[_ngcontent-%COMP%]{font-size:.9em;color:#555}.explanation[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.explanation[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fff;border-bottom-color:#ffffff4d}.architecture-diagram[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:20px;margin-top:20px}.layer[_ngcontent-%COMP%]{flex:1;background:#ffffff1a;border:1px solid rgba(255,255,255,.2);border-radius:8px;padding:15px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.layer[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-top:0;color:#fff;text-align:center;border-bottom:1px solid rgba(255,255,255,.3);padding-bottom:8px}.layer[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:10px 0 0;padding-left:20px}.layer[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:5px;font-size:.9em}@media (max-width: 768px){.state-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.architecture-diagram[_ngcontent-%COMP%], .controls[_ngcontent-%COMP%]{flex-direction:column}.btn[_ngcontent-%COMP%]{width:100%}}"]})};export{C as a,M as b,k as c,L as d};
