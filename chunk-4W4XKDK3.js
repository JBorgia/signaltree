import{a as m,bc as P,cc as M,ia as C,ua as D,ya as w,za as g}from"./chunk-Z7YHEQZ3.js";var S={MAX_PATH_CACHE_SIZE:1e3,LAZY_THRESHOLD:50,ESTIMATE_MAX_DEPTH:3,ESTIMATE_SAMPLE_SIZE_ARRAY:3,ESTIMATE_SAMPLE_SIZE_OBJECT:5,DEFAULT_CACHE_SIZE:100,DEFAULT_BATCH_SIZE:10},B={NULL_OR_UNDEFINED:"null/undefined",CIRCULAR_REF:"circular ref",UPDATER_INVALID:"updater invalid",LAZY_FALLBACK:"lazy fallback",SIGNAL_CREATION_FAILED:"signal creation failed",UPDATE_PATH_NOT_FOUND:"update path not found",UPDATE_FAILED:"update failed",ROLLBACK_FAILED:"rollback failed",CLEANUP_ERROR:"cleanup error",PRESET_UNKNOWN:"unknown preset",STRATEGY_SELECTION:"strategy select",TREE_DESTROYED:"destroyed",UPDATE_TRANSACTION:"update tx",BATCH_NOT_ENABLED:"batching disabled",MEMOIZE_NOT_ENABLED:"memoize disabled",MIDDLEWARE_NOT_AVAILABLE:"middleware missing",ENTITY_HELPERS_NOT_AVAILABLE:"entity helpers missing",ASYNC_ACTIONS_NOT_AVAILABLE:"async actions missing",TIME_TRAVEL_NOT_AVAILABLE:"time travel missing",OPTIMIZE_NOT_AVAILABLE:"optimize missing",CACHE_NOT_AVAILABLE:"cache missing",PERFORMANCE_NOT_ENABLED:"performance disabled",ENHANCER_ORDER_FAILED:"enhancer order failed",ENHANCER_CYCLE_DETECTED:"enhancer cycle",ENHANCER_REQUIREMENT_MISSING:"enhancer req missing",ENHANCER_PROVIDES_MISSING:"enhancer provides missing",ENHANCER_FAILED:"enhancer failed",ENHANCER_NOT_FUNCTION:"enhancer not function",EFFECT_NO_CONTEXT:"no angular context",SUBSCRIBE_NO_CONTEXT:"no angular context"},U=(()=>{let e={},n=0;for(let s of Object.keys(B))e[s]=String(n++);return e})(),Q=typeof globalThis=="object"&&globalThis!==null&&"process"in globalThis&&typeof globalThis.process=="object"&&"env"in globalThis.process&&globalThis.process.env.NODE_ENV==="production",j=!1,f=Object.freeze(j?B:U);function x(e,n=new Set,s=!1){let t=e.map((a,l)=>({fn:a,name:a.metadata&&a.metadata.name?String(a.metadata.name):`enhancer#${l}`,requires:new Set(a.metadata?.requires??[]),provides:new Set(a.metadata?.provides??[])})),o=new Map,r=new Map;for(let a of t)r.set(a.name,a),o.set(a.name,new Set);for(let a of t)for(let l of t)if(a!==l){for(let T of l.requires)if(!n.has(T)&&a.provides.has(T)){let d=o.get(a.name);d&&d.add(l.name)}}let i=new Map;for(let a of o.keys())i.set(a,0);for(let[,a]of o)for(let l of a)i.set(l,(i.get(l)||0)+1);let u=[];for(let[a,l]of i.entries())l===0&&u.push(a);let c=[];for(;u.length>0;){let a=u.shift();if(!a)break;c.push(a);let l=o.get(a);if(l)for(let T of l)i.set(T,(i.get(T)||0)-1),i.get(T)===0&&u.push(T)}return c.length!==t.length?(s&&console.warn(f.ENHANCER_CYCLE_DETECTED),e):c.map(a=>{let l=r.get(a);return l?l.fn:e[0]})}var W=Symbol.for("NodeAccessor");function h(e,n){if(e===n)return!0;if(e==null||n==null)return e===n;let s=typeof e;if(s!==typeof n||s!=="object")return!1;if(e instanceof Date&&n instanceof Date)return e.getTime()===n.getTime();if(e instanceof RegExp&&n instanceof RegExp)return e.source===n.source&&e.flags===n.flags;if(e instanceof Map&&n instanceof Map){if(e.size!==n.size)return!1;for(let[c,a]of e)if(!n.has(c)||!h(a,n.get(c)))return!1;return!0}if(e instanceof Set&&n instanceof Set){if(e.size!==n.size)return!1;for(let c of e)if(!n.has(c))return!1;return!0}if(Array.isArray(e))return!Array.isArray(n)||e.length!==n.length?!1:e.every((c,a)=>h(c,n[a]));if(Array.isArray(n))return!1;let o=e,r=n,i=Object.keys(o),u=Object.keys(r);return i.length!==u.length?!1:i.every(c=>c in r&&h(o[c],r[c]))}function y(e){if(e==null)return!1;if(e instanceof Date||e instanceof RegExp||typeof e=="function"||e instanceof Map||e instanceof Set||e instanceof WeakMap||e instanceof WeakSet||e instanceof ArrayBuffer||e instanceof DataView||e instanceof Error||e instanceof Promise||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof BigInt64Array||e instanceof BigUint64Array||typeof window<"u"&&(e instanceof URL||e instanceof URLSearchParams||e instanceof FormData||e instanceof Blob||typeof File<"u"&&e instanceof File||typeof FileList<"u"&&e instanceof FileList||typeof Headers<"u"&&e instanceof Headers||typeof Request<"u"&&e instanceof Request||typeof Response<"u"&&e instanceof Response||typeof AbortController<"u"&&e instanceof AbortController||typeof AbortSignal<"u"&&e instanceof AbortSignal))return!0;try{let n=globalThis?.Buffer;if(n&&e instanceof n)return!0}catch{}return!1}function _(e){return typeof e=="function"&&e&&W in e}function F(e){return w(e)||_(e)}var O=class{constructor(n){this.maxSize=n}cache=new Map;set(n,s){if(this.cache.size>=this.maxSize){let t=this.cache.keys().next().value;t!==void 0&&this.cache.delete(t)}this.cache.delete(n),this.cache.set(n,s)}get(n){let s=this.cache.get(n);return s!==void 0&&(this.cache.delete(n),this.cache.set(n,s)),s}clear(){this.cache.clear()}size(){return this.cache.size}},v=new O(S.MAX_PATH_CACHE_SIZE);function G(e){let n=v.get(e);if(n)return n;let s=e.split(".");return v.set(e,s),s}function q(...e){return n=>e.reduce((s,t)=>t(s),n)}function R(e,n,s=""){let t=new Map,o=new Map,r=new Map,i=()=>{r.forEach(c=>{try{c()}catch(a){console.warn("Error during nested cleanup:",a)}}),r.clear(),t.clear(),o.clear()};return new Proxy(e,{get(c,a){if(a==="__cleanup__")return i;if(typeof a=="symbol"||a==="valueOf"||a==="toString")return c[a];let l=a,T=s?`${s}.${l}`:l;if(!(l in c))return;let d=c[l];if(w(d))return d;if(t.has(T))return t.get(T);if(o.has(T))return o.get(T);if(d&&typeof d=="object"&&!Array.isArray(d)&&!w(d)&&!y(d))try{let E=R(d,n,T);o.set(T,E);let A=E;return typeof A.__cleanup__=="function"&&r.set(T,A.__cleanup__),E}catch(E){console.warn(`Failed to create lazy proxy for path "${T}":`,E);let A=g(d,{equal:n});return t.set(T,A),A}try{let E=g(d,{equal:n});return t.set(T,E),E}catch(E){return console.warn(`Failed to create signal for path "${T}":`,E),d}},set(c,a,l){if(typeof a=="symbol")return c[a]=l,!0;let T=a,d=s?`${s}.${T}`:T;try{c[T]=l;let E=t.get(d);if(E&&"set"in E&&E.set(l),o.has(d)){let A=r.get(d);A&&(A(),r.delete(d)),o.delete(d)}return!0}catch(E){return console.warn(`Failed to set value for path "${d}":`,E),!1}},has(c,a){return a in c},ownKeys(c){return Reflect.ownKeys(c)},getOwnPropertyDescriptor(c,a){return Reflect.getOwnPropertyDescriptor(c,a)}})}function p(e){if(e==null)return e;if(_(e)){let t={};for(let o in e){if(!Object.prototype.hasOwnProperty.call(e,o)||o==="length"||o==="prototype")continue;if(o==="name"){let i=e[o];if(!w(i)&&!_(i))continue}let r=e[o];if(_(r))t[o]=p(r);else if(w(r)){let i=r();typeof i=="object"&&i!==null&&!Array.isArray(i)&&!y(i)?t[o]=p(i):t[o]=i}else typeof r=="object"&&r!==null&&!Array.isArray(r)&&!y(r)?t[o]=p(r):t[o]=r}return t}if(w(e)){let t=e();return typeof t=="object"&&t!==null&&!Array.isArray(t)&&!y(t)?p(t):t}if(typeof e!="object"||Array.isArray(e)||y(e))return e;let n={};for(let t in e){if(!Object.prototype.hasOwnProperty.call(e,t)||(t==="set"||t==="update")&&typeof e[t]=="function")continue;let o=e[t];if(_(o)){let r=o();typeof r=="object"&&r!==null&&!Array.isArray(r)&&!y(r)?n[t]=p(r):n[t]=r}else if(w(o)){let r=o();typeof r=="object"&&r!==null&&!Array.isArray(r)&&!y(r)?n[t]=p(r):n[t]=r}else typeof o=="object"&&o!==null&&!Array.isArray(o)&&!y(o)?n[t]=p(o):n[t]=o}let s=Object.getOwnPropertySymbols(e);for(let t of s){let o=e[t];if(_(o)){let r=o();typeof r=="object"&&r!==null&&!Array.isArray(r)&&!y(r)?n[t]=p(r):n[t]=r}else if(w(o)){let r=o();typeof r=="object"&&r!==null&&!Array.isArray(r)&&!y(r)?n[t]=p(r):n[t]=r}else typeof o=="object"&&o!==null&&!Array.isArray(o)&&!y(o)?n[t]=p(o):n[t]=o}return n}var k=Symbol.for("NodeAccessor");function Y(){let e=function(n){if(arguments.length===0)return p(e);if(typeof n=="function"){let s=n,t=p(e),o=s(t);N(e,o)}else N(e,n)};return e[k]=!0,e}function Z(e,n){let s=function(t){if(arguments.length===0)return e();if(typeof t=="function"){let o=t;n.set(o(e()))}else n.set(t)};return s[k]=!0,s}function N(e,n){if(!n||typeof n!="object")return;let s;if(z(e))s=e;else if(e&&typeof e=="object")s=e;else return;let t=n;for(let o in t){if(!(o in s))continue;let r=s[o],i=t[o];w(r)?"set"in r&&typeof r.set=="function"&&r.set(i):z(r)&&(i&&typeof i=="object"?N(r,i):r(i))}}function z(e){return typeof e=="function"&&e&&e[k]===!0}function b(e,n=S.ESTIMATE_MAX_DEPTH,s=0){if(s>=n)return 1;if(e==null)return 0;if(typeof e!="object")return 1;let t=0;try{if(Array.isArray(e)){t=e.length;let o=Math.min(S.ESTIMATE_SAMPLE_SIZE_ARRAY,e.length);for(let r=0;r<o;r++)t+=b(e[r],n,s+1)*.1}else{let o=Object.keys(e);t=o.length;let r=Math.min(S.ESTIMATE_SAMPLE_SIZE_OBJECT,o.length);for(let i=0;i<r;i++){let u=e[o[i]];t+=b(u,n,s+1)*.5}}}catch{return 1}return Math.floor(t)}function V(e,n,s){return n.useLazySignals!==void 0?n.useLazySignals:n.debugMode||n.enableDevTools?!1:n.batchUpdates&&n.useMemoization?!0:(s??b(e))>S.LAZY_THRESHOLD}function $(e){return e?Object.is:h}function I(e,n){if(e==null||typeof e!="object")return g(e,{equal:n});if(Array.isArray(e))return g(e,{equal:n});if(y(e))return g(e,{equal:n});let s={},t=new WeakSet;if(t.has(e))return console.warn(f.CIRCULAR_REF),g(e,{equal:n});t.add(e);try{for(let[r,i]of Object.entries(e))try{if(typeof r=="symbol")continue;if(w(i)){s[r]=i;continue}if(i==null)s[r]=g(i,{equal:n});else if(typeof i!="object")s[r]=g(i,{equal:n});else if(Array.isArray(i)||y(i))s[r]=g(i,{equal:n});else{let u=I(i,n),c=Y();for(let a in u)if(Object.prototype.hasOwnProperty.call(u,a))try{Object.defineProperty(c,a,{value:u[a],enumerable:!0,configurable:!0})}catch{}s[r]=c}}catch(u){console.warn(`${f.SIGNAL_CREATION_FAILED} "${r}":`,u),s[r]=g(i,{equal:n})}let o=Object.getOwnPropertySymbols(e);for(let r of o){let i=e[r];try{w(i)?s[r]=i:s[r]=g(i,{equal:n})}catch(u){console.warn(f.SIGNAL_CREATION_FAILED,u)}}}catch(o){throw new Error(`Failed to create signal store: ${o instanceof Error?o.message:"Unknown error"}`)}return s}function H(e,n={}){let s=n.useLazySignals??V(e.state,n);return e.with=(...t)=>{if(t.length===0)return e;let o=new Set;n.batchUpdates&&o.add("batchUpdate"),n.useMemoization&&o.add("memoize"),n.enableTimeTravel&&o.add("undo"),n.enableDevTools&&o.add("connectDevTools");try{for(let a of Object.keys(e))o.add(String(a))}catch{}let r=t.some(a=>!!(a.metadata&&(a.metadata.requires||a.metadata.provides))),i=t;if(r)try{i=x(t,o,n.debugMode)}catch(a){console.warn(f.ENHANCER_ORDER_FAILED,a)}let u=new Set(o),c=e;for(let a=0;a<i.length;a++){let l=i[a];if(typeof l!="function")throw new Error(f.ENHANCER_NOT_FUNCTION.replace("%d",String(a)));let T=l.metadata?.requires??[];for(let d of T)if(!(d in c)&&!u.has(d)){let E=l.metadata?.name??`enhancer#${a}`,A=f.ENHANCER_REQUIREMENT_MISSING.replace("%s",E).replace("%s",d);if(n.debugMode)throw new Error(A);console.warn(A)}try{let d=l(c);d!==c&&(c=d);let E=l.metadata?.provides??[];for(let A of E)u.add(A);if(n.debugMode&&E.length>0)for(let A of E)A in c||console.warn(f.ENHANCER_PROVIDES_MISSING.replace("%s",l.metadata?.name??String(a)).replace("%s",A))}catch(d){let E=l.metadata?.name||`enhancer at index ${a}`;throw console.error(f.ENHANCER_FAILED.replace("%s",E),d),n.debugMode&&(console.error("[SignalTree] Enhancer stack trace:",l),console.error("[SignalTree] Tree state at failure:",c)),d}}return c},e.destroy=()=>{try{if(s){let t=e.state;if(t&&typeof t=="object"&&"__cleanup__"in t){let o=t.__cleanup__;typeof o=="function"&&o()}}n.debugMode&&console.log(f.TREE_DESTROYED)}catch(t){console.error(f.CLEANUP_ERROR,t)}},K(e,n),e}function K(e,n){e.batchUpdate=s=>{console.warn(f.BATCH_NOT_ENABLED),e(t=>{let o=s(t);return m(m({},t),o)})},e.memoize=(s,t)=>(console.warn(f.MEMOIZE_NOT_ENABLED),P(()=>s(e()))),e.memoizedUpdate=s=>{n.debugMode&&console.warn(f.MEMOIZE_NOT_ENABLED),e(t=>m(m({},t),s(t)))},e.clearMemoCache=()=>{n.debugMode&&console.warn(f.MEMOIZE_NOT_ENABLED)},e.getCacheStats=()=>({size:0,hitRate:0,totalHits:0,totalMisses:0,keys:[]}),e.effect=s=>{try{M(()=>s(e()))}catch(t){n.debugMode&&console.warn(f.EFFECT_NO_CONTEXT,t)}},e.subscribe=s=>{try{let t=C(D),o=!1,r=M(()=>{o||s(e())}),i=()=>{o=!0,r.destroy()};return t.onDestroy(i),i}catch(t){return n.debugMode&&console.warn(f.SUBSCRIBE_NO_CONTEXT,t),s(e()),()=>{}}},e.optimize=()=>{n.debugMode&&console.warn(f.OPTIMIZE_NOT_AVAILABLE)},e.clearCache=()=>{n.debugMode&&console.warn(f.CACHE_NOT_AVAILABLE)},e.invalidatePattern=()=>(n.debugMode&&console.warn(f.PERFORMANCE_NOT_ENABLED),0),e.getMetrics=()=>({updates:0,computations:0,cacheHits:0,cacheMisses:0,averageUpdateTime:0}),e.addTap=s=>{n.debugMode&&console.warn(f.MIDDLEWARE_NOT_AVAILABLE)},e.removeTap=s=>{n.debugMode&&console.warn(f.MIDDLEWARE_NOT_AVAILABLE)},e.entities=()=>(n.debugMode&&console.warn(f.ENTITY_HELPERS_NOT_AVAILABLE),{}),e.asyncAction=(s,t={})=>(n.debugMode&&console.warn(f.ASYNC_ACTIONS_NOT_AVAILABLE),{}),e.undo=()=>{n.debugMode&&console.warn(f.TIME_TRAVEL_NOT_AVAILABLE)},e.redo=()=>{n.debugMode&&console.warn(f.TIME_TRAVEL_NOT_AVAILABLE)},e.getHistory=()=>(n.debugMode&&console.warn(f.TIME_TRAVEL_NOT_AVAILABLE),[]),e.resetHistory=()=>{n.debugMode&&console.warn(f.TIME_TRAVEL_NOT_AVAILABLE)}}function L(e,n={}){if(e==null)throw new Error(f.NULL_OR_UNDEFINED);let s=b(e),t=$(n.useShallowComparison??!1);if(Array.isArray(e)){let u=g(e,{equal:t}),c=Z(u,u);return Object.defineProperty(c,"state",{value:u,enumerable:!1}),Object.defineProperty(c,"$",{value:u,enumerable:!1}),H(c,n),c}let o=V(e,n,s);n.debugMode&&console.log(f.STRATEGY_SELECTION.replace("%s",o?"lazy":"eager").replace("%d",String(s)));let r;try{o&&typeof e=="object"?r=R(e,t):r=I(e,t)}catch(u){if(o)console.warn(f.LAZY_FALLBACK,u),r=I(e,t);else throw u}let i=function(u){if(arguments.length===0)return p(r);if(typeof u=="function"){let c=u,a=p(r),l=c(a);N(r,l)}else N(r,u)};Object.defineProperty(i,k,{value:!0,enumerable:!1}),Object.defineProperty(i,"state",{value:r,enumerable:!1}),Object.defineProperty(i,"$",{value:r,enumerable:!1}),H(i,n);for(let u in r)if(Object.prototype.hasOwnProperty.call(r,u)&&!(u in i))try{Object.defineProperty(i,u,{value:r[u],enumerable:!0,configurable:!0})}catch{}return i}var X={basic:{useLazySignals:!1,debugMode:!1},performance:{useLazySignals:!0,batchUpdates:!0,useMemoization:!0,useShallowComparison:!0},development:{useLazySignals:!1,debugMode:!0,enableDevTools:!0,trackPerformance:!0},production:{useLazySignals:!0,batchUpdates:!0,useMemoization:!0,debugMode:!1}};function J(e,n){if(typeof n=="string"){let t=X[n];return t?L(e,t):(console.warn(f.PRESET_UNKNOWN.replace("%s",n)),L(e,{}))}return L(e,n||{})}export{_ as a,F as b,G as c,q as d,J as e};
