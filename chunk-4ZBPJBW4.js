import{$ as ue,Xb as I,Yb as ee,la as fe,pa as S,qa as R}from"./chunk-MX75YDMR.js";import{a as y,b as D}from"./chunk-A3ECCK3J.js";var Ie=Object.freeze({PATH_CACHE_SIZE:1e3}),V=Ie.PATH_CACHE_SIZE;var de=typeof globalThis=="object"&&globalThis!==null?globalThis.structuredClone:void 0;function F(n){if(de)try{return de(n)}catch{}return P(n,new WeakMap)}function P(n,e){if(n===null||typeof n!="object"||typeof n=="function")return n;let i=e.get(n);if(i)return i;if(n instanceof Date)return new Date(n.getTime());if(n instanceof RegExp)return new RegExp(n.source,n.flags);if(n instanceof Map){let t=new Map;e.set(n,t);for(let[a,c]of n)t.set(P(a,e),P(c,e));return t}if(n instanceof Set){let t=new Set;e.set(n,t);for(let a of n)t.add(P(a,e));return t}if(Array.isArray(n)){let t=new Array(n.length);e.set(n,t);for(let a=0;a<n.length;a++)t[a]=P(n[a],e);return t}if(ArrayBuffer.isView(n)){if(n instanceof DataView){let c=P(n.buffer,e);return new DataView(c,n.byteOffset,n.byteLength)}let t=n;if(typeof t.slice=="function")return t.slice();let a=P(n.buffer,e);return new n.constructor(a,n.byteOffset,n.length)}if(n instanceof ArrayBuffer)return n.slice(0);let r=Object.getPrototypeOf(n),o=r?Object.create(r):{};e.set(n,o);for(let t of Reflect.ownKeys(n)){let a=Object.getOwnPropertyDescriptor(n,t);a&&("value"in a&&(a.value=P(a.value,e)),Object.defineProperty(o,t,a))}return o}function v(n,e){if(n===e)return!0;if(n==null||e==null)return n===e;let i=typeof n;if(i!==typeof e||i!=="object")return!1;if(n instanceof Date&&e instanceof Date)return n.getTime()===e.getTime();if(n instanceof RegExp&&e instanceof RegExp)return n.source===e.source&&n.flags===e.flags;if(n instanceof Map&&e instanceof Map){if(n.size!==e.size)return!1;for(let[l,s]of n)if(!e.has(l)||!v(s,e.get(l)))return!1;return!0}if(n instanceof Set&&e instanceof Set){if(n.size!==e.size)return!1;for(let l of n)if(!e.has(l))return!1;return!0}if(Array.isArray(n))return!Array.isArray(e)||n.length!==e.length?!1:n.every((l,s)=>v(l,e[s]));if(Array.isArray(e))return!1;let o=n,t=e,a=Object.keys(o),c=Object.keys(t);return a.length!==c.length?!1:a.every(l=>l in t&&v(o[l],t[l]))}function k(n){if(n==null)return!1;if(n instanceof Date||n instanceof RegExp||typeof n=="function"||n instanceof Map||n instanceof Set||n instanceof WeakMap||n instanceof WeakSet||n instanceof ArrayBuffer||n instanceof DataView||n instanceof Error||n instanceof Promise||n instanceof Int8Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray||n instanceof Int16Array||n instanceof Uint16Array||n instanceof Int32Array||n instanceof Uint32Array||n instanceof Float32Array||n instanceof Float64Array||n instanceof BigInt64Array||n instanceof BigUint64Array||typeof window<"u"&&(n instanceof URL||n instanceof URLSearchParams||n instanceof FormData||n instanceof Blob||typeof File<"u"&&n instanceof File||typeof FileList<"u"&&n instanceof FileList||typeof Headers<"u"&&n instanceof Headers||typeof Request<"u"&&n instanceof Request||typeof Response<"u"&&n instanceof Response||typeof AbortController<"u"&&n instanceof AbortController||typeof AbortSignal<"u"&&n instanceof AbortSignal))return!0;try{let e=globalThis?.Buffer;if(e&&n instanceof e)return!0}catch{}return!1}var x=class{constructor(e){this.maxSize=e;if(!Number.isFinite(e)||e<=0)throw new Error("LRUCache maxSize must be a positive, finite number")}cache=new Map;set(e,i){if(this.cache.has(e)&&this.cache.delete(e),this.cache.set(e,i),this.cache.size>this.maxSize){let r=this.cache.keys().next().value;r!==void 0&&this.cache.delete(r)}}get(e){if(!this.cache.has(e))return;let i=this.cache.get(e);return i!==void 0&&(this.cache.delete(e),this.cache.set(e,i)),i}delete(e){this.cache.delete(e)}has(e){return this.cache.has(e)}clear(){this.cache.clear()}size(){return this.cache.size}forEach(e){this.cache.forEach((i,r)=>e(i,r))}entries(){return this.cache.entries()}keys(){return this.cache.keys()}resize(e){if(!Number.isFinite(e)||e<=0)throw new Error("LRUCache newSize must be a positive, finite number");for(this.maxSize=e;this.cache.size>this.maxSize;){let i=this.cache.keys().next().value;if(i===void 0)break;this.cache.delete(i)}}};var ge=new x(V);function ne(n){let e=ge.get(n);if(e)return e;let i=n.split(".");return ge.set(n,i),i}var L={MAX_PATH_CACHE_SIZE:V,LAZY_THRESHOLD:50,ESTIMATE_MAX_DEPTH:3,ESTIMATE_SAMPLE_SIZE_ARRAY:3,ESTIMATE_SAMPLE_SIZE_OBJECT:5,DEFAULT_CACHE_SIZE:100,DEFAULT_BATCH_SIZE:10},pe={NULL_OR_UNDEFINED:"null/undefined",CIRCULAR_REF:"circular ref",UPDATER_INVALID:"updater invalid",LAZY_FALLBACK:"lazy fallback",SIGNAL_CREATION_FAILED:"signal creation failed",UPDATE_PATH_NOT_FOUND:"update path not found",UPDATE_FAILED:"update failed",ROLLBACK_FAILED:"rollback failed",CLEANUP_ERROR:"cleanup error",PRESET_UNKNOWN:"unknown preset",STRATEGY_SELECTION:"strategy select",TREE_DESTROYED:"destroyed",UPDATE_TRANSACTION:"update tx",BATCH_NOT_ENABLED:"batching disabled",MEMOIZE_NOT_ENABLED:"memoize disabled",MIDDLEWARE_NOT_AVAILABLE:"middleware missing",ENTITY_HELPERS_NOT_AVAILABLE:"entity helpers missing",ASYNC_ACTIONS_NOT_AVAILABLE:"async actions missing",TIME_TRAVEL_NOT_AVAILABLE:"time travel missing",OPTIMIZE_NOT_AVAILABLE:"optimize missing",UPDATE_OPTIMIZED_NOT_AVAILABLE:"update optimized missing",CACHE_NOT_AVAILABLE:"cache missing",PERFORMANCE_NOT_ENABLED:"performance disabled",ENHANCER_ORDER_FAILED:"enhancer order failed",ENHANCER_CYCLE_DETECTED:"enhancer cycle",ENHANCER_REQUIREMENT_MISSING:"enhancer req missing",ENHANCER_PROVIDES_MISSING:"enhancer provides missing",ENHANCER_FAILED:"enhancer failed",ENHANCER_NOT_FUNCTION:"enhancer not function",EFFECT_NO_CONTEXT:"no angular context",SUBSCRIBE_NO_CONTEXT:"no angular context"},xe=(()=>{let n={},e=0;for(let i of Object.keys(pe))n[i]=String(e++);return n})(),bn=typeof globalThis=="object"&&globalThis!==null&&"process"in globalThis&&typeof globalThis.process=="object"&&"env"in globalThis.process&&globalThis.process.env.NODE_ENV==="production",Ne=!1,m=Object.freeze(Ne?pe:xe);function he(n,e=new Set,i=!1){let r=n.map((s,f)=>({fn:s,name:s.metadata&&s.metadata.name?String(s.metadata.name):`enhancer#${f}`,requires:new Set(s.metadata?.requires??[]),provides:new Set(s.metadata?.provides??[])})),o=new Map,t=new Map;for(let s of r)t.set(s.name,s),o.set(s.name,new Set);for(let s of r)for(let f of r)if(s!==f){for(let h of f.requires)if(!e.has(h)&&s.provides.has(h)){let u=o.get(s.name);u&&u.add(f.name)}}let a=new Map;for(let s of o.keys())a.set(s,0);for(let[,s]of o)for(let f of s)a.set(f,(a.get(f)||0)+1);let c=[];for(let[s,f]of a.entries())f===0&&c.push(s);let l=[];for(;c.length>0;){let s=c.shift();if(!s)break;l.push(s);let f=o.get(s);if(f)for(let h of f)a.set(h,(a.get(h)||0)-1),a.get(h)===0&&c.push(h)}return l.length!==r.length?(i&&console.warn(m.ENHANCER_CYCLE_DETECTED),n):l.map(s=>{let f=t.get(s);return f?f.fn:n[0]})}var H=class{cache=new Map;registry=null;config;stats={cleanedUpSignals:0,peakCachedSignals:0,manualDisposes:0};constructor(e={}){this.config={enableAutoCleanup:e.enableAutoCleanup??!0,debugMode:e.debugMode??!1,onCleanup:e.onCleanup??(()=>{})},this.config.enableAutoCleanup&&typeof FinalizationRegistry<"u"&&(this.registry=new FinalizationRegistry(i=>{this.handleCleanup(i)})),this.config.debugMode&&console.log("[SignalMemoryManager] Initialized",{autoCleanup:this.config.enableAutoCleanup,hasRegistry:!!this.registry})}cacheSignal(e,i){let o={ref:new WeakRef(i),path:e,cachedAt:Date.now()};this.cache.set(e,o),this.registry&&this.registry.register(i,e,i);let t=this.cache.size;t>this.stats.peakCachedSignals&&(this.stats.peakCachedSignals=t),this.config.debugMode&&console.log(`[SignalMemoryManager] Cached signal: ${e}`,{cacheSize:t,peak:this.stats.peakCachedSignals})}getSignal(e){let i=this.cache.get(e);if(!i)return;let r=i.ref.deref();if(!r){this.cache.delete(e),this.config.debugMode&&console.log(`[SignalMemoryManager] Signal GC'd: ${e}`);return}return r}hasSignal(e){return this.cache.has(e)}removeSignal(e){let i=this.cache.get(e);if(!i)return!1;let r=i.ref.deref();return r&&this.registry&&this.registry.unregister(r),this.cache.delete(e),this.config.debugMode&&console.log(`[SignalMemoryManager] Removed signal: ${e}`),!0}handleCleanup(e){this.cache.delete(e),this.stats.cleanedUpSignals++;let i=this.getStats();this.config.debugMode&&console.log(`[SignalMemoryManager] Auto cleanup: ${e}`,i),this.config.onCleanup(e,i)}getStats(){let e=0;for(let[r,o]of this.cache.entries())o.ref.deref()?e++:this.cache.delete(r);let i=e*100;return{cachedSignals:e,cleanedUpSignals:this.stats.cleanedUpSignals,peakCachedSignals:this.stats.peakCachedSignals,manualDisposes:this.stats.manualDisposes,estimatedMemoryBytes:i}}dispose(){if(this.config.debugMode&&console.log("[SignalMemoryManager] Disposing",{cachedSignals:this.cache.size}),this.registry)for(let e of this.cache.values()){let i=e.ref.deref();i&&this.registry.unregister(i)}this.cache.clear(),this.stats.manualDisposes++,this.config.debugMode&&console.log("[SignalMemoryManager] Disposed",this.getStats())}getCachedPaths(){let e=[];for(let[i,r]of this.cache.entries())r.ref.deref()&&e.push(i);return e}clearStale(){let e=0;for(let[i,r]of this.cache.entries())r.ref.deref()||(this.cache.delete(i),e++);return this.config.debugMode&&e>0&&console.log(`[SignalMemoryManager] Cleared ${e} stale entries`),e}resetStats(){this.stats={cleanedUpSignals:0,peakCachedSignals:0,manualDisposes:0},this.config.debugMode&&console.log("[SignalMemoryManager] Stats reset")}};var $=class{defaultOptions={maxDepth:100,detectDeletions:!1,ignoreArrayOrder:!1,equalityFn:(e,i)=>e===i,keyValidator:void 0};diff(e,i,r={}){let o=y(y({},this.defaultOptions),r),t=[],a=new WeakSet;return this.traverse(e,i,[],t,a,o,0),{changes:t,hasChanges:t.length>0}}traverse(e,i,r,o,t,a,c){if(c>a.maxDepth)return;if(typeof i!="object"||i===null){a.equalityFn(e,i)||o.push({type:e===void 0?"add":"update",path:[...r],value:i,oldValue:e});return}if(t.has(i))return;if(t.add(i),Array.isArray(i)){this.diffArrays(e,i,r,o,t,a,c);return}if(!e||typeof e!="object"||Array.isArray(e)){o.push({type:"replace",path:[...r],value:i,oldValue:e});return}let l=e,s=i;for(let f in s)if(Object.prototype.hasOwnProperty.call(s,f)){if(a.keyValidator&&!a.keyValidator(f))continue;this.traverse(l[f],s[f],[...r,f],o,t,a,c+1)}if(a.detectDeletions)for(let f in l)Object.prototype.hasOwnProperty.call(l,f)&&!(f in s)&&o.push({type:"delete",path:[...r,f],oldValue:l[f]})}diffArrays(e,i,r,o,t,a,c){if(!Array.isArray(e)){o.push({type:"replace",path:[...r],value:i,oldValue:e});return}a.ignoreArrayOrder?this.diffArraysUnordered(e,i,r,o,a):this.diffArraysOrdered(e,i,r,o,t,a,c)}diffArraysOrdered(e,i,r,o,t,a,c){let l=Math.max(e.length,i.length);for(let s=0;s<l;s++)s>=i.length?a.detectDeletions&&o.push({type:"delete",path:[...r,s],oldValue:e[s]}):s>=e.length?o.push({type:"add",path:[...r,s],value:i[s]}):this.traverse(e[s],i[s],[...r,s],o,t,a,c+1)}diffArraysUnordered(e,i,r,o,t){let a=new Set(e.map(l=>this.stringify(l))),c=new Set(i.map(l=>this.stringify(l)));i.forEach((l,s)=>{let f=this.stringify(l);a.has(f)||o.push({type:"add",path:[...r,s],value:l})}),t.detectDeletions&&e.forEach((l,s)=>{let f=this.stringify(l);c.has(f)||o.push({type:"delete",path:[...r,s],oldValue:l})})}stringify(e){try{return JSON.stringify(e)}catch{return String(e)}}};var U=class{value=null;children=new Map},q=class{root=new U;pathCache=new Map;stats={hits:0,misses:0,sets:0,cleanups:0};set(e,i){let r=this.pathToString(e),o=new WeakRef(i),t=this.root;for(let a of e){let c=String(a);t.children.has(c)||t.children.set(c,new U);let l=t.children.get(c);if(!l)throw new Error(`Failed to get node for key: ${c}`);t=l}t.value=o,this.pathCache.set(r,o),this.stats.sets++}get(e){let i=this.pathToString(e),r=this.pathCache.get(i);if(r){let t=r.deref();if(t)return this.stats.hits++,t;this.pathCache.delete(i),this.stats.cleanups++}let o=this.root;for(let t of e){let a=String(t);if(o=o.children.get(a),!o)return this.stats.misses++,null}if(o.value){let t=o.value.deref();if(t)return this.pathCache.set(i,o.value),this.stats.hits++,t;o.value=null,this.stats.cleanups++}return this.stats.misses++,null}has(e){return this.get(e)!==null}getByPrefix(e){let i=new Map,r=this.root;for(let o of e){let t=String(o);if(r=r.children.get(t),!r)return i}return this.collectDescendants(r,[],i),i}delete(e){let i=this.pathToString(e);this.pathCache.delete(i);let r=this.root,o=[r];for(let a of e){let c=String(a);if(r=r.children.get(c),!r)return!1;o.push(r)}let t=r.value!==null;r.value=null;for(let a=o.length-1;a>0;a--){let c=o[a];if(c.value===null&&c.children.size===0){let l=o[a-1],s=e[a-1];l.children.delete(String(s))}else break}return t}clear(){this.root=new U,this.pathCache.clear()}getStats(){let e=this.stats.hits+this.stats.misses,i=e>0?this.stats.hits/e:0;return D(y({},this.stats),{hitRate:i,cacheSize:this.pathCache.size})}buildFromTree(e,i=[]){if(e){if(S(e)){this.set(i,e);return}if(typeof e=="object")for(let[r,o]of Object.entries(e))this.buildFromTree(o,[...i,r])}}pathToString(e){return e.join(".")}collectDescendants(e,i,r){if(e.value){let o=e.value.deref();o&&r.set(this.pathToString(i),o)}for(let[o,t]of e.children)this.collectDescendants(t,[...i,o],r)}};var K=class{pathIndex;diffEngine;constructor(e){this.pathIndex=new q,this.diffEngine=new $,this.pathIndex.buildFromTree(e)}update(e,i,r={}){let o=performance.now(),t={};r.maxDepth!==void 0&&(t.maxDepth=r.maxDepth),r.ignoreArrayOrder!==void 0&&(t.ignoreArrayOrder=r.ignoreArrayOrder),r.equalityFn!==void 0&&(t.equalityFn=r.equalityFn);let a=this.diffEngine.diff(e,i,t);if(a.changes.length===0)return{changed:!1,duration:performance.now()-o,changedPaths:[]};let c=this.createPatches(a.changes),l=this.sortPatches(c),s=r.batch?this.batchApplyPatches(e,l,r.batchSize):this.applyPatches(e,l);return{changed:!0,duration:performance.now()-o,changedPaths:s.appliedPaths,stats:{totalPaths:a.changes.length,optimizedPaths:c.length,batchedUpdates:s.batchCount}}}rebuildIndex(e){this.pathIndex.clear(),this.pathIndex.buildFromTree(e)}getIndexStats(){return this.pathIndex.getStats()}createPatches(e){let i=[],r=new Set;for(let o of e){let t=o.path.join("."),a=!1;for(let l of r)if(t.startsWith(l+".")){a=!0;break}if(a)continue;let c=this.createPatch(o);i.push(c),r.add(t),o.type==="replace"&&typeof o.value=="object"&&r.add(t)}return i}createPatch(e){return{type:e.type,path:e.path,value:e.value,oldValue:e.oldValue,priority:this.calculatePriority(e),signal:this.pathIndex.get(e.path)}}calculatePriority(e){let i=0;return i+=(10-e.path.length)*10,e.path.some(r=>typeof r=="number")&&(i-=20),e.type==="replace"&&(i+=30),i}sortPatches(e){return e.sort((i,r)=>i.priority!==r.priority?r.priority-i.priority:i.path.length-r.path.length)}applyPatches(e,i){let r=[],o=0;for(let t of i)this.applyPatch(t,e)&&(r.push(t.path.join(".")),o++);return{appliedPaths:r,updateCount:o,batchCount:1}}batchApplyPatches(e,i,r=50){let o=[];for(let c=0;c<i.length;c+=r)o.push(i.slice(c,c+r));let t=[],a=0;for(let c of o)for(let l of c)this.applyPatch(l,e)&&(t.push(l.path.join(".")),a++);return{appliedPaths:t,updateCount:a,batchCount:o.length}}applyPatch(e,i){try{if(e.signal&&S(e.signal)&&"set"in e.signal){let t=e.signal();return this.isEqual(t,e.value)?!1:(e.signal.set(e.value),e.type==="add"&&e.value!==void 0&&this.pathIndex.set(e.path,e.signal),!0)}let r=i;for(let t=0;t<e.path.length-1;t++){let a=e.path[t];if(r=r[a],!r||typeof r!="object")return!1}let o=e.path[e.path.length-1];return this.isEqual(r[o],e.value)?!1:(r[o]=e.value,!0)}catch(r){return console.error(`Failed to apply patch at ${e.path.join(".")}:`,r),!1}}isEqual(e,i){if(e===i)return!0;if(typeof e!=typeof i||typeof e!="object"||e===null||i===null)return!1;try{return JSON.stringify(e)===JSON.stringify(i)}catch{return!1}}};var Oe=["__proto__","constructor","prototype"],ze=/<[^>]*>/g,te=[/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,/on\w+\s*=/gi,/javascript:/gi,/<iframe\b/gi,/<object\b/gi,/<embed\b/gi],G=class{config;dangerousKeys;constructor(e={}){this.config={preventPrototypePollution:e.preventPrototypePollution??!0,preventXSS:e.preventXSS??!1,preventFunctions:e.preventFunctions??!0,customDangerousKeys:e.customDangerousKeys??[],onSecurityEvent:e.onSecurityEvent??(()=>{}),sanitizationMode:e.sanitizationMode??"strict"},this.dangerousKeys=new Set([...Oe,...this.config.customDangerousKeys])}validateKey(e){if(this.config.preventPrototypePollution&&this.dangerousKeys.has(e)){let i={type:"dangerous-key-blocked",key:e,reason:`Dangerous key "${e}" blocked to prevent prototype pollution`,timestamp:Date.now()};throw this.config.onSecurityEvent(i),new Error(`[SignalTree Security] Dangerous key "${e}" is not allowed. This key can lead to prototype pollution attacks. Blocked keys: ${Array.from(this.dangerousKeys).join(", ")}`)}}validateValue(e){if(this.config.preventFunctions&&typeof e=="function"){let r={type:"function-value-blocked",value:e,reason:"Function values are not allowed - state must be serializable",timestamp:Date.now()};throw this.config.onSecurityEvent(r),new Error(`[SignalTree Security] Function values are not allowed in state trees. Functions cannot be serialized, breaking features like time-travel, persistence, debugging, and SSR. 

To fix this:
  - Store function references outside the tree
  - Use method names (strings) and a function registry
  - Use computed signals for derived values

Blocked value: ${e.toString().substring(0,100)}...`)}if(!this.config.preventXSS||typeof e!="string")return e;let i=!1;for(let r of te)if(r.lastIndex=0,r.test(e)){i=!0;break}if(i){let r={type:"xss-attempt-blocked",value:e,reason:"Dangerous HTML pattern detected and sanitized",timestamp:Date.now()};return this.config.onSecurityEvent(r),this.sanitize(e)}return this.sanitize(e)}sanitize(e){if(this.config.sanitizationMode==="strict"){let i=e;for(let r of te)r.lastIndex=0,i=i.replace(r,"");return i.replace(ze,"")}else{let i=e;for(let r of te)r.lastIndex=0,i=i.replace(r,"");return i}}validateKeyValue(e,i){return this.validateKey(e),this.validateValue(i)}isDangerousKey(e){return this.dangerousKeys.has(e)}getConfig(){return y({},this.config)}};var De=Symbol.for("NodeAccessor");function C(n){return typeof n=="function"&&n&&De in n}function Te(n){return S(n)||C(n)}function ye(...n){return e=>n.reduce((i,r)=>r(i),e)}function re(n,e,i="",r){let o=new Map,t=new Map,a=new Map,c=()=>{a.forEach(s=>{try{s()}catch(f){console.warn("Error during nested cleanup:",f)}}),a.clear(),o.clear(),t.clear(),r&&r.dispose()};return new Proxy(n,{get(s,f){if(f==="__cleanup__")return c;if(typeof f=="symbol"||f==="valueOf"||f==="toString")return s[f];let h=f,u=i?`${i}.${h}`:h;if(!(h in s))return;let d=s[h];if(S(d))return d;if(r){let g=r.getSignal(u);if(g)return g}if(o.has(u))return o.get(u);if(t.has(u))return t.get(u);if(d&&typeof d=="object"&&!Array.isArray(d)&&!S(d)&&!k(d))try{let g=re(d,e,u,r);t.set(u,g);let p=g;return typeof p.__cleanup__=="function"&&a.set(u,p.__cleanup__),g}catch(g){console.warn(`Failed to create lazy proxy for path "${u}":`,g);let p=R(d,{equal:e});return o.set(u,p),r&&r.cacheSignal(u,p),p}try{let g=R(d,{equal:e});return o.set(u,g),r&&r.cacheSignal(u,g),g}catch(g){return console.warn(`Failed to create signal for path "${u}":`,g),d}},set(s,f,h){if(typeof f=="symbol")return s[f]=h,!0;let u=f,d=i?`${i}.${u}`:u;try{s[u]=h;let g=o.get(d);if(g&&"set"in g&&g.set(h),t.has(d)){let p=a.get(d);p&&(p(),a.delete(d)),t.delete(d)}return!0}catch(g){return console.warn(`Failed to set value for path "${d}":`,g),!1}},has(s,f){return f in s},ownKeys(s){return Reflect.ownKeys(s)},getOwnPropertyDescriptor(s,f){return Reflect.getOwnPropertyDescriptor(s,f)}})}function A(n){if(n==null)return n;if(C(n)){let r={};for(let o in n){if(!Object.prototype.hasOwnProperty.call(n,o)||o==="length"||o==="prototype")continue;if(o==="name"){let a=n[o];if(!S(a)&&!C(a))continue}let t=n[o];if(C(t))r[o]=A(t);else if(S(t)){let a=t();typeof a=="object"&&a!==null&&!Array.isArray(a)&&!k(a)?r[o]=A(a):r[o]=a}else typeof t=="object"&&t!==null&&!Array.isArray(t)&&!k(t)?r[o]=A(t):r[o]=t}return r}if(S(n)){let r=n();return typeof r=="object"&&r!==null&&!Array.isArray(r)&&!k(r)?A(r):r}if(typeof n!="object"||Array.isArray(n)||k(n))return n;let e={};for(let r in n){if(!Object.prototype.hasOwnProperty.call(n,r)||(r==="set"||r==="update")&&typeof n[r]=="function")continue;let o=n[r];if(C(o)){let t=o();typeof t=="object"&&t!==null&&!Array.isArray(t)&&!k(t)?e[r]=A(t):e[r]=t}else if(S(o)){let t=o();typeof t=="object"&&t!==null&&!Array.isArray(t)&&!k(t)?e[r]=A(t):e[r]=t}else typeof o=="object"&&o!==null&&!Array.isArray(o)&&!k(o)?e[r]=A(o):e[r]=o}let i=Object.getOwnPropertySymbols(n);for(let r of i){let o=n[r];if(C(o)){let t=o();typeof t=="object"&&t!==null&&!Array.isArray(t)&&!k(t)?e[r]=A(t):e[r]=t}else if(S(o)){let t=o();typeof t=="object"&&t!==null&&!Array.isArray(t)&&!k(t)?e[r]=A(t):e[r]=t}else typeof o=="object"&&o!==null&&!Array.isArray(o)&&!k(o)?e[r]=A(o):e[r]=o}return e}var Z=Symbol.for("NodeAccessor");function Le(){let n=function(e){if(arguments.length===0)return A(n);if(typeof e=="function"){let i=e,r=A(n),o=i(r);B(n,o)}else B(n,e)};return n[Z]=!0,n}function Ue(n,e){let i=function(r){if(arguments.length===0)return n();if(typeof r=="function"){let o=r;e.set(o(n()))}else e.set(r)};return i[Z]=!0,i}function B(n,e){if(!e||typeof e!="object")return;let i;if(me(n))i=n;else if(n&&typeof n=="object")i=n;else return;let r=e;for(let o in r){if(!(o in i))continue;let t=i[o],a=r[o];S(t)?"set"in t&&typeof t.set=="function"&&t.set(a):me(t)&&(a&&typeof a=="object"?B(t,a):t(a))}}function me(n){return typeof n=="function"&&n&&n[Z]===!0}function Y(n,e=L.ESTIMATE_MAX_DEPTH,i=0){if(i>=e)return 1;if(n==null)return 0;if(typeof n!="object")return 1;let r=0;try{if(Array.isArray(n)){r=n.length;let o=Math.min(L.ESTIMATE_SAMPLE_SIZE_ARRAY,n.length);for(let t=0;t<o;t++)r+=Y(n[t],e,i+1)*.1}else{let o=Object.keys(n);r=o.length;let t=Math.min(L.ESTIMATE_SAMPLE_SIZE_OBJECT,o.length);for(let a=0;a<t;a++){let c=n[o[a]];r+=Y(c,e,i+1)*.5}}}catch{return 1}return Math.floor(r)}function we(n,e,i){return e.useLazySignals!==void 0?e.useLazySignals:e.debugMode||e.enableDevTools?!1:e.batchUpdates&&e.useMemoization?!0:(i??Y(n))>L.LAZY_THRESHOLD}function Be(n,e,i=[]){if(!e.security)return;let r=new G(e.security);function o(t,a){if(t==null)return;if(typeof t!="object"){r.validateValue(t);return}if(k(t))return;if(Array.isArray(t)){t.forEach((s,f)=>{o(s,[...a,String(f)])});return}let c=[...Object.keys(t),...Object.getOwnPropertyNames(t)],l=[...new Set(c)];for(let s of l){if(typeof s=="symbol")continue;try{r.validateKey(s)}catch(h){let u=h;throw new Error(`${u.message}
Path: ${[...a,s].join(".")}`)}let f=t[s];try{r.validateValue(f)}catch(h){let u=h;throw new Error(`${u.message}
Path: ${[...a,s].join(".")}`)}o(f,[...a,s])}}o(n,i)}function je(n){return n?Object.is:v}function oe(n,e){if(n==null||typeof n!="object")return R(n,{equal:e});if(Array.isArray(n))return R(n,{equal:e});if(k(n))return R(n,{equal:e});let i={},r=new WeakSet;if(r.has(n))return console.warn(m.CIRCULAR_REF),R(n,{equal:e});r.add(n);try{for(let[t,a]of Object.entries(n))try{if(typeof t=="symbol")continue;if(S(a)){i[t]=a;continue}if(a==null)i[t]=R(a,{equal:e});else if(typeof a!="object")i[t]=R(a,{equal:e});else if(Array.isArray(a)||k(a))i[t]=R(a,{equal:e});else{let c=oe(a,e),l=Le();for(let s in c)if(Object.prototype.hasOwnProperty.call(c,s))try{Object.defineProperty(l,s,{value:c[s],enumerable:!0,configurable:!0})}catch{}i[t]=l}}catch(c){console.warn(`${m.SIGNAL_CREATION_FAILED} "${t}":`,c),i[t]=R(a,{equal:e})}let o=Object.getOwnPropertySymbols(n);for(let t of o){let a=n[t];try{S(a)?i[t]=a:i[t]=R(a,{equal:e})}catch(c){console.warn(m.SIGNAL_CREATION_FAILED,c)}}}catch(o){throw new Error(`Failed to create signal store: ${o instanceof Error?o.message:"Unknown error"}`)}return i}function Se(n,e={}){let i=e.useLazySignals??we(n.state,e);return n.with=((...r)=>{if(r.length===0)return n;let o=new Set;e.batchUpdates&&o.add("batchUpdate"),e.useMemoization&&o.add("memoize"),e.enableTimeTravel&&o.add("undo"),e.enableDevTools&&o.add("connectDevTools");try{for(let s of Object.keys(n))o.add(String(s))}catch{}let t=r.some(s=>!!(s.metadata&&(s.metadata.requires||s.metadata.provides))),a=r;if(t)try{a=he(r,o,e.debugMode)}catch(s){console.warn(m.ENHANCER_ORDER_FAILED,s)}let c=new Set(o),l=n;for(let s=0;s<a.length;s++){let f=a[s];if(typeof f!="function")throw new Error(m.ENHANCER_NOT_FUNCTION.replace("%d",String(s)));let h=f.metadata?.requires??[];for(let u of h)if(!(u in l)&&!c.has(u)){let d=f.metadata?.name??`enhancer#${s}`,g=m.ENHANCER_REQUIREMENT_MISSING.replace("%s",d).replace("%s",u);if(e.debugMode)throw new Error(g);console.warn(g)}try{let u=f(l);u!==l&&(l=u);let d=f.metadata?.provides??[];for(let g of d)c.add(g);if(e.debugMode&&d.length>0)for(let g of d)g in l||console.warn(m.ENHANCER_PROVIDES_MISSING.replace("%s",f.metadata?.name??String(s)).replace("%s",g))}catch(u){let d=f.metadata?.name||`enhancer at index ${s}`;throw console.error(m.ENHANCER_FAILED.replace("%s",d),u),e.debugMode&&(console.error("[SignalTree] Enhancer stack trace:",f),console.error("[SignalTree] Tree state at failure:",l)),u}}return l}),n.destroy=()=>{try{if(i){let r=n.state;if(r&&typeof r=="object"&&"__cleanup__"in r){let o=r.__cleanup__;typeof o=="function"&&o()}}e.debugMode&&console.log(m.TREE_DESTROYED)}catch(r){console.error(m.CLEANUP_ERROR,r)}},We(n,e),n}function We(n,e){n.batchUpdate=r=>{console.warn(m.BATCH_NOT_ENABLED),n(o=>{let t=r(o);return y(y({},o),t)})},n.memoize=(r,o)=>(console.warn(m.MEMOIZE_NOT_ENABLED),I(()=>r(n()))),n.memoizedUpdate=r=>{e.debugMode&&console.warn(m.MEMOIZE_NOT_ENABLED),n(o=>y(y({},o),r(o)))},n.clearMemoCache=()=>{e.debugMode&&console.warn(m.MEMOIZE_NOT_ENABLED)},n.getCacheStats=()=>({size:0,hitRate:0,totalHits:0,totalMisses:0,keys:[]}),n.effect=r=>{try{ee(()=>r(n()))}catch(o){e.debugMode&&console.warn(m.EFFECT_NO_CONTEXT,o)}},n.subscribe=r=>{try{let o=ue(fe),t=!1,a=ee(()=>{t||r(n())}),c=()=>{t=!0,a.destroy()};return o.onDestroy(c),c}catch(o){return e.debugMode&&console.warn(m.SUBSCRIBE_NO_CONTEXT,o),r(n()),()=>{}}},n.optimize=()=>{e.debugMode&&console.warn(m.OPTIMIZE_NOT_AVAILABLE)},n.clearCache=()=>{e.debugMode&&console.warn(m.CACHE_NOT_AVAILABLE)},n.invalidatePattern=()=>(e.debugMode&&console.warn(m.PERFORMANCE_NOT_ENABLED),0);let i=n;i.updateEngine||(i.updateEngine=new K(n)),n.updateOptimized=(r,o={})=>{let a=n.updateEngine;return a?a.update(n(),r,o):(e.debugMode&&console.warn(m.UPDATE_OPTIMIZED_NOT_AVAILABLE),n(c=>y(y({},c),r)),{changed:!0,duration:0,changedPaths:Object.keys(r),stats:void 0})},n.getMetrics=()=>({updates:0,computations:0,cacheHits:0,cacheMisses:0,averageUpdateTime:0}),n.addTap=r=>{e.debugMode&&console.warn(m.MIDDLEWARE_NOT_AVAILABLE)},n.removeTap=r=>{e.debugMode&&console.warn(m.MIDDLEWARE_NOT_AVAILABLE)},n.entities=()=>(e.debugMode&&console.warn(m.ENTITY_HELPERS_NOT_AVAILABLE),{}),n.asyncAction=(r,o={})=>(e.debugMode&&console.warn(m.ASYNC_ACTIONS_NOT_AVAILABLE),{}),n.undo=()=>{e.debugMode&&console.warn(m.TIME_TRAVEL_NOT_AVAILABLE)},n.redo=()=>{e.debugMode&&console.warn(m.TIME_TRAVEL_NOT_AVAILABLE)},n.getHistory=()=>(e.debugMode&&console.warn(m.TIME_TRAVEL_NOT_AVAILABLE),[]),n.resetHistory=()=>{e.debugMode&&console.warn(m.TIME_TRAVEL_NOT_AVAILABLE)}}function ie(n,e={}){if(n==null)throw new Error(m.NULL_OR_UNDEFINED);Be(n,e);let i=Y(n),r=je(e.useShallowComparison??!1);if(Array.isArray(n)){let l=R(n,{equal:r}),s=Ue(l,l);return Object.defineProperty(s,"state",{value:l,enumerable:!1}),Object.defineProperty(s,"$",{value:l,enumerable:!1}),Se(s,e),s}let o=we(n,e,i);e.debugMode&&console.log(m.STRATEGY_SELECTION.replace("%s",o?"lazy":"eager").replace("%d",String(i)));let t,a;try{o&&typeof n=="object"?(a=new H,t=re(n,r,"",a)):t=oe(n,r)}catch(l){if(o)console.warn(m.LAZY_FALLBACK,l),t=oe(n,r),a=void 0;else throw l}let c=function(l){if(arguments.length===0)return A(t);if(typeof l=="function"){let s=l,f=A(t),h=s(f);B(t,h)}else B(t,l)};Object.defineProperty(c,Z,{value:!0,enumerable:!1}),Object.defineProperty(c,"state",{value:t,enumerable:!1}),Object.defineProperty(c,"$",{value:t,enumerable:!1}),a&&Object.defineProperty(c,"dispose",{value:()=>{a?.dispose();let l=t.__cleanup__;typeof l=="function"&&l()},enumerable:!1,writable:!1}),Se(c,e);for(let l in t)if(Object.prototype.hasOwnProperty.call(t,l)&&!(l in c))try{Object.defineProperty(c,l,{value:t[l],enumerable:!0,configurable:!0})}catch{}return c}var Ve={basic:{useLazySignals:!1,debugMode:!1},performance:{useLazySignals:!0,batchUpdates:!0,useMemoization:!0,useShallowComparison:!0},development:{useLazySignals:!1,debugMode:!0,enableDevTools:!0,trackPerformance:!0},production:{useLazySignals:!0,batchUpdates:!0,useMemoization:!0,debugMode:!1}};function Fe(n,e){if(typeof e=="string"){let r=Ve[e];return r?ie(n,r):(console.warn(m.PRESET_UNKNOWN.replace("%s",e)),ie(n,{}))}return ie(n,e||{})}var M=[],X=!1,N,O={};function He(n,e=O){let i=e.maxBatchSize??100;return n.path&&(M=M.filter(r=>r.path!==n.path)),M.push(n),M.length>i?(J(),!0):($e(e),!1)}function $e(n){N!==void 0&&clearTimeout(N);let e=n.autoFlushDelay??16;N=setTimeout(()=>{J()},e)}function J(){if(X)return;let n;do{if(M.length===0)return;X=!0,n=M,M=[],N!==void 0&&(clearTimeout(N),N=void 0),n.sort((e,i)=>(i.depth??0)-(e.depth??0));try{n.forEach(({fn:e})=>e())}finally{X=!1}}while(M.length>0)}function be(n,e){let i=performance.now(),r=e?ne(e).length:0;He({fn:n,startTime:i,depth:r,path:e},O)||(O.batchTimeoutMs&&M.length>0&&i-M[0].startTime>=O.batchTimeoutMs?J():!X&&M.length>0&&queueMicrotask(()=>{J()}))}function Ee(n={}){let{enabled:e=!0}=n;return O=y(y({},O),n),i=>{if(!e)return i;let r=i.bind(i),o=function(...t){if(t.length===0)return r();be(()=>{if(t.length===1){let a=t[0];r(a)}})};return Object.setPrototypeOf(o,Object.getPrototypeOf(i)),Object.assign(o,i),"state"in i&&Object.defineProperty(o,"state",{value:i.state,enumerable:!1,configurable:!0}),"$"in i&&Object.defineProperty(o,"$",{value:i.$,enumerable:!1,configurable:!0}),o.batchUpdate=t=>{be(()=>{let a=r(),c=t(a);Object.entries(c).forEach(([l,s])=>{let f=o.state[l];f&&"set"in f?f.set(s):C(f)&&f(s)})})},o}}function qe(){return Ee({enabled:!0,maxBatchSize:200,batchTimeoutMs:0})}var at=300*1e3,Ke=new Map;function Ge(n,e){if(e){let r=new x(n),o=new Map,t=()=>{for(;o.size>r.size();){let a=o.keys().next().value;if(a===void 0)break;o.delete(a)}};return{get:a=>{let c=r.get(a);return c!==void 0?o.set(a,c):o.has(a)&&o.delete(a),c},set:(a,c)=>{r.set(a,c),o.set(a,c),t()},delete:a=>{r.delete(a),o.delete(a)},clear:()=>{r.clear(),o.clear()},size:()=>o.size,forEach:a=>{o.forEach((c,l)=>a(c,l))},keys:()=>o.keys()}}let i=new Map;return{get:r=>i.get(r),set:(r,o)=>{i.set(r,o)},delete:r=>i.delete(r),clear:()=>i.clear(),size:()=>i.size,forEach:r=>{i.forEach((o,t)=>r(o,t))},keys:()=>i.keys()}}function ke(n){return n._memoCleanupInterval}function Ae(n,e){if(e===void 0){delete n._memoCleanupInterval;return}n._memoCleanupInterval=e}function Ye(n){let e=ke(n);if(e){try{clearInterval(e)}catch{}Ae(n)}}function Ze(n,e){if(n===e)return!0;if(n==null||e==null||typeof n!=typeof e)return!1;if(typeof n=="object"&&typeof e=="object"){let i=n,r=e,o=0;for(let a in i)if(Object.prototype.hasOwnProperty.call(i,a)&&(o++,!(a in r)||i[a]!==r[a]))return!1;let t=0;for(let a in r)Object.prototype.hasOwnProperty.call(r,a)&&t++;return o===t}return!1}function Xe(n,e){try{return`${n.name||"anonymous"}_${JSON.stringify(e)}`}catch{return`${n.name||"anonymous"}_${e.length}`}}function Je(n){switch(n){case"shallow":return Ze;case"reference":return(e,i)=>e===i;case"deep":default:return v}}var Re={selector:{equality:"reference",maxCacheSize:10,enableLRU:!1,ttl:void 0},computed:{equality:"shallow",maxCacheSize:100,enableLRU:!1,ttl:void 0},deepState:{equality:"deep",maxCacheSize:1e3,enableLRU:!0,ttl:300*1e3},highFrequency:{equality:"reference",maxCacheSize:5,enableLRU:!1,ttl:void 0}};function Qe(){return j(Re.selector)}function en(){return j(Re.computed)}function j(n={}){let{enabled:e=!0,maxCacheSize:i=1e3,ttl:r,equality:o="deep",enableLRU:t=!0}=n;return a=>{let c=a.bind(a),l=u=>{Object.entries(u).forEach(([d,g])=>{let p=a.state[d];p&&"set"in p?p.set(g):C(p)&&p(g)})};if(!e){let u=a;return u.memoizedUpdate=d=>{let g=c(),p=d(g);l(p)},u.clearMemoCache=()=>{},u.getCacheStats=()=>({size:0,hitRate:0,totalHits:0,totalMisses:0,keys:[]}),u}let s=Ge(i,t);Ke.set(a,s);let f=Je(o);if(a.memoizedUpdate=(u,d)=>{let g=c(),p=d||Xe(u,[g]),w=s.get(p);if(w&&f(w.deps,[g])){let E=w.value;l(E);return}let b=u(g);s.set(p,{value:b,deps:[g],timestamp:Date.now(),hitCount:1}),l(b)},a.clearMemoCache=u=>{u?s.delete(u):s.clear()},a.getCacheStats=()=>{let u=0,d=0;s.forEach(p=>{u+=p.hitCount||0,d+=Math.floor((p.hitCount||0)/2)});let g=u+d>0?u/(u+d):0;return{size:s.size(),hitRate:g,totalHits:u,totalMisses:d,keys:Array.from(s.keys())}},ke(a)){let u=a.clearMemoCache.bind(a);a.clearMemoCache=d=>{u(d),Ye(a)}}if(r){let d=setInterval(()=>{let g=Date.now();s.forEach((p,w)=>{p.timestamp&&g-p.timestamp>r&&s.delete(w)})},r);Ae(a,d)}return a}}function nn(){return j({enabled:!0,maxCacheSize:100,ttl:void 0,equality:"reference",enableLRU:!1})}function tn(){return j({enabled:!0,maxCacheSize:1e3,ttl:6e4,equality:"shallow",enableLRU:!0})}var ae=class{constructor(e,i={},r){this.tree=e;this.config=i;this.restoreStateFn=r;this.maxHistorySize=i.maxHistorySize??50,this.includePayload=i.includePayload??!0,this.actionNames=y({update:"UPDATE",set:"SET",batch:"BATCH"},i.actionNames),this.addEntry("INIT",this.tree())}history=[];currentIndex=-1;maxHistorySize;includePayload;actionNames;addEntry(e,i,r){this.currentIndex<this.history.length-1&&(this.history=this.history.slice(0,this.currentIndex+1));let o=y({state:F(i),timestamp:Date.now(),action:this.actionNames[e]||e},this.includePayload&&r!==void 0&&{payload:r});this.history.push(o),this.currentIndex=this.history.length-1,this.history.length>this.maxHistorySize&&(this.history.shift(),this.currentIndex--)}undo(){if(!this.canUndo())return!1;this.currentIndex--;let e=this.history[this.currentIndex];return this.restoreState(e.state),!0}redo(){if(!this.canRedo())return!1;this.currentIndex++;let e=this.history[this.currentIndex];return this.restoreState(e.state),!0}getHistory(){return this.history.map(e=>D(y({},e),{state:F(e.state)}))}resetHistory(){let e=this.tree();this.history=[],this.currentIndex=-1,this.addEntry("RESET",e)}jumpTo(e){if(e<0||e>=this.history.length)return!1;this.currentIndex=e;let i=this.history[e];return this.restoreState(i.state),!0}getCurrentIndex(){return this.currentIndex}canUndo(){return this.currentIndex>0}canRedo(){return this.currentIndex<this.history.length-1}restoreState(e){this.restoreStateFn?this.restoreStateFn(e):this.tree(e)}};function rn(n={}){return e=>{let i=e.bind(e),r=!1,o=new ae(e,n,a=>{r=!0;try{i(a)}finally{r=!1}}),t=function(...a){if(a.length===0)return i();{if(r){if(a.length===1){let h=a[0];return i(h)}return}let c=i(),l;if(a.length===1){let h=a[0];l=i(h)}let s=i();return v(c,s)||o.addEntry("update",s),l}};return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),Object.assign(t,e),"state"in e&&Object.defineProperty(t,"state",{value:e.state,enumerable:!1,configurable:!0}),"$"in e&&Object.defineProperty(t,"$",{value:e.$,enumerable:!1,configurable:!0}),t.undo=()=>{o.undo()},t.redo=()=>{o.redo()},t.getHistory=()=>o.getHistory(),t.resetHistory=()=>{o.resetHistory()},t.jumpTo=a=>{o.jumpTo(a)},t.canUndo=()=>o.canUndo(),t.canRedo=()=>o.canRedo(),t.getCurrentIndex=()=>o.getCurrentIndex(),Object.assign(t,{__timeTravel:o})}}function on(n,e){let i=()=>{let o=n.state[e];if(!o)throw new Error(`Entity key '${String(e)}' does not exist in the state`);if(!Te(o))throw new Error(`Entity key '${String(e)}' is not a signal. This should not happen with SignalTree.`);let t=o,a=t();if(!Array.isArray(a))throw new Error(`Entity key '${String(e)}' does not contain an array. Current type: ${typeof a}`);return t},r=(o,t)=>{C(o)?o(t):o.set(t)};return{add:o=>{let t=i(),a=t();if(a.some(c=>c.id===o.id))throw new Error(`Entity with id '${o.id}' already exists`);r(t,[...a,o])},update:(o,t)=>{let a=i(),l=a().map(s=>s.id===o?y(y({},s),t):s);r(a,l)},remove:o=>{let t=i(),c=t().filter(l=>l.id!==o);r(t,c)},upsert:o=>{let t=i(),a=t(),c=a.findIndex(l=>l.id===o.id);if(c>=0){let l=[...a];l[c]=o,r(t,l)}else r(t,[...a,o])},selectById:o=>{let t=i();return I(()=>t().find(a=>a.id===o))},selectBy:o=>{let t=i();return I(()=>t().filter(o))},selectIds:()=>{let o=i();return I(()=>o().map(t=>t.id))},selectAll:()=>i(),selectTotal:()=>{let o=i();return I(()=>o().length)},clear:()=>{let o=i();r(o,[])}}}function an(n={}){let{enabled:e=!0}=n;return function(r){return e?Object.assign(r,{entities(t){return on(r,t)}}):r}}var _=new WeakMap;function sn(n=[]){return e=>{_.set(e,[...n]);let i=e.bind(e),r=function(...a){if(a.length===0)return i();{let c="UPDATE",l=i(),s=_.get(e)||[],f;if(a.length===1){let d=a[0];typeof d=="function"?f=d(l):f=d}else return;for(let d of s)if(d.before&&!d.before(c,f,l))return;let h=l;if(a.length===1){let d=a[0];i(d)}let u=i();for(let d of s)d.after&&d.after(c,f,h,u)}};Object.setPrototypeOf(r,Object.getPrototypeOf(e)),Object.assign(r,e),"state"in e&&Object.defineProperty(r,"state",{value:e.state,enumerable:!1,configurable:!0}),"$"in e&&Object.defineProperty(r,"$",{value:e.$,enumerable:!1,configurable:!0}),r.addTap=a=>{let c=_.get(e)||[],l=c.findIndex(s=>s.id===a.id);l>=0?c[l]=a:c.push(a),_.set(e,c)},r.removeTap=a=>{let l=(_.get(e)||[]).filter(s=>s.id!==a);_.set(e,l)};let o=e.batchUpdate;o&&(r.batchUpdate=a=>{let c="BATCH_UPDATE",l=i(),s=a(l),f=_.get(e)||[];for(let d of f)if(d.before&&!d.before(c,s,l))return;let h=l;o.call(e,a);let u=i();for(let d of f)d.after&&d.after(c,s,h,u)});let t=e.destroy;return r.destroy=()=>{_.delete(e),t&&t.call(e)},r}}var se={basic:{batchUpdates:!1,useMemoization:!1,trackPerformance:!1,enableTimeTravel:!1,enableDevTools:!1,debugMode:!1},performance:{batchUpdates:!0,useMemoization:!0,trackPerformance:!1,enableTimeTravel:!1,enableDevTools:!1,debugMode:!1,useShallowComparison:!0,maxCacheSize:200},development:{batchUpdates:!0,useMemoization:!0,trackPerformance:!0,enableTimeTravel:!0,enableDevTools:!0,debugMode:!0,maxCacheSize:100},production:{batchUpdates:!0,useMemoization:!0,trackPerformance:!1,enableTimeTravel:!1,enableDevTools:!1,debugMode:!1,useShallowComparison:!0,maxCacheSize:200}};function Ce(n,e={}){let i=se[n];return y(y({},i),e)}function cn(){return Object.keys(se)}function ln(n={}){let e=Ce("development",n),i=[];function r(t){let a=globalThis.require;if(typeof a=="function")try{return a(t)}catch{return}}try{let t=r("@signaltree/devtools"),a=t&&(t.withDevtools??t.withDevTools??t.default??t);typeof a=="function"&&i.push(a)}catch(t){}try{let t=r("@signaltree/time-travel"),a=t&&(t.withTimeTravel??t.default??t);typeof a=="function"&&i.push(a)}catch(t){}let o=ye(...i);return{config:e,enhancer:o}}var T={DATE:"\xA7d",REGEXP:"\xA7r",MAP:"\xA7m",SET:"\xA7s",UNDEFINED:"\xA7u",NAN:"\xA7n",INFINITY:"\xA7i",NEG_INFINITY:"\xA7-i",BIGINT:"\xA7b",SYMBOL:"\xA7y",FUNCTION:"\xA7f",CIRCULAR:"\xA7c"};var ve={includeMetadata:!0,replacer:void 0,reviver:void 0,preserveTypes:!0,maxDepth:50,handleCircular:!0};function z(n,e=new WeakSet,i=0,r=50,o=!0){if(i>r)return"[Max Depth Exceeded]";if(n===null||typeof n!="object")return o?n===void 0?{[T.UNDEFINED]:!0}:typeof n=="number"?Number.isNaN(n)?{[T.NAN]:!0}:n===1/0?{[T.INFINITY]:!0}:n===-1/0?{[T.NEG_INFINITY]:!0}:n:typeof n=="bigint"?{[T.BIGINT]:String(n)}:typeof n=="symbol"?{[T.SYMBOL]:String(n)}:n:n;if(typeof n=="function")try{let t=n();return z(t,e,i+1,r,o)}catch{return"[Function]"}if(e.has(n))return"[Circular Reference]";if(S(n))return n();if(o){if(n instanceof Date)return{[T.DATE]:n.toISOString()};if(n instanceof RegExp)return{[T.REGEXP]:{source:n.source,flags:n.flags}};if(n instanceof Map)return{[T.MAP]:Array.from(n.entries())};if(n instanceof Set)return{[T.SET]:Array.from(n.values())}}else if(n instanceof Date||n instanceof RegExp)return n;e.add(n);try{if(Array.isArray(n)){let a=n.map(c=>z(c,e,i+1,r,o));return e.delete(n),a}let t={};for(let[a,c]of Object.entries(n))if(!((a==="set"||a==="update")&&typeof c=="function"&&!S(c)))if(S(c))t[a]=z(c(),e,i+1,r,o);else if(typeof c=="function"&&a!=="set"&&a!=="update")try{let l=c();t[a]=z(l,e,i+1,r,o)}catch{continue}else t[a]=z(c,e,i+1,r,o);return e.delete(n),t}catch{return e.delete(n),"[Serialization Error]"}}function Q(n,e="",i=new WeakSet,r=new Map){let o=[];if(n===null||typeof n!="object")return o;if(i.has(n)){let t=r.get(n)||"";return o.push({path:e,targetPath:t}),o}if(i.add(n),r.set(n,e),Array.isArray(n)){let t=n;for(let a=0;a<t.length;a++){let c=e?`${e}[${a}]`:`[${a}]`,l=Q(t[a],c,i,r);o.push(...l)}}else for(let[t,a]of Object.entries(n)){let c=e?`${e}.${t}`:t,l=Q(a,c,i,r);o.push(...l)}return i.delete(n),o}function un(n){let e=new WeakSet,i=new Map;return function(o,t){if(n.replacer&&(t=n.replacer.call(this,o,t)),S(t))return t();if(t&&typeof t=="object"){if(e.has(t)){if(n.handleCircular){let c=i.get(t)||"";return{[T.CIRCULAR]:c}}return}e.add(t);let a=o||"";i.set(t,a)}return t}}function Me(n,e){for(let{path:i,targetPath:r}of e){let o=i.split(/\.|\[|\]/).filter(Boolean),t=r.split(/\.|\[|\]/).filter(Boolean),a=n;for(let l=0;l<o.length-1&&(a=a[o[l]],!!a);l++);let c=n;for(let l of t)if(c=c[l],!c)break;a&&c&&(a[o[o.length-1]]=c)}}function fn(n={}){let e=i=>{let r=i;r.toJSON=()=>i(),r.fromJSON=(t,a)=>{let c=u=>{if(!u||typeof u!="object")return u;if(T.UNDEFINED in u)return;if(T.NAN in u)return NaN;if(T.INFINITY in u)return 1/0;if(T.NEG_INFINITY in u)return-1/0;if(T.BIGINT in u)return BigInt(u[T.BIGINT]);if(T.SYMBOL in u)return Symbol.for(u[T.SYMBOL]);if(T.DATE in u)return new Date(u[T.DATE]);if(T.REGEXP in u){let g=u[T.REGEXP];return new RegExp(g.source,g.flags)}if(T.MAP in u)return new Map(u[T.MAP]);if(T.SET in u)return new Set(u[T.SET]);if(Array.isArray(u))return u.map(c);let d={};for(let[g,p]of Object.entries(u))d[g]=c(p);return d},l=c(t);function s(u,d){let g=i.$;if(u&&g)for(let w of u.split(".")){if(!w)continue;let b=g[w];if(!b||typeof b!="object"&&typeof b!="function"){g=void 0;break}g=b}let p=g?.[d];return S(p)?p:void 0}function f(u,d,g=""){if(!(!u||!d))for(let p in d){if(!Object.prototype.hasOwnProperty.call(d,p))continue;let w=d[p],b=u[p],E=S(b)||typeof b=="function"&&"set"in b&&typeof b.set=="function"?b:s(g,p);if(E){E.set(w);continue}w&&typeof w=="object"&&!Array.isArray(w)&&b&&(typeof b=="object"||typeof b=="function"&&!("set"in b))&&!S(b)&&f(b,w,g?`${g}.${p}`:p)}}let h=a?.nodeMap;if(h&&Object.keys(h).length>0){if(h[""]==="r"){let u=i.$;u&&typeof u.set=="function"&&u.set(l)}for(let[u,d]of Object.entries(h)){if(u===""||d!=="b")continue;let g=u.split(/\.|\[|\]/).filter(Boolean),p=i.$;for(let w of g){if(!p)break;p=p[w]??void 0}if(p&&(S(p)||typeof p=="function"&&"set"in p&&typeof p.set=="function")){let w=l;for(let b of g){if(w==null){w=void 0;break}if(typeof w=="object")w=w[b];else{w=void 0;break}}try{p.set(w)}catch{}}}f(i.state,l);return}f(i.state,l)};function o(t,a){if(!a)return t;if(t===void 0)return{[T.UNDEFINED]:!0};if(typeof t=="number")return Number.isNaN(t)?{[T.NAN]:!0}:t===1/0?{[T.INFINITY]:!0}:t===-1/0?{[T.NEG_INFINITY]:!0}:t;if(typeof t=="bigint")return{[T.BIGINT]:String(t)};if(typeof t=="symbol")return{[T.SYMBOL]:String(t)};if(t instanceof Date)return{[T.DATE]:t.toISOString()};if(t instanceof RegExp)return{[T.REGEXP]:{source:t.source,flags:t.flags}};if(t instanceof Map)return{[T.MAP]:Array.from(t.entries())};if(t instanceof Set)return{[T.SET]:Array.from(t.values())};if(Array.isArray(t))return t.map(c=>o(c,a));if(t&&typeof t=="object"){let c={};for(let[l,s]of Object.entries(t))c[l]=o(s,a);return c}return t}return r.serialize=t=>{let a=y(y(y({},ve),n),t),c=z(i.state,new WeakSet,0,a.maxDepth,a.preserveTypes),l=o(c,a.preserveTypes),s=a.handleCircular?Q(l):[],f={data:l},h={};try{let g=i.$;g&&typeof g.set=="function"&&(h[""]="r");let p=new WeakSet,w=E=>S(E)||typeof E=="function"&&"set"in E&&typeof E.set=="function",b=(E,W="")=>{if(!E||typeof E!="object"&&typeof E!="function")return;let ce=E;if(!p.has(ce)){p.add(ce),W&&w(E)&&(h[W]="b");for(let[le,Pe]of Object.entries(E)){let _e=W?`${W}.${le}`:le;b(Pe,_e)}}};g&&b(g)}catch{}a.includeMetadata&&(f.metadata=y(y({timestamp:Date.now(),version:"1.0.0"},s.length>0&&{circularRefs:s}),Object.keys(h).length>0&&{nodeMap:h}));let u=un(a);return JSON.stringify(f,u,2)},r.deserialize=(t,a)=>{let c=y(y(y({},ve),n),a);try{let l=JSON.parse(t),{data:s,metadata:f}=l;f?.circularRefs&&c.handleCircular&&Me(s,f.circularRefs),r.fromJSON(s,f),i.__config?.debugMode&&console.log("[SignalTree] State restored from serialized data",{timestamp:f?.timestamp,version:f?.version})}catch(l){throw console.error("[SignalTree] Failed to deserialize:",l),new Error(`Failed to deserialize SignalTree state: ${l instanceof Error?l.message:"Unknown error"}`)}},r.snapshot=()=>{let t=r.toJSON(),a=Q(t);return{data:JSON.parse(JSON.stringify(t)),metadata:y({timestamp:Date.now(),version:"1.0.0"},a.length>0&&{circularRefs:a})}},r.restore=t=>{let{data:a,metadata:c}=t;c?.circularRefs&&Me(a,c.circularRefs),r.fromJSON(a,c)},r};return e.metadata={name:"serialization"},e}export{Fe as a,Ee as b,qe as c,Qe as d,en as e,j as f,nn as g,tn as h,rn as i,an as j,fn as k,sn as l,Ce as m,cn as n,ln as o};
