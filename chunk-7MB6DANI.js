import{a as T,b as h}from"./chunk-IT4IGUIF.js";function o(t){if(t===null||typeof t!="object")return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return new RegExp(t.source,t.flags);if(t instanceof Array)return t.map(n=>o(n));if(t instanceof Set)return new Set(Array.from(t).map(o));if(t instanceof Map)return new Map(Array.from(t).map(([n,s])=>[o(n),o(s)]));let e={};for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=o(t[n]));return e}function l(t,e){if(t===e)return!0;if(t===null||e===null||t===void 0||e===void 0)return t===e;if(typeof t!=typeof e)return!1;if(typeof t!="object")return t===e;if(t instanceof Date&&e instanceof Date)return t.getTime()===e.getTime();if(t instanceof RegExp&&e instanceof RegExp)return t.toString()===e.toString();if(t instanceof Array&&e instanceof Array){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!l(t[r],e[r]))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(let r of t)if(!e.has(r))return!1;return!0}if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(let[r,i]of t)if(!e.has(r)||!l(i,e.get(r)))return!1;return!0}let n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(let r of n)if(!s.includes(r)||!l(t[r],e[r]))return!1;return!0}var f=class{constructor(e,n={},s){this.tree=e;this.config=n;this.restoreStateFn=s;this.maxHistorySize=n.maxHistorySize??50,this.includePayload=n.includePayload??!0,this.actionNames=T({update:"UPDATE",set:"SET",batch:"BATCH"},n.actionNames),this.addEntry("INIT",this.tree())}history=[];currentIndex=-1;maxHistorySize;includePayload;actionNames;addEntry(e,n,s){this.currentIndex<this.history.length-1&&(this.history=this.history.slice(0,this.currentIndex+1));let r=T({state:o(n),timestamp:Date.now(),action:this.actionNames[e]||e},this.includePayload&&s!==void 0&&{payload:s});this.history.push(r),this.currentIndex=this.history.length-1,this.history.length>this.maxHistorySize&&(this.history.shift(),this.currentIndex--)}undo(){if(!this.canUndo())return!1;this.currentIndex--;let e=this.history[this.currentIndex];return this.restoreState(e.state),!0}redo(){if(!this.canRedo())return!1;this.currentIndex++;let e=this.history[this.currentIndex];return this.restoreState(e.state),!0}getHistory(){return this.history.map(e=>h(T({},e),{state:o(e.state)}))}resetHistory(){let e=this.tree();this.history=[],this.currentIndex=-1,this.addEntry("RESET",e)}jumpTo(e){if(e<0||e>=this.history.length)return!1;this.currentIndex=e;let n=this.history[e];return this.restoreState(n.state),!0}getCurrentIndex(){return this.currentIndex}canUndo(){return this.currentIndex>0}canRedo(){return this.currentIndex<this.history.length-1}restoreState(e){this.restoreStateFn?this.restoreStateFn(e):this.tree(e)}};function v(t={}){return e=>{let n=e.bind(e),s=!1,r=new f(e,t,a=>{s=!0;try{n(a)}finally{s=!1}}),i=function(...a){if(a.length===0)return n();{if(s){if(a.length===1){let u=a[0];return n(u)}return}let g=n(),c;if(a.length===1){let u=a[0];c=n(u)}let d=n();return l(g,d)||r.addEntry("update",d),c}};return Object.setPrototypeOf(i,Object.getPrototypeOf(e)),Object.assign(i,e),"state"in e&&Object.defineProperty(i,"state",{value:e.state,enumerable:!1,configurable:!0}),"$"in e&&Object.defineProperty(i,"$",{value:e.$,enumerable:!1,configurable:!0}),i.undo=()=>{r.undo()},i.redo=()=>{r.redo()},i.getHistory=()=>r.getHistory(),i.resetHistory=()=>{r.resetHistory()},i.jumpTo=a=>{r.jumpTo(a)},i.canUndo=()=>r.canUndo(),i.canRedo=()=>r.canRedo(),i.getCurrentIndex=()=>r.getCurrentIndex(),Object.assign(i,{__timeTravel:r})}}export{v as a};
