<div class="container">
  <h1>🧠 Memoization Demo</h1>

  <!-- Explanation Card -->
  <div class="explanation-card">
    <h2>💾 What is Memoization?</h2>
    <p class="intro-text">
      <strong>Memoization</strong> is an <em>optimization technique</em> that stores the results of expensive function calls and returns the cached result when the same inputs occur again. This dramatically improves performance by avoiding redundant calculations.
    </p>

    <div class="how-it-works">
      <h3>⚡ How It Works</h3>
      <ol class="instruction-list">
        <li><strong>First Call:</strong> Compute the result and store it in cache along with the input values</li>
        <li><strong>Subsequent Calls:</strong> Check if inputs match cached values - if yes, return cached result instantly</li>
        <li><strong>Cache Miss:</strong> If inputs changed, recompute the result and update the cache</li>
        <li><strong>Performance Gain:</strong> Cached results return in microseconds vs milliseconds for computation</li>
      </ol>
    </div>

    <div class="key-features">
      <h3>✨ Key Benefits</h3>
      <div class="feature-tags">
        <span class="feature-tag">⚡ Faster Rendering</span>
        <span class="feature-tag">💾 Reduced CPU Usage</span>
        <span class="feature-tag">🔄 Automatic Caching</span>
        <span class="feature-tag">📊 Improved UX</span>
      </div>
    </div>
  </div>

  <!-- Demo Grid -->
  <div class="demo-grid">
    <!-- Controls Card -->
    <div class="card controls-card">
      <h2>🎛️ Controls</h2>
      <p class="card-description">
        Adjust values to see how memoization caches results
      </p>

      <!-- Input Value -->
      <div class="control-group">
        <label for="input-value">
          Input Value: <strong>{{ inputValue() }}</strong>
        </label>
        <input
          id="input-value"
          type="range"
          min="1"
          max="20"
          [value]="inputValue()"
          (input)="updateInput(+$any($event.target).value)"
          class="range-input"
        />
      </div>

      <!-- Multiplier -->
      <div class="control-group">
        <label for="multiplier">
          Multiplier: <strong>{{ multiplier() }}</strong>
        </label>
        <input
          id="multiplier"
          type="range"
          min="1"
          max="10"
          [value]="multiplier()"
          (input)="updateMultiplier(+$any($event.target).value)"
          class="range-input"
        />
      </div>

      <!-- Results Display -->
      <div class="results-section">
        <div class="result-item expensive">
          <div class="result-label">Memoized Result</div>
          <div class="result-value">{{ expensiveResult() }}</div>
          <div class="result-hint">With caching</div>
        </div>

        <div class="result-item simple">
          <div class="result-label">Simple Result</div>
          <div class="result-value">{{ simpleResult() }}</div>
          <div class="result-hint">No caching</div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="button-group">
        <button
          (click)="triggerRecompute()"
          class="btn-primary btn-sm"
        >
          Trigger Recompute
        </button>
        <button
          (click)="clearCache()"
          class="btn-warning btn-sm"
        >
          Clear Cache
        </button>
        <button
          (click)="resetStats()"
          class="btn-danger btn-sm"
        >
          Reset All
        </button>
      </div>
    </div>

    <!-- Statistics Card -->
    <div class="card stats-card">
      <h2>📊 Statistics</h2>
      <p class="card-description">
        Real-time performance metrics
      </p>

      <div class="stats-grid">
        <div class="stat-item computations">
          <div class="stat-icon">🔢</div>
          <div class="stat-content">
            <div class="stat-label">Total Computations</div>
            <div class="stat-value">{{ totalComputations() }}</div>
          </div>
        </div>

        <div class="stat-item cache-hits">
          <div class="stat-icon">💾</div>
          <div class="stat-content">
            <div class="stat-label">Cache Hits</div>
            <div class="stat-value">{{ cacheHitCount() }}</div>
          </div>
        </div>

        <div class="stat-item new-computations">
          <div class="stat-icon">⚡</div>
          <div class="stat-content">
            <div class="stat-label">New Computations</div>
            <div class="stat-value">{{ computationCount() }}</div>
          </div>
        </div>

        <div class="stat-item hit-rate">
          <div class="stat-icon">📈</div>
          <div class="stat-content">
            <div class="stat-label">Cache Hit Rate</div>
            <div class="stat-value">{{ cacheHitRate().toFixed(1) }}%</div>
          </div>
        </div>
      </div>

      <!-- Performance Indicator -->
      <div class="performance-section">
        <div class="perf-label">Average Duration (Last 10)</div>
        <div class="perf-value">
          {{ formatDuration(averageDuration()) }}
        </div>
        <div class="perf-bar">
          <div
            class="perf-fill"
            [class.fast]="averageDuration() < 1"
            [class.slow]="averageDuration() >= 1"
            [style.width.%]="Math.min((averageDuration() / 10) * 100, 100)"
          ></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Computation Logs Card -->
  <div class="section-card logs-card">
    <div class="logs-header">
      <h2>📝 Computation Logs</h2>
      <button
        (click)="clearLogs()"
        class="btn-secondary btn-sm"
        [disabled]="logs().length === 0"
      >
        Clear Logs
      </button>
    </div>
    <p class="card-description">
      Real-time log of all computations showing cache hits and misses
    </p>

    @if (logs().length === 0) {
      <div class="empty-logs">
        <p>No computations logged yet.</p>
        <p class="empty-hint">Adjust the sliders above to trigger computations</p>
      </div>
    } @else {
      <div class="logs-list">
        @for (log of logs(); track log.id) {
          <div class="log-entry" [class.cached]="log.cached" [class.computed]="!log.cached">
            <div class="log-icon">
              {{ log.cached ? '💾' : '⚡' }}
            </div>
            <div class="log-content">
              <div class="log-header">
                <div class="log-type">{{ log.type }}</div>
                <div class="log-time">{{ formatTime(log.timestamp) }}</div>
              </div>
              <div class="log-details">
                <span class="log-input">Input: {{ log.input }}</span>
                <span class="log-separator">→</span>
                <span class="log-output">Output: {{ log.output }}</span>
              </div>
              <div class="log-footer">
                <span class="log-status" [class.cached]="log.cached">
                  {{ log.cached ? 'CACHED' : 'COMPUTED' }}
                </span>
                <span class="log-duration">{{ formatDuration(log.duration) }}</span>
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>
