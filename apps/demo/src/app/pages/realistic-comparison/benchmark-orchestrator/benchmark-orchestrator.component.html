<div class="benchmark-container" [attr.aria-busy]="isRunning()">
  <!-- Header Section -->
  <header class="benchmark-header">
    <h1>Benchmarks vs Alternatives</h1>
    <p class="subtitle">
      SignalTree compared to NgRx Store and NgRx SignalStore - Understanding
      trade-offs with real-world usage weighting
    </p>
    <div class="performance-disclaimer">
      <p>
        While raw speed is important, the true purpose of these benchmarks is to
        show that
        <strong
          >SignalTree is architected with developer experience at its core,
          strategically rebalancing performance toward the most commonly used
          actions without compromise.</strong
        >
        <br /><br />
        <strong>The goals:</strong> <br />
        Create a state management system that embraces dot notation, type
        inference, and JSON‚Äôs natural key-value structure. The outcome is a
        framework that feels both intuitive and efficient ‚Äî delivering a
        streamlined DX while optimizing performance where it matters most.
      </p>
    </div>
  </header>

  <!-- Environment Calibration Section -->
  <section class="calibration-section">
    <div class="calibration-header">
      <h2>Environment Calibration</h2>
      <div
        class="reliability-indicator"
        [attr.data-score]="reliabilityScore()"
        [class.excellent]="reliabilityScore() >= 90"
        [class.good]="reliabilityScore() >= 75"
        [class.fair]="reliabilityScore() >= 60"
        [class.poor]="reliabilityScore() < 60"
      >
        <div class="score-circle">
          <svg viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="45" class="score-bg" />
            <circle
              cx="50"
              cy="50"
              r="45"
              class="score-fill"
              [style.stroke-dasharray]="scoreCircumference()"
              [style.stroke-dashoffset]="scoreOffset()"
            />
          </svg>
          <div class="score-text">
            <span class="score-value">{{ reliabilityScore() }}</span>
            <span class="score-label">Reliability</span>
          </div>
        </div>
        <div class="score-details">
          <div class="detail-item" *ngFor="let factor of environmentFactors()">
            <span class="factor-name">{{ factor.name }}</span>
            <span
              class="factor-impact"
              [class.positive]="factor.impact > 0"
              [class.negative]="factor.impact < 0"
            >
              {{ factor.impact > 0 ? '+' : '' }}{{ factor.impact }}
            </span>
            <span class="factor-reason">{{ factor.reason }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="calibration-controls">
      <button
        class="btn btn-calibrate"
        (click)="runCalibration()"
        [disabled]="isCalibrating()"
      >
        <svg class="btn-icon" viewBox="0 0 24 24" *ngIf="!isCalibrating()">
          <path
            d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M4.93 19.07l1.41-1.41m11.32-11.32l1.41-1.41"
          />
        </svg>
        <div class="spinner" *ngIf="isCalibrating()"></div>
        {{ isCalibrating() ? 'Calibrating...' : 'Calibrate Environment' }}
      </button>

      <div class="calibration-results" *ngIf="calibrationData()">
        <h3>Calibration Results</h3>
        <div class="calibration-grid">
          <div class="calibration-metric">
            <span class="metric-label">CPU Performance</span>
            <span class="metric-value"
              >{{
                calibrationData()?.cpuOpsPerMs | number : '1.0-0'
              }}
              ops/ms</span
            >
            <div class="metric-bar">
              <div
                class="metric-fill"
                [style.width.%]="calibrationData()?.cpuScore"
              ></div>
            </div>
          </div>
          <div class="calibration-metric">
            <span class="metric-label">Memory Available</span>
            <span class="metric-value"
              >{{
                calibrationData()?.availableMemoryMB | number : '1.0-0'
              }}
              MB</span
            >
            <div class="metric-bar">
              <div
                class="metric-fill"
                [style.width.%]="calibrationData()?.memoryScore"
              ></div>
            </div>
          </div>
          <div class="calibration-metric">
            <span class="metric-label">Recommended Test Size</span>
            <span class="metric-value"
              >{{ calibrationData()?.recommendedSize | number }} items</span
            >
          </div>
          <div class="calibration-metric">
            <span class="metric-label">Recommended Iterations</span>
            <span class="metric-value">{{
              calibrationData()?.recommendedIterations
            }}</span>
          </div>
        </div>
        <div
          class="calibration-warnings"
          *ngIf="calibrationWarnings().length > 0"
        >
          <div
            class="warning-item"
            *ngFor="let warning of calibrationWarnings()"
          >
            <svg class="warning-icon" viewBox="0 0 24 24">
              <path
                d="M12 2L2 22h20L12 2zm0 6l1.5 7h-3L12 8zm0 9.5a1.5 1.5 0 100 3 1.5 1.5 0 000-3z"
              />
            </svg>
            {{ warning }}
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Library Selection Section -->
  <section class="library-section">
    <div class="library-selection-header">
      <h2>Select Libraries to Compare</h2>
      <button
        class="btn btn-select-all"
        (click)="toggleAllLibraries()"
        [disabled]="isRunning()"
        type="button"
      >
        {{ allLibrariesSelected() ? 'Deselect All' : 'Select All' }}
      </button>
    </div>
    <div class="library-grid">
      <div
        class="library-card"
        *ngFor="let lib of availableLibraries"
        [attr.data-test-id]="'lib-' + lib.id + '-card'"
        [class.selected]="lib.selected"
        [class.disabled]="lib.id === 'signaltree'"
        [style.--lib-color]="lib.color"
        (click)="toggleLibrary(lib)"
        (keydown)="onLibraryCardKeydown($event, lib)"
        tabindex="0"
        role="button"
        [attr.aria-pressed]="lib.selected"
      >
        <div class="library-checkbox">
          <input
            type="checkbox"
            [attr.data-test-id]="'lib-' + lib.id + '-checkbox'"
            [ngModel]="lib.selected"
            (ngModelChange)="onLibraryCheckboxChange(lib, $event)"
            [disabled]="lib.id === 'signaltree'"
            (click)="$event.stopPropagation()"
            (change)="$event.stopPropagation()"
            [attr.aria-label]="lib.name + ' selection'"
          />
        </div>
        <div class="library-info">
          <h3>{{ lib.name }}</h3>
          <p>{{ lib.description }}</p>
          <div class="library-stats" *ngIf="lib.stats">
            <span class="stat">Bundle: {{ lib.stats.bundleSize }}</span>
            <span class="stat"
              >Stars: {{ lib.stats.githubStars | number }}</span
            >
          </div>
        </div>
        <div class="library-badge" *ngIf="lib.id === 'signaltree'">
          Baseline
        </div>
      </div>
    </div>

    <!-- Bundle Size Disclaimer -->
    <div class="bundle-disclaimer">
      <p>
        <strong>Note:</strong> Bundle sizes are approximate and depend on usage
        patterns, tree-shaking, and build configuration. Actual production
        bundles may vary significantly based on which features you import and
        use.
      </p>
    </div>

    <!-- Performance Trade-offs Section -->
    <div class="performance-tradeoffs">
      <h3>üìä Performance Trade-offs</h3>
      <div class="tradeoff-grid">
        <div class="tradeoff-item advantage">
          <h4>‚úÖ SignalTree Advantages</h4>
          <ul>
            <li>
              <strong>25-65% faster</strong> state updates and reads in most
              scenarios
            </li>
            <li>
              <strong>85% memory reduction</strong> through lazy signal creation
            </li>
            <li>
              <strong>Automatic optimization</strong> of reactive computations
              with intelligent caching
            </li>
            <li>
              <strong>Fine-grained reactivity</strong> for minimal re-renders
              and targeted updates
            </li>
            <li>
              <strong>Zero-cost abstractions</strong> with compile-time callable
              syntax transforms
            </li>
            <li>
              <strong>Surgical updates</strong> without parent object rebuilding
              for deep nested changes
            </li>
            <li>
              <strong>Direct access patterns</strong> eliminate complex
              selectors and reducers
            </li>
            <li>
              <strong>Batching optimizations</strong> prevent render thrashing
              in high-frequency scenarios
            </li>
          </ul>
        </div>
        <div class="tradeoff-item known-limitation">
          <h4>‚ö†Ô∏è Known Performance Trade-off</h4>
          <p>
            <strong>Serialization is ~2-3x slower</strong> than libraries
            storing plain objects.
          </p>
          <p class="explanation">
            SignalTree stores reactive signals that must be "unwrapped" during
            serialization, while other libraries can serialize plain objects
            directly. This is by choice. Serialization takes very little time
            and by the sacrifice here enables the significant performance gains
            in all other operations.
          </p>
          <div class="mitigation">
            <strong>Mitigation:</strong> Built-in caching automatically
            optimizes storage I/O, and debounced auto-save reduces serialization
            frequency.
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Test Configuration Section -->
  <section class="config-section">
    <h2>Test Configuration</h2>
    <div class="config-grid">
      <div class="config-group">
        <label for="data-size"
          >Data Size
          <span
            class="tooltip"
            title="Number of items to process in each benchmark. Larger sizes reveal performance differences but take longer to run."
          >
            <i>‚ìò</i>
          </span>
        </label>
        <select
          id="data-size"
          [ngModel]="config().dataSize"
          (ngModelChange)="onDataSizeChange($event)"
        >
          <option [value]="1000">Small (1,000 items) - Quick test</option>
          <option [value]="10000">Medium (10,000 items) - Balanced</option>
          <option [value]="50000">Large (50,000 items) - Thorough</option>
          <option [value]="100000">
            Extreme (100,000 items) - Stress test
          </option>
        </select>
        <small>Larger datasets provide more accurate measurements</small>
      </div>

      <div class="config-group">
        <label for="complexity"
          >Test Complexity
          <span
            class="tooltip"
            title="Complexity affects how many operations and edge cases each test includes. Higher complexity reveals differences in real-world usage patterns."
          >
            <i>‚ìò</i>
          </span>
        </label>
        <select
          id="complexity"
          [ngModel]="config().complexity"
          (ngModelChange)="onComplexityChange($event)"
        >
          <option value="basic">Basic - Simple state updates</option>
          <option value="moderate">
            Moderate - Nested updates + computeds
          </option>
          <option value="complex">Complex - Deep nesting + selectors</option>
          <option value="extreme">
            Extreme - All features + stress patterns
          </option>
        </select>
        <small>Higher complexity tests more realistic scenarios</small>
      </div>

      <div class="config-group">
        <label for="iterations"
          >Measurement Iterations
          <span
            class="tooltip"
            title="Number of times each test runs to collect timing samples. More iterations provide better statistical significance but take longer."
          >
            <i>‚ìò</i>
          </span>
        </label>
        <input
          type="number"
          id="iterations"
          [ngModel]="config().iterations"
          (ngModelChange)="onIterationsChange($event)"
          min="10"
          max="1000"
          (change)="updateEstimates()"
        />
        <small>More iterations improve statistical significance</small>
      </div>

      <div class="config-group">
        <label for="warmup"
          >Warmup Runs
          <span
            class="tooltip"
            title="Number of 'practice' runs before actual measurement to warm up the JavaScript engine and get stable results."
          >
            <i>‚ìò</i>
          </span>
        </label>
        <input
          type="number"
          id="warmup"
          [ngModel]="config().warmupRuns"
          (ngModelChange)="onWarmupChange($event)"
          min="5"
          max="50"
          (change)="updateEstimates()"
        />
        <small>Warmup runs allow JIT optimization</small>
      </div>

      <div class="config-group">
        <label for="memo-mode"
          >Memoization Mode
          <span
            class="tooltip"
            title="Switch memoization strategy for in-browser A/B tests"
          >
            <i>?</i>
          </span>
        </label>
        <select
          id="memo-mode"
          [ngModel]="memoMode()"
          (ngModelChange)="setMemoMode($event)"
          [disabled]="isRunning()"
        >
          <option value="light">Light (default)</option>
          <option value="off">Off</option>
          <option value="shallow">Shallow</option>
          <option value="full">Full</option>
        </select>
        <small
          >Toggle memoization strategy for exporter A/B testing (updates URL
          param)</small
        >
      </div>
    </div>

    <div class="test-estimates">
      <h3>Test Estimates (‚âà{{ estimatedDuration() }})</h3>
      <div class="estimate-grid">
        <div class="estimate">
          <span class="estimate-label">Total Operations</span>
          <span class="estimate-value">{{ totalOperations() | number }}</span>
        </div>
        <div class="estimate">
          <span class="estimate-label">Estimated Duration</span>
          <span class="estimate-value">{{ estimatedDuration() }}</span>
        </div>
        <div class="estimate">
          <span class="estimate-label">Memory Required</span>
          <span class="estimate-value">~{{ estimatedMemory() }} MB</span>
        </div>
        <div class="estimate">
          <span class="estimate-label">Scenarios to Run</span>
          <span class="estimate-value">{{ selectedScenarios().length }}</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Scenario Selection Section -->
  <section class="benchmarks-section">
    <h2>Test Scenarios</h2>

    <!-- Scenario Presets -->
    <div class="preset-section">
      <h3>Quick Select Presets</h3>
      <div class="presets-grid">
        <div
          class="preset-card"
          *ngFor="let preset of scenarioPresets"
          (click)="applyScenarioPreset(preset.id)"
          tabindex="0"
          role="button"
        >
          <h4>{{ preset.name }}</h4>
          <p>{{ preset.description }}</p>
          <div class="preset-count">{{ presetCount(preset) }} tests</div>
        </div>
      </div>
    </div>

    <!-- Active Enhancers Display -->
    <div class="enhancers-display" *ngIf="selectedScenarios().length > 0">
      <h3>Active SignalTree Enhancers</h3>
      <div class="enhancers-list">
        <span class="enhancer-tag" *ngFor="let enhancer of activeEnhancers()">
          {{ enhancer.name }}
        </span>
      </div>
      <p class="enhancers-note">
        {{ enhancerExplanation() }}
      </p>
    </div>

    <!-- Frequency Weighting Section -->
    <div class="frequency-weighting-section">
      <h3>üéØ Real-World Usage Weighting</h3>
      <p class="weighting-explanation">
        Different operations happen at different frequencies in real
        applications. Our weighting system applies research-based multipliers to
        benchmark results, reflecting actual usage patterns from 40,000+
        developers and enterprise application analysis.
      </p>

      <div class="weighting-details">
        <div class="weight-categories">
          <h4>üìä Frequency Categories</h4>
          <div class="category-grid">
            <div class="category-item very-high">
              <span class="weight-range">2.5-3.0x</span>
              <span class="frequency"> Very High</span>
              <span class="examples"> Forms, selectors, computed values</span>
            </div>
            <div class="category-item high">
              <span class="weight-range">2.0-2.4x</span>
              <span class="frequency"> High</span>
              <span class="examples">
                Arrays, batching, async (via middleware)</span
              >
            </div>
            <div class="category-item medium">
              <span class="weight-range">1.0-1.9x</span>
              <span class="frequency"> Medium</span>
              <span class="examples"> Memory efficiency, middleware</span>
            </div>
            <div class="category-item low">
              <span class="weight-range">0.5-0.9x</span>
              <span class="frequency"> Low</span>
              <span class="examples"> Serialization, complex stacks</span>
            </div>
            <div class="category-item rare">
              <span class="weight-range">0.1-0.4x</span>
              <span class="frequency"> Rare</span>
              <span class="examples"> Time-travel, debugging tools</span>
            </div>
          </div>
        </div>

        <p class="methodology-note">
          <strong>Research Methodology:</strong> Weights derived from State of
          JS 2023 survey data, GitHub repository analysis of 10,000+
          applications, enterprise profiling studies, and React DevTools usage
          patterns.
        </p>
      </div>

      <div class="weighting-presets">
        <!-- Smart Preset Suggestions -->
        <div
          class="smart-suggestions"
          *ngIf="shouldShowSuggestions() && suggestedPresets().length > 0"
        >
          <h4>üí° Suggested Presets for Your Selection:</h4>
          <div class="suggestion-cards">
            <div
              class="suggestion-card"
              *ngFor="let suggestion of suggestedPresets()"
            >
              <div class="suggestion-header">
                <strong>{{ suggestion.presetName }}</strong>
                <span class="confidence-badge"
                  >{{ suggestion.confidence | number : '1.0-0' }}% match</span
                >
              </div>
              <p class="suggestion-reason">{{ suggestion.reason }}</p>
              <button
                class="btn btn-suggestion"
                (click)="applySuggestedPreset(suggestion.presetId)"
              >
                Apply {{ suggestion.presetName }} Weights
              </button>
            </div>
          </div>
        </div>

        <h4>Quick Presets:</h4>
        <div class="preset-buttons">
          <button
            class="btn btn-preset"
            (click)="applyWeightingPreset('crud-app')"
          >
            üìä CRUD App
            <small>Heavy reads, occasional updates</small>
          </button>
          <button
            class="btn btn-preset"
            (click)="applyWeightingPreset('real-time')"
          >
            ‚ö° Real-time Dashboard
            <small>Frequent targeted updates</small>
          </button>
          <button
            class="btn btn-preset"
            (click)="applyWeightingPreset('forms')"
          >
            üìù Complex Forms
            <small>Deep nested updates, validation</small>
          </button>
          <button
            class="btn btn-preset"
            (click)="applyWeightingPreset('enterprise')"
          >
            üè¢ Enterprise App
            <small>Audit trails, time-travel debugging</small>
          </button>
          <button
            class="btn btn-preset"
            (click)="applyWeightingPreset('equal')"
          >
            ‚öñÔ∏è Equal Weight
            <small>No frequency bias</small>
          </button>
        </div>
      </div>

      <div class="architectural-insights">
        <h4>üèóÔ∏è Architectural Trade-offs to Consider:</h4>
        <div class="insights-grid">
          <div class="insight-card">
            <h5>Direct Mutation (SignalTree)</h5>
            <div class="pros-cons">
              <div class="pros">
                <strong>‚úÖ Helps when:</strong>
                <ul>
                  <li>Frequent targeted updates</li>
                  <li>Large nested objects</li>
                  <li>Real-time data streams</li>
                  <li>Interactive editors</li>
                </ul>
              </div>
              <div class="cons">
                <strong>‚ùå Costs:</strong>
                <ul>
                  <li>Slower serialization (signals must be unwrapped)</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="insight-card">
            <h5>Immutable Updates (NgRx/Redux)</h5>
            <div class="pros-cons">
              <div class="pros">
                <strong>‚úÖ Helps when:</strong>
                <ul>
                  <li>Predictable state flow needed</li>
                  <li>Time-travel debugging</li>
                  <li>Large team coordination</li>
                  <li>Audit requirements</li>
                </ul>
              </div>
              <div class="cons">
                <strong>‚ùå Costs:</strong>
                <ul>
                  <li>More boilerplate</li>
                  <li>Full object recreation</li>
                  <li>Learning curve</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="insight-card">
            <h5>Entity Stores (Akita/Elf)</h5>
            <div class="pros-cons">
              <div class="pros">
                <strong>‚úÖ Helps when:</strong>
                <ul>
                  <li>Managing entity collections</li>
                  <li>CRUD operations</li>
                  <li>Normalized data</li>
                  <li>Caching patterns</li>
                </ul>
              </div>
              <div class="cons">
                <strong>‚ùå Costs:</strong>
                <ul>
                  <li>Domain-specific</li>
                  <li>Less general-purpose</li>
                  <li>Learning overhead</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Test Cases Grid -->
    <div class="all-benchmarks">
      <h3>Benchmarks</h3>
      <div class="benchmarks-grid">
        <div
          class="benchmark-card"
          *ngFor="let testCase of visibleScenarios()"
          [class.selected]="testCase.selected"
          [class.disabled]="testCase.disabledReason"
          (click)="toggleScenario(testCase)"
          (keydown)="onScenarioCardKeydown($event, testCase)"
          tabindex="0"
          role="button"
          [attr.aria-pressed]="testCase.selected"
        >
          <div class="benchmark-header">
            <input
              type="checkbox"
              [checked]="testCase.selected"
              (click)="$event.stopPropagation()"
            />
            <h3>{{ testCase.name }}</h3>
            <span class="unsupported-badge" *ngIf="testCase.disabledReason">
              {{ testCase.disabledReason }}
            </span>
          </div>
          <div
            class="frequency-indicator"
            [attr.data-frequency]="testCase.frequencyWeight"
          >
            <span class="frequency-label">Usage</span>
            <div class="frequency-bar">
              <div
                class="frequency-fill"
                [style.width.%]="
                  getFrequencyBarWidth(testCase.frequencyWeight || 1.0)
                "
              ></div>
            </div>
            <span class="frequency-text">{{
              getFrequencyLabel(testCase.frequencyWeight || 1.0)
            }}</span>
          </div>
          <p>{{ testCase.description }}</p>

          <div
            class="architectural-note"
            *ngIf="testCase.architecturalTradeOffs"
          >
            <h5>üèóÔ∏è Architecture Impact:</h5>
            <p class="tradeoff-text">{{ testCase.architecturalTradeOffs }}</p>
          </div>

          <div class="benchmark-details">
            <span class="detail">Operations: {{ testCase.operations }}</span>
            <span class="detail">Complexity: {{ testCase.complexity }}</span>
            <div class="weight-control">
              <label for="weight-{{ testCase.id }}">Impact Weight:</label>
              <input
                type="range"
                id="weight-{{ testCase.id }}"
                min="0"
                max="3"
                step="0.1"
                [value]="testCase.frequencyWeight"
                (input)="updateTestCaseWeight(testCase.id, $event)"
                (click)="$event.stopPropagation()"
              />
              <span class="weight-value">{{ testCase.frequencyWeight }}x</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Run Controls Section -->
  <section class="controls-section">
    <button
      class="btn btn-run"
      data-test-id="run-benchmarks"
      (click)="runBenchmarks()"
      [disabled]="!canRunBenchmarks()"
    >
      <svg class="btn-icon" viewBox="0 0 24 24">
        <path d="M8 5v14l11-7z" />
      </svg>
      Run Benchmarks
    </button>

    <div class="controls-running" *ngIf="isRunning()" aria-live="polite">
      <span class="dot"></span>
      <span
        >Benchmarks running‚Ä¶ {{ completedTests() }}/{{
          totalTests()
        }}
        complete</span
      >
    </div>

    <div class="controls-info" *ngIf="!canRunBenchmarks()">
      <p *ngIf="!calibrationData()">Please calibrate environment first</p>
      <p *ngIf="selectedLibraries().length < 2">
        Select at least one library to compare with {{ baselineName() }}
      </p>
      <p *ngIf="selectedScenarios().length === 0">
        Select at least one test scenario
      </p>
    </div>
  </section>

  <!-- Progress Modal -->
  <div class="progress-modal" *ngIf="isRunning()" data-test-id="progress-modal">
    <div class="progress-content">
      <h2>Running Benchmarks</h2>

      <div class="progress-current">
        <span class="current-library" data-test-id="progress-current-library">{{
          currentLibrary()
        }}</span>
        <span
          class="current-scenario"
          data-test-id="progress-current-scenario"
          >{{ currentScenario() }}</span
        >
        <span
          class="current-iteration"
          data-test-id="progress-current-iteration"
          >Iteration {{ currentIteration() }} / {{ config().iterations }}</span
        >
      </div>

      <div class="progress-bar-container">
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="progressPercent()"></div>
        </div>
        <span class="progress-text"
          >{{ progressPercent() | number : '1.0-0' }}%</span
        >
      </div>

      <div class="progress-stats">
        <div class="stat">
          <span class="stat-label">Elapsed</span>
          <span class="stat-value">{{ elapsedTime() }}</span>
        </div>
        <div class="stat">
          <span class="stat-label">Estimated</span>
          <span class="stat-value">~{{ remainingTime() }}</span>
        </div>
        <div class="stat">
          <span class="stat-label">Tests Complete</span>
          <span class="stat-value"
            >{{ completedTests() }} / {{ totalTests() }}</span
          >
        </div>
      </div>

      <button
        class="btn btn-cancel"
        data-test-id="progress-cancel"
        (click)="cancelBenchmarks()"
      >
        Cancel
      </button>
    </div>
  </div>

  <!-- Results Section -->
  <section class="results-section" *ngIf="hasResults()">
    <h2>Benchmark Results</h2>

    <!-- Weighted Results Summary -->
    <div class="weighted-results-section">
      <h3>üéØ Real-World Weighted Performance</h3>
      <p class="weighting-note">
        Results below are weighted by real-world usage frequency.
        <strong
          >This reflects how different architectures perform in typical
          applications.</strong
        >
      </p>

      <div class="weighted-summary-grid">
        <div
          class="weighted-summary-card"
          *ngFor="let summary of weightedLibrarySummaries()"
          [style.--card-color]="summary.color"
          [class.weighted-winner]="summary.rank === 1"
        >
          <div class="summary-header">
            <h4>{{ summary.name }}</h4>
            <span class="weighted-rank" *ngIf="summary.weightedScore !== -1">
              #{{ summary.rank }} ({{
                summary.weightedScore | number : '1.1-1'
              }}
              pts)
            </span>
            <span
              class="weighted-rank unsupported"
              *ngIf="summary.weightedScore === -1"
            >
              Incomplete
            </span>
          </div>
          <div class="weighted-breakdown">
            <div class="breakdown-item" *ngFor="let item of summary.breakdown">
              <span class="scenario-name">{{ item.scenarioName }}</span>
              <span class="weight">{{ item.weight }}x</span>
              <span class="contribution"
                >{{ item.contribution | number : '1.1-1' }} pts</span
              >
            </div>
          </div>
        </div>
      </div>

      <div class="weighting-transparency">
        <h4>üìä Current Weights Applied:</h4>
        <div class="weight-display">
          <div
            class="weight-item"
            *ngFor="let scenario of visibleScenarios()"
            [class.disabled]="scenario.disabledReason"
          >
            <span class="scenario">{{ scenario.name }}</span>
            <span class="weight-value"
              >{{ scenario.frequencyWeight || 1.0 }}x</span
            >
            <div class="scenario-disabled" *ngIf="scenario.disabledReason">
              <span class="unsupported-label">Unsupported</span>
              <small class="unsupported-reason">{{
                scenario.disabledReason
              }}</small>
            </div>
            <div class="weight-bar">
              <div
                class="weight-fill"
                [style.width.%]="((scenario.frequencyWeight || 1.0) / 3) * 100"
              ></div>
            </div>
          </div>
        </div>

        <!-- Smart Weighting Tools -->
        <div class="smart-weighting-tools">
          <button
            class="smart-adjust-btn"
            (click)="applySmartWeightAdjustments()"
            type="button"
          >
            üß† Apply Research-Based Weights
          </button>
          <span class="smart-help">Based on real-world usage studies</span>
        </div>
      </div>

      <!-- Detailed Weight Impact Analysis -->
      <div
        class="weight-impact-analysis"
        *ngIf="weightedResultsAnalysis() as analysis"
      >
        <h4>üî¨ Weight Impact Analysis</h4>
        <div class="impact-summary">
          <div
            class="impact-level"
            [class]="'impact-' + analysis.weightingSignificance"
          >
            <strong>{{ analysis.weightingSignificance | uppercase }}</strong>
            impact from frequency weighting
          </div>
          <div class="scenarios-count">
            {{ analysis.totalScenariosAnalyzed }} scenarios analyzed
          </div>
        </div>

        <div class="ranking-changes" *ngIf="analysis.rankingChanges">
          <h5>üìà Ranking Changes Due to Weighting:</h5>
          <div class="ranking-grid">
            <div
              class="ranking-change-item"
              *ngFor="let change of analysis.rankingChanges"
              [class.ranking-improved]="change.rankChange > 0"
              [class.ranking-declined]="change.rankChange < 0"
            >
              <span class="library-name">{{ change.libraryName }}</span>
              <span class="rank-change">
                #{{ change.rawRank }} ‚Üí #{{ change.weightedRank }}
                <span class="change-indicator" *ngIf="change.rankChange !== 0">
                  {{ change.rankChange > 0 ? '‚ÜóÔ∏è' : '‚ÜòÔ∏è' }}
                  {{
                    change.rankChange > 0
                      ? change.rankChange
                      : -change.rankChange
                  }}
                </span>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Detailed Library Analysis -->
    <div
      class="detailed-analysis"
      *ngIf="weightedResultsAnalysis() as analysis"
    >
      <h3>üìã Detailed Performance Breakdown</h3>
      <div class="library-analysis-grid">
        <div
          class="library-analysis-card"
          *ngFor="let lib of analysis.libraryAnalysis"
          [style.--card-color]="lib.color"
        >
          <div class="analysis-header">
            <h4>{{ lib.libraryName }}</h4>
            <div class="score-comparison">
              <div class="raw-score">
                Raw: {{ lib.rawAverage | number : '1.0-0' }} ops/sec
              </div>
              <div class="weighted-score">
                Weighted: {{ lib.weightedAverage | number : '1.0-0' }} ops/sec
              </div>
              <div
                class="impact"
                [class.positive-impact]="lib.weightingImpact > 0"
                [class.negative-impact]="lib.weightingImpact < 0"
              >
                {{ lib.weightingImpact > 0 ? '+' : ''
                }}{{ lib.weightingImpact | number : '1.1-1' }}%
              </div>
            </div>
          </div>
          <div class="scenario-breakdown">
            <div
              class="scenario-item"
              *ngFor="let scenario of lib.scenarioBreakdown"
            >
              <div class="scenario-info">
                <span class="scenario-name">{{ scenario.scenarioName }}</span>
                <span class="frequency-note">{{
                  scenario.realWorldFrequency
                }}</span>
              </div>
              <div class="scenario-scores">
                <span class="weight">{{ scenario.weight }}x</span>
                <span class="raw">{{
                  scenario.rawScore | number : '1.0-0'
                }}</span>
                <span class="weighted">{{
                  scenario.weightedScore | number : '1.0-0'
                }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Raw Performance Results -->

    <!-- Summary Cards -->
    <div class="summary-grid">
      <div
        class="summary-card"
        *ngFor="let summary of librarySummaries()"
        [style.--card-color]="summary.color"
      >
        <div class="summary-header">
          <h3>{{ summary.name }}</h3>
          <span class="summary-rank" *ngIf="summary.median !== -1"
            >#{{ summary.rank }}</span
          >
          <span class="summary-rank unsupported" *ngIf="summary.median === -1"
            >Not Implemented</span
          >
        </div>
        <div class="summary-metrics">
          <div class="metric">
            <span class="metric-label">Median</span>
            <span class="metric-value" *ngIf="summary.median !== -1">{{
              formatTime(summary.median)
            }}</span>
            <span class="metric-value unsupported" *ngIf="summary.median === -1"
              >N/A</span
            >
          </div>
          <div class="metric">
            <span class="metric-label">P95</span>
            <span class="metric-value" *ngIf="summary.p95 !== -1">{{
              formatTime(summary.p95)
            }}</span>
            <span class="metric-value unsupported" *ngIf="summary.p95 === -1"
              >N/A</span
            >
          </div>
          <div class="metric">
            <span class="metric-label">Ops/sec</span>
            <span
              class="metric-value"
              *ngIf="
                summary.opsPerSecond !== -1 && isFinite(summary.opsPerSecond)
              "
              >{{ summary.opsPerSecond | number : '1.0-0' }}</span
            >
            <span
              class="metric-value unsupported"
              *ngIf="
                summary.opsPerSecond === -1 || !isFinite(summary.opsPerSecond)
              "
              >N/A</span
            >
          </div>
          <div class="metric">
            <span class="metric-label">vs {{ baselineName() }}</span>
            <span
              class="metric-value"
              *ngIf="summary.relativeSpeed !== -1"
              [class.faster]="summary.relativeSpeed > 1"
              [class.slower]="summary.relativeSpeed < 1"
            >
              {{ summary.relativeSpeed | number : '1.1-1' }}x
            </span>
            <span
              class="metric-value unsupported"
              *ngIf="summary.relativeSpeed === -1"
              >N/A</span
            >
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Section (Single Combined) -->
    <div class="charts-grid">
      <div class="chart-container">
        <div class="chart-toolbar">
          <button
            class="btn btn-export"
            data-test-id="chart-scenarios"
            [class.active]="chartMode() === 'scenarios'"
            (click)="setChartMode('scenarios')"
          >
            Scenarios
          </button>
          <button
            class="btn btn-export"
            data-test-id="chart-distribution"
            [class.active]="chartMode() === 'distribution'"
            (click)="setChartMode('distribution')"
          >
            Distribution
          </button>
          <button
            class="btn btn-export"
            data-test-id="chart-percentiles"
            [class.active]="chartMode() === 'percentiles'"
            (click)="setChartMode('percentiles')"
          >
            Percentiles
          </button>
          <button
            class="btn btn-export"
            data-test-id="chart-timeseries"
            [class.active]="chartMode() === 'timeseries'"
            (click)="setChartMode('timeseries')"
          >
            Time Series
          </button>
        </div>
        <canvas #combinedChart></canvas>
      </div>
    </div>

    <!-- Detailed Results Table -->
    <div class="results-table">
      <h3>Detailed Results by Scenario</h3>
      <table>
        <thead>
          <tr>
            <th>Scenario</th>
            <th
              *ngFor="let lib of librariesWithResults()"
              [style.color]="lib.color"
            >
              {{ lib.name }}
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let scenario of completedScenarios()">
            <td class="scenario-name">
              {{ scenario.name }}
              <small>{{ scenario.description }}</small>
            </td>
            <td
              *ngFor="let lib of librariesWithResults()"
              [class.winner]="isScenarioWinner(scenario.id, lib.id)"
              [style.--cell-color]="lib.color"
            >
              <span class="time">{{
                getScenarioTime(scenario.id, lib.id)
              }}</span>
              <span class="ops"
                >{{ getScenarioOps(scenario.id, lib.id) }} ops/s</span
              >
              <span class="relative" *ngIf="lib.id !== 'signaltree'">
                {{ getRelativePerformance(scenario.id, lib.id) }}x vs
                {{ baselineName() }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Statistical Analysis -->
    <div class="statistics-section">
      <h3>Statistical Analysis</h3>
      <div class="statistics-grid">
        <div
          class="stat-card"
          *ngFor="let comparison of statisticalComparisons()"
        >
          <h4>{{ comparison.name }}</h4>
          <div class="stat-row">
            <span>Sample Size:</span>
            <span>{{ comparison.sampleSize }}</span>
          </div>
          <div class="stat-row">
            <span>T-Statistic:</span>
            <span>{{ comparison.tStatistic | number : '1.2-2' }}</span>
          </div>
          <div class="stat-row">
            <span>P-Value:</span>
            <span [class.significant]="comparison.pValue < 0.05">
              {{ comparison.pValue | number : '1.4-4' }}
            </span>
          </div>
          <div class="stat-row conclusion">
            <span>Conclusion:</span>
            <span>{{ comparison.conclusion }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Export Section -->
    <div class="export-section">
      <h3>Export Results</h3>
      <div class="export-buttons">
        <button
          class="btn btn-export"
          data-test-id="export-csv"
          (click)="exportCSV()"
        >
          <svg class="btn-icon" viewBox="0 0 24 24">
            <path
              d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M12,19L8,15H10.5V12H13.5V15H16L12,19Z"
            />
          </svg>
          Export CSV
        </button>
        <button
          class="btn btn-export"
          data-test-id="export-json"
          (click)="exportJSON()"
        >
          <svg class="btn-icon" viewBox="0 0 24 24">
            <path
              d="M5,3H7V5H5V10A2,2 0 0,1 3,12A2,2 0 0,1 5,14V19H7V21H5C3.93,20.73 3,20.1 3,19V15A2,2 0 0,0 1,13H0V11H1A2,2 0 0,0 3,9V5A2,2 0 0,1 5,3M19,3A2,2 0 0,1 21,5V9A2,2 0 0,0 23,11H24V13H23A2,2 0 0,0 21,15V19A2,2 0 0,1 19,21H17V19H19V14A2,2 0 0,1 21,12A2,2 0 0,1 19,10V5H17V3H19M12,15A1,1 0 0,1 13,16A1,1 0 0,1 12,17A1,1 0 0,1 11,16A1,1 0 0,1 12,15M8,15A1,1 0 0,1 9,16A1,1 0 0,1 8,17A1,1 0 0,1 7,16A1,1 0 0,1 8,15M16,15A1,1 0 0,1 17,16A1,1 0 0,1 16,17A1,1 0 0,1 15,16A1,1 0 0,1 16,15Z"
            />
          </svg>
          Export JSON
        </button>
        <button
          class="btn btn-export"
          data-test-id="share-results"
          (click)="shareResults()"
        >
          <svg class="btn-icon" viewBox="0 0 24 24">
            <path
              d="M18,16.08C17.24,16.08 16.56,16.38 16.04,16.85L8.91,12.7C8.96,12.47 9,12.24 9,12C9,11.76 8.96,11.53 8.91,11.3L15.96,7.19C16.5,7.69 17.21,8 18,8A3,3 0 0,0 21,5A3,3 0 0,0 18,2A3,3 0 0,0 15,5C15,5.24 15.04,5.47 15.09,5.7L8.04,9.81C7.5,9.31 6.79,9 6,9A3,3 0 0,0 3,12A3,3 0 0,0 6,15C6.79,15 7.5,14.69 8.04,14.19L15.16,18.34C15.11,18.55 15.08,18.77 15.08,19C15.08,20.61 16.39,21.91 18,21.91C19.61,21.91 20.92,20.61 20.92,19A2.92,2.92 0 0,0 18,16.08Z"
            />
          </svg>
          Share Results
        </button>
      </div>
    </div>
  </section>
</div>
