<div class="benchmark-history-container">
  <div class="header">
    <h1>üìä Benchmark History</h1>
    <p class="subtitle">
      Real-world performance data from SignalTree users across different systems
    </p>
  </div>

  <!-- Loading State -->
  <div class="loading" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading benchmarks...</p>
  </div>

  <!-- Error State -->
  <div class="error-banner" *ngIf="error && !loading">
    <p>{{ error }}</p>
    <button class="btn primary" (click)="loadBenchmarks()">Retry</button>
  </div>

  <!-- Content -->
  <div *ngIf="!loading && !error">
    <!-- Statistics Summary -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">üìà</div>
        <div class="stat-value">{{ stats.totalSubmissions | number }}</div>
        <div class="stat-label">Total Submissions</div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üéØ</div>
        <div class="stat-value">{{ stats.avgDepth | number }}</div>
        <div class="stat-label">Average Depth</div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">‚ö°</div>
        <div class="stat-value">{{ stats.avgCreation }}ms</div>
        <div class="stat-label">Avg Creation Time</div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üèÜ</div>
        <div class="stat-value">{{ stats.fastest }}ms</div>
        <div class="stat-label">Fastest Time</div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üìç</div>
        <div class="stat-value">{{ stats.avgAccess }}ms</div>
        <div class="stat-label">Avg Access Time</div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üîÑ</div>
        <div class="stat-value">{{ stats.avgUpdate }}ms</div>
        <div class="stat-label">Avg Update Time</div>
      </div>
    </div>

    <!-- Filters -->
    <div class="filters-section">
      <h2>üîç Filters & Sorting</h2>
      <div class="filters-grid">
        <div class="filter-group">
          <label for="browserFilter">Browser:</label>
          <select
            id="browserFilter"
            [(ngModel)]="selectedBrowser"
            class="filter-select"
          >
            <option value="all">All Browsers</option>
            <option *ngFor="let browser of uniqueBrowsers" [value]="browser">
              {{ browser }}
            </option>
          </select>
        </div>

        <div class="filter-group">
          <label for="osFilter">Operating System:</label>
          <select id="osFilter" [(ngModel)]="selectedOS" class="filter-select">
            <option value="all">All Operating Systems</option>
            <option *ngFor="let os of uniqueOS" [value]="os">
              {{ os }}
            </option>
          </select>
        </div>

        <div class="filter-group">
          <div class="filter-label">Sort By:</div>
          <div class="sort-buttons">
            <button
              class="btn small"
              [class.active]="sortBy === 'date'"
              (click)="setSortBy('date')"
            >
              Date
              {{
                sortBy === 'date' ? (sortDirection === 'desc' ? '‚Üì' : '‚Üë') : ''
              }}
            </button>
            <button
              class="btn small"
              [class.active]="sortBy === 'depth'"
              (click)="setSortBy('depth')"
            >
              Depth
              {{
                sortBy === 'depth' ? (sortDirection === 'desc' ? '‚Üì' : '‚Üë') : ''
              }}
            </button>
            <button
              class="btn small"
              [class.active]="sortBy === 'performance'"
              (click)="setSortBy('performance')"
            >
              Speed
              {{
                sortBy === 'performance'
                  ? sortDirection === 'desc'
                    ? '‚Üì'
                    : '‚Üë'
                  : ''
              }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- No Results -->
    <div class="no-results" *ngIf="filteredBenchmarks.length === 0">
      <p>No benchmarks found with the selected filters.</p>
    </div>

    <!-- Benchmarks Table -->
    <div class="benchmarks-section" *ngIf="filteredBenchmarks.length > 0">
      <h2>üìã Benchmark Results ({{ filteredBenchmarks.length | number }})</h2>

      <div class="benchmarks-table">
        <div class="table-header">
          <div class="col-date">Date</div>
          <div class="col-depth">Depth</div>
          <div class="col-system">System</div>
          <div class="col-performance">Performance</div>
        </div>

        <div
          *ngFor="let benchmark of filteredBenchmarks"
          class="table-row"
          [class.highlight]="benchmark.depth >= 100"
        >
          <div class="col-date">
            <div class="date-text">{{ formatDate(benchmark.createdAt) }}</div>
          </div>

          <div class="col-depth">
            <span class="depth-badge" [class.extreme]="benchmark.depth >= 100">
              {{ benchmark.depth }} levels
            </span>
          </div>

          <div class="col-system">
            <div class="system-info">
              <div class="system-row">
                <span class="system-label">Browser:</span>
                <span class="system-value">{{
                  benchmark.machineInfo.browser
                }}</span>
              </div>
              <div class="system-row">
                <span class="system-label">OS:</span>
                <span class="system-value">{{ benchmark.machineInfo.os }}</span>
              </div>
              <div class="system-row">
                <span class="system-label">CPU:</span>
                <span class="system-value"
                  >{{ benchmark.machineInfo.cpuCores }} cores</span
                >
              </div>
              <div class="system-row">
                <span class="system-label">Memory:</span>
                <span class="system-value">{{
                  benchmark.machineInfo.memory
                }}</span>
              </div>
            </div>
          </div>

          <div class="col-performance">
            <div class="performance-metrics">
              <div
                class="metric"
                [class]="getPerformanceClass(benchmark.results.creationTime)"
              >
                <span class="metric-label">Creation:</span>
                <span class="metric-value"
                  >{{ benchmark.results.creationTime.toFixed(3) }}ms</span
                >
              </div>
              <div
                class="metric"
                [class]="getPerformanceClass(benchmark.results.accessTime)"
              >
                <span class="metric-label">Access:</span>
                <span class="metric-value"
                  >{{ benchmark.results.accessTime.toFixed(3) }}ms</span
                >
              </div>
              <div
                class="metric"
                [class]="getPerformanceClass(benchmark.results.updateTime)"
              >
                <span class="metric-label">Update:</span>
                <span class="metric-value"
                  >{{ benchmark.results.updateTime.toFixed(3) }}ms</span
                >
              </div>
              <div class="metric tests">
                <span class="metric-label">Tests:</span>
                <span class="metric-value">{{
                  benchmark.results.totalTests
                }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Info Section -->
    <div class="info-section">
      <h3>üìñ About This Data</h3>
      <p>
        All benchmarks are submitted anonymously by users who have consented to
        share their results. This data helps us understand real-world
        performance across different hardware and browsers, and guides
        optimization efforts.
      </p>
      <p>
        <strong>Performance Classes:</strong>
        <span class="perf-badge excellent">Excellent (&lt;0.05ms)</span>
        <span class="perf-badge good">Good (&lt;0.1ms)</span>
        <span class="perf-badge fair">Fair (&lt;0.5ms)</span>
        <span class="perf-badge poor">Needs Improvement (‚â•0.5ms)</span>
      </p>
    </div>
  </div>
</div>
