<div class="container">
  <h1>Time Travel Demo</h1>

  <div class="explanation-card">
    <h2>What is Time Travel?</h2>
    <p class="intro-text">
      <strong>Time Travel</strong> allows you to
      <em>undo and redo state changes</em>, navigate through your application's
      history, and replay user actions. Perfect for debugging, testing, and
      providing undo/redo functionality.
    </p>
    <div class="how-it-works">
      <h3>How It Works</h3>
      <ol class="instruction-list">
        <li>
          <strong>Automatic Tracking:</strong> Every state change is recorded in
          history
        </li>
        <li>
          <strong>Navigate History:</strong> Move backward and forward through
          state snapshots
        </li>
        <li>
          <strong>Jump to State:</strong> Click any history item to instantly
          restore that state
        </li>
        <li>
          <strong>Undo/Redo:</strong> Built-in undo and redo functionality
        </li>
        <li>
          <strong>Quick Test:</strong> Click "Generate Sample Actions" to see
          time travel in action instantly!
        </li>
      </ol>
    </div>
  </div>

  <div class="demo-grid">
    <div class="card actions-card">
      <h2>Make State Changes</h2>
      <p class="card-description">
        Each action below creates a new entry in history. Click "Generate Sample
        Actions" to quickly populate history, then use Undo/Redo to navigate!
      </p>

      <div class="control-section">
        <h3>Counter: {{ counter() }}</h3>
        <p style="font-size: 0.875rem; color: #6b7280; margin: 0.5rem 0">
          Increment or decrement to add history entries
        </p>
        <div class="button-group">
          <button (click)="increment()" class="btn-primary btn-sm">
            +1 Increment
          </button>
          <button (click)="decrement()" class="btn-danger btn-sm">
            -1 Decrement
          </button>
          <button (click)="reset()" class="btn-secondary btn-sm">
            Reset to 0
          </button>
        </div>
      </div>

      <div class="control-section">
        <h3>Message</h3>
        <input
          type="text"
          [value]="message()"
          (input)="updateMessage($any($event.target).value)"
          class="form-input"
        />
      </div>

      <div class="control-section">
        <h3>Todos</h3>
        <div class="input-group">
          <input
            type="text"
            [(ngModel)]="newTodoText"
            (keyup.enter)="addTodo()"
            placeholder="Add a todo..."
            class="form-input"
          />
          <button
            (click)="addTodo()"
            [disabled]="!newTodoText.trim()"
            class="btn-primary btn-sm"
          >
            Add
          </button>
        </div>
        <div class="todos-list">
          @for (todo of todos(); track todo.id) {
          <div class="todo-item" [class.completed]="todo.completed">
            <input
              type="checkbox"
              [checked]="todo.completed"
              (change)="toggleTodo(todo.id)"
            />
            <span>{{ todo.title }}</span>
            <button (click)="deleteTodo(todo.id)" class="btn-delete">X</button>
          </div>
          }
        </div>
      </div>
    </div>

    <div class="card time-travel-card">
      <h2>Time Travel Controls</h2>
      <p class="card-description">Navigate through state history</p>

      <div class="tt-controls">
        <button (click)="undo()" [disabled]="!canUndo()" class="btn-warning">
          Undo
        </button>
        <button (click)="redo()" [disabled]="!canRedo()" class="btn-success">
          Redo
        </button>
        <button (click)="generateSampleActions()" class="btn-primary btn-sm">
          ðŸŽ¬ Generate Sample Actions
        </button>
        <button (click)="clearHistory()" class="btn-danger btn-sm">
          Clear History
        </button>
      </div>

      <div class="history-info">
        <div class="info-item">
          <span class="label">History Length:</span>
          <span class="value">{{ historyLength() }}</span>
        </div>
        <div class="info-item">
          <span class="label">Current Position:</span>
          <span class="value"
            >{{ currentIndex() + 1 }} / {{ historyLength() }}</span
          >
        </div>
      </div>

      <div class="history-list">
        <h3>State History</h3>
        @for (state of history(); track $index) {
        <div
          class="history-item"
          [class.active]="$index === currentIndex()"
          (click)="goToState($index)"
          tabindex="0"
          (keyup)="onHistoryItemKeyup($event, $index)"
          role="button"
          [attr.aria-pressed]="$index === currentIndex()"
        >
          <div class="history-index">{{ $index + 1 }}</div>
          <div class="history-content">
            <div class="history-time">
              {{ formatTimestamp(state.timestamp) }}
            </div>
            <div class="history-preview">
              {{ getStatePreview(state.state) }}
            </div>
          </div>
        </div>
        }
      </div>
    </div>
  </div>
</div>
