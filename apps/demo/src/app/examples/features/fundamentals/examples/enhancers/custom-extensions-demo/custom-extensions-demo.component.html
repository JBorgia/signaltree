<div class="custom-extensions-demo">
  <header class="demo-header">
    <h1>ğŸ”§ Custom Markers & Enhancers</h1>
    <p class="subtitle">
      Learn how to extend SignalTree with your own markers and enhancers
    </p>
  </header>

  <!-- Overview Section -->
  <section class="overview-section">
    <div class="concept-cards">
      <div class="concept-card marker-card">
        <div class="card-icon">ğŸ·ï¸</div>
        <h3>Markers</h3>
        <p>
          Placeholders in your state that get <strong>materialized</strong> into
          specialized signal types during tree initialization.
        </p>
        <ul>
          <li>Define state shape declaratively</li>
          <li>Auto-transform to rich APIs</li>
          <li>
            Examples: <code>entityMap()</code>, <code>status()</code>,
            <code>stored()</code>
          </li>
        </ul>
      </div>

      <div class="concept-card enhancer-card">
        <div class="card-icon">âš¡</div>
        <h3>Enhancers</h3>
        <p>
          Functions that <strong>augment</strong> your tree with additional
          methods, signals, or behavior via <code>.with()</code>.
        </p>
        <ul>
          <li>Add cross-cutting features</li>
          <li>Compose via chaining</li>
          <li>
            Examples: <code>devTools()</code>, <code>batching()</code>,
            <code>effects()</code>
          </li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Live Demo Section -->
  <section class="demo-section">
    <h2>ğŸ“± Live Demo</h2>
    <p class="section-intro">
      This demo uses a custom <code>validated()</code> marker and a custom
      <code>withLogger()</code> enhancer:
    </p>

    <div class="demo-grid">
      <!-- Validated Fields Panel -->
      <div class="panel validated-panel">
        <h3>ğŸ·ï¸ Custom <code>validated()</code> Marker</h3>
        <p class="panel-description">
          Each field below uses the custom marker to provide built-in
          validation:
        </p>

        <div class="form-group">
          <label for="username">Username</label>
          <div class="input-row">
            <input
              id="username"
              type="text"
              [(ngModel)]="usernameInput"
              [class.invalid]="!username.isValid()"
              [class.valid]="username.isValid() && usernameInput"
              placeholder="Enter username"
            />
            <button class="btn-small" (click)="updateUsername()">Set</button>
          </div>
          <div class="validation-status">
            @if (username.error(); as error) {
            <span class="error">âŒ {{ error }}</span>
            } @else if (username()) {
            <span class="valid">âœ… Valid</span>
            }
          </div>
          <div class="current-value">
            Current: <code>{{ username() || '(empty)' }}</code>
          </div>
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <div class="input-row">
            <input
              id="email"
              type="email"
              [(ngModel)]="emailInput"
              [class.invalid]="!email.isValid()"
              [class.valid]="email.isValid() && emailInput"
              placeholder="Enter email"
            />
            <button class="btn-small" (click)="updateEmail()">Set</button>
          </div>
          <div class="validation-status">
            @if (email.error(); as error) {
            <span class="error">âŒ {{ error }}</span>
            } @else if (email()) {
            <span class="valid">âœ… Valid</span>
            }
          </div>
          <div class="current-value">
            Current: <code>{{ email() || '(empty)' }}</code>
          </div>
        </div>

        <div class="form-group">
          <label for="age">Age</label>
          <div class="input-row">
            <input
              id="age"
              type="number"
              [(ngModel)]="ageInput"
              [class.invalid]="!age.isValid()"
              [class.valid]="age.isValid()"
              placeholder="Enter age"
            />
            <button class="btn-small" (click)="updateAge()">Set</button>
          </div>
          <div class="validation-status">
            @if (age.error(); as error) {
            <span class="error">âŒ {{ error }}</span>
            } @else {
            <span class="valid">âœ… Valid</span>
            }
          </div>
          <div class="current-value">
            Current: <code>{{ age() }}</code>
          </div>
        </div>

        <div class="actions">
          <button class="btn-secondary" (click)="resetAll()">Reset All</button>
        </div>
      </div>

      <!-- Logger Panel -->
      <div class="panel logger-panel">
        <h3>âš¡ Custom <code>withLogger()</code> Enhancer</h3>
        <p class="panel-description">
          The enhancer adds <code>log()</code>, <code>history</code>, and
          <code>clearLogs()</code>:
        </p>

        <div class="counter-section">
          <span class="section-label">Counter (regular signal)</span>
          <div class="counter-row">
            <span class="counter-value">{{ store.$.counter() }}</span>
            <button class="btn-primary" (click)="incrementCounter()">+1</button>
          </div>
        </div>

        <div class="log-section">
          <div class="log-header">
            <span class="section-label"
              >Log History ({{ history().length }} entries)</span
            >
            <button class="btn-small btn-secondary" (click)="clearLogs()">
              Clear
            </button>
          </div>
          <div class="log-container">
            @if (history().length === 0) {
            <div class="log-empty">No logs yet</div>
            } @else { @for (entry of history(); track entry) {
            <div class="log-entry">{{ entry }}</div>
            } }
          </div>
        </div>

        <div class="last-action">
          <strong>Last action:</strong> {{ lastAction() }}
        </div>
      </div>
    </div>
  </section>

  <!-- Code Examples Section -->
  <section class="code-section">
    <h2>ğŸ“ Implementation Guide</h2>

    <div class="code-tabs">
      <details open>
        <summary>
          <span class="tab-icon">ğŸ·ï¸</span>
          Custom Marker Implementation
        </summary>
        <div class="code-content">
          <p>
            A marker is a placeholder object identified by a unique Symbol.
            During tree finalization, registered processors transform markers
            into their materialized form.
          </p>
          <pre><code [innerText]="markerCode || '[code not available]'"></code></pre>
          <div class="code-debug">
            Length: <code>{{ markerCode?.length ?? 0 }}</code>
          </div>
        </div>
      </details>

      <details>
        <summary>
          <span class="tab-icon">âš¡</span>
          Custom Enhancer Implementation
        </summary>
        <div class="code-content">
          <p>
            An enhancer is a function that takes a tree and returns an augmented
            tree with additional methods or behavior.
          </p>
          <pre><code [innerText]="enhancerCode || '[code not available]'"></code></pre>
          <div class="code-debug">
            Length: <code>{{ enhancerCode?.length ?? 0 }}</code>
          </div>
        </div>
      </details>

      <details>
        <summary>
          <span class="tab-icon">ğŸš€</span>
          Usage Example
        </summary>
        <div class="code-content">
          <p>
            Combine markers and enhancers for powerful, type-safe state
            management:
          </p>
          <pre><code [innerText]="usageCode || '[code not available]'"></code></pre>
          <div class="code-debug">
            Length: <code>{{ usageCode?.length ?? 0 }}</code>
          </div>
        </div>
      </details>
    </div>
  </section>

  <!-- Best Practices Section -->
  <section class="best-practices-section">
    <h2>âœ… Best Practices</h2>

    <div class="practices-grid">
      <div class="practice">
        <h4>ğŸ·ï¸ Markers</h4>
        <ul>
          <li>Use <code>Symbol()</code> for unique identification</li>
          <li>Keep type guards simple and fast</li>
          <li>Register processors once at app startup</li>
          <li>Handle errors gracefully in materializers</li>
          <li>Provide <code>reset()</code> methods for default restoration</li>
        </ul>
      </div>

      <div class="practice">
        <h4>âš¡ Enhancers</h4>
        <ul>
          <li>Return <code>tree & YourMethods</code> for type inference</li>
          <li>Use <code>Object.assign()</code> to preserve tree identity</li>
          <li>Provide cleanup in <code>destroy()</code> if needed</li>
          <li>Add <code>/*@__PURE__*/</code> for tree-shaking</li>
          <li>Use <code>createEnhancer()</code> for metadata</li>
        </ul>
      </div>

      <div class="practice">
        <h4>ğŸ”— Composition</h4>
        <ul>
          <li>Chain enhancers with <code>.with().with()</code></li>
          <li>Markers work independently of enhancers</li>
          <li>Order matters for enhancer dependencies</li>
          <li>Use <code>provides</code>/<code>requires</code> metadata</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Links Section -->
  <section class="links-section">
    <h2>ğŸ“š Learn More</h2>
    <div class="links-grid">
      <a
        href="/docs/custom-markers-enhancers.md"
        class="link-card"
        target="_blank"
      >
        <span class="link-icon">ğŸ“–</span>
        <span>Full Documentation</span>
      </a>
      <a
        href="https://github.com/JBorgia/signaltree"
        class="link-card"
        target="_blank"
      >
        <span class="link-icon">ğŸ™</span>
        <span>Source Code</span>
      </a>
      <a routerLink="/devtools" class="link-card">
        <span class="link-icon">ğŸ”§</span>
        <span>DevTools Demo</span>
      </a>
      <a routerLink="/batching" class="link-card">
        <span class="link-icon">ğŸ“¦</span>
        <span>Batching Demo</span>
      </a>
    </div>
  </section>
</div>
