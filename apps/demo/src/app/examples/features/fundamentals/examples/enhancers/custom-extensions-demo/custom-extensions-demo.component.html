<div class="custom-extensions-demo">
  <header class="demo-header">
    <h1>üîß Custom Markers & Enhancers</h1>
    <p class="subtitle">
      Learn how to extend SignalTree with your own markers and enhancers. This
      demo shows a complete <code>validated()</code> marker and
      <code>withAnalytics()</code> / <code>withLogger()</code> enhancers.
    </p>
  </header>

  <!-- Overview Section -->
  <section class="overview-section">
    <div class="concept-cards">
      <div class="concept-card marker-card">
        <div class="card-icon">üè∑Ô∏è</div>
        <h3>Markers</h3>
        <p>
          Placeholders in your state that get <strong>materialized</strong> into
          specialized signal types during tree initialization.
        </p>
        <ul>
          <li>Define state shape declaratively</li>
          <li>Auto-transform to rich APIs</li>
          <li>
            Examples: <code>entityMap()</code>, <code>status()</code>,
            <code>validated()</code>
          </li>
        </ul>
      </div>

      <div class="concept-card enhancer-card">
        <div class="card-icon">‚ö°</div>
        <h3>Enhancers</h3>
        <p>
          Functions that augment your tree with additional methods, signals, or
          behaviors via <code>.with()</code>.
        </p>
        <ul>
          <li>Add methods to tree instances</li>
          <li>Can have dependencies on other enhancers</li>
          <li>
            Examples: <code>batching()</code>, <code>devTools()</code>,
            <code>withAnalytics()</code>
          </li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Live Demo Section -->
  <section class="demo-section">
    <h2>üìù Live Demo: Validated Form with Analytics</h2>
    <p class="section-desc">
      This form uses a custom <code>validated()</code> marker for real-time
      validation and custom enhancers for analytics and logging.
    </p>

    <div class="demo-grid">
      <!-- Form Panel -->
      <div class="demo-panel form-panel">
        <h3>Form with Validation</h3>

        <div
          class="form-group"
          [class.has-error]="emailError()"
          [class.is-valid]="!emailError() && store.$.email()"
        >
          <label for="email">Email</label>
          <input
            id="email"
            type="email"
            [value]="store.$.email()"
            (input)="onEmailChange($event)"
            placeholder="Enter email address"
          />
          @if (emailError()) {
          <span class="error-message">{{ emailError() }}</span>
          } @if (!emailError() && store.$.email()) {
          <span class="valid-indicator">‚úì Valid</span>
          }
        </div>

        <div
          class="form-group"
          [class.has-error]="usernameError()"
          [class.is-valid]="!usernameError() && store.$.username()"
        >
          <label for="username">Username</label>
          <input
            id="username"
            type="text"
            [value]="store.$.username()"
            (input)="onUsernameChange($event)"
            placeholder="Choose a username"
          />
          @if (usernameError()) {
          <span class="error-message">{{ usernameError() }}</span>
          } @if (!usernameError() && store.$.username()) {
          <span class="valid-indicator">‚úì Valid</span>
          }
        </div>

        <div
          class="form-group"
          [class.has-error]="ageError()"
          [class.is-valid]="!ageError() && store.$.age() > 0"
        >
          <label for="age">Age</label>
          <input
            id="age"
            type="number"
            [value]="store.$.age()"
            (input)="onAgeChange($event)"
            placeholder="Enter your age"
            min="0"
            max="150"
          />
          @if (ageError()) {
          <span class="error-message">{{ ageError() }}</span>
          } @if (!ageError() && store.$.age() > 0) {
          <span class="valid-indicator">‚úì Valid</span>
          }
        </div>

        <div class="form-actions">
          <button
            class="btn primary"
            [disabled]="!allFieldsValid()"
            (click)="submitForm()"
          >
            Submit Form
          </button>
          <button class="btn secondary" (click)="resetForm()">Reset</button>
        </div>

        @if (store.$.lastSubmitted()) {
        <div class="submit-info">
          <strong>Last submitted:</strong> {{ store.$.lastSubmitted() }}
          <br />
          <strong>Total submissions:</strong> {{ store.$.submitCount() }}
        </div>
        }
      </div>

      <!-- Analytics Panel -->
      <div class="demo-panel analytics-panel">
        <h3>Custom withAnalytics() Enhancer</h3>
        <div class="panel-header">
          <span class="event-count">{{ store.eventCount() }} events</span>
          <button class="btn small" (click)="store.clearEvents()">Clear</button>
        </div>

        <div class="events-list">
          @for (event of store.events().slice().reverse().slice(0, 10); track
          event.timestamp) {
          <div class="event-item" [class]="event.type">
            <span class="event-type">{{ event.type }}</span>
            <span class="event-time">{{
              event.timestamp | date : 'HH:mm:ss.SSS'
            }}</span>
            @if (event.data) {
            <pre class="event-data">{{ event.data | json }}</pre>
            }
          </div>
          } @if (store.events().length === 0) {
          <div class="empty-state">
            No events tracked yet. Interact with the form!
          </div>
          }
        </div>
      </div>

      <!-- Logger Panel -->
      <div class="demo-panel logger-panel">
        <h3>Custom withLogger() Enhancer</h3>
        <div class="panel-header">
          <span class="log-count">{{ logs().length }} logs</span>
          <button class="btn small" (click)="clearLogs()">Clear</button>
        </div>

        <div class="logs-list">
          @for (entry of logs().slice().reverse(); track entry.timestamp) {
          <div class="log-item" [class]="entry.level">
            <span class="log-level">{{ entry.level | uppercase }}</span>
            <span class="log-message">{{ entry.message }}</span>
            <span class="log-time">{{
              entry.timestamp | date : 'HH:mm:ss'
            }}</span>
          </div>
          } @if (logs().length === 0) {
          <div class="empty-state">No logs yet. Submit or reset the form!</div>
          }
        </div>
      </div>
    </div>
  </section>

  <!-- Code Examples Section -->
  <section class="code-section">
    <h2>üìö Implementation Guide</h2>

    <div class="code-examples-container">
      <div class="code-example">
        <h4>üè∑Ô∏è Creating a Custom Marker</h4>
        <p class="code-desc">
          A marker is a placeholder that gets transformed into a specialized
          signal. Here's how to create the <code>validated()</code> marker:
        </p>
        <pre><code>{{ markerCode }}</code></pre>
      </div>

      <div class="code-example">
        <h4>‚ö° Creating Custom Enhancers</h4>
        <p class="code-desc">
          Enhancers add methods and behavior to your tree:
        </p>
        <pre><code>{{ enhancerCode }}</code></pre>
      </div>

      <div class="code-example">
        <h4>üöÄ Usage Example</h4>
        <p class="code-desc">
          Combining custom markers and enhancers in a real application:
        </p>
        <pre><code>{{ usageCode }}</code></pre>
      </div>
    </div>
  </section>

  <!-- Best Practices Section -->
  <section class="best-practices-section">
    <h2>‚úÖ Best Practices Checklist</h2>

    <div class="practices-grid">
      <div class="practice-card">
        <h4>Markers</h4>
        <ul>
          <li>Use <code>Symbol()</code> for unique identification</li>
          <li>Keep type guards simple and fast</li>
          <li>Register processors once at app startup</li>
          <li>Provide <code>reset()</code> methods</li>
          <li>Handle SSR (no browser APIs at import time)</li>
        </ul>
      </div>

      <div class="practice-card">
        <h4>Enhancers</h4>
        <ul>
          <li>Return <code>tree & YourMethods</code> for TypeScript</li>
          <li>Use <code>Object.assign()</code> to preserve tree identity</li>
          <li>Add <code>/*&#64;__PURE__*/</code> for tree-shaking</li>
          <li>Use <code>createEnhancer()</code> for dependencies</li>
          <li>Implement <code>destroy()</code> for cleanup</li>
        </ul>
      </div>
    </div>
  </section>
</div>
