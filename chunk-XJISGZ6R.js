import{a as je,b as We,c as Ue,d as Le,e as ze,f as L,h as Ge,j as Be,n as He,o as $e,u as z,w as qe}from"./chunk-2ZHKFTSC.js";import{a as D,b as Ke,d as Ye}from"./chunk-DPTM7YK3.js";import{Ab as Z,Gb as _e,Ib as m,Ja as v,Jb as U,Kb as I,Oa as xe,Sa as Me,Vb as Pe,X as Fe,Ya as Oe,_a as Re,ab as Q,ba as J,cc as V,dc as Ie,na as Ee,ob as O,p as se,pb as b,qb as d,ra as le,rb as X,s as ae,sa as k,uc as De,ya as Ae,yb as W,zc as Ne}from"./chunk-YRWSUYO4.js";import{a as j,d as Ve,j as A}from"./chunk-A3ECCK3J.js";function ce(e,n){if(e===n)return!0;let r=e.split("."),t=n.split(".");return r.length!==t.length?!1:r.every((o,i)=>o==="*"||o===t[i])}function ue(e,n){if(!n||typeof n!="object")return e;let r=e,t=n;for(let[o,i]of Object.entries(t)){if(i===void 0)continue;let s=r[o];if(Je(s)&&Je(i)){r[o]=ue(D(s),i);continue}r[o]=D(i)}return e}function Je(e){return!!e&&typeof e=="object"&&!Array.isArray(e)&&Object.prototype.toString.call(e)==="[object Object]"}var G=class extends Error{constructor(r,t){super("Form validation failed");this.errors=r;this.asyncErrors=t;this.name="FormValidationError"}},en="signaltree",ge="signaltreeAsync";function nn(e,n={}){let ke=n,{validators:r={},asyncValidators:t={},destroyRef:o,fieldConfigs:i={},conditionals:s=[],persistKey:c,storage:g,persistDebounceMs:u=100,validationBatchMs:y=0}=ke,x=Ve(ke,["validators","asyncValidators","destroyRef","fieldConfigs","conditionals","persistKey","storage","persistDebounceMs","validationBatchMs"]),M=Cn(r,i),h=wn(t,i),{values:E}=Tn(e,c,g),ne=D(E),_=Ye(E,x);Sn(_.state);let f=_.state;tn(f);let l=ee(E,"",M,h),be=o??hn(),P=[],B=k({}),H=k({}),ye=k({}),ve=k({}),he=k(l.dirty),te=k(l.valid&&!l.pending),$=k(!1),Ce=()=>{let a=vn(l);B.set(a.syncErrors),H.set(a.asyncErrors),ye.set(a.touched),ve.set(a.pending),he.set(l.dirty),te.set(l.valid&&!l.pending)},F=null,w=(a=!1)=>{if(a||y<=0){F&&(clearTimeout(F),F=null),Ce();return}F&&clearTimeout(F),F=setTimeout(()=>{F=null,Ce()},y)};w(!0);let q=Vn(l,c,g,u,P);q.persistImmediately();let ln=new Set([...Object.keys(M),...Object.keys(h)]),re={},oe={};ln.forEach(a=>{re[a]=V(()=>B()[a]),oe[a]=V(()=>H()[a])});let cn=a=>kn(i,a),K=(a,p)=>{if(a instanceof L){Object.entries(a.controls).forEach(([C,S])=>{K(S,R(p,C))});return}if(a instanceof z){let C=de(f,p);C&&yn(a,C,p,M,h,P,K),a.controls.forEach((S,N)=>{K(S,R(p,String(N)))});return}let T=de(f,p);T&&bn(a,T,P,cn(p))};K(l,"");let we=new Map,ie=s.length>0?()=>{let a=l.getRawValue();s.forEach(({when:p,fields:T})=>{let C=!0;try{C=p(a)}catch{C=!0}T.forEach(S=>{let N=l.get(S);!N||we.get(S)===C||(we.set(S,C),C?N.enable({emitEvent:!1}):N.disable({emitEvent:!1}))})})}:()=>{};ie();let Y=[];Y.push(l.valueChanges.subscribe(()=>{w(),q.schedulePersist(),ie()})),Y.push(l.statusChanges.subscribe(()=>w())),l.events&&Y.push(l.events.subscribe(()=>w())),P.push(()=>{Y.forEach(a=>a.unsubscribe()),F&&clearTimeout(F)}),be&&be.onDestroy(()=>{P.splice(0).forEach(a=>a())});let Te=(a,p)=>{let T=de(f,a),C=l.get(a);if(T&&"set"in T?T.set(p):C&&C.setValue(p,{emitEvent:!0}),C){let S=C;S.markAsTouched(),S.markAsDirty(),S.updateValueAndValidity({emitEvent:!0})}w(!0),q.schedulePersist()},un=a=>{Object.entries(a).forEach(([p,T])=>{Te(p,T)})},dn=()=>{l.reset(ne),$.set(!1),w(!0),q.persistImmediately(),ie()},Se=a=>A(null,null,function*(){if(a){let p=l.get(a);if(!p)return;p.markAsTouched(),p.updateValueAndValidity({emitEvent:!0}),w(!0),yield Qe(p),w(!0);return}l.markAllAsTouched(),l.updateValueAndValidity({emitEvent:!0}),w(!0),yield Qe(l),w(!0)});return{state:f,$:f,form:l,errors:B,asyncErrors:H,touched:ye,asyncValidating:ve,dirty:he,valid:te,submitting:$,unwrap:()=>_(),setValue:Te,setValues:un,reset:dn,submit:a=>A(null,null,function*(){$.set(!0);try{if(yield Se(),!te())throw new G(B(),H());let p=l.getRawValue();return yield a(p)}finally{$.set(!1),w(!0)}}),validate:Se,getFieldError:a=>re[a]||V(()=>{}),getFieldAsyncError:a=>oe[a]||V(()=>{}),getFieldTouched:a=>V(()=>l.get(a)?.touched??!1),isFieldValid:a=>V(()=>{let p=l.get(a);return!!p&&p.valid&&!p.pending}),isFieldAsyncValidating:a=>V(()=>!!l.get(a)?.pending),fieldErrors:re,fieldAsyncErrors:oe,values:_,destroy:()=>{P.splice(0).forEach(a=>a())}}}function tn(e,n=new WeakSet){if(!n.has(e)){n.add(e);for(let r in e){let t=e[r];if(le(t)){let o=t();Array.isArray(o)&&(e[r]=mn(t))}else typeof t=="object"&&t!==null&&!Array.isArray(t)&&tn(t,n)}}}var mn=e=>{let n=e;return n.push=r=>{e.update(t=>[...t,r])},n.removeAt=r=>{e.update(t=>t.filter((o,i)=>i!==r))},n.setAt=(r,t)=>{e.update(o=>o.map((i,s)=>s===r?t:i))},n.insertAt=(r,t)=>{e.update(o=>[...o.slice(0,r),t,...o.slice(r)])},n.move=(r,t)=>{e.update(o=>{let i=[...o],[s]=i.splice(r,1);return s!==void 0&&i.splice(t,0,s),i})},n.clear=()=>{e.set([])},n};function de(e,n){if(!n)return null;let r=Ke(n),t=e;for(let o of r){if(!t||typeof t!="object")return null;t=t[o]}return le(t)?t:null}function R(e,n){return e?`${e}.${n}`:n}function fn(e){return n=>{let r=e(n.value);return r?{[en]:r}:null}}function pn(e){return n=>A(null,null,function*(){try{let r=e(n.value),t=se(r)?yield ae(r):yield r;return t?{[ge]:t}:null}catch{return{[ge]:"Validation error"}}})}function ee(e,n,r,t){let o=Xe(r,n),i=Xe(t,n),s=o?[fn(o)]:void 0,c=i?[pn(i)]:void 0;if(Array.isArray(e)){let g=e.map((u,y)=>ee(u,R(n,String(y)),r,t));return new z(g,s,c)}if(rn(e)){let g={};for(let[u,y]of Object.entries(e))g[u]=ee(y,R(n,u),r,t);return new L(g,{validators:s,asyncValidators:c})}return new Ge(e,{validators:s,asyncValidators:c,nonNullable:!1})}function bn(e,n,r,t){let o=e.connect;if(typeof o=="function")try{let f=o.call(e,n);f&&typeof f.unsubscribe=="function"&&r.push(()=>f.unsubscribe());return}catch{}let i=!1,s=!1,c=0,g=0,u=null,y=t?.debounceMs??0,x=n.set.bind(n),M=n.update.bind(n),h=f=>{if(s=!0,!Object.is(e.value,f)){let l=e;l.setValue(f,{emitEvent:!0}),l.markAsDirty()}s=!1};n.set=f=>{let l=++c;x(f),!i&&(g>l||h(f))},n.update=f=>{let l=f(n());n.set(l)};let E=f=>{i=!0,g=++c,x(f),i=!1},ne=f=>{if(!s){if(y>0){u&&clearTimeout(u),u=setTimeout(()=>{u=null,E(f)},y);return}E(f)}},_=e.valueChanges.subscribe(f=>{ne(f)});r.push(()=>{_.unsubscribe(),n.set=x,n.update=M,u&&clearTimeout(u)})}function yn(e,n,r,t,o,i,s){let c=e.connect;if(typeof c=="function")try{let h=c.call(e,n);h&&typeof h.unsubscribe=="function"&&i.push(()=>h.unsubscribe());return}catch{}let g=!1,u=!1,y=n.set.bind(n),x=n.update.bind(n);n.set=h=>{y(h),!g&&(u=!0,me(e,h,r,t,o,s),e.markAsDirty(),u=!1)},n.update=h=>{let E=h(n());n.set(E)};let M=e.valueChanges.subscribe(h=>{u||(g=!0,y(h),g=!1)});i.push(()=>{M.unsubscribe(),n.set=y,n.update=x}),me(e,n(),r,t,o,s)}function me(e,n,r,t,o,i){for(Array.isArray(n)||(n=[]);e.length>n.length;)e.removeAt(e.length-1);n.forEach((s,c)=>{let g=R(r,String(c)),u=e.at(c);if(!u){let y=ee(s,g,t,o);e.insert(c,y),i(y,g);return}if(u instanceof z){me(u,Array.isArray(s)?s:[],g,t,o,i);return}if(u instanceof L){rn(s)&&u.setValue(s,{emitEvent:!1});return}Object.is(u.value,s)||u.setValue(s,{emitEvent:!1})})}function vn(e){let n={syncErrors:{},asyncErrors:{},touched:{},pending:{}};return fe(e,(r,t)=>{if(!r)return;t.touched&&(n.touched[r]=!0),t.pending&&(n.pending[r]=!0);let o=t.errors;if(!o)return;let i=o[en];typeof i=="string"&&(n.syncErrors[r]=i);let s=o[ge];typeof s=="string"&&(n.asyncErrors[r]=s)},""),n}function fe(e,n,r=""){if(n(r,e),e instanceof L){Object.entries(e.controls).forEach(([t,o])=>{fe(o,n,R(r,t))});return}e instanceof z&&e.controls.forEach((t,o)=>{fe(t,n,R(r,String(o)))})}function Qe(e){return e.pending?new Promise(n=>{let r=e.statusChanges.subscribe(()=>{e.pending||(r.unsubscribe(),n())})}):Promise.resolve()}function rn(e){return!!e&&typeof e=="object"&&!Array.isArray(e)&&Object.prototype.toString.call(e)==="[object Object]"}function hn(){try{return J(Ee)}catch{return null}}function Cn(e,n){let r=new Map;for(let[o,i]of Object.entries(e)){let s=r.get(o)??[];s.push(i),r.set(o,s)}for(let[o,i]of Object.entries(n)){let s=on(i.validators);if(s.length===0)continue;let c=r.get(o)??[];c.push(...s),r.set(o,c)}let t={};return r.forEach((o,i)=>{t[i]=s=>{for(let c of o){let g=c(s);if(g)return g}return null}}),j(j({},e),t)}function wn(e,n){let r=new Map;for(let[o,i]of Object.entries(e)){let s=r.get(o)??[];s.push(i),r.set(o,s)}for(let[o,i]of Object.entries(n)){let s=on(i.asyncValidators);if(s.length===0)continue;let c=r.get(o)??[];c.push(...s),r.set(o,c)}let t={};return r.forEach((o,i)=>{t[i]=s=>A(null,null,function*(){for(let c of o){let g=c(s),u=se(g)?yield ae(g):yield g;if(u)return u}return null})}),j(j({},e),t)}function on(e){return e?Array.isArray(e)?e:Object.values(e):[]}function Tn(e,n,r){let t=D(e);if(!n||!r)return{values:t};try{let o=r.getItem(n);if(!o)return{values:t};let i=JSON.parse(o);return{values:ue(t,i)}}catch{return{values:t}}}function Sn(e){if(!e||typeof e!="object")throw new Error("Invalid state structure for form tree")}function kn(e,n){if(e[n])return e[n];let r=Object.keys(e),t;for(let o of r)o.includes("*")&&ce(o,n)&&(!t||t.key.length<o.length)&&(t={key:o,config:e[o]});return t?t.config:e["*"]}function Xe(e,n){if(e[n])return e[n];let r;for(let t of Object.keys(e))t.includes("*")&&ce(t,n)&&(!r||r.key.length<t.length)&&(r={key:t,value:e[t]});return r?r.value:e["*"]}function Vn(e,n,r,t,o){if(!n||!r)return{schedulePersist:()=>{},persistImmediately:()=>{}};let i=null,s=()=>{try{let g=JSON.stringify(e.getRawValue());r.setItem(n,g)}catch{}},c=()=>{if(t<=0){s();return}i&&clearTimeout(i),i=setTimeout(()=>{i=null,s()},t)};return o.push(()=>{i&&clearTimeout(i)}),{schedulePersist:c,persistImmediately:s}}var Ze=class e{signalTreeSignalValue;signalTreeSignalValueChange=new xe;elementRef=J(Ae);renderer=J(Me);onChange=()=>{};onTouched=()=>{};ngOnInit(){Ie(()=>{let n=this.signalTreeSignalValue();this.renderer.setProperty(this.elementRef.nativeElement,"value",n)})}handleChange(n){let t=n.target?.value;t!==void 0&&(this.signalTreeSignalValue.set(t),this.signalTreeSignalValueChange.emit(t),this.onChange(t))}handleBlur(){this.onTouched()}writeValue(n){n!==void 0&&this.signalTreeSignalValue.set(n)}registerOnChange(n){this.onChange=n}registerOnTouched(n){this.onTouched=n}setDisabledState(n){this.renderer.setProperty(this.elementRef.nativeElement,"disabled",n)}static \u0275fac=function(r){return new(r||e)};static \u0275dir=Re({type:e,selectors:[["","signalTreeSignalValue",""]],hostBindings:function(r,t){r&1&&W("input",function(i){return t.handleChange(i)})("change",function(i){return t.handleChange(i)})("blur",function(){return t.handleBlur()})},inputs:{signalTreeSignalValue:"signalTreeSignalValue"},outputs:{signalTreeSignalValueChange:"signalTreeSignalValueChange"},features:[Pe([{provide:je,useExisting:Fe(()=>e),multi:!0}])]})};function pe(e="Required"){return n=>n?null:e}function sn(e="Invalid email"){return n=>{let r=n;return r&&!r.includes("@")?e:null}}function Fn(e,n){if(e&1&&(b(0,"p",18),m(1),d()),e&2){let r=Z();v(),U(r.nameError)}}function En(e,n){if(e&1&&(b(0,"p",18),m(1),d()),e&2){let r=Z();v(),U(r.emailError)}}function An(e,n){if(e&1&&(b(0,"div",19)(1,"h3"),m(2,"Last Saved Payload"),d(),b(3,"p")(4,"strong"),m(5,"Name:"),d(),m(6),d(),b(7,"p")(8,"strong"),m(9,"Email:"),d(),m(10),d(),b(11,"p")(12,"strong"),m(13,"Updates opt-in:"),d(),m(14),d()()),e&2){let r,t,o,i=Z();v(6),I(" ",(r=i.lastSaved())==null?null:r.name),v(4),I(" ",(t=i.lastSaved())==null?null:t.email),v(4),I(" ",(o=i.lastSaved())!=null&&o.receiveUpdates?"Enabled":"Disabled"," ")}}var an=class e{storage=typeof window<"u"?window.localStorage:void 0;profile=nn({name:"",email:"",receiveUpdates:!0},{persistKey:"signaltree-ng-forms-demo",storage:this.storage,fieldConfigs:{name:{validators:[pe("Name is required")]},email:{validators:[pe(),sn()],debounceMs:150}}});status=k("idle");lastSaved=k(null);preview=V(()=>{let n=this.profile.errors(),r=this.profile.asyncErrors();return JSON.stringify({values:this.profile.unwrap(),valid:this.profile.valid(),dirty:this.profile.dirty(),submitting:this.profile.submitting(),errors:n,asyncErrors:r},null,2)});calloutCode=`import { createFormTree, email, required } from '@signaltree/ng-forms';

const checkout = createFormTree({
  email: '',
  marketingOptIn: false,
}, {
  fieldConfigs: {
    email: {
      validators: [required(), email()],
      debounceMs: 120,
    },
  },
  persistKey: 'checkout-draft',
});`;get nameError(){return this.profile.getFieldError("name")()}get emailError(){return this.profile.getFieldError("email")()}get submissionLabel(){switch(this.status()){case"saving":return"Saving\u2026";case"saved":return"Saved!";case"needs-attention":return"Fix validation errors";default:return"Save profile"}}save(){return A(this,null,function*(){try{if(!this.profile.valid()){yield this.profile.validate(),this.status.set("needs-attention");return}this.status.set("saving"),yield this.profile.submit(n=>A(this,null,function*(){yield new Promise(r=>setTimeout(r,400)),this.lastSaved.set(n)})),this.status.set("saved"),setTimeout(()=>{this.status()==="saved"&&this.status.set("idle")},2e3)}catch(n){if(n instanceof G){this.status.set("needs-attention");return}console.error("Failed to submit form",n),this.status.set("error")}})}reset(){this.profile.reset(),this.status.set("idle"),this.lastSaved.set(null)}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=Oe({type:e,selectors:[["app-ng-forms-demo"]],decls:49,vars:12,consts:[["data-testid","ng-forms-demo",1,"ng-forms-demo"],[1,"form-panel"],["novalidate","",3,"ngSubmit","formGroup"],[1,"field"],["for","name"],["id","name","type","text","formControlName","name","placeholder","Ada Lovelace"],["class","error",4,"ngIf"],["for","email"],["id","email","type","email","formControlName","email","placeholder","ada@example.com"],[1,"field","checkbox"],["type","checkbox","formControlName","receiveUpdates"],[1,"actions"],["type","submit",3,"disabled"],["type","button",1,"reset",3,"click","disabled"],[1,"status"],[1,"callout"],[1,"inspector"],["class","saved-summary",4,"ngIf"],[1,"error"],[1,"saved-summary"]],template:function(r,t){r&1&&(b(0,"div",0)(1,"header")(2,"h1"),m(3,"SignalTree + Angular Forms"),d(),b(4,"p"),m(5," This demo shows how "),b(6,"code"),m(7,"@signaltree/ng-forms"),d(),m(8," keeps a reactive profile form in sync with a SignalTree store, including validation, persistence, and async submission hooks. "),d()(),b(9,"section",1)(10,"h2"),m(11,"Profile Form"),d(),b(12,"form",2),W("ngSubmit",function(){return t.save()}),b(13,"div",3)(14,"label",4),m(15,"Full name"),d(),X(16,"input",5),Q(17,Fn,2,1,"p",6),d(),b(18,"div",3)(19,"label",7),m(20,"Email"),d(),X(21,"input",8),Q(22,En,2,1,"p",6),d(),b(23,"div",9)(24,"label"),X(25,"input",10),m(26," Keep me posted on product updates "),d()(),b(27,"div",11)(28,"button",12),m(29),d(),b(30,"button",13),W("click",function(){return t.reset()}),m(31," Reset "),d()(),b(32,"p",14),m(33),d()(),b(34,"article",15)(35,"h3"),m(36,"Form Tree Setup"),d(),b(37,"pre")(38,"code"),m(39),d()()()(),b(40,"section",16)(41,"h2"),m(42,"Live State Preview"),d(),b(43,"p"),m(44," SignalTree keeps the form state, validation errors, and async metadata in a single tree. You can inspect the current snapshot below. "),d(),b(45,"pre")(46,"code"),m(47),d()(),Q(48,An,15,3,"div",17),d()()),r&2&&(v(12),O("formGroup",t.profile.form),v(5),O("ngIf",t.nameError),v(5),O("ngIf",t.emailError),v(6),O("disabled",t.status()==="saving"),v(),I(" ",t.submissionLabel," "),v(),O("disabled",t.status()==="saving"),v(2),_e("error",t.status()==="error"),v(),I(" Status: ",t.status()," "),v(6),U(t.calloutCode),v(8),U(t.preview),v(),O("ngIf",t.lastSaved()))},dependencies:[Ne,De,qe,Be,Ue,We,Le,ze,He,$e],styles:[".ng-forms-demo[_ngcontent-%COMP%]{display:grid;gap:2rem;padding:2rem;max-width:1100px}.ng-forms-demo[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:.5rem}.ng-forms-demo[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#475569;max-width:640px}.form-panel[_ngcontent-%COMP%]{background:#f8fafc;border:1px solid #e2e8f0;border-radius:12px;padding:1.5rem;display:grid;gap:1.5rem}.form-panel[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:grid;gap:1rem}.field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:600;margin-bottom:.5rem}.field[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%]{width:100%;padding:.75rem .9rem;border-radius:8px;border:1px solid #cbd5f5;font-size:.95rem}.field[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]:focus, .field[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%]:focus{outline:none;border-color:#6366f1;box-shadow:0 0 0 3px #6366f126}.field.checkbox[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.6rem;font-weight:500}.actions[_ngcontent-%COMP%]{display:flex;gap:.75rem}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.65rem 1.4rem;border-radius:999px;border:none;font-weight:600;cursor:pointer;background:#312e81;color:#fff;transition:background .2s ease}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{background:#94a3b8;cursor:not-allowed}.actions[_ngcontent-%COMP%]   .reset[_ngcontent-%COMP%]{background:transparent;color:#312e81;border:1px solid #312e81}.actions[_ngcontent-%COMP%]   .reset[_ngcontent-%COMP%]:hover:not(:disabled){background:#312e8114}.error[_ngcontent-%COMP%]{margin-top:.35rem;color:#dc2626;font-size:.85rem}.status[_ngcontent-%COMP%]{font-size:.9rem;color:#334155}.status.error[_ngcontent-%COMP%]{color:#dc2626}.callout[_ngcontent-%COMP%]{background:#1e1b4b;color:#e0e7ff;padding:1rem;border-radius:10px;font-size:.9rem;overflow-x:auto}.callout[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:.75rem;font-size:1rem}.callout[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{margin:0;white-space:pre-wrap;word-break:break-word}.inspector[_ngcontent-%COMP%]{display:grid;gap:1rem}.inspector[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{background:#0f172ae6;color:#e2e8f0;border-radius:12px;padding:1rem;overflow-x:auto;font-size:.85rem}.saved-summary[_ngcontent-%COMP%]{background:#f1f5f9;border-radius:10px;padding:1rem;border:1px solid #cbd5f5}"]})};export{an as NgFormsDemoComponent};
