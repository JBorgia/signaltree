import{a as q}from"./chunk-YLUDIB2Y.js";import{a as R,b as P,c as N,d as O,k as J}from"./chunk-QAZQSZCQ.js";import{e as j}from"./chunk-QBPEN4DG.js";import{$a as h,Hb as T,Ib as r,Jb as M,Kb as p,Lb as F,Mb as $,Na as a,Nb as _,Ob as v,Pb as y,Sb as U,Tb as C,Ub as E,Xa as I,_b as k,a as D,b as L,oa as f,oc as V,pa as x,pb as m,pc as W,qb as o,qc as B,rb as i,vb as S,vc as A,xb as c,zb as g}from"./chunk-STRTG7VY.js";var H=()=>["all","active","completed"];function K(d,t){if(d&1){let e=S();o(0,"div",6)(1,"h3",7),r(2,"Undo/Redo"),i(),o(3,"div",23)(4,"button",42),c("click",function(){f(e);let l=g();return x(l.undo())}),r(5),i(),o(6,"button",42),c("click",function(){f(e);let l=g();return x(l.redo())}),r(7),i()()()}if(d&2){let e=g();a(4),m("disabled",e.undoStack().length===0),a(),p(" \u21B6 Undo (",e.undoStack().length,") "),a(),m("disabled",e.redoStack().length===0),a(),p(" \u21B7 Redo (",e.redoStack().length,") ")}}function X(d,t){if(d&1){let e=S();o(0,"button",43),c("click",function(){let l=f(e).$implicit,s=g();return x(s.setFilterFromString(l))}),r(1),C(2,"titlecase"),i()}if(d&2){let e=t.$implicit,n=g();T(n.filter()===e?"border-blue-500 text-blue-600":"border-transparent text-gray-500"),a(),F(" ",E(2,4,e)," (",n.getFilteredCount(e),") ")}}function Y(d,t){if(d&1){let e=S();o(0,"div",44)(1,"input",45),c("change",function(){let l=f(e).$implicit,s=g();return x(s.toggleTodo(l.id))}),i(),o(2,"span",46),r(3),i(),o(4,"button",47),c("click",function(){let l=f(e).$implicit,s=g();return x(s.deleteTodo(l.id))}),r(5," Delete "),i()()}if(d&2){let e=t.$implicit;a(),m("checked",e.completed),a(),T(e.completed?"line-through text-gray-500":"text-gray-900"),a(),p(" ",e.title," ")}}function Z(d,t){if(d&1&&(o(0,"div",48),r(1),i()),d&2){let e=g();a(),p(" ",e.filter()==="all"?"No todos yet.":"No "+e.filter()+" todos."," ")}}function ee(d,t){if(d&1&&(o(0,"span"),r(1),i()),d&2){let e=g().$implicit;a(),p(" \u2022 ",e.duration.toFixed(1),"ms")}}function te(d,t){if(d&1&&(o(0,"span"),r(1),i()),d&2){let e=g().$implicit;a(),p(" \u2022 ",e.error)}}function ne(d,t){if(d&1&&(o(0,"div",56),r(1),i()),d&2){let e=g().$implicit;a(),p(" ",e.data.message," ")}}function ie(d,t){if(d&1&&(o(0,"div",49)(1,"div",50)(2,"span",51),r(3),i(),o(4,"span",52),r(5),i()(),o(6,"div",53),r(7),C(8,"titlecase"),h(9,ee,2,1,"span",54)(10,te,2,1,"span",54),i(),h(11,ne,2,1,"div",55),i()),d&2){let e=t.$implicit,n=g();T(n.getLogClass(e)),a(3),M(e.action),a(2),M(n.formatTime(e.timestamp)),a(2),p(" ",E(8,8,e.type)," "),a(2),m("ngIf",e.duration),a(),m("ngIf",e.error),a(),m("ngIf",e.data&&e.data.message)}}function oe(d,t){d&1&&(o(0,"div",48),r(1," No middleware logs yet. Enable logging and perform some actions. "),i())}function re(d,t){if(d&1&&(o(0,"div",59)(1,"div",60),r(2),i(),o(3,"div",61)(4,"div",62),r(5),i(),o(6,"div",63),r(7),i()(),o(8,"div",64),r(9),i()()),d&2){let e=t.$implicit,n=t.index,l=g(2);a(2),p(" ",l.undoStack().length-n," "),a(3),M(e.action),a(2),$(" ",l.formatTime(e.timestamp)," \u2022 ",e.previousState.length," \u2192 ",e.newState.length," todos "),a(2),p(" ",l.getUndoChangeDescription(e)," ")}}function de(d,t){if(d&1&&(o(0,"div",57)(1,"h2",4),r(2,"Undo Stack Visualization"),i(),o(3,"div",8),h(4,re,10,6,"div",58),i()()),d&2){let e=g();a(4),m("ngForOf",e.undoStack().slice().reverse())("ngForTrackBy",e.trackUndoEntry)}}var ae=d=>(t,e)=>{let n=`log_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l=performance.now();d.push({id:n,timestamp:Date.now(),type:"before",action:t,data:{message:`Starting ${t}`}});try{let s=e(),u=performance.now()-l;return d.push({id:n,timestamp:Date.now(),type:"after",action:t,data:{message:`Completed ${t}`},duration:u}),s}catch(s){throw d.push({id:n,timestamp:Date.now(),type:"error",action:t,error:s instanceof Error?s.message:"Unknown error"}),s}},le=()=>(d,t,...e)=>{let n=e[0];if(d.includes("todo")&&n){if(d.includes("add")&&(!n.title||n.title.trim().length===0))throw new Error("Todo title cannot be empty");if(d.includes("add")&&n.title.length>200)throw new Error("Todo title cannot exceed 200 characters");if(d.includes("update")&&n.id&&typeof n.id!="number")throw new Error("Todo ID must be a number")}return t()},se=()=>(d,t,...e)=>{let n=t();if(d.includes("todo")&&e[0])try{let l=e[0];localStorage.setItem("signaltree_demo_todos",JSON.stringify(l.todos))}catch(l){console.warn("Failed to persist state:",l)}return n},me=(d,t)=>(e,n,...l)=>{if(e==="undo"||e==="redo")return n();let s=n(),[u,b]=l;if(u&&b){let w=b();w&&JSON.stringify(u)!==JSON.stringify(w)&&(d.push({action:e,previousState:[...u],newState:[...w],timestamp:Date.now()}),d.length>20&&d.shift(),t.splice(0,t.length))}return s},z=class d{store=j({todos:q(5),filter:"all",middlewareLogs:[],enableLogging:!0,enableValidation:!0,enablePersistence:!1,enableUndo:!0,undoStack:[],redoStack:[]});todos=this.store.$.todos;filter=this.store.$.filter;middlewareLogs=this.store.$.middlewareLogs;undoStack=this.store.$.undoStack;redoStack=this.store.$.redoStack;newTodoText="";enableLogging=this.store.$.enableLogging();enableValidation=this.store.$.enableValidation();enablePersistence=this.store.$.enablePersistence();enableUndo=this.store.$.enableUndo();filteredTodos=k(()=>{let t=this.todos();switch(this.filter()){case"active":return t.filter(n=>!n.completed);case"completed":return t.filter(n=>n.completed);default:return t}});completedCount=k(()=>this.todos().filter(t=>t.completed).length);activeCount=k(()=>this.todos().filter(t=>!t.completed).length);executeWithMiddleware(t,e,n){let l=this.middlewareLogs(),s=[...this.todos()],u=[];this.enableLogging&&u.push(ae(l)),this.enableValidation&&u.push(le()),this.enableUndo&&u.push(me(this.undoStack(),this.redoStack())),this.enablePersistence&&u.push(se());let b=e;for(let w=u.length-1;w>=0;w--){let G=u[w],Q=b;b=()=>G(t,Q,n,s,()=>this.todos())}try{b(),this.enableLogging&&this.store.$.middlewareLogs.set([...l])}catch(w){this.enableLogging&&this.store.$.middlewareLogs.set([...l]),alert(w instanceof Error?w.message:"Unknown error occurred")}}addTodo(){this.newTodoText.trim()&&this.executeWithMiddleware("add_todo",()=>{let t={id:Math.max(...this.todos().map(e=>e.id),0)+1,title:this.newTodoText.trim(),completed:!1,createdAt:new Date,priority:"medium"};this.store.$.todos.update(e=>[...e,t]),this.newTodoText=""},{title:this.newTodoText.trim()})}addRandomTodo(){let t=["Learn SignalTree middleware","Build awesome Angular apps","Write unit tests","Review pull requests","Plan next sprint","Update documentation","Refactor legacy code","Implement new features"],e=t[Math.floor(Math.random()*t.length)];this.executeWithMiddleware("add_random_todo",()=>{let n={id:Math.max(...this.todos().map(l=>l.id),0)+1,title:e,completed:!1,createdAt:new Date,priority:["low","medium","high"][Math.floor(Math.random()*3)]};this.store.$.todos.update(l=>[...l,n])},{title:e})}addInvalidTodo(){this.executeWithMiddleware("add_invalid_todo",()=>{let t={id:Math.max(...this.todos().map(e=>e.id),0)+1,title:"",completed:!1,createdAt:new Date,priority:"medium"};this.store.$.todos.update(e=>[...e,t])},{title:""})}toggleTodo(t){this.executeWithMiddleware("toggle_todo",()=>{this.store.$.todos.update(e=>e.map(n=>n.id===t?L(D({},n),{completed:!n.completed}):n))},{id:t})}toggleRandomTodo(){let t=this.todos();if(t.length===0)return;let e=t[Math.floor(Math.random()*t.length)];this.toggleTodo(e.id)}deleteTodo(t){this.executeWithMiddleware("delete_todo",()=>{this.store.$.todos.update(e=>e.filter(n=>n.id!==t))},{id:t})}deleteRandomTodo(){let t=this.todos();if(t.length===0)return;let e=t[Math.floor(Math.random()*t.length)];this.deleteTodo(e.id)}clearAllTodos(){this.executeWithMiddleware("clear_all_todos",()=>{this.store.$.todos.set([])})}undo(){let t=this.undoStack(),e=this.redoStack();t.length!==0&&this.executeWithMiddleware("undo",()=>{let n=t[t.length-1];e.push(n),this.store.$.redoStack.set([...e]),this.store.$.undoStack.set(t.slice(0,-1)),this.store.$.todos.set([...n.previousState])})}redo(){let t=this.redoStack(),e=this.undoStack();t.length!==0&&this.executeWithMiddleware("redo",()=>{let n=t[t.length-1];e.push(n),this.store.$.undoStack.set([...e]),this.store.$.redoStack.set(t.slice(0,-1)),this.store.$.todos.set([...n.newState])})}setFilter(t){this.store.$.filter.set(t)}setFilterFromString(t){(t==="all"||t==="active"||t==="completed")&&this.setFilter(t)}clearLogs(){this.store.$.middlewareLogs.set([])}loadFromStorage(){this.executeWithMiddleware("load_from_storage",()=>{try{let t=localStorage.getItem("signaltree_demo_todos");if(t){let e=JSON.parse(t);this.store.$.todos.set(e)}}catch(t){console.warn("Failed to load from storage:",t)}})}getFilteredCount(t){let e=this.todos();switch(t){case"active":return e.filter(n=>!n.completed).length;case"completed":return e.filter(n=>n.completed).length;default:return e.length}}getLogClass(t){switch(t.type){case"before":return"bg-blue-50 border border-blue-200";case"after":return"bg-green-50 border border-green-200";case"error":return"bg-red-50 border border-red-200";default:return"bg-gray-50 border border-gray-200"}}getUndoChangeDescription(t){if(t.previousState.length!==t.newState.length){let e=Math.abs(t.newState.length-t.previousState.length);return`${t.newState.length>t.previousState.length?"+":"-"}${e}`}return"modified"}formatTime(t){return new Date(t).toLocaleTimeString()}trackTodo(t,e){return e.id}trackLog(t,e){return e.id}trackUndoEntry(t,e){return e.timestamp}static \u0275fac=function(e){return new(e||d)};static \u0275cmp=I({type:d,selectors:[["app-middleware-demo"]],decls:112,vars:23,consts:[[1,"container","mx-auto","p-6"],[1,"text-3xl","font-bold","mb-6"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-8"],[1,"bg-white","rounded-lg","shadow","p-6"],[1,"text-xl","font-semibold","mb-4"],[1,"space-y-4"],[1,"border","rounded-lg","p-4"],[1,"font-medium","mb-3"],[1,"space-y-2"],[1,"flex","items-center"],["type","checkbox",1,"rounded","border-gray-300","text-blue-600","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"ml-2","text-sm"],[1,"w-full","px-3","py-2","bg-green-500","text-white","rounded","text-sm","hover:bg-green-600",3,"click"],[1,"w-full","px-3","py-2","bg-red-500","text-white","rounded","text-sm","hover:bg-red-600",3,"click"],[1,"w-full","px-3","py-2","bg-blue-500","text-white","rounded","text-sm","hover:bg-blue-600","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","px-3","py-2","bg-orange-500","text-white","rounded","text-sm","hover:bg-orange-600","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["class","border rounded-lg p-4",4,"ngIf"],[1,"w-full","px-3","py-2","bg-red-600","text-white","rounded","text-sm","hover:bg-red-700","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","px-3","py-2","bg-yellow-500","text-white","rounded","text-sm","hover:bg-yellow-600","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","px-3","py-2","bg-purple-500","text-white","rounded","text-sm","hover:bg-purple-600",3,"click"],[1,"flex","border-b","mb-4"],["class","px-4 py-2 border-b-2 text-sm font-medium hover:text-gray-700",3,"class","click",4,"ngFor","ngForOf"],[1,"mb-4"],[1,"flex","gap-2"],["type","text","placeholder","Add a new todo...",1,"flex-1","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","keyup.enter","ngModel"],[1,"px-4","py-2","bg-blue-500","text-white","rounded","hover:bg-blue-600","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"space-y-2","max-h-64","overflow-y-auto"],["class","flex items-center gap-3 p-3 border rounded-lg hover:bg-gray-50",4,"ngFor","ngForOf","ngForTrackBy"],["class","text-center text-gray-500 py-8",4,"ngIf"],[1,"mt-4","pt-4","border-t"],[1,"grid","grid-cols-3","gap-4","text-center","text-sm"],[1,"font-semibold","text-blue-600"],[1,"text-gray-500"],[1,"font-semibold","text-green-600"],[1,"font-semibold","text-yellow-600"],[1,"space-y-2","max-h-80","overflow-y-auto"],["class","p-3 rounded-lg text-sm",3,"class",4,"ngFor","ngForOf","ngForTrackBy"],["class","mt-8 bg-white rounded-lg shadow p-6",4,"ngIf"],[1,"mt-8","bg-indigo-50","rounded-lg","p-6"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"font-medium","text-indigo-800","mb-2"],[1,"text-sm","text-indigo-700"],[1,"flex-1","px-3","py-2","bg-gray-500","text-white","rounded","text-sm","hover:bg-gray-600","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"px-4","py-2","border-b-2","text-sm","font-medium","hover:text-gray-700",3,"click"],[1,"flex","items-center","gap-3","p-3","border","rounded-lg","hover:bg-gray-50"],["type","checkbox",1,"rounded","border-gray-300","text-blue-600","focus:ring-blue-500",3,"change","checked"],[1,"flex-1","text-sm"],[1,"px-2","py-1","text-xs","bg-red-500","text-white","rounded","hover:bg-red-600",3,"click"],[1,"text-center","text-gray-500","py-8"],[1,"p-3","rounded-lg","text-sm"],[1,"flex","items-center","justify-between","mb-1"],[1,"font-medium"],[1,"text-xs","opacity-75"],[1,"text-xs","opacity-90"],[4,"ngIf"],["class","text-xs mt-1 opacity-75",4,"ngIf"],[1,"text-xs","mt-1","opacity-75"],[1,"mt-8","bg-white","rounded-lg","shadow","p-6"],["class","flex items-center gap-4 p-3 bg-gray-50 rounded-lg",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","items-center","gap-4","p-3","bg-gray-50","rounded-lg"],[1,"w-8","h-8","bg-blue-500","text-white","rounded-full","flex","items-center","justify-center","text-sm","font-medium"],[1,"flex-1"],[1,"font-medium","text-sm"],[1,"text-xs","text-gray-500"],[1,"text-xs","text-gray-400"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"h1",1),r(2,"SignalTree Middleware Demo"),i(),o(3,"div",2)(4,"div",3)(5,"h2",4),r(6,"Middleware Controls"),i(),o(7,"div",5)(8,"div",6)(9,"h3",7),r(10,"Enable Middleware"),i(),o(11,"div",8)(12,"label",9)(13,"input",10),y("ngModelChange",function(s){return v(n.enableLogging,s)||(n.enableLogging=s),s}),i(),o(14,"span",11),r(15,"\u{1F50D} Logging Middleware"),i()(),o(16,"label",9)(17,"input",10),y("ngModelChange",function(s){return v(n.enableValidation,s)||(n.enableValidation=s),s}),i(),o(18,"span",11),r(19,"\u2705 Validation Middleware"),i()(),o(20,"label",9)(21,"input",10),y("ngModelChange",function(s){return v(n.enablePersistence,s)||(n.enablePersistence=s),s}),i(),o(22,"span",11),r(23,"\u{1F4BE} Persistence Middleware"),i()(),o(24,"label",9)(25,"input",10),y("ngModelChange",function(s){return v(n.enableUndo,s)||(n.enableUndo=s),s}),i(),o(26,"span",11),r(27,"\u21B6 Undo/Redo Middleware"),i()()()(),o(28,"div",6)(29,"h3",7),r(30,"Quick Actions"),i(),o(31,"div",8)(32,"button",12),c("click",function(){return n.addRandomTodo()}),r(33," + Add Random Todo "),i(),o(34,"button",13),c("click",function(){return n.addInvalidTodo()}),r(35," + Add Invalid Todo (Test Validation) "),i(),o(36,"button",14),c("click",function(){return n.toggleRandomTodo()}),r(37," \u21BB Toggle Random Todo "),i(),o(38,"button",15),c("click",function(){return n.deleteRandomTodo()}),r(39," \xD7 Delete Random Todo "),i()()(),h(40,K,8,4,"div",16),o(41,"div",6)(42,"h3",7),r(43,"State Actions"),i(),o(44,"div",8)(45,"button",17),c("click",function(){return n.clearAllTodos()}),r(46," Clear All Todos "),i(),o(47,"button",18),c("click",function(){return n.clearLogs()}),r(48," Clear Logs "),i(),o(49,"button",19),c("click",function(){return n.loadFromStorage()}),r(50," Load from Storage "),i()()()()(),o(51,"div",3)(52,"h2",4),r(53,"Todo List"),i(),o(54,"div",20),h(55,X,3,6,"button",21),i(),o(56,"div",22)(57,"div",23)(58,"input",24),y("ngModelChange",function(s){return v(n.newTodoText,s)||(n.newTodoText=s),s}),c("keyup.enter",function(){return n.addTodo()}),i(),o(59,"button",25),c("click",function(){return n.addTodo()}),r(60," Add "),i()()(),o(61,"div",26),h(62,Y,6,4,"div",27),i(),h(63,Z,2,1,"div",28),o(64,"div",29)(65,"div",30)(66,"div")(67,"div",31),r(68),i(),o(69,"div",32),r(70,"Total"),i()(),o(71,"div")(72,"div",33),r(73),i(),o(74,"div",32),r(75,"Completed"),i()(),o(76,"div")(77,"div",34),r(78),i(),o(79,"div",32),r(80,"Active"),i()()()()(),o(81,"div",3)(82,"h2",4),r(83,"Middleware Logs"),i(),o(84,"div",35),h(85,ie,12,10,"div",36),i(),h(86,oe,2,0,"div",28),i()(),h(87,de,5,2,"div",37),o(88,"div",38)(89,"h2",4),r(90," Middleware Features Demonstrated "),i(),o(91,"div",39)(92,"div")(93,"h3",40),r(94,"Logging Middleware"),i(),o(95,"p",41),r(96," Automatically logs all state changes with timing information and action details. "),i()(),o(97,"div")(98,"h3",40),r(99," Validation Middleware "),i(),o(100,"p",41),r(101," Validates data before state changes, preventing invalid operations and maintaining data integrity. "),i()(),o(102,"div")(103,"h3",40),r(104," Persistence Middleware "),i(),o(105,"p",41),r(106," Automatically saves state changes to local storage for data persistence across sessions. "),i()(),o(107,"div")(108,"h3",40),r(109," Undo/Redo Middleware "),i(),o(110,"p",41),r(111," Tracks state changes and provides undo/redo functionality with configurable history limits. "),i()()()()()),e&2&&(a(13),_("ngModel",n.enableLogging),a(4),_("ngModel",n.enableValidation),a(4),_("ngModel",n.enablePersistence),a(4),_("ngModel",n.enableUndo),a(11),m("disabled",n.todos().length===0),a(2),m("disabled",n.todos().length===0),a(2),m("ngIf",n.enableUndo),a(5),m("disabled",n.todos().length===0),a(2),m("disabled",n.middlewareLogs().length===0),a(8),m("ngForOf",U(22,H)),a(3),_("ngModel",n.newTodoText),a(),m("disabled",!n.newTodoText.trim()),a(3),m("ngForOf",n.filteredTodos())("ngForTrackBy",n.trackTodo),a(),m("ngIf",n.filteredTodos().length===0),a(5),p(" ",n.todos().length," "),a(5),p(" ",n.completedCount()," "),a(5),p(" ",n.activeCount()," "),a(7),m("ngForOf",n.middlewareLogs().slice().reverse())("ngForTrackBy",n.trackLog),a(),m("ngIf",n.middlewareLogs().length===0),a(),m("ngIf",n.enableUndo&&n.undoStack().length>0))},dependencies:[A,V,W,J,P,R,N,O,B],encapsulation:2})};export{z as MiddlewareDemoComponent};
