import{a as V}from"./chunk-7MB6DANI.js";import{a as S,b as ie}from"./chunk-X4WEGLGO.js";import{a as _,b as z}from"./chunk-YWKZDN6Z.js";import{a as ee,e as T}from"./chunk-75A3EJSS.js";import{$b as x,a as M,b as E,da as oe,j as y,ya as D}from"./chunk-IT4IGUIF.js";var Ee=5*60*1e3,ge=new Map;function he(l,e){if(l===e)return!0;if(l==null||e==null||typeof l!=typeof e)return!1;if(typeof l=="object"&&typeof e=="object"){let r=l,o=e,a=Object.keys(r),n=Object.keys(o);if(a.length!==n.length)return!1;for(let t of a)if(r[t]!==o[t])return!1;return!0}return!1}function se(l,e){if(l===e)return!0;if(l==null||e==null||typeof l!=typeof e)return!1;if(typeof l=="object"){let r=Object.keys(l),o=Object.keys(e);if(r.length!==o.length)return!1;for(let a of r)if(!o.includes(a)||!se(l[a],e[a]))return!1;return!0}return!1}function pe(l,e){try{return`${l.name||"anonymous"}_${JSON.stringify(e)}`}catch{return`${l.name||"anonymous"}_${e.length}`}}function ye(l){switch(l){case"shallow":return he;case"reference":return(e,r)=>e===r;case"deep":default:return se}}function $(l={}){let{enabled:e=!0,maxCacheSize:r=1e3,ttl:o,equality:a="deep",enableLRU:n=!0}=l;return t=>{if(!e)return t;let i=new Map;ge.set(t,i);let s=ye(a),c=()=>{if(!n||i.size<=r)return;let u=Array.from(i.entries());u.sort((h,g)=>(h[1].timestamp||0)-(g[1].timestamp||0)),u.slice(0,i.size-r+1).forEach(([h])=>i.delete(h))},m=t.bind(t);t.memoizedUpdate=(u,f)=>{let h=m(),g=f||pe(u,[h]),p=i.get(g);if(p&&s(p.deps,[h])){let k=p.value;Object.entries(k).forEach(([I,A])=>{let R=t.state[I];R&&"set"in R?R.set(A):ee(R)&&R(A)});return}let b=u(h);i.set(g,{value:b,deps:[h],timestamp:Date.now(),hitCount:1}),Object.entries(b).forEach(([k,I])=>{let A=t.state[k];A&&"set"in A?A.set(I):ee(A)&&A(I)}),c()},t.clearMemoCache=u=>{u?i.delete(u):i.clear()},t.getCacheStats=()=>{let u=0,f=0;for(let g of i.values())u+=g.hitCount||0,f+=Math.floor((g.hitCount||0)/2);let h=u+f>0?u/(u+f):0;return{size:i.size,hitRate:h,totalHits:u,totalMisses:f,keys:Array.from(i.keys())}};let d=t._memoCleanupInterval;if(d&&typeof d=="number"){let u=t.clearMemoCache.bind(t);t.clearMemoCache=f=>{u(f);try{clearInterval(d)}catch{}}}if(o){let f=setInterval(()=>{let h=Date.now();for(let[g,p]of i.entries())p.timestamp&&h-p.timestamp>o&&i.delete(g)},o);t._memoCleanupInterval=f}return t}}function O(){return $({enabled:!0,maxCacheSize:100,ttl:void 0,equality:"reference",enableLRU:!1})}function L(){return $({enabled:!0,maxCacheSize:1e3,ttl:6e4,equality:"shallow",enableLRU:!0})}var w={DATE:"\xA7d",REGEXP:"\xA7r",MAP:"\xA7m",SET:"\xA7s",UNDEFINED:"\xA7u",NAN:"\xA7n",INFINITY:"\xA7i",NEG_INFINITY:"\xA7-i",BIGINT:"\xA7b",SYMBOL:"\xA7y",FUNCTION:"\xA7f",CIRCULAR:"\xA7c"};var ce={includeMetadata:!0,replacer:void 0,reviver:void 0,preserveTypes:!0,maxDepth:50,handleCircular:!0};function F(l,e=new WeakSet,r=0,o=50,a=!0){if(r>o)return"[Max Depth Exceeded]";if(l===null||typeof l!="object")return a?l===void 0?{[w.UNDEFINED]:!0}:typeof l=="number"?Number.isNaN(l)?{[w.NAN]:!0}:l===1/0?{[w.INFINITY]:!0}:l===-1/0?{[w.NEG_INFINITY]:!0}:l:typeof l=="bigint"?{[w.BIGINT]:String(l)}:typeof l=="symbol"?{[w.SYMBOL]:String(l)}:l:l;if(typeof l=="function")try{let n=l();return F(n,e,r+1,o,a)}catch{return"[Function]"}if(e.has(l))return"[Circular Reference]";if(D(l))return l();if(a){if(l instanceof Date)return{[w.DATE]:l.toISOString()};if(l instanceof RegExp)return{[w.REGEXP]:{source:l.source,flags:l.flags}};if(l instanceof Map)return{[w.MAP]:Array.from(l.entries())};if(l instanceof Set)return{[w.SET]:Array.from(l.values())}}else if(l instanceof Date||l instanceof RegExp)return l;e.add(l);try{if(Array.isArray(l)){let t=l.map(i=>F(i,e,r+1,o,a));return e.delete(l),t}let n={};for(let[t,i]of Object.entries(l))if(!((t==="set"||t==="update")&&typeof i=="function"&&!D(i)))if(D(i))n[t]=F(i(),e,r+1,o,a);else if(typeof i=="function"&&t!=="set"&&t!=="update")try{let s=i();n[t]=F(s,e,r+1,o,a)}catch{continue}else n[t]=F(i,e,r+1,o,a);return e.delete(l),n}catch{return e.delete(l),"[Serialization Error]"}}function J(l,e="",r=new WeakSet,o=new Map){let a=[];if(l===null||typeof l!="object")return a;if(r.has(l)){let n=o.get(l)||"";return a.push({path:e,targetPath:n}),a}if(r.add(l),o.set(l,e),Array.isArray(l)){let n=l;for(let t=0;t<n.length;t++){let i=e?`${e}[${t}]`:`[${t}]`,s=J(n[t],i,r,o);a.push(...s)}}else for(let[n,t]of Object.entries(l)){let i=e?`${e}.${n}`:n,s=J(t,i,r,o);a.push(...s)}return r.delete(l),a}function we(l){let e=new WeakSet,r=new Map;return function(a,n){if(l.replacer&&(n=l.replacer.call(this,a,n)),D(n))return n();if(n&&typeof n=="object"){if(e.has(n)){if(l.handleCircular){let i=r.get(n)||"";return{[w.CIRCULAR]:i}}return}e.add(n);let t=a||"";r.set(n,t)}return n}}function le(l,e){for(let{path:r,targetPath:o}of e){let a=r.split(/\.|\[|\]/).filter(Boolean),n=o.split(/\.|\[|\]/).filter(Boolean),t=l;for(let s=0;s<a.length-1&&(t=t[a[s]],!!t);s++);let i=l;for(let s of n)if(i=i[s],!i)break;t&&i&&(t[a[a.length-1]]=i)}}function ne(l={}){let e=r=>{let o=r;o.toJSON=()=>r(),o.fromJSON=(n,t)=>{let i=u=>{if(!u||typeof u!="object")return u;if(w.UNDEFINED in u)return;if(w.NAN in u)return NaN;if(w.INFINITY in u)return 1/0;if(w.NEG_INFINITY in u)return-1/0;if(w.BIGINT in u)return BigInt(u[w.BIGINT]);if(w.SYMBOL in u)return Symbol.for(u[w.SYMBOL]);if(w.DATE in u)return new Date(u[w.DATE]);if(w.REGEXP in u){let h=u[w.REGEXP];return new RegExp(h.source,h.flags)}if(w.MAP in u)return new Map(u[w.MAP]);if(w.SET in u)return new Set(u[w.SET]);if(Array.isArray(u))return u.map(i);let f={};for(let[h,g]of Object.entries(u))f[h]=i(g);return f},s=i(n);function c(u,f){let h=r.$;if(u&&h)for(let p of u.split(".")){if(!p)continue;let b=h[p];if(!b||typeof b!="object"&&typeof b!="function"){h=void 0;break}h=b}let g=h?.[f];return D(g)?g:void 0}function m(u,f,h=""){if(!(!u||!f))for(let g in f){if(!Object.prototype.hasOwnProperty.call(f,g))continue;let p=f[g],b=u[g],k=D(b)||typeof b=="function"&&"set"in b&&typeof b.set=="function"?b:c(h,g);if(k){k.set(p);continue}p&&typeof p=="object"&&!Array.isArray(p)&&b&&(typeof b=="object"||typeof b=="function"&&!("set"in b))&&!D(b)&&m(b,p,h?`${h}.${g}`:g)}}let d=t?.nodeMap;if(d&&Object.keys(d).length>0){if(d[""]==="r"){let u=r.$;u&&typeof u.set=="function"&&u.set(s)}for(let[u,f]of Object.entries(d)){if(u===""||f!=="b")continue;let h=u.split(/\.|\[|\]/).filter(Boolean),g=r.$;for(let p of h){if(!g)break;g=g[p]??void 0}if(g&&(D(g)||typeof g=="function"&&"set"in g&&typeof g.set=="function")){let p=s;for(let b of h){if(p==null){p=void 0;break}if(typeof p=="object")p=p[b];else{p=void 0;break}}try{g.set(p)}catch{}}}m(r.state,s);return}m(r.state,s)};function a(n,t){if(!t)return n;if(n===void 0)return{[w.UNDEFINED]:!0};if(typeof n=="number")return Number.isNaN(n)?{[w.NAN]:!0}:n===1/0?{[w.INFINITY]:!0}:n===-1/0?{[w.NEG_INFINITY]:!0}:n;if(typeof n=="bigint")return{[w.BIGINT]:String(n)};if(typeof n=="symbol")return{[w.SYMBOL]:String(n)};if(n instanceof Date)return{[w.DATE]:n.toISOString()};if(n instanceof RegExp)return{[w.REGEXP]:{source:n.source,flags:n.flags}};if(n instanceof Map)return{[w.MAP]:Array.from(n.entries())};if(n instanceof Set)return{[w.SET]:Array.from(n.values())};if(Array.isArray(n))return n.map(i=>a(i,t));if(n&&typeof n=="object"){let i={};for(let[s,c]of Object.entries(n))i[s]=a(c,t);return i}return n}return o.serialize=n=>{let t=M(M(M({},ce),l),n),i=F(r.state,new WeakSet,0,t.maxDepth,t.preserveTypes),s=a(i,t.preserveTypes),c=t.handleCircular?J(s):[],m={data:s},d={};try{let h=r.$;h&&typeof h.set=="function"&&(d[""]="r");let g=new WeakSet,p=k=>D(k)||typeof k=="function"&&"set"in k&&typeof k.set=="function",b=(k,I="")=>{if(!k||typeof k!="object"&&typeof k!="function")return;let A=k;if(!g.has(A)){g.add(A),I&&p(k)&&(d[I]="b");for(let[R,C]of Object.entries(k)){let K=I?`${I}.${R}`:R;b(C,K)}}};h&&b(h)}catch{}t.includeMetadata&&(m.metadata=M(M({timestamp:Date.now(),version:"1.0.0"},c.length>0&&{circularRefs:c}),Object.keys(d).length>0&&{nodeMap:d}));let u=we(t);return JSON.stringify(m,u,2)},o.deserialize=(n,t)=>{let i=M(M(M({},ce),l),t);try{let s=JSON.parse(n),{data:c,metadata:m}=s;m?.circularRefs&&i.handleCircular&&le(c,m.circularRefs),o.fromJSON(c,m),r.__config?.debugMode&&console.log("[SignalTree] State restored from serialized data",{timestamp:m?.timestamp,version:m?.version})}catch(s){throw console.error("[SignalTree] Failed to deserialize:",s),new Error(`Failed to deserialize SignalTree state: ${s instanceof Error?s.message:"Unknown error"}`)}},o.snapshot=()=>{let n=o.toJSON(),t=J(n);return{data:JSON.parse(JSON.stringify(n)),metadata:M({timestamp:Date.now(),version:"1.0.0"},t.length>0&&{circularRefs:t})}},o.restore=n=>{let{data:t,metadata:i}=n;i?.circularRefs&&le(t,i.circularRefs),o.fromJSON(t,i)},o};return e.metadata={name:"serialization"},e}var q=performance,ue=new Set;function be(l,e,r){if(e==null)return l;let o=Math.min(l,e);return o<l&&r&&!ue.has(r)&&(console.warn(`[BenchRunner] Cap applied to ${r}: requested=${l}, cap=${e}. You can raise this in configuration for scaling tests.`),ue.add(r)),o}function Se(l){if(typeof queueMicrotask=="function"){queueMicrotask(l);return}if(typeof MessageChannel<"u"){let e=new MessageChannel;e.port1.onmessage=()=>{l()},e.port2.postMessage(0);return}setTimeout(l,0)}function te(){let l=window.requestIdleCallback;return typeof l=="function"?new Promise(e=>{l(()=>e(),{timeout:50})}):new Promise(e=>Se(e))}function Te(){let l=!1,e;function r(o,a){e=o,!l&&(l=!0,requestAnimationFrame(()=>{l=!1;try{a?.(e)}finally{e=void 0}}))}return{schedule:r}}var ke=Te(),B=class{static percentile(e,r){if(e.length===0)return 0;let o=Math.ceil(r/100*e.length)-1;return e[Math.max(0,Math.min(o,e.length-1))]}static standardDeviation(e){if(e.length===0)return 0;let r=e.reduce((n,t)=>n+t,0)/e.length,a=e.map(n=>Math.pow(n-r,2)).reduce((n,t)=>n+t,0)/e.length;return Math.sqrt(a)}static removeStatisticalOutliers(e,r=.2){if(e.length<4)return e;let o=[...e].sort((m,d)=>m-d),a=this.percentile(o,25),n=this.percentile(o,75),t=n-a,i=a-1.5*t,s=n+1.5*t,c=e.filter(m=>m>=i&&m<=s);return c.length<e.length*(1-r)?e:c}static assessReliability(e,r){if(e.length<10)return{reliability:"low",coefficientOfVariation:0,recommendation:"Sample size too small for reliable measurement"};if(r<50)return{reliability:"low",coefficientOfVariation:0,recommendation:"Total runtime too short for reliable timing measurement"};let o=e.reduce((i,s)=>i+s,0)/e.length,a=o>0?this.standardDeviation(e)/o:0,n,t;return a<.05?(n="high",t="Excellent measurement stability - high confidence in results"):a<.15?(n="medium",t="Good measurement stability - results are likely reliable"):(n="low",t="High variability detected - consider checking for system interference or increasing sample size"),{reliability:n,coefficientOfVariation:a,recommendation:t}}static detectAnomalies(e){if(e.length<10)return{outliers:[],anomalyCount:0,anomalyRate:0,recommendation:"Sample size too small for reliable anomaly detection"};let r=[...e].sort((d,u)=>d-u),o=this.percentile(r,25),a=this.percentile(r,75),n=a-o,t=o-1.5*n,i=a+1.5*n,s=e.filter(d=>d<t||d>i),c=s.length/e.length,m;return c>.2?m="High anomaly rate detected - check for system interference, GC pressure, or thermal throttling":c>.1?m="Moderate anomaly rate - consider increasing sample size or checking environment":c>.05?m="Low anomaly rate - results are likely reliable":m="Very low anomaly rate - high confidence in results",{outliers:s,anomalyCount:s.length,anomalyRate:c,recommendation:m}}};function me(){return y(this,null,function*(){"gc"in window&&typeof window.gc=="function"&&window.gc?.();let l=new Array(1e6).fill(0);yield te(),l.length=0,yield new Promise(e=>setTimeout(e,100))})}function W(l,e){return y(this,null,function*(){let{warmup:r=5,operations:o,yieldEvery:a=0,trackMemory:n=!1,label:t="benchmark",measurementSamples:i=30,maxRuntimeMs:s=3e4,removeOutliers:c=!0,minSamples:m=10,forceGC:d=!1,operationsCap:u,minDurationMs:f=100,onProgress:h}=e,g=be(o,u,t);d&&(yield me()),console.debug(`[${t}] Starting warmup (${r} iterations)`);for(let v=0;v<r;v++)yield l(v),a&&(v+1)%a===0&&(yield te());d&&(yield me());let p=[],b=n&&q.memory?q.memory.usedJSHeapSize:void 0,k=0,I=0;for(console.debug(`[${t}] Starting measurement phase`);p.length<i&&k<s||k<f&&p.length<i*3;){let v=performance.now();for(let P=0;P<g;P++)yield l(P);let N=performance.now()-v;p.push(N),k+=N,I+=g,typeof h=="function"&&ke.schedule({samplesCollected:p.length,elapsedMs:k},P=>h(P)),p.length%10===0&&(yield te())}let A=n&&q.memory?q.memory.usedJSHeapSize:void 0,R=c?B.removeStatisticalOutliers(p):p;R.length<m&&(console.warn(`[${t}] Insufficient samples after outlier removal, using raw samples`),R=p);let C=[...R].sort((v,N)=>v-N),K=C.reduce((v,N)=>v+N,0)/C.length,Q=B.assessReliability(R,k),re=B.detectAnomalies(p),H=E(M({median:B.percentile(C,50),mean:K,min:C[0],max:C[C.length-1],p95:B.percentile(C,95),p99:B.percentile(C,99),stdDev:B.standardDeviation(C),samples:R,sampleCount:R.length,totalIterations:I,totalRuntimeMs:k},n&&b!==void 0&&A!==void 0&&{memoryDeltaMB:(A-b)/(1024*1024)}),{reliability:Q.reliability,coefficientOfVariation:Q.coefficientOfVariation,outlierCount:re.anomalyCount,anomalyRate:re.anomalyRate,recommendation:Q.recommendation});function fe(v,N){if(!v||v.length===0)return!1;let P=v.length;if(v.filter(U=>U===0).length/P>=.25)return!0;let Y=new Map;for(let U of v){let ae=Math.round(U*10)/10;Y.set(ae,(Y.get(ae)??0)+1)}let j=0;for(let U of Y.values())U>j&&(j=U);return j/P>=.35&&N<.5}try{if(!!!e.__adaptiveAttempted&&fe(p,H.median)){let P=Math.max(f*4,500),Z=Math.max(i*2,i+10);console.warn(`[${t}] Quantization detected in samples \u2014 rerunning with minDurationMs=${P} and measurementSamples=${Z}`);let Y=E(M({},e),{minDurationMs:P,measurementSamples:Z,__adaptiveAttempted:!0});return yield W(l,Y)}}catch(v){console.warn(`[${t}] Adaptive re-measure failed: ${v.message}`)}return console.debug(`[${t}] Completed: ${I} total iterations, ${p.length} samples, ${k.toFixed(1)}ms total, reliability: ${H.reliability}, CV: ${(H.coefficientOfVariation*100).toFixed(1)}%`),H})}var X=class{static compareBenchmarks(e,r,o,a,n=.95){let t=e.median-o.median,i=o.median>0?(o.median-e.median)/o.median*100:0,s=this.bootstrapMedianDifference(e.samples,o.samples,1e3,n),c=this.mannWhitneyUTest(e.samples,o.samples),m=this.cohensD(e.samples,o.samples),d;return c.isSignificant?t<0?d=`${r} is significantly faster than ${a}`:d=`${a} is significantly faster than ${r}`:d="No statistically significant difference detected",{library1:r,library2:a,medianDifference:t,percentageImprovement:i,isStatisticallySignificant:c.isSignificant,confidenceInterval:[s.lowerBound,s.upperBound],effectSize:m.effectSize,effectSizeInterpretation:m.interpretation,conclusion:d}}static bootstrapMedianDifference(e,r,o=1e3,a=.95){let n=[];for(let c=0;c<o;c++){let m=this.bootstrapSample(e),d=this.bootstrapSample(r),u=B.percentile([...m].sort((f,h)=>f-h),50)-B.percentile([...d].sort((f,h)=>f-h),50);n.push(u)}n.sort((c,m)=>c-m);let t=1-a,i=Math.floor(t/2*o),s=Math.floor((1-t/2)*o);return{lowerBound:n[i],upperBound:n[s]}}static mannWhitneyUTest(e,r){let o=e.length,a=r.length,n=[...e.map(c=>({value:c,group:1})),...r.map(c=>({value:c,group:2}))].sort((c,m)=>c.value-m.value),t=0;for(let c=0;c<n.length;c++)n[c].group===1&&(t+=c+1);let i=t-o*(o+1)/2,s=Math.min(i,o*a-i);if(o>20&&a>20){let c=o*a/2,m=Math.sqrt(o*a*(o+a+1)/12),d=Math.abs((s-c)/m),u=2*(1-this.normalCDF(d));return{isSignificant:u<.05,pValue:u}}return{isSignificant:!1,pValue:1}}static cohensD(e,r){let o=e.reduce((d,u)=>d+u,0)/e.length,a=r.reduce((d,u)=>d+u,0)/r.length,n=this.variance(e),t=this.variance(r),i=Math.sqrt(((e.length-1)*n+(r.length-1)*t)/(e.length+r.length-2)),s=(o-a)/i,c=Math.abs(s),m;return c<.2?m="Negligible effect":c<.5?m="Small effect":c<.8?m="Medium effect":m="Large effect",{effectSize:s,interpretation:m}}static normalCDF(e){return .5*(1+this.erf(e/Math.sqrt(2)))}static erf(e){let r=.254829592,o=-.284496736,a=1.421413741,n=-1.453152027,t=1.061405429,i=.3275911,s=e<0?-1:1;e=Math.abs(e);let c=1/(1+i*e),m=1-((((t*c+n)*c+a)*c+o)*c+r)*c*Math.exp(-e*e);return s*m}static variance(e){let r=e.reduce((o,a)=>o+a,0)/e.length;return e.reduce((o,a)=>o+Math.pow(a-r,2),0)/(e.length-1)}static bootstrapSample(e){let r=[];for(let o=0;o<e.length;o++){let a=Math.floor(Math.random()*e.length);r.push(e[a])}return r}},G=class{static detectPerformanceThrottling(){return y(this,null,function*(){let r=performance.now(),o=0;for(let s=0;s<1e5;s++)o+=Math.sqrt(s)*Math.sin(s);let n=1e5/(performance.now()-r),t=n<300,i;return t?i="Performance throttling detected. Consider: closing other tabs, plugging in laptop, checking thermal throttling, or running in incognito mode.":n<500?i="Moderate performance detected. Results may have higher variance.":i="Good performance environment detected.",o===1/0&&console.log("Calibration complete"),{isThrottled:t,opsPerMs:n,recommendation:i}})}static validateEnvironment(){return y(this,null,function*(){let e=[],r=[],o=yield this.detectPerformanceThrottling();if(o.isThrottled&&(e.push("Performance throttling detected"),r.push(o.recommendation)),q.memory){let n=q.memory;n.usedJSHeapSize/n.jsHeapSizeLimit*100>80&&(e.push("High memory usage detected"),r.push("Consider closing other tabs or refreshing the page to free memory"))}return"requestIdleCallback"in window||r.push("Browser lacks requestIdleCallback support - timing may be less accurate"),window.outerHeight-window.innerHeight>160&&r.push("Developer tools appear to be open - this may affect performance measurements"),{isReady:e.length===0,issues:e,recommendations:r}})}};var de=class l{yieldBetweenBenchmarks(){return y(this,null,function*(){return new Promise(e=>{requestAnimationFrame(()=>{setTimeout(e,0)})})})}yieldToUI=ie();getRuntimeMemoMode(){try{let e=window.__SIGNALTREE_MEMO_MODE;if(e==="off"||e==="light"||e==="shallow"||e==="full")return e}catch{}return"light"}runDeepNestedBenchmark(e,r=15){return y(this,null,function*(){let o=performance.now(),a=t=>t===0?{value:0,data:"test"}:{level:a(t-1)},n=T(a(r)).with(_(),L());for(let t=0;t<Math.min(e,S.ITERATIONS.DEEP_NESTED);t++){let i=n.state;for(let s=0;s<r&&i?.level;s++)i=i.level;i?.value&&typeof i.value.set=="function"?i.value.set(t):typeof i?.value=="function"&&i.value(t)}return performance.now()-o})}runArrayBenchmark(e){return y(this,null,function*(){let r=performance.now(),o=T({items:Array.from({length:e},(n,t)=>({id:t,value:Math.random()*1e3}))}).with(z()),a=Math.min(S.ITERATIONS.ARRAY_UPDATES,e);for(let n=0;n<a;n++){let t=n%e;o.state.items.update(i=>(i[t].value=Math.random()*1e3,i))}return performance.now()-r})}runComputedBenchmark(e){return y(this,null,function*(){let r=performance.now(),o=this.getRuntimeMemoMode(),a=[_()];o==="light"?a.push(O()):o==="shallow"?a.push(L()):o==="full"&&a.push($());let n=T({value:0,factors:Array.from({length:50},(i,s)=>s+1)});a.length&&(n=n.with(...a));let t=x(()=>{let i=n.state.value(),s=0;for(let c of n.state.factors())s+=Math.sin(i*c)*Math.cos(c);return s});for(let i=0;i<Math.min(e,S.ITERATIONS.COMPUTED);i++)n.state.value.set(i),t(),i&1023;return performance.now()-r})}runBatchUpdatesBenchmark(e=100,r=1e3){return y(this,null,function*(){let o=performance.now(),a=T({items:Array.from({length:r},(n,t)=>t)}).with(z());for(let n=0;n<e;n++)a.state.items.update(t=>{for(let i=0;i<r;i++)t[i]=t[i]+1|0;return t});return performance.now()-o})}runSelectorBenchmark(e){return y(this,null,function*(){let r=performance.now(),o=this.getRuntimeMemoMode(),a=[];o==="light"?a.push(O()):o==="shallow"?a.push(L()):o==="full"&&a.push($());let n=T({items:Array.from({length:e},(c,m)=>({id:m,flag:m%2===0,value:Math.random()*100,metadata:{category:m%5,priority:m%3}}))});a.length&&(n=n.with(...a));let t=x(()=>n.state.items().filter(c=>c.flag).length),i=x(()=>n.state.items().filter(c=>c.value>50).length),s=x(()=>n.state.items().reduce((m,d)=>{let u=d.metadata.category;return m[u]=(m[u]||0)+1,m},{}));for(let c=0;c<S.ITERATIONS.SELECTOR;c++)t(),i(),s(),(c&S.YIELD_FREQUENCY.SELECTOR)===0&&n.state.items.update(m=>{let d=c%m.length;return m[d].flag=!m[d].flag,m});return performance.now()-r})}runSerializationBenchmark(e){return y(this,null,function*(){let r=T({users:Array.from({length:Math.max(S.DATA_SIZE_LIMITS.USER_SIMULATION.MIN,Math.min(S.DATA_SIZE_LIMITS.USER_SIMULATION.MAX,e))},(i,s)=>({id:s,name:`User ${s}`,roles:s%5===0?["admin","user"]:["user"],active:s%3===0,meta:{createdAt:new Date(2020,0,1+s%28)}})),settings:{theme:"dark",flags:{a:!0,b:!1,c:o(8).reduce((i,s)=>E(M({},i),{[s]:s%2===0}),{})}}}).with($(),z(),ne({preserveTypes:!1,includeMetadata:!1}));function o(i){return Array.from({length:i},(s,c)=>c)}for(let i=0;i<10;i++)r.state.users.update(s=>{let c=i%s.length;return s[c].active=!s[c].active,s});let a=performance.now(),n=r.snapshot();return JSON.stringify({data:n.data}),performance.now()-a})}runConcurrentUpdatesBenchmark(e=50,r=200){return y(this,null,function*(){let o=T({counters:Array.from({length:e},()=>({value:0}))}).with(_()),a=performance.now();for(let n=0;n<r;n++)for(let t=0;t<e;t++){let i=t;o.state.counters.update(s=>s.map((c,m)=>m===i?E(M({},c),{value:c.value+1|0}):c))}return performance.now()-a})}runMemoryEfficiencyBenchmark(e){return y(this,null,function*(){let r=Math.max(S.DATA_SIZE_LIMITS.ENTITY_COUNT.MIN,Math.min(S.DATA_SIZE_LIMITS.ENTITY_COUNT.MAX,e)),o=Math.max(10,Math.min(200,Math.floor(r/250))),a=T({groups:Array.from({length:o},(i,s)=>({id:s,items:Array.from({length:Math.floor(r/o)},(c,m)=>({id:s*1e6+m,score:m*13%997,tags:m%7===0?["hot","new"]:["cold"]}))}))}).with(O(),_()),n=performance.now(),t=Math.max(100,Math.floor(r*.01));for(let i=0;i<t;i++){let s=i%o;a.state.groups.update(c=>{let m=[...c],d=m[s];return d&&d.items&&(m[s]=E(M({},d),{items:d.items.map((u,f)=>{let h=i%d.items.length;return f===h?E(M({},u),{score:u.score+1|0,tags:(i&63)===0?u.tags.includes("hot")?["cold"]:["hot"]:u.tags}):u})})),m})}return performance.now()-n})}runDataFetchingBenchmark(e){return y(this,null,function*(){let r=performance.now(),o=Array.from({length:Math.min(e,S.DATA_SIZE_LIMITS.USER_SIMULATION.MAX)},(n,t)=>({id:t,title:`Item ${t}`,description:`Description for item ${t}`,tags:[`tag${t%10}`,`category${t%5}`],meta:{createdAt:new Date(2023,0,1+t%365),updatedAt:new Date(2023,6,1+t%180),views:Math.floor(Math.random()*1e3),rating:Math.random()*5},relations:{authorId:Math.floor(t/10),parentId:t>0?t-1:null,childIds:t<e-1?[t+1]:[]}})),a=T({items:[],metadata:{total:0,loaded:!1,lastFetch:null},filters:{search:"",category:"",tags:[]},pagination:{page:1,size:50,total:0}}).with(_(),L());a.state.metadata.loaded.set(!1),a.state.items.set(o),a.state.metadata.total.set(o.length),a.state.metadata.lastFetch.set(new Date),a.state.metadata.loaded.set(!0);for(let n=0;n<Math.min(S.ITERATIONS.BATCH_UPDATES,e/10);n++){a.state.filters.search.set(`search${n}`),a.state.filters.category.set(`cat${n%5}`);let t=a.state.items().filter(i=>i.title.includes(a.state.filters.search())||i.tags.includes(a.state.filters.category()));a.state.pagination.total.set(t.length)}return performance.now()-r})}runRealTimeUpdatesBenchmark(e){return y(this,null,function*(){let r=performance.now(),o=T({liveMetrics:{activeUsers:0,totalSessions:0,pageViews:0,serverLoad:0,responseTime:0},recentEvents:[],notifications:[],alerts:[]}).with(z(),O()),a=Math.min(S.ITERATIONS.REAL_TIME_UPDATES,e);for(let n=0;n<a;n++)o.state.liveMetrics.activeUsers.update(t=>t+Math.floor(Math.random()*10-5)),o.state.liveMetrics.pageViews.update(t=>t+Math.floor(Math.random()*20)),o.state.liveMetrics.serverLoad.set(Math.random()),o.state.liveMetrics.responseTime.set(50+Math.random()*200),(n&S.YIELD_FREQUENCY.DATA_FETCHING)===0&&o.state.recentEvents.update(t=>[...t.slice(-99),{id:n,type:"user_action",timestamp:Date.now(),data:`event${n}`}]),(n&S.YIELD_FREQUENCY.REAL_TIME_UPDATES)===0&&o.state.notifications.update(t=>[...t.slice(-9),{id:n,message:`Notification ${n}`,priority:"normal",timestamp:Date.now()}]);return performance.now()-r})}runStateSizeScalingBenchmark(e){return y(this,null,function*(){let r=performance.now(),o=Array.from({length:Math.min(e*S.DATA_SIZE_LIMITS.LARGE_DATASET.MULTIPLIER,S.DATA_SIZE_LIMITS.LARGE_DATASET.MAX)},(t,i)=>({id:i,name:`Entity ${i}`,properties:Array.from({length:20},(s,c)=>({key:`prop_${c}`,value:`value_${i}_${c}`,metadata:{type:"string",indexed:c%3===0}})),relations:Array.from({length:Math.min(5,i)},(s,c)=>({targetId:i-c-1,type:"reference"}))})),a=T({entities:o,indices:{},cache:{},stats:{size:0,lastUpdate:null}}).with(O(),_());a.state.stats.size.set(o.length),a.state.stats.lastUpdate.set(new Date);let n=Math.min(S.ITERATIONS.STATE_SIZE_SCALING,e/5);for(let t=0;t<n;t++){let i=t%o.length;a.state.entities.update(s=>{let c=s[i];return c&&(c.properties[0].value=`updated_${Date.now()}`),s}),(t&S.YIELD_FREQUENCY.REAL_TIME_UPDATES)===0&&a.state.cache.update(s=>E(M({},s),{[`cache_${t}`]:{computed:Math.random(),timestamp:Date.now()}}))}return performance.now()-r})}runAsyncWorkflowBenchmark(e){return y(this,null,function*(){let r=T({items:[],loading:!1,error:null}).with(z()),o=f=>y(null,null,function*(){return yield new Promise(h=>setTimeout(h,S.TIMING.ASYNC_DELAY_MS)),Array.from({length:f},(h,g)=>({id:g,value:g}))}),a=performance.now(),n=Math.min(Math.max(1,Math.floor(e/10)),S.ITERATIONS.ASYNC_WORKFLOW),t=Math.min(8,Math.max(1,n)),i=Math.max(1,Math.floor(e/Math.max(n,10))),s=new Array(e),c=0;function m(f,h){return y(this,null,function*(){let g=0;for(;g<f.length;){let p=f.slice(g,g+t);yield Promise.all(p.map(b=>h(b))),g+=t}})}r.state.loading.set(!0),r.state.error.set(null);let d=()=>y(null,null,function*(){try{let f=yield o(Math.min(i,e)),h=r.preallocateArray;if(h){let g=h("items",s.length);for(let p=0;p<f.length;p++){let b=(c+p)%s.length;g.update(b,f[p])}g.commit(),c=(c+f.length)%s.length}else if(r.batch)r.batch(()=>{for(let g=0;g<f.length;g++){let p=(c+g)%s.length;s[p]=f[g]}r.state.items.set(s),c=(c+f.length)%s.length});else{let g=c;for(let p=0;p<f.length;p++){let b=(g+p)%s.length;s[b]=f[p]}r.state.items.set(s.slice()),c=(c+f.length)%s.length}}catch(f){r.state.error.set(f?.message??String(f))}}),u=Array.from({length:n},(f,h)=>h);return yield m(u,d),r.state.loading.set(!1),performance.now()-a})}runConcurrentAsyncBenchmark(e){return y(this,null,function*(){let r=T({results:[],activeOperations:0}),o=t=>y(null,null,function*(){r.state.activeOperations.update(s=>s+1),yield new Promise(s=>setTimeout(s,Math.random()*S.TIMING.RANDOM_DELAY_MAX_MS));let i={id:t,value:Math.random()};r.state.results.update(s=>[...s,i]),r.state.activeOperations.update(s=>s-1)}),a=performance.now(),n=Array.from({length:e},(t,i)=>o(i));return yield Promise.all(n),performance.now()-a})}runAsyncCancellationBenchmark(e){return y(this,null,function*(){let r=T({activeRequest:null,result:null,cancelled:0}),o=performance.now();for(let a=0;a<e;a++){let n=r.state.activeRequest();n&&(n.abort(),r.state.cancelled.update(i=>i+1));let t=new AbortController;r.state.activeRequest.set(t);try{yield new Promise((i,s)=>{let c=setTimeout(()=>{t.signal.aborted||(r.state.result.set({id:a,data:"completed"}),i(null))},5);t.signal.addEventListener("abort",()=>{clearTimeout(c),s(new Error("Cancelled"))})})}catch{}}return performance.now()-o})}runUndoRedoBenchmark(e){return y(this,null,function*(){let r=T({counter:0,data:{value:"initial"}}).with(V()),o=performance.now();for(let a=0;a<e;a++)r.state.counter.set(a),r.state.data({value:`step_${a}`});for(let a=0;a<e/2;a++)r.undo?.();for(let a=0;a<e/4;a++)r.redo?.();return performance.now()-o})}runHistorySizeBenchmark(e){return y(this,null,function*(){let r=T({value:0,data:{content:"initial"}}).with(V({maxHistorySize:e})),o=performance.now();for(let a=0;a<e;a++)r.state.value.set(a),r.state.data({content:`step_${a}`});return performance.now()-o})}runJumpToStateBenchmark(e){return y(this,null,function*(){let r=T({currentState:0,data:{value:"initial"}}).with(V()),o=performance.now();for(let a=0;a<e;a++)r.state.currentState.set(a),r.state.data({value:`state_${a}`});for(let a=0;a<e;a++){let n=Math.floor(Math.random()*e);r.jumpToStep?.(n)}return performance.now()-o})}runSingleMiddlewareBenchmark(e){return y(this,null,function*(){let r=T({value:0,middlewareLog:[]}),o=(n,t)=>{r.state.middlewareLog.update(i=>[...i.slice(-100),`${n}:${t}`])},a=performance.now();for(let n=0;n<e;n++)o("setValue",n),r.state.value.set(n);return performance.now()-a})}runMultipleMiddlewareBenchmark(e,r){return y(this,null,function*(){let o=T({value:0,logs:Array.from({length:e},()=>[])}),a=Array.from({length:e},(t,i)=>(s,c)=>{o.state.logs()[i].push(`MW${i}:${s}:${c}`)}),n=performance.now();for(let t=0;t<r;t++)a.forEach(i=>i("setValue",t)),o.state.value.set(t);return performance.now()-n})}runConditionalMiddlewareBenchmark(e){return y(this,null,function*(){let r=T({value:0,conditionalLog:[],condition:!0}),o=(n,t)=>{r.state.condition()&&r.state.conditionalLog.update(i=>[...i.slice(-50),`${n}:${t}`])},a=performance.now();for(let n=0;n<e;n++)(n&S.YIELD_FREQUENCY.DATA_FETCHING)===0&&r.state.condition.set(!r.state.condition()),o("setValue",n),r.state.value.set(n);return performance.now()-a})}runAllFeaturesEnabledBenchmark(e){return y(this,null,function*(){let r=T({data:[],loading:!1,history:[],middlewareLog:[]}).with($(),_(),ne()),o=performance.now(),a=Math.min(e/100,S.ITERATIONS.ASYNC_WORKFLOW);for(let n=0;n<a;n++)r.state.loading.set(!0),yield new Promise(t=>setTimeout(t,S.TIMING.TIMEOUT_DELAY_MS)),r.state.data.update(t=>[...t,{id:n,value:Math.random()}]),r.state.loading.set(!1),r.state.history.update(t=>[...t.slice(-20),{action:"update",id:n}]),r.state.middlewareLog.update(t=>[...t.slice(-30),`action_${n}`]);return performance.now()-o})}runEnhancedArrayBenchmark(e){return y(this,null,function*(){let r={operations:Math.min(S.ITERATIONS.ARRAY_UPDATES,e),warmup:10,measurementSamples:30,yieldEvery:S.YIELD_FREQUENCY.ARRAY_UPDATES,trackMemory:!0,removeOutliers:!0,forceGC:!0,label:"SignalTree Array Updates",minDurationMs:100},o=T({items:Array.from({length:e},(a,n)=>({id:n,value:Math.random()*1e3}))}).with(z());return W(a=>y(null,null,function*(){let n=a%e;o.state.items.update(t=>{let i=[...t];return i[n]=E(M({},i[n]),{value:Math.random()*1e3}),i})}),r)})}runEnhancedSelectorBenchmark(e){return y(this,null,function*(){let r=T({items:Array.from({length:e},(n,t)=>({id:t,flag:t%2===0}))}).with(O()),o=x(()=>r.state.items().filter(n=>n.flag).length);return W(()=>y(null,null,function*(){o()}),{operations:1e3,warmup:5,measurementSamples:50,yieldEvery:64,trackMemory:!1,removeOutliers:!0,label:"SignalTree Selector (Memoized)",minDurationMs:50})})}runEnhancedDeepNestedBenchmark(e,r=15){return y(this,null,function*(){let o=t=>t===0?{value:0,data:"test"}:{level:o(t-1)},a=T(o(r)).with(_(),L()),n={operations:Math.min(e,1e3),warmup:5,measurementSamples:20,yieldEvery:1024,trackMemory:!0,removeOutliers:!0,forceGC:!0,label:"SignalTree Deep Nested Updates",minDurationMs:100};return W(t=>y(null,null,function*(){a.update(i=>{let s=(c,m)=>m===0?E(M({},c),{value:t}):E(M({},c),{level:s(c.level??{},m-1)});return s(i,r-1)})}),n)})}runPureArrayBenchmark(e){return y(this,null,function*(){let r=T({items:Array.from({length:e},(n,t)=>({id:t,value:Math.random()*1e3}))}).with(z()),o=Math.min(S.ITERATIONS.ARRAY_UPDATES,e),a=performance.now();for(let n=0;n<o;n++){let t=n%e;r.state.items.update(i=>{let s=[...i];return s[t]=E(M({},s[t]),{value:Math.random()*1e3}),s})}return performance.now()-a})}runPureSelectorBenchmark(e){return y(this,null,function*(){let r=T({items:Array.from({length:e},(n,t)=>({id:t,flag:t%2===0}))}).with(O()),o=x(()=>r.state.items().filter(n=>n.flag).length),a=performance.now();for(let n=0;n<S.ITERATIONS.SELECTOR;n++)o();return performance.now()-a})}runPureDeepNestedBenchmark(e,r=15){return y(this,null,function*(){let o=i=>i===0?{value:0,data:"test"}:{level:o(i-1)},a=T(o(r)).with(_(),L()),n=Math.min(e,S.ITERATIONS.DEEP_NESTED),t=performance.now();for(let i=0;i<n;i++)a.update(s=>{let c=(m,d)=>d===0?E(M({},m),{value:i}):E(M({},m),{level:c(m.level??{},d-1)});return c(s,r-1)});return performance.now()-t})}runPureBenchmarkSuite(e){return y(this,null,function*(){let r=performance.now();yield this.yieldBetweenBenchmarks(),console.log("\u{1F3AF} Starting Pure Array Benchmark...");let o=yield this.runPureArrayBenchmark(e);yield this.yieldBetweenBenchmarks(),console.log("\u{1F3AF} Starting Pure Selector Benchmark...");let a=yield this.runPureSelectorBenchmark(e);yield this.yieldBetweenBenchmarks(),console.log("\u{1F3AF} Starting Pure Deep Nested Benchmark...");let n=yield this.runPureDeepNestedBenchmark(e),t=performance.now()-r;return console.log(`\u2705 Pure Benchmark Suite Complete:
      \u2022 Array: ${o.toFixed(2)}ms
      \u2022 Selector: ${a.toFixed(2)}ms
      \u2022 Deep Nested: ${n.toFixed(2)}ms
      \u2022 Total: ${t.toFixed(2)}ms`),{arrayBenchmark:o,selectorBenchmark:a,deepNestedBenchmark:n,totalTime:t}})}validateBenchmarkEnvironment(){return y(this,null,function*(){let e=yield G.validateEnvironment(),r=yield G.detectPerformanceThrottling();return E(M({},e),{performanceMetrics:{isThrottled:r.isThrottled,opsPerMs:r.opsPerMs}})})}static compareWithLibrary(e,r,o){return X.compareBenchmarks(e,"SignalTree",r,o,.95)}runComprehensiveBenchmarkSuite(e){return y(this,null,function*(){let r=yield this.validateBenchmarkEnvironment();r.isReady||console.warn("Benchmark environment validation failed:",r.issues);let[o,a,n]=yield Promise.all([this.runEnhancedArrayBenchmark(e),this.runEnhancedSelectorBenchmark(e),this.runEnhancedDeepNestedBenchmark(e)]),t=[o,a,n],i=t.map(u=>u.reliability),s=i.includes("low")?"low":i.includes("medium")?"medium":"high",c=t.reduce((u,f)=>u+f.sampleCount,0),m=t.reduce((u,f)=>u+f.totalRuntimeMs,0),d=[];return t.forEach(u=>{u.reliability==="low"&&d.push(u.recommendation),u.anomalyRate>.1&&d.push(`High anomaly rate in ${u.samples.length>0?"benchmark":"unknown benchmark"} - check for interference`)}),r.performanceMetrics.isThrottled&&d.push("Performance throttling detected - results may not reflect optimal performance"),{arrayBenchmark:o,selectorBenchmark:a,deepNestedBenchmark:n,environment:r,summary:{overallReliability:s,totalSamples:c,totalRuntime:m,recommendations:[...new Set(d)]}}})}demonstrateEnhancedBenchmarking(e=1e3){return y(this,null,function*(){console.log("\u{1F680} Starting Enhanced SignalTree Benchmark Demonstration");let r=yield this.validateBenchmarkEnvironment();console.log("Environment Check:",r),r.isReady||(console.warn("\u26A0\uFE0F Environment issues detected:",r.issues),console.log("\u{1F4A1} Recommendations:",r.recommendations)),console.log(`
\u{1F4CA} Running Enhanced Array Benchmark...`);let o=yield this.runEnhancedArrayBenchmark(e);console.log(`\u2705 Array Benchmark Complete:
      \u2022 Median: ${o.median.toFixed(2)}ms
      \u2022 Reliability: ${o.reliability}
      \u2022 CV: ${(o.coefficientOfVariation*100).toFixed(1)}%
      \u2022 Samples: ${o.sampleCount}
      \u2022 Memory \u0394: ${o.memoryDeltaMB?.toFixed(2)??"N/A"}MB`),console.log(`
\u{1F3AF} Running Enhanced Selector Benchmark...`);let a=yield this.runEnhancedSelectorBenchmark(e);console.log(`\u2705 Selector Benchmark Complete:
      \u2022 Median: ${a.median.toFixed(2)}ms
      \u2022 Reliability: ${a.reliability}
      \u2022 CV: ${(a.coefficientOfVariation*100).toFixed(1)}%
      \u2022 Samples: ${a.sampleCount}`),console.log(`
\u{1F4C8} Statistical Comparison Example:`);let n=l.compareWithLibrary(o,a,"Selector Benchmark");console.log(`Comparison Result:
      \u2022 Difference: ${n.medianDifference.toFixed(2)}ms
      \u2022 Improvement: ${n.percentageImprovement.toFixed(1)}%
      \u2022 Significant: ${n.isStatisticallySignificant}
      \u2022 Effect Size: ${n.effectSizeInterpretation}
      \u2022 Conclusion: ${n.conclusion}`),console.log(`
\u{1F389} Enhanced Benchmark Demonstration Complete!`)})}static \u0275fac=function(r){return new(r||l)};static \u0275prov=oe({token:l,factory:l.\u0275fac,providedIn:"root"})};export{de as a};
