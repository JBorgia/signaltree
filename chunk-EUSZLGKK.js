import{$b as O,aa as he,ac as re,ma as Te,qa as b,ra as k}from"./chunk-MVZBW2TQ.js";import{a as m,b as P}from"./chunk-A3ECCK3J.js";var ze=Object.freeze({PATH_CACHE_SIZE:1e3}),H=ze.PATH_CACHE_SIZE;var me=typeof globalThis=="object"&&globalThis!==null?globalThis.structuredClone:void 0;function $(t){if(me)try{return me(t)}catch{}return x(t,new WeakMap)}function x(t,e){if(t===null||typeof t!="object"||typeof t=="function")return t;let o=e.get(t);if(o)return o;if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return new RegExp(t.source,t.flags);if(t instanceof Map){let r=new Map;e.set(t,r);for(let[a,c]of t)r.set(x(a,e),x(c,e));return r}if(t instanceof Set){let r=new Set;e.set(t,r);for(let a of t)r.add(x(a,e));return r}if(Array.isArray(t)){let r=new Array(t.length);e.set(t,r);for(let a=0;a<t.length;a++)r[a]=x(t[a],e);return r}if(ArrayBuffer.isView(t)){if(t instanceof DataView){let c=x(t.buffer,e);return new DataView(c,t.byteOffset,t.byteLength)}let r=t;if(typeof r.slice=="function")return r.slice();let a=x(t.buffer,e);return new t.constructor(a,t.byteOffset,t.length)}if(t instanceof ArrayBuffer)return t.slice(0);let n=Object.getPrototypeOf(t),i=n?Object.create(n):{};e.set(t,i);for(let r of Reflect.ownKeys(t)){let a=Object.getOwnPropertyDescriptor(t,r);a&&("value"in a&&(a.value=x(a.value,e)),Object.defineProperty(i,r,a))}return i}function v(t,e){if(t===e)return!0;if(t==null||e==null)return t===e;let o=typeof t;if(o!==typeof e||o!=="object")return!1;if(t instanceof Date&&e instanceof Date)return t.getTime()===e.getTime();if(t instanceof RegExp&&e instanceof RegExp)return t.source===e.source&&t.flags===e.flags;if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(let[l,s]of t)if(!e.has(l)||!v(s,e.get(l)))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(let l of t)if(!e.has(l))return!1;return!0}if(Array.isArray(t))return!Array.isArray(e)||t.length!==e.length?!1:t.every((l,s)=>v(l,e[s]));if(Array.isArray(e))return!1;let i=t,r=e,a=Object.keys(i),c=Object.keys(r);return a.length!==c.length?!1:a.every(l=>l in r&&v(i[l],r[l]))}function A(t){if(t==null)return!1;if(t instanceof Date||t instanceof RegExp||typeof t=="function"||t instanceof Map||t instanceof Set||t instanceof WeakMap||t instanceof WeakSet||t instanceof ArrayBuffer||t instanceof DataView||t instanceof Error||t instanceof Promise||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array||t instanceof BigInt64Array||t instanceof BigUint64Array||typeof window<"u"&&(t instanceof URL||t instanceof URLSearchParams||t instanceof FormData||t instanceof Blob||typeof File<"u"&&t instanceof File||typeof FileList<"u"&&t instanceof FileList||typeof Headers<"u"&&t instanceof Headers||typeof Request<"u"&&t instanceof Request||typeof Response<"u"&&t instanceof Response||typeof AbortController<"u"&&t instanceof AbortController||typeof AbortSignal<"u"&&t instanceof AbortSignal))return!0;try{let e=globalThis?.Buffer;if(e&&t instanceof e)return!0}catch{}return!1}var z=class{constructor(e){this.maxSize=e;if(!Number.isFinite(e)||e<=0)throw new Error("LRUCache maxSize must be a positive, finite number")}cache=new Map;set(e,o){if(this.cache.has(e)&&this.cache.delete(e),this.cache.set(e,o),this.cache.size>this.maxSize){let n=this.cache.keys().next().value;n!==void 0&&this.cache.delete(n)}}get(e){if(!this.cache.has(e))return;let o=this.cache.get(e);return o!==void 0&&(this.cache.delete(e),this.cache.set(e,o)),o}delete(e){this.cache.delete(e)}has(e){return this.cache.has(e)}clear(){this.cache.clear()}size(){return this.cache.size}forEach(e){this.cache.forEach((o,n)=>e(o,n))}entries(){return this.cache.entries()}keys(){return this.cache.keys()}resize(e){if(!Number.isFinite(e)||e<=0)throw new Error("LRUCache newSize must be a positive, finite number");for(this.maxSize=e;this.cache.size>this.maxSize;){let o=this.cache.keys().next().value;if(o===void 0)break;this.cache.delete(o)}}};var ye=new z(H);function oe(t){let e=ye.get(t);if(e)return e;let o=t.split(".");return ye.set(t,o),o}var j={MAX_PATH_CACHE_SIZE:H,LAZY_THRESHOLD:50,ESTIMATE_MAX_DEPTH:3,ESTIMATE_SAMPLE_SIZE_ARRAY:3,ESTIMATE_SAMPLE_SIZE_OBJECT:5,DEFAULT_CACHE_SIZE:100,DEFAULT_BATCH_SIZE:10},Se={NULL_OR_UNDEFINED:"null/undefined",CIRCULAR_REF:"circular ref",UPDATER_INVALID:"updater invalid",LAZY_FALLBACK:"lazy fallback",SIGNAL_CREATION_FAILED:"signal creation failed",UPDATE_PATH_NOT_FOUND:"update path not found",UPDATE_FAILED:"update failed",ROLLBACK_FAILED:"rollback failed",CLEANUP_ERROR:"cleanup error",PRESET_UNKNOWN:"unknown preset",STRATEGY_SELECTION:"strategy select",TREE_DESTROYED:"destroyed",UPDATE_TRANSACTION:"update tx",BATCH_NOT_ENABLED:"batching disabled",MEMOIZE_NOT_ENABLED:"memoize disabled",MIDDLEWARE_NOT_AVAILABLE:"middleware missing",ENTITY_HELPERS_NOT_AVAILABLE:"entity helpers missing",ASYNC_ACTIONS_NOT_AVAILABLE:"async actions missing",TIME_TRAVEL_NOT_AVAILABLE:"time travel missing",OPTIMIZE_NOT_AVAILABLE:"optimize missing",UPDATE_OPTIMIZED_NOT_AVAILABLE:"update optimized missing",CACHE_NOT_AVAILABLE:"cache missing",PERFORMANCE_NOT_ENABLED:"performance disabled",ENHANCER_ORDER_FAILED:"enhancer order failed",ENHANCER_CYCLE_DETECTED:"enhancer cycle",ENHANCER_REQUIREMENT_MISSING:"enhancer req missing",ENHANCER_PROVIDES_MISSING:"enhancer provides missing",ENHANCER_FAILED:"enhancer failed",ENHANCER_NOT_FUNCTION:"enhancer not function",EFFECT_NO_CONTEXT:"no angular context",SUBSCRIBE_NO_CONTEXT:"no angular context"},Le=(()=>{let t={},e=0;for(let o of Object.keys(Se))t[o]=String(e++);return t})(),Ct=typeof globalThis=="object"&&globalThis!==null&&"process"in globalThis&&typeof globalThis.process=="object"&&"env"in globalThis.process&&globalThis.process.env.NODE_ENV==="production",Ue=!1,w=Object.freeze(Ue?Se:Le);function we(t,e=new Set,o=!1){let n=t.map((s,f)=>({fn:s,name:s.metadata&&s.metadata.name?String(s.metadata.name):`enhancer#${f}`,requires:new Set(s.metadata?.requires??[]),provides:new Set(s.metadata?.provides??[])})),i=new Map,r=new Map;for(let s of n)r.set(s.name,s),i.set(s.name,new Set);for(let s of n)for(let f of n)if(s!==f){for(let h of f.requires)if(!e.has(h)&&s.provides.has(h)){let u=i.get(s.name);u&&u.add(f.name)}}let a=new Map;for(let s of i.keys())a.set(s,0);for(let[,s]of i)for(let f of s)a.set(f,(a.get(f)||0)+1);let c=[];for(let[s,f]of a.entries())f===0&&c.push(s);let l=[];for(;c.length>0;){let s=c.shift();if(!s)break;l.push(s);let f=i.get(s);if(f)for(let h of f)a.set(h,(a.get(h)||0)-1),a.get(h)===0&&c.push(h)}return l.length!==n.length?(o&&console.warn(w.ENHANCER_CYCLE_DETECTED),t):l.map(s=>{let f=r.get(s);return f?f.fn:t[0]})}var q=class{cache=new Map;registry=null;config;stats={cleanedUpSignals:0,peakCachedSignals:0,manualDisposes:0};constructor(e={}){this.config={enableAutoCleanup:e.enableAutoCleanup??!0,debugMode:e.debugMode??!1,onCleanup:e.onCleanup??(()=>{})},this.config.enableAutoCleanup&&typeof FinalizationRegistry<"u"&&(this.registry=new FinalizationRegistry(o=>{this.handleCleanup(o)})),this.config.debugMode&&console.log("[SignalMemoryManager] Initialized",{autoCleanup:this.config.enableAutoCleanup,hasRegistry:!!this.registry})}cacheSignal(e,o){let i={ref:new WeakRef(o),path:e,cachedAt:Date.now()};this.cache.set(e,i),this.registry&&this.registry.register(o,e,o);let r=this.cache.size;r>this.stats.peakCachedSignals&&(this.stats.peakCachedSignals=r),this.config.debugMode&&console.log(`[SignalMemoryManager] Cached signal: ${e}`,{cacheSize:r,peak:this.stats.peakCachedSignals})}getSignal(e){let o=this.cache.get(e);if(!o)return;let n=o.ref.deref();if(!n){this.cache.delete(e),this.config.debugMode&&console.log(`[SignalMemoryManager] Signal GC'd: ${e}`);return}return n}hasSignal(e){return this.cache.has(e)}removeSignal(e){let o=this.cache.get(e);if(!o)return!1;let n=o.ref.deref();return n&&this.registry&&this.registry.unregister(n),this.cache.delete(e),this.config.debugMode&&console.log(`[SignalMemoryManager] Removed signal: ${e}`),!0}handleCleanup(e){this.cache.delete(e),this.stats.cleanedUpSignals++;let o=this.getStats();this.config.debugMode&&console.log(`[SignalMemoryManager] Auto cleanup: ${e}`,o),this.config.onCleanup(e,o)}getStats(){let e=0;for(let[n,i]of this.cache.entries())i.ref.deref()?e++:this.cache.delete(n);let o=e*100;return{cachedSignals:e,cleanedUpSignals:this.stats.cleanedUpSignals,peakCachedSignals:this.stats.peakCachedSignals,manualDisposes:this.stats.manualDisposes,estimatedMemoryBytes:o}}dispose(){if(this.config.debugMode&&console.log("[SignalMemoryManager] Disposing",{cachedSignals:this.cache.size}),this.registry)for(let e of this.cache.values()){let o=e.ref.deref();o&&this.registry.unregister(o)}this.cache.clear(),this.stats.manualDisposes++,this.config.debugMode&&console.log("[SignalMemoryManager] Disposed",this.getStats())}getCachedPaths(){let e=[];for(let[o,n]of this.cache.entries())n.ref.deref()&&e.push(o);return e}clearStale(){let e=0;for(let[o,n]of this.cache.entries())n.ref.deref()||(this.cache.delete(o),e++);return this.config.debugMode&&e>0&&console.log(`[SignalMemoryManager] Cleared ${e} stale entries`),e}resetStats(){this.stats={cleanedUpSignals:0,peakCachedSignals:0,manualDisposes:0},this.config.debugMode&&console.log("[SignalMemoryManager] Stats reset")}};var K=class{defaultOptions={maxDepth:100,detectDeletions:!1,ignoreArrayOrder:!1,equalityFn:(e,o)=>e===o,keyValidator:void 0};diff(e,o,n={}){let i=m(m({},this.defaultOptions),n),r=[],a=new WeakSet;return this.traverse(e,o,[],r,a,i,0),{changes:r,hasChanges:r.length>0}}traverse(e,o,n,i,r,a,c){if(c>a.maxDepth)return;if(typeof o!="object"||o===null){a.equalityFn(e,o)||i.push({type:e===void 0?"add":"update",path:[...n],value:o,oldValue:e});return}if(r.has(o))return;if(r.add(o),Array.isArray(o)){this.diffArrays(e,o,n,i,r,a,c);return}if(!e||typeof e!="object"||Array.isArray(e)){i.push({type:"replace",path:[...n],value:o,oldValue:e});return}let l=e,s=o;for(let f in s)if(Object.prototype.hasOwnProperty.call(s,f)){if(a.keyValidator&&!a.keyValidator(f))continue;this.traverse(l[f],s[f],[...n,f],i,r,a,c+1)}if(a.detectDeletions)for(let f in l)Object.prototype.hasOwnProperty.call(l,f)&&!(f in s)&&i.push({type:"delete",path:[...n,f],oldValue:l[f]})}diffArrays(e,o,n,i,r,a,c){if(!Array.isArray(e)){i.push({type:"replace",path:[...n],value:o,oldValue:e});return}a.ignoreArrayOrder?this.diffArraysUnordered(e,o,n,i,a):this.diffArraysOrdered(e,o,n,i,r,a,c)}diffArraysOrdered(e,o,n,i,r,a,c){let l=Math.max(e.length,o.length);for(let s=0;s<l;s++)s>=o.length?a.detectDeletions&&i.push({type:"delete",path:[...n,s],oldValue:e[s]}):s>=e.length?i.push({type:"add",path:[...n,s],value:o[s]}):this.traverse(e[s],o[s],[...n,s],i,r,a,c+1)}diffArraysUnordered(e,o,n,i,r){let a=new Set(e.map(l=>this.stringify(l))),c=new Set(o.map(l=>this.stringify(l)));o.forEach((l,s)=>{let f=this.stringify(l);a.has(f)||i.push({type:"add",path:[...n,s],value:l})}),r.detectDeletions&&e.forEach((l,s)=>{let f=this.stringify(l);c.has(f)||i.push({type:"delete",path:[...n,s],oldValue:l})})}stringify(e){try{return JSON.stringify(e)}catch{return String(e)}}};var W=class{value=null;children=new Map},G=class{root=new W;pathCache=new Map;stats={hits:0,misses:0,sets:0,cleanups:0};set(e,o){let n=this.pathToString(e),i=new WeakRef(o),r=this.root;for(let a of e){let c=String(a);r.children.has(c)||r.children.set(c,new W);let l=r.children.get(c);if(!l)throw new Error(`Failed to get node for key: ${c}`);r=l}r.value=i,this.pathCache.set(n,i),this.stats.sets++}get(e){let o=this.pathToString(e),n=this.pathCache.get(o);if(n){let r=n.deref();if(r)return this.stats.hits++,r;this.pathCache.delete(o),this.stats.cleanups++}let i=this.root;for(let r of e){let a=String(r);if(i=i.children.get(a),!i)return this.stats.misses++,null}if(i.value){let r=i.value.deref();if(r)return this.pathCache.set(o,i.value),this.stats.hits++,r;i.value=null,this.stats.cleanups++}return this.stats.misses++,null}has(e){return this.get(e)!==null}getByPrefix(e){let o=new Map,n=this.root;for(let i of e){let r=String(i);if(n=n.children.get(r),!n)return o}return this.collectDescendants(n,[],o),o}delete(e){let o=this.pathToString(e);this.pathCache.delete(o);let n=this.root,i=[n];for(let a of e){let c=String(a);if(n=n.children.get(c),!n)return!1;i.push(n)}let r=n.value!==null;n.value=null;for(let a=i.length-1;a>0;a--){let c=i[a];if(c.value===null&&c.children.size===0){let l=i[a-1],s=e[a-1];l.children.delete(String(s))}else break}return r}clear(){this.root=new W,this.pathCache.clear()}getStats(){let e=this.stats.hits+this.stats.misses,o=e>0?this.stats.hits/e:0;return P(m({},this.stats),{hitRate:o,cacheSize:this.pathCache.size})}buildFromTree(e,o=[]){if(e){if(b(e)){this.set(o,e);return}if(typeof e=="object")for(let[n,i]of Object.entries(e))this.buildFromTree(i,[...o,n])}}pathToString(e){return e.join(".")}collectDescendants(e,o,n){if(e.value){let i=e.value.deref();i&&n.set(this.pathToString(o),i)}for(let[i,r]of e.children)this.collectDescendants(r,[...o,i],n)}};var Y=class{pathIndex;diffEngine;constructor(e){this.pathIndex=new G,this.diffEngine=new K,this.pathIndex.buildFromTree(e)}update(e,o,n={}){let i=performance.now(),r={};n.maxDepth!==void 0&&(r.maxDepth=n.maxDepth),n.ignoreArrayOrder!==void 0&&(r.ignoreArrayOrder=n.ignoreArrayOrder),n.equalityFn!==void 0&&(r.equalityFn=n.equalityFn);let a=this.diffEngine.diff(e,o,r);if(a.changes.length===0)return{changed:!1,duration:performance.now()-i,changedPaths:[]};let c=this.createPatches(a.changes),l=this.sortPatches(c),s=n.batch?this.batchApplyPatches(e,l,n.batchSize):this.applyPatches(e,l);return{changed:!0,duration:performance.now()-i,changedPaths:s.appliedPaths,stats:{totalPaths:a.changes.length,optimizedPaths:c.length,batchedUpdates:s.batchCount}}}rebuildIndex(e){this.pathIndex.clear(),this.pathIndex.buildFromTree(e)}getIndexStats(){return this.pathIndex.getStats()}createPatches(e){let o=[],n=new Set;for(let i of e){let r=i.path.join("."),a=!1;for(let l of n)if(r.startsWith(l+".")){a=!0;break}if(a)continue;let c=this.createPatch(i);o.push(c),n.add(r),i.type==="replace"&&typeof i.value=="object"&&n.add(r)}return o}createPatch(e){return{type:e.type,path:e.path,value:e.value,oldValue:e.oldValue,priority:this.calculatePriority(e),signal:this.pathIndex.get(e.path)}}calculatePriority(e){let o=0;return o+=(10-e.path.length)*10,e.path.some(n=>typeof n=="number")&&(o-=20),e.type==="replace"&&(o+=30),o}sortPatches(e){return e.sort((o,n)=>o.priority!==n.priority?n.priority-o.priority:o.path.length-n.path.length)}applyPatches(e,o){let n=[],i=0;for(let r of o)this.applyPatch(r,e)&&(n.push(r.path.join(".")),i++);return{appliedPaths:n,updateCount:i,batchCount:1}}batchApplyPatches(e,o,n=50){let i=[];for(let c=0;c<o.length;c+=n)i.push(o.slice(c,c+n));let r=[],a=0;for(let c of i)for(let l of c)this.applyPatch(l,e)&&(r.push(l.path.join(".")),a++);return{appliedPaths:r,updateCount:a,batchCount:i.length}}applyPatch(e,o){try{if(e.signal&&b(e.signal)&&"set"in e.signal){let r=e.signal();return this.isEqual(r,e.value)?!1:(e.signal.set(e.value),e.type==="add"&&e.value!==void 0&&this.pathIndex.set(e.path,e.signal),!0)}let n=o;for(let r=0;r<e.path.length-1;r++){let a=e.path[r];if(n=n[a],!n||typeof n!="object")return!1}let i=e.path[e.path.length-1];return this.isEqual(n[i],e.value)?!1:(n[i]=e.value,!0)}catch(n){return console.error(`Failed to apply patch at ${e.path.join(".")}:`,n),!1}}isEqual(e,o){if(e===o)return!0;if(typeof e!=typeof o||typeof e!="object"||e===null||o===null)return!1;try{return JSON.stringify(e)===JSON.stringify(o)}catch{return!1}}};var Be=["__proto__","constructor","prototype"],je=/<[^>]*>/g,ie=[/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,/on\w+\s*=/gi,/javascript:/gi,/<iframe\b/gi,/<object\b/gi,/<embed\b/gi],Z=class{config;dangerousKeys;constructor(e={}){this.config={preventPrototypePollution:e.preventPrototypePollution??!0,preventXSS:e.preventXSS??!1,preventFunctions:e.preventFunctions??!0,customDangerousKeys:e.customDangerousKeys??[],onSecurityEvent:e.onSecurityEvent??(()=>{}),sanitizationMode:e.sanitizationMode??"strict"},this.dangerousKeys=new Set([...Be,...this.config.customDangerousKeys])}validateKey(e){if(this.config.preventPrototypePollution&&this.dangerousKeys.has(e)){let o={type:"dangerous-key-blocked",key:e,reason:`Dangerous key "${e}" blocked to prevent prototype pollution`,timestamp:Date.now()};throw this.config.onSecurityEvent(o),new Error(`[SignalTree Security] Dangerous key "${e}" is not allowed. This key can lead to prototype pollution attacks. Blocked keys: ${Array.from(this.dangerousKeys).join(", ")}`)}}validateValue(e){if(this.config.preventFunctions&&typeof e=="function"){let n={type:"function-value-blocked",value:e,reason:"Function values are not allowed - state must be serializable",timestamp:Date.now()};throw this.config.onSecurityEvent(n),new Error(`[SignalTree Security] Function values are not allowed in state trees. Functions cannot be serialized, breaking features like time-travel, persistence, debugging, and SSR. 

To fix this:
  - Store function references outside the tree
  - Use method names (strings) and a function registry
  - Use computed signals for derived values

Blocked value: ${e.toString().substring(0,100)}...`)}if(!this.config.preventXSS||typeof e!="string")return e;let o=!1;for(let n of ie)if(n.lastIndex=0,n.test(e)){o=!0;break}if(o){let n={type:"xss-attempt-blocked",value:e,reason:"Dangerous HTML pattern detected and sanitized",timestamp:Date.now()};return this.config.onSecurityEvent(n),this.sanitize(e)}return this.sanitize(e)}sanitize(e){if(this.config.sanitizationMode==="strict"){let o=e;for(let n of ie)n.lastIndex=0,o=o.replace(n,"");return o.replace(je,"")}else{let o=e;for(let n of ie)n.lastIndex=0,o=o.replace(n,"");return o}}validateKeyValue(e,o){return this.validateKey(e),this.validateValue(o)}isDangerousKey(e){return this.dangerousKeys.has(e)}getConfig(){return m({},this.config)}};var We=Symbol.for("NodeAccessor");function M(t){return typeof t=="function"&&t&&We in t}function be(t){return b(t)||M(t)}function Ee(...t){return e=>t.reduce((o,n)=>n(o),e)}function ae(t,e,o="",n){let i=new Map,r=new Map,a=new Map,c=()=>{a.forEach(s=>{try{s()}catch(f){console.warn("Error during nested cleanup:",f)}}),a.clear(),i.clear(),r.clear(),n&&n.dispose()};return new Proxy(t,{get(s,f){if(f==="__cleanup__")return c;if(typeof f=="symbol"||f==="valueOf"||f==="toString")return s[f];let h=f,u=o?`${o}.${h}`:h;if(!(h in s))return;let d=s[h];if(b(d))return d;if(n){let g=n.getSignal(u);if(g)return g}if(i.has(u))return i.get(u);if(r.has(u))return r.get(u);if(d&&typeof d=="object"&&!Array.isArray(d)&&!b(d)&&!A(d))try{let g=ae(d,e,u,n);r.set(u,g);let p=g;return typeof p.__cleanup__=="function"&&a.set(u,p.__cleanup__),g}catch(g){console.warn(`Failed to create lazy proxy for path "${u}":`,g);let p=k(d,{equal:e});return i.set(u,p),n&&n.cacheSignal(u,p),p}try{let g=k(d,{equal:e});return i.set(u,g),n&&n.cacheSignal(u,g),g}catch(g){return console.warn(`Failed to create signal for path "${u}":`,g),d}},set(s,f,h){if(typeof f=="symbol")return s[f]=h,!0;let u=f,d=o?`${o}.${u}`:u;try{s[u]=h;let g=i.get(d);if(g&&"set"in g&&g.set(h),r.has(d)){let p=a.get(d);p&&(p(),a.delete(d)),r.delete(d)}return!0}catch(g){return console.warn(`Failed to set value for path "${d}":`,g),!1}},has(s,f){return f in s},ownKeys(s){return Reflect.ownKeys(s)},getOwnPropertyDescriptor(s,f){return Reflect.getOwnPropertyDescriptor(s,f)}})}function C(t){if(t==null)return t;if(M(t)){let n={};for(let i in t){if(!Object.prototype.hasOwnProperty.call(t,i)||i==="length"||i==="prototype")continue;if(i==="name"){let a=t[i];if(!b(a)&&!M(a))continue}let r=t[i];if(M(r))n[i]=C(r);else if(b(r)){let a=r();typeof a=="object"&&a!==null&&!Array.isArray(a)&&!A(a)?n[i]=C(a):n[i]=a}else typeof r=="object"&&r!==null&&!Array.isArray(r)&&!A(r)?n[i]=C(r):n[i]=r}return n}if(b(t)){let n=t();return typeof n=="object"&&n!==null&&!Array.isArray(n)&&!A(n)?C(n):n}if(typeof t!="object"||Array.isArray(t)||A(t))return t;let e={};for(let n in t){if(!Object.prototype.hasOwnProperty.call(t,n)||(n==="set"||n==="update")&&typeof t[n]=="function")continue;let i=t[n];if(M(i)){let r=i();typeof r=="object"&&r!==null&&!Array.isArray(r)&&!A(r)?e[n]=C(r):e[n]=r}else if(b(i)){let r=i();typeof r=="object"&&r!==null&&!Array.isArray(r)&&!A(r)?e[n]=C(r):e[n]=r}else typeof i=="object"&&i!==null&&!Array.isArray(i)&&!A(i)?e[n]=C(i):e[n]=i}let o=Object.getOwnPropertySymbols(t);for(let n of o){let i=t[n];if(M(i)){let r=i();typeof r=="object"&&r!==null&&!Array.isArray(r)&&!A(r)?e[n]=C(r):e[n]=r}else if(b(i)){let r=i();typeof r=="object"&&r!==null&&!Array.isArray(r)&&!A(r)?e[n]=C(r):e[n]=r}else typeof i=="object"&&i!==null&&!Array.isArray(i)&&!A(i)?e[n]=C(i):e[n]=i}return e}var J=Symbol.for("NodeAccessor");function Ve(){let t=function(e){if(arguments.length===0)return C(t);if(typeof e=="function"){let o=e,n=C(t),i=o(n);V(t,i)}else V(t,e)};return t[J]=!0,t}function Fe(t,e){let o=function(n){if(arguments.length===0)return t();if(typeof n=="function"){let i=n;e.set(i(t()))}else e.set(n)};return o[J]=!0,o}function V(t,e){if(!e||typeof e!="object")return;let o;if(ke(t))o=t;else if(t&&typeof t=="object")o=t;else return;let n=e;for(let i in n){if(!(i in o))continue;let r=o[i],a=n[i];b(r)?"set"in r&&typeof r.set=="function"&&r.set(a):ke(r)&&(a&&typeof a=="object"?V(r,a):r(a))}}function ke(t){return typeof t=="function"&&t&&t[J]===!0}function X(t,e=j.ESTIMATE_MAX_DEPTH,o=0){if(o>=e)return 1;if(t==null)return 0;if(typeof t!="object")return 1;let n=0;try{if(Array.isArray(t)){n=t.length;let i=Math.min(j.ESTIMATE_SAMPLE_SIZE_ARRAY,t.length);for(let r=0;r<i;r++)n+=X(t[r],e,o+1)*.1}else{let i=Object.keys(t);n=i.length;let r=Math.min(j.ESTIMATE_SAMPLE_SIZE_OBJECT,i.length);for(let a=0;a<r;a++){let c=t[i[a]];n+=X(c,e,o+1)*.5}}}catch{return 1}return Math.floor(n)}function Ce(t,e,o){return e.useLazySignals!==void 0?e.useLazySignals:e.debugMode||e.enableDevTools?!1:e.batchUpdates&&e.useMemoization?!0:(o??X(t))>j.LAZY_THRESHOLD}function He(t,e,o=[]){if(!e.security)return;let n=new Z(e.security);function i(r,a){if(r==null)return;if(typeof r!="object"){n.validateValue(r);return}if(A(r))return;if(Array.isArray(r)){r.forEach((s,f)=>{i(s,[...a,String(f)])});return}let c=[...Object.keys(r),...Object.getOwnPropertyNames(r)],l=[...new Set(c)];for(let s of l){if(typeof s=="symbol")continue;try{n.validateKey(s)}catch(h){let u=h;throw new Error(`${u.message}
Path: ${[...a,s].join(".")}`)}let f=r[s];try{n.validateValue(f)}catch(h){let u=h;throw new Error(`${u.message}
Path: ${[...a,s].join(".")}`)}i(f,[...a,s])}}i(t,o)}function $e(t){return t?Object.is:v}function ce(t,e){if(t==null||typeof t!="object")return k(t,{equal:e});if(Array.isArray(t))return k(t,{equal:e});if(A(t))return k(t,{equal:e});let o={},n=new WeakSet;if(n.has(t))return console.warn(w.CIRCULAR_REF),k(t,{equal:e});n.add(t);try{for(let[r,a]of Object.entries(t))try{if(typeof r=="symbol")continue;if(b(a)){o[r]=a;continue}if(a==null)o[r]=k(a,{equal:e});else if(typeof a!="object")o[r]=k(a,{equal:e});else if(Array.isArray(a)||A(a))o[r]=k(a,{equal:e});else{let c=ce(a,e),l=Ve();for(let s in c)if(Object.prototype.hasOwnProperty.call(c,s))try{Object.defineProperty(l,s,{value:c[s],enumerable:!0,configurable:!0})}catch{}o[r]=l}}catch(c){console.warn(`${w.SIGNAL_CREATION_FAILED} "${r}":`,c),o[r]=k(a,{equal:e})}let i=Object.getOwnPropertySymbols(t);for(let r of i){let a=t[r];try{b(a)?o[r]=a:o[r]=k(a,{equal:e})}catch(c){console.warn(w.SIGNAL_CREATION_FAILED,c)}}}catch(i){throw new Error(`Failed to create signal store: ${i instanceof Error?i.message:"Unknown error"}`)}return o}function Ae(t,e={}){let o=e.useLazySignals??Ce(t.state,e);return t.with=((...n)=>{if(n.length===0)return t;let i=new Set;e.batchUpdates&&i.add("batchUpdate"),e.useMemoization&&i.add("memoize"),e.enableTimeTravel&&i.add("undo"),e.enableDevTools&&i.add("connectDevTools");try{for(let s of Object.keys(t))i.add(String(s))}catch{}let r=n.some(s=>!!(s.metadata&&(s.metadata.requires||s.metadata.provides))),a=n;if(r)try{a=we(n,i,e.debugMode)}catch(s){console.warn(w.ENHANCER_ORDER_FAILED,s)}let c=new Set(i),l=t;for(let s=0;s<a.length;s++){let f=a[s];if(typeof f!="function")throw new Error(w.ENHANCER_NOT_FUNCTION.replace("%d",String(s)));let h=f.metadata?.requires??[];for(let u of h)if(!(u in l)&&!c.has(u)){let d=f.metadata?.name??`enhancer#${s}`,g=w.ENHANCER_REQUIREMENT_MISSING.replace("%s",d).replace("%s",u);if(e.debugMode)throw new Error(g);console.warn(g)}try{let u=f(l);u!==l&&(l=u);let d=f.metadata?.provides??[];for(let g of d)c.add(g);if(e.debugMode&&d.length>0)for(let g of d)g in l||console.warn(w.ENHANCER_PROVIDES_MISSING.replace("%s",f.metadata?.name??String(s)).replace("%s",g))}catch(u){let d=f.metadata?.name||`enhancer at index ${s}`;throw console.error(w.ENHANCER_FAILED.replace("%s",d),u),e.debugMode&&(console.error("[SignalTree] Enhancer stack trace:",f),console.error("[SignalTree] Tree state at failure:",l)),u}}return l}),t.destroy=()=>{try{if(o){let n=t.state;if(n&&typeof n=="object"&&"__cleanup__"in n){let i=n.__cleanup__;typeof i=="function"&&i()}}e.debugMode&&console.log(w.TREE_DESTROYED)}catch(n){console.error(w.CLEANUP_ERROR,n)}},qe(t,e),t}function qe(t,e){t.batchUpdate=n=>{console.warn(w.BATCH_NOT_ENABLED),t(i=>{let r=n(i);return m(m({},i),r)})},t.memoize=(n,i)=>(console.warn(w.MEMOIZE_NOT_ENABLED),O(()=>n(t()))),t.memoizedUpdate=n=>{e.debugMode&&console.warn(w.MEMOIZE_NOT_ENABLED),t(i=>m(m({},i),n(i)))},t.clearMemoCache=()=>{e.debugMode&&console.warn(w.MEMOIZE_NOT_ENABLED)},t.getCacheStats=()=>({size:0,hitRate:0,totalHits:0,totalMisses:0,keys:[]}),t.effect=n=>{try{re(()=>n(t()))}catch(i){e.debugMode&&console.warn(w.EFFECT_NO_CONTEXT,i)}},t.subscribe=n=>{try{let i=he(Te),r=!1,a=re(()=>{r||n(t())}),c=()=>{r=!0,a.destroy()};return i.onDestroy(c),c}catch(i){return e.debugMode&&console.warn(w.SUBSCRIBE_NO_CONTEXT,i),n(t()),()=>{}}},t.optimize=()=>{e.debugMode&&console.warn(w.OPTIMIZE_NOT_AVAILABLE)},t.clearCache=()=>{e.debugMode&&console.warn(w.CACHE_NOT_AVAILABLE)},t.invalidatePattern=()=>(e.debugMode&&console.warn(w.PERFORMANCE_NOT_ENABLED),0);let o=t;o.updateEngine||(o.updateEngine=new Y(t)),t.updateOptimized=(n,i={})=>{let a=t.updateEngine;return a?a.update(t(),n,i):(e.debugMode&&console.warn(w.UPDATE_OPTIMIZED_NOT_AVAILABLE),t(c=>m(m({},c),n)),{changed:!0,duration:0,changedPaths:Object.keys(n),stats:void 0})},t.getMetrics=()=>({updates:0,computations:0,cacheHits:0,cacheMisses:0,averageUpdateTime:0}),t.addTap=n=>{e.debugMode&&console.warn(w.MIDDLEWARE_NOT_AVAILABLE)},t.removeTap=n=>{e.debugMode&&console.warn(w.MIDDLEWARE_NOT_AVAILABLE)},t.entities=()=>(e.debugMode&&console.warn(w.ENTITY_HELPERS_NOT_AVAILABLE),{}),t.asyncAction=(n,i={})=>(e.debugMode&&console.warn(w.ASYNC_ACTIONS_NOT_AVAILABLE),{}),t.undo=()=>{e.debugMode&&console.warn(w.TIME_TRAVEL_NOT_AVAILABLE)},t.redo=()=>{e.debugMode&&console.warn(w.TIME_TRAVEL_NOT_AVAILABLE)},t.getHistory=()=>(e.debugMode&&console.warn(w.TIME_TRAVEL_NOT_AVAILABLE),[]),t.resetHistory=()=>{e.debugMode&&console.warn(w.TIME_TRAVEL_NOT_AVAILABLE)}}function se(t,e={}){if(t==null)throw new Error(w.NULL_OR_UNDEFINED);He(t,e);let o=X(t),n=$e(e.useShallowComparison??!1);if(Array.isArray(t)){let l=k(t,{equal:n}),s=Fe(l,l);return Object.defineProperty(s,"state",{value:l,enumerable:!1}),Object.defineProperty(s,"$",{value:l,enumerable:!1}),Ae(s,e),s}let i=Ce(t,e,o);e.debugMode&&console.log(w.STRATEGY_SELECTION.replace("%s",i?"lazy":"eager").replace("%d",String(o)));let r,a;try{i&&typeof t=="object"?(a=new q,r=ae(t,n,"",a)):r=ce(t,n)}catch(l){if(i)console.warn(w.LAZY_FALLBACK,l),r=ce(t,n),a=void 0;else throw l}let c=function(l){if(arguments.length===0)return C(r);if(typeof l=="function"){let s=l,f=C(r),h=s(f);V(r,h)}else V(r,l)};Object.defineProperty(c,J,{value:!0,enumerable:!1}),Object.defineProperty(c,"state",{value:r,enumerable:!1}),Object.defineProperty(c,"$",{value:r,enumerable:!1}),a&&Object.defineProperty(c,"dispose",{value:()=>{a?.dispose();let l=r.__cleanup__;typeof l=="function"&&l()},enumerable:!1,writable:!1}),Ae(c,e);for(let l in r)if(Object.prototype.hasOwnProperty.call(r,l)&&!(l in c))try{Object.defineProperty(c,l,{value:r[l],enumerable:!0,configurable:!0})}catch{}return c}var Ke={basic:{useLazySignals:!1,debugMode:!1},performance:{useLazySignals:!0,batchUpdates:!0,useMemoization:!0,useShallowComparison:!0},development:{useLazySignals:!1,debugMode:!0,enableDevTools:!0,trackPerformance:!0},production:{useLazySignals:!0,batchUpdates:!0,useMemoization:!0,debugMode:!1}};function Ge(t,e){if(typeof e=="string"){let n=Ke[e];return n?se(t,n):(console.warn(w.PRESET_UNKNOWN.replace("%s",e)),se(t,{}))}return se(t,e||{})}var R=[],Q=!1,L,U={};function Ye(t,e=U){let o=e.maxBatchSize??100;return t.path&&(R=R.filter(n=>n.path!==t.path)),R.push(t),R.length>o?(ee(),!0):(Ze(e),!1)}function Ze(t){L!==void 0&&clearTimeout(L);let e=t.autoFlushDelay??16;L=setTimeout(()=>{ee()},e)}function ee(){if(Q)return;let t;do{if(R.length===0)return;Q=!0,t=R,R=[],L!==void 0&&(clearTimeout(L),L=void 0),t.sort((e,o)=>(o.depth??0)-(e.depth??0));try{t.forEach(({fn:e})=>e())}finally{Q=!1}}while(R.length>0)}function Me(t,e){let o=performance.now(),n=e?oe(e).length:0;Ye({fn:t,startTime:o,depth:n,path:e},U)||(U.batchTimeoutMs&&R.length>0&&o-R[0].startTime>=U.batchTimeoutMs?ee():!Q&&R.length>0&&queueMicrotask(()=>{ee()}))}function te(t={}){let{enabled:e=!0}=t;return U=m(m({},U),t),o=>{if(!e)return o;let n=o.bind(o),i=function(...r){if(r.length===0)return n();Me(()=>{if(r.length===1){let a=r[0];n(a)}})};return Object.setPrototypeOf(i,Object.getPrototypeOf(o)),Object.assign(i,o),"state"in o&&Object.defineProperty(i,"state",{value:o.state,enumerable:!1,configurable:!0}),"$"in o&&Object.defineProperty(i,"$",{value:o.$,enumerable:!1,configurable:!0}),i.batchUpdate=r=>{Me(()=>{let a=n(),c=r(a);Object.entries(c).forEach(([l,s])=>{let f=i.state[l];f&&"set"in f?f.set(s):M(f)&&f(s)})})},i}}function le(){return te({enabled:!0,maxBatchSize:200,batchTimeoutMs:0})}var fn=300*1e3,Xe=new Map;function Je(t,e){if(e){let n=new z(t),i=new Map,r=()=>{for(;i.size>n.size();){let a=i.keys().next().value;if(a===void 0)break;i.delete(a)}};return{get:a=>{let c=n.get(a);return c!==void 0?i.set(a,c):i.has(a)&&i.delete(a),c},set:(a,c)=>{n.set(a,c),i.set(a,c),r()},delete:a=>{n.delete(a),i.delete(a)},clear:()=>{n.clear(),i.clear()},size:()=>i.size,forEach:a=>{i.forEach((c,l)=>a(c,l))},keys:()=>i.keys()}}let o=new Map;return{get:n=>o.get(n),set:(n,i)=>{o.set(n,i)},delete:n=>o.delete(n),clear:()=>o.clear(),size:()=>o.size,forEach:n=>{o.forEach((i,r)=>n(i,r))},keys:()=>o.keys()}}function ve(t){return t._memoCleanupInterval}function Re(t,e){if(e===void 0){delete t._memoCleanupInterval;return}t._memoCleanupInterval=e}function Qe(t){let e=ve(t);if(e){try{clearInterval(e)}catch{}Re(t)}}function et(t,e){if(t===e)return!0;if(t==null||e==null||typeof t!=typeof e)return!1;if(typeof t=="object"&&typeof e=="object"){let o=t,n=e,i=0;for(let a in o)if(Object.prototype.hasOwnProperty.call(o,a)&&(i++,!(a in n)||o[a]!==n[a]))return!1;let r=0;for(let a in n)Object.prototype.hasOwnProperty.call(n,a)&&r++;return i===r}return!1}function tt(t,e){try{return`${t.name||"anonymous"}_${JSON.stringify(e)}`}catch{return`${t.name||"anonymous"}_${e.length}`}}function nt(t){switch(t){case"shallow":return et;case"reference":return(e,o)=>e===o;case"deep":default:return v}}var Pe={selector:{equality:"reference",maxCacheSize:10,enableLRU:!1,ttl:void 0},computed:{equality:"shallow",maxCacheSize:100,enableLRU:!1,ttl:void 0},deepState:{equality:"deep",maxCacheSize:1e3,enableLRU:!0,ttl:300*1e3},highFrequency:{equality:"reference",maxCacheSize:5,enableLRU:!1,ttl:void 0}};function rt(){return I(Pe.selector)}function ot(){return I(Pe.computed)}function I(t={}){let{enabled:e=!0,maxCacheSize:o=1e3,ttl:n,equality:i="deep",enableLRU:r=!0}=t;return a=>{let c=a.bind(a),l=u=>{Object.entries(u).forEach(([d,g])=>{let p=a.state[d];p&&"set"in p?p.set(g):M(p)&&p(g)})};if(!e){let u=a;return u.memoizedUpdate=d=>{let g=c(),p=d(g);l(p)},u.clearMemoCache=()=>{},u.getCacheStats=()=>({size:0,hitRate:0,totalHits:0,totalMisses:0,keys:[]}),u}let s=Je(o,r);Xe.set(a,s);let f=nt(i);if(a.memoizedUpdate=(u,d)=>{let g=c(),p=d||tt(u,[g]),T=s.get(p);if(T&&f(T.deps,[g])){let E=T.value;l(E);return}let S=u(g);s.set(p,{value:S,deps:[g],timestamp:Date.now(),hitCount:1}),l(S)},a.clearMemoCache=u=>{u?s.delete(u):s.clear()},a.getCacheStats=()=>{let u=0,d=0;s.forEach(p=>{u+=p.hitCount||0,d+=Math.floor((p.hitCount||0)/2)});let g=u+d>0?u/(u+d):0;return{size:s.size(),hitRate:g,totalHits:u,totalMisses:d,keys:Array.from(s.keys())}},ve(a)){let u=a.clearMemoCache.bind(a);a.clearMemoCache=d=>{u(d),Qe(a)}}if(n){let d=setInterval(()=>{let g=Date.now();s.forEach((p,T)=>{p.timestamp&&g-p.timestamp>n&&s.delete(T)})},n);Re(a,d)}return a}}function ue(){return I({enabled:!0,maxCacheSize:1e4,ttl:3e5,equality:"shallow",enableLRU:!0})}function it(){return I({enabled:!0,maxCacheSize:100,ttl:void 0,equality:"reference",enableLRU:!1})}function at(){return I({enabled:!0,maxCacheSize:1e3,ttl:6e4,equality:"shallow",enableLRU:!0})}var fe=class{constructor(e,o={},n){this.tree=e;this.config=o;this.restoreStateFn=n;this.maxHistorySize=o.maxHistorySize??50,this.includePayload=o.includePayload??!0,this.actionNames=m({update:"UPDATE",set:"SET",batch:"BATCH"},o.actionNames),this.addEntry("INIT",this.tree())}history=[];currentIndex=-1;maxHistorySize;includePayload;actionNames;addEntry(e,o,n){this.currentIndex<this.history.length-1&&(this.history=this.history.slice(0,this.currentIndex+1));let i=m({state:$(o),timestamp:Date.now(),action:this.actionNames[e]||e},this.includePayload&&n!==void 0&&{payload:n});this.history.push(i),this.currentIndex=this.history.length-1,this.history.length>this.maxHistorySize&&(this.history.shift(),this.currentIndex--)}undo(){if(!this.canUndo())return!1;this.currentIndex--;let e=this.history[this.currentIndex];return this.restoreState(e.state),!0}redo(){if(!this.canRedo())return!1;this.currentIndex++;let e=this.history[this.currentIndex];return this.restoreState(e.state),!0}getHistory(){return this.history.map(e=>P(m({},e),{state:$(e.state)}))}resetHistory(){let e=this.tree();this.history=[],this.currentIndex=-1,this.addEntry("RESET",e)}jumpTo(e){if(e<0||e>=this.history.length)return!1;this.currentIndex=e;let o=this.history[e];return this.restoreState(o.state),!0}getCurrentIndex(){return this.currentIndex}canUndo(){return this.currentIndex>0}canRedo(){return this.currentIndex<this.history.length-1}restoreState(e){this.restoreStateFn?this.restoreStateFn(e):this.tree(e)}};function de(t={}){return e=>{let o=e.bind(e),n=!1,i=new fe(e,t,a=>{n=!0;try{o(a)}finally{n=!1}}),r=function(...a){if(a.length===0)return o();{if(n){if(a.length===1){let h=a[0];return o(h)}return}let c=o(),l;if(a.length===1){let h=a[0];l=o(h)}let s=o();return v(c,s)||i.addEntry("update",s),l}};return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),Object.assign(r,e),"state"in e&&Object.defineProperty(r,"state",{value:e.state,enumerable:!1,configurable:!0}),"$"in e&&Object.defineProperty(r,"$",{value:e.$,enumerable:!1,configurable:!0}),r.undo=()=>{i.undo()},r.redo=()=>{i.redo()},r.getHistory=()=>i.getHistory(),r.resetHistory=()=>{i.resetHistory()},r.jumpTo=a=>{i.jumpTo(a)},r.canUndo=()=>i.canUndo(),r.canRedo=()=>i.canRedo(),r.getCurrentIndex=()=>i.getCurrentIndex(),Object.assign(r,{__timeTravel:i})}}function st(t,e){let o=()=>{let i=t.state[e];if(!i)throw new Error(`Entity key '${String(e)}' does not exist in the state`);if(!be(i))throw new Error(`Entity key '${String(e)}' is not a signal. This should not happen with SignalTree.`);let r=i,a=r();if(!Array.isArray(a))throw new Error(`Entity key '${String(e)}' does not contain an array. Current type: ${typeof a}`);return r},n=(i,r)=>{M(i)?i(r):i.set(r)};return{add:i=>{let r=o(),a=r();if(a.some(c=>c.id===i.id))throw new Error(`Entity with id '${i.id}' already exists`);n(r,[...a,i])},update:(i,r)=>{let a=o(),l=a().map(s=>s.id===i?m(m({},s),r):s);n(a,l)},remove:i=>{let r=o(),c=r().filter(l=>l.id!==i);n(r,c)},upsert:i=>{let r=o(),a=r(),c=a.findIndex(l=>l.id===i.id);if(c>=0){let l=[...a];l[c]=i,n(r,l)}else n(r,[...a,i])},selectById:i=>{let r=o();return O(()=>r().find(a=>a.id===i))},selectBy:i=>{let r=o();return O(()=>r().filter(i))},selectIds:()=>{let i=o();return O(()=>i().map(r=>r.id))},selectAll:()=>o(),selectTotal:()=>{let i=o();return O(()=>i().length)},clear:()=>{let i=o();n(i,[])}}}function ct(t={}){let{enabled:e=!0}=t;return function(n){return e?Object.assign(n,{entities(r){return st(n,r)}}):n}}var N=new WeakMap;function ge(t=[]){return e=>{N.set(e,[...t]);let o=e.bind(e),n=function(...a){if(a.length===0)return o();{let c="UPDATE",l=o(),s=N.get(e)||[],f;if(a.length===1){let d=a[0];typeof d=="function"?f=d(l):f=d}else return;for(let d of s)if(d.before&&!d.before(c,f,l))return;let h=l;if(a.length===1){let d=a[0];o(d)}let u=o();for(let d of s)d.after&&d.after(c,f,h,u)}};Object.setPrototypeOf(n,Object.getPrototypeOf(e)),Object.assign(n,e),"state"in e&&Object.defineProperty(n,"state",{value:e.state,enumerable:!1,configurable:!0}),"$"in e&&Object.defineProperty(n,"$",{value:e.$,enumerable:!1,configurable:!0}),n.addTap=a=>{let c=N.get(e)||[],l=c.findIndex(s=>s.id===a.id);l>=0?c[l]=a:c.push(a),N.set(e,c)},n.removeTap=a=>{let l=(N.get(e)||[]).filter(s=>s.id!==a);N.set(e,l)};let i=e.batchUpdate;i&&(n.batchUpdate=a=>{let c="BATCH_UPDATE",l=o(),s=a(l),f=N.get(e)||[];for(let d of f)if(d.before&&!d.before(c,s,l))return;let h=l;i.call(e,a);let u=o();for(let d of f)d.after&&d.after(c,s,h,u)});let r=e.destroy;return n.destroy=()=>{N.delete(e),r&&r.call(e)},n}}function lt(){let t=new Map;return{trackMethodCall:(e,o,n)=>{let i=t.get(e);i?(i.lastActivity=new Date,i.operationCount++,i.averageExecutionTime=(i.averageExecutionTime*(i.operationCount-1)+n)/i.operationCount):t.set(e,{name:e,methods:[o],addedAt:new Date,lastActivity:new Date,operationCount:1,averageExecutionTime:n,errorCount:0})},trackError:(e,o,n)=>{let i=t.get(e);i&&i.errorCount++,console.error(`\u274C [${e}] Error${n?` in ${n}`:""}:`,o)},getModuleActivity:e=>t.get(e),getAllModules:()=>Array.from(t.values())}}function ut(){let t=[],e=(o,n,i)=>{t.push({timestamp:new Date,module:o,type:n,data:i}),t.length>1e3&&t.splice(0,t.length-1e3)};return{logComposition:(o,n)=>{e("core","composition",{modules:o,action:n}),console.log(`\u{1F517} Composition ${n}:`,o.join(" \u2192 "))},logMethodExecution:(o,n,i,r)=>{e(o,"method",{method:n,args:i,result:r}),console.debug(`\u{1F527} [${o}] ${n}`,{args:i,result:r})},logStateChange:(o,n,i,r)=>{e(o,"state",{path:n,oldValue:i,newValue:r}),console.debug(`\u{1F4DD} [${o}] State change at ${n}:`,{from:i,to:r})},logPerformanceWarning:(o,n,i,r)=>{e(o,"performance",{operation:n,duration:i,threshold:r}),console.warn(`\u26A0\uFE0F [${o}] Slow ${n}: ${i.toFixed(2)}ms (threshold: ${r}ms)`)},exportLogs:()=>[...t]}}function ft(){let t=k({totalUpdates:0,moduleUpdates:{},modulePerformance:{},compositionChain:[],signalGrowth:{},memoryDelta:{},moduleCacheStats:{}});return{signal:t.asReadonly(),updateMetrics:e=>{t.update(o=>m(m({},o),e))},trackModuleUpdate:(e,o)=>{t.update(n=>P(m({},n),{totalUpdates:n.totalUpdates+1,moduleUpdates:P(m({},n.moduleUpdates),{[e]:(n.moduleUpdates[e]||0)+1}),modulePerformance:P(m({},n.modulePerformance),{[e]:o})}))}}}function _e(t={}){let{enabled:e=!0,treeName:o="ModularSignalTree",enableBrowserDevTools:n=!0,enableLogging:i=!0,performanceThreshold:r=16}=t;return a=>{if(!e)return Object.assign(a,{__devTools:{activityTracker:{trackMethodCall:()=>{},trackError:()=>{},getModuleActivity:()=>{},getAllModules:()=>[]},logger:{logComposition:()=>{},logMethodExecution:()=>{},logStateChange:()=>{},logPerformanceWarning:()=>{},exportLogs:()=>[]},metrics:k({totalUpdates:0,moduleUpdates:{},modulePerformance:{},compositionChain:[],signalGrowth:{},memoryDelta:{},moduleCacheStats:{}}).asReadonly(),trackComposition:()=>{},startModuleProfiling:()=>"",endModuleProfiling:()=>{},connectDevTools:()=>{},exportDebugSession:()=>({metrics:{totalUpdates:0,moduleUpdates:{},modulePerformance:{},compositionChain:[],signalGrowth:{},memoryDelta:{},moduleCacheStats:{}},modules:[],logs:[],compositionHistory:[]})}});let c=lt(),l=i?ut():{logComposition:()=>{},logMethodExecution:()=>{},logStateChange:()=>{},logPerformanceWarning:()=>{},exportLogs:()=>[]},s=ft(),f=[],h=new Map,u=null;n&&typeof window<"u"&&"__REDUX_DEVTOOLS_EXTENSION__"in window&&(u={send:window.__REDUX_DEVTOOLS_EXTENSION__.connect({name:o,features:{dispatch:!0,jump:!0,skip:!0}}).send});let d=a.bind(a),g=function(...T){if(T.length===0)return d();{let S=performance.now(),E;if(T.length===1){let D=T[0];E=d(D)}let _=performance.now()-S,F=d();return s.trackModuleUpdate("core",_),_>r&&l.logPerformanceWarning("core","update",_,r),u&&u.send("UPDATE",F),E}};Object.setPrototypeOf(g,Object.getPrototypeOf(a)),Object.assign(g,a),"state"in a&&Object.defineProperty(g,"state",{value:a.state,enumerable:!1,configurable:!0}),"$"in a&&Object.defineProperty(g,"$",{value:a.$,enumerable:!1,configurable:!0});let p={activityTracker:c,logger:l,metrics:s.signal,trackComposition:T=>{f.push({timestamp:new Date,chain:[...T]}),s.updateMetrics({compositionChain:T}),l.logComposition(T,"with")},startModuleProfiling:T=>{let S=`${T}_${Date.now()}`;return h.set(S,{module:T,operation:"profile",startTime:performance.now()}),S},endModuleProfiling:T=>{let S=h.get(T);if(S){let E=performance.now()-S.startTime;c.trackMethodCall(S.module,S.operation,E),h.delete(T)}},connectDevTools:T=>{u&&(u.send("@@INIT",d()),console.log(`\u{1F517} Connected to Redux DevTools as "${T}"`))},exportDebugSession:()=>({metrics:s.signal(),modules:c.getAllModules(),logs:l.exportLogs(),compositionHistory:[...f]})};return Object.assign(g,{__devTools:p})}}var pe={basic:{batchUpdates:!1,useMemoization:!1,trackPerformance:!1,enableTimeTravel:!1,enableDevTools:!1,debugMode:!1},performance:{batchUpdates:!0,useMemoization:!0,trackPerformance:!1,enableTimeTravel:!1,enableDevTools:!1,debugMode:!1,useShallowComparison:!0,maxCacheSize:200},development:{batchUpdates:!0,useMemoization:!0,trackPerformance:!0,enableTimeTravel:!0,enableDevTools:!0,debugMode:!0,maxCacheSize:100},production:{batchUpdates:!0,useMemoization:!0,trackPerformance:!1,enableTimeTravel:!1,enableDevTools:!1,debugMode:!1,useShallowComparison:!0,maxCacheSize:200}};function xe(t,e={}){let o=pe[t];return m(m({},o),e)}function dt(){return Object.keys(pe)}function gt(t={}){let e=xe("development",t),o=Ee(te(),le(),I(),ue(),ge(),de(),_e({treeName:e.treeName??"SignalTree Dev"}));return{config:e,enhancer:o}}var y={DATE:"\xA7d",REGEXP:"\xA7r",MAP:"\xA7m",SET:"\xA7s",UNDEFINED:"\xA7u",NAN:"\xA7n",INFINITY:"\xA7i",NEG_INFINITY:"\xA7-i",BIGINT:"\xA7b",SYMBOL:"\xA7y",FUNCTION:"\xA7f",CIRCULAR:"\xA7c"};var Ie={includeMetadata:!0,replacer:void 0,reviver:void 0,preserveTypes:!0,maxDepth:50,handleCircular:!0};function B(t,e=new WeakSet,o=0,n=50,i=!0){if(o>n)return"[Max Depth Exceeded]";if(t===null||typeof t!="object")return i?t===void 0?{[y.UNDEFINED]:!0}:typeof t=="number"?Number.isNaN(t)?{[y.NAN]:!0}:t===1/0?{[y.INFINITY]:!0}:t===-1/0?{[y.NEG_INFINITY]:!0}:t:typeof t=="bigint"?{[y.BIGINT]:String(t)}:typeof t=="symbol"?{[y.SYMBOL]:String(t)}:t:t;if(typeof t=="function")try{let r=t();return B(r,e,o+1,n,i)}catch{return"[Function]"}if(e.has(t))return"[Circular Reference]";if(b(t))return t();if(i){if(t instanceof Date)return{[y.DATE]:t.toISOString()};if(t instanceof RegExp)return{[y.REGEXP]:{source:t.source,flags:t.flags}};if(t instanceof Map)return{[y.MAP]:Array.from(t.entries())};if(t instanceof Set)return{[y.SET]:Array.from(t.values())}}else if(t instanceof Date||t instanceof RegExp)return t;e.add(t);try{if(Array.isArray(t)){let a=t.map(c=>B(c,e,o+1,n,i));return e.delete(t),a}let r={};for(let[a,c]of Object.entries(t))if(!((a==="set"||a==="update")&&typeof c=="function"&&!b(c)))if(b(c))r[a]=B(c(),e,o+1,n,i);else if(typeof c=="function"&&a!=="set"&&a!=="update")try{let l=c();r[a]=B(l,e,o+1,n,i)}catch{continue}else r[a]=B(c,e,o+1,n,i);return e.delete(t),r}catch{return e.delete(t),"[Serialization Error]"}}function ne(t,e="",o=new WeakSet,n=new Map){let i=[];if(t===null||typeof t!="object")return i;if(o.has(t)){let r=n.get(t)||"";return i.push({path:e,targetPath:r}),i}if(o.add(t),n.set(t,e),Array.isArray(t)){let r=t;for(let a=0;a<r.length;a++){let c=e?`${e}[${a}]`:`[${a}]`,l=ne(r[a],c,o,n);i.push(...l)}}else for(let[r,a]of Object.entries(t)){let c=e?`${e}.${r}`:r,l=ne(a,c,o,n);i.push(...l)}return o.delete(t),i}function pt(t){let e=new WeakSet,o=new Map;return function(i,r){if(t.replacer&&(r=t.replacer.call(this,i,r)),b(r))return r();if(r&&typeof r=="object"){if(e.has(r)){if(t.handleCircular){let c=o.get(r)||"";return{[y.CIRCULAR]:c}}return}e.add(r);let a=i||"";o.set(r,a)}return r}}function Ne(t,e){for(let{path:o,targetPath:n}of e){let i=o.split(/\.|\[|\]/).filter(Boolean),r=n.split(/\.|\[|\]/).filter(Boolean),a=t;for(let l=0;l<i.length-1&&(a=a[i[l]],!!a);l++);let c=t;for(let l of r)if(c=c[l],!c)break;a&&c&&(a[i[i.length-1]]=c)}}function ht(t={}){let e=o=>{let n=o;n.toJSON=()=>o(),n.fromJSON=(r,a)=>{let c=u=>{if(!u||typeof u!="object")return u;if(y.UNDEFINED in u)return;if(y.NAN in u)return NaN;if(y.INFINITY in u)return 1/0;if(y.NEG_INFINITY in u)return-1/0;if(y.BIGINT in u)return BigInt(u[y.BIGINT]);if(y.SYMBOL in u)return Symbol.for(u[y.SYMBOL]);if(y.DATE in u)return new Date(u[y.DATE]);if(y.REGEXP in u){let g=u[y.REGEXP];return new RegExp(g.source,g.flags)}if(y.MAP in u)return new Map(u[y.MAP]);if(y.SET in u)return new Set(u[y.SET]);if(Array.isArray(u))return u.map(c);let d={};for(let[g,p]of Object.entries(u))d[g]=c(p);return d},l=c(r);function s(u,d){let g=o.$;if(u&&g)for(let T of u.split(".")){if(!T)continue;let S=g[T];if(!S||typeof S!="object"&&typeof S!="function"){g=void 0;break}g=S}let p=g?.[d];return b(p)?p:void 0}function f(u,d,g=""){if(!(!u||!d))for(let p in d){if(!Object.prototype.hasOwnProperty.call(d,p))continue;let T=d[p],S=u[p],E=b(S)||typeof S=="function"&&"set"in S&&typeof S.set=="function"?S:s(g,p);if(E){E.set(T);continue}T&&typeof T=="object"&&!Array.isArray(T)&&S&&(typeof S=="object"||typeof S=="function"&&!("set"in S))&&!b(S)&&f(S,T,g?`${g}.${p}`:p)}}let h=a?.nodeMap;if(h&&Object.keys(h).length>0){if(h[""]==="r"){let u=o.$;u&&typeof u.set=="function"&&u.set(l)}for(let[u,d]of Object.entries(h)){if(u===""||d!=="b")continue;let g=u.split(/\.|\[|\]/).filter(Boolean),p=o.$;for(let T of g){if(!p)break;p=p[T]??void 0}if(p&&(b(p)||typeof p=="function"&&"set"in p&&typeof p.set=="function")){let T=l;for(let S of g){if(T==null){T=void 0;break}if(typeof T=="object")T=T[S];else{T=void 0;break}}try{p.set(T)}catch{}}}f(o.state,l);return}f(o.state,l)};function i(r,a){if(!a)return r;if(r===void 0)return{[y.UNDEFINED]:!0};if(typeof r=="number")return Number.isNaN(r)?{[y.NAN]:!0}:r===1/0?{[y.INFINITY]:!0}:r===-1/0?{[y.NEG_INFINITY]:!0}:r;if(typeof r=="bigint")return{[y.BIGINT]:String(r)};if(typeof r=="symbol")return{[y.SYMBOL]:String(r)};if(r instanceof Date)return{[y.DATE]:r.toISOString()};if(r instanceof RegExp)return{[y.REGEXP]:{source:r.source,flags:r.flags}};if(r instanceof Map)return{[y.MAP]:Array.from(r.entries())};if(r instanceof Set)return{[y.SET]:Array.from(r.values())};if(Array.isArray(r))return r.map(c=>i(c,a));if(r&&typeof r=="object"){let c={};for(let[l,s]of Object.entries(r))c[l]=i(s,a);return c}return r}return n.serialize=r=>{let a=m(m(m({},Ie),t),r),c=B(o.state,new WeakSet,0,a.maxDepth,a.preserveTypes),l=i(c,a.preserveTypes),s=a.handleCircular?ne(l):[],f={data:l},h={};try{let g=o.$;g&&typeof g.set=="function"&&(h[""]="r");let p=new WeakSet,T=E=>b(E)||typeof E=="function"&&"set"in E&&typeof E.set=="function",S=(E,_="")=>{if(!E||typeof E!="object"&&typeof E!="function")return;let F=E;if(!p.has(F)){p.add(F),_&&T(E)&&(h[_]="b");for(let[D,Oe]of Object.entries(E)){let De=_?`${_}.${D}`:D;S(Oe,De)}}};g&&S(g)}catch{}a.includeMetadata&&(f.metadata=m(m({timestamp:Date.now(),version:"1.0.0"},s.length>0&&{circularRefs:s}),Object.keys(h).length>0&&{nodeMap:h}));let u=pt(a);return JSON.stringify(f,u,2)},n.deserialize=(r,a)=>{let c=m(m(m({},Ie),t),a);try{let l=JSON.parse(r),{data:s,metadata:f}=l;f?.circularRefs&&c.handleCircular&&Ne(s,f.circularRefs),n.fromJSON(s,f),o.__config?.debugMode&&console.log("[SignalTree] State restored from serialized data",{timestamp:f?.timestamp,version:f?.version})}catch(l){throw console.error("[SignalTree] Failed to deserialize:",l),new Error(`Failed to deserialize SignalTree state: ${l instanceof Error?l.message:"Unknown error"}`)}},n.snapshot=()=>{let r=n.toJSON(),a=ne(r);return{data:JSON.parse(JSON.stringify(r)),metadata:m({timestamp:Date.now(),version:"1.0.0"},a.length>0&&{circularRefs:a})}},n.restore=r=>{let{data:a,metadata:c}=r;c?.circularRefs&&Ne(a,c.circularRefs),n.fromJSON(a,c)},n};return e.metadata={name:"serialization"},e}export{Ge as a,te as b,le as c,rt as d,ot as e,I as f,it as g,at as h,de as i,ct as j,ht as k,ge as l,xe as m,dt as n,gt as o};
