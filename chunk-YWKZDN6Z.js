import{a as T,c as p}from"./chunk-75A3EJSS.js";import{a as f}from"./chunk-IT4IGUIF.js";var a=[],h=!1,s,c={};function S(t,n=c){let e=n.maxBatchSize??100;return t.path&&(a=a.filter(i=>i.path!==t.path)),a.push(t),a.length>e?(d(),!0):(y(n),!1)}function y(t){s!==void 0&&clearTimeout(s);let n=t.autoFlushDelay??16;s=setTimeout(()=>{d()},n)}function d(){if(h)return;let t;do{if(a.length===0)return;h=!0,t=a,a=[],s!==void 0&&(clearTimeout(s),s=void 0),t.sort((n,e)=>(e.depth??0)-(n.depth??0));try{t.forEach(({fn:n})=>n())}finally{h=!1}}while(a.length>0)}function b(t,n){let e=performance.now(),i=n?p(n).length:0;S({fn:t,startTime:e,depth:i,path:n},c)||(c.batchTimeoutMs&&a.length>0&&e-a[0].startTime>=c.batchTimeoutMs?d():!h&&a.length>0&&queueMicrotask(()=>{d()}))}function v(t={}){let{enabled:n=!0}=t;return c=f(f({},c),t),e=>{if(!n)return e;let i=e.bind(e),r=function(...o){if(o.length===0)return i();b(()=>{if(o.length===1){let u=o[0];i(u)}})};return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),Object.assign(r,e),"state"in e&&Object.defineProperty(r,"state",{value:e.state,enumerable:!1,configurable:!0}),"$"in e&&Object.defineProperty(r,"$",{value:e.$,enumerable:!1,configurable:!0}),r.batchUpdate=o=>{b(()=>{let u=i(),m=o(u);Object.entries(m).forEach(([B,g])=>{let l=r.state[B];l&&"set"in l?l.set(g):T(l)&&l(g)})})},r}}function U(){return v({enabled:!0,maxBatchSize:200,batchTimeoutMs:0})}export{v as a,U as b};
