import{b as U,c as k}from"./chunk-YLUDIB2Y.js";import{b as L,c as B,d as R,k as W}from"./chunk-QAZQSZCQ.js";import{a as j,b as z,e as q}from"./chunk-QBPEN4DG.js";import{$a as b,Eb as D,Hb as M,Ib as s,Jb as y,Kb as c,La as C,Na as l,Nb as O,Ob as V,Pb as $,Wb as H,Xa as I,_b as x,a as _,b as T,oa as p,oc as N,pa as u,pb as g,pc as F,qb as o,rb as n,sb as P,vb as w,vc as A,xb as h,zb as f}from"./chunk-STRTG7VY.js";function G(d,i){let e=()=>{let r=d.state[i];if(!r)throw new Error(`Entity key '${String(i)}' does not exist in the state`);if(!z(r))throw new Error(`Entity key '${String(i)}' is not a signal. This should not happen with SignalTree.`);let a=r,m=a();if(!Array.isArray(m))throw new Error(`Entity key '${String(i)}' does not contain an array. Current type: ${typeof m}`);return a},t=(r,a)=>{j(r)?r(a):r.set(a)};return{add:r=>{let a=e(),m=a();if(m.some(v=>v.id===r.id))throw new Error(`Entity with id '${r.id}' already exists`);t(a,[...m,r])},update:(r,a)=>{let m=e(),E=m().map(S=>S.id===r?_(_({},S),a):S);t(m,E)},remove:r=>{let a=e(),v=a().filter(E=>E.id!==r);t(a,v)},upsert:r=>{let a=e(),m=a(),v=m.findIndex(E=>E.id===r.id);if(v>=0){let E=[...m];E[v]=r,t(a,E)}else t(a,[...m,r])},selectById:r=>{let a=e();return x(()=>a().find(m=>m.id===r))},selectBy:r=>{let a=e();return x(()=>a().filter(r))},selectIds:()=>{let r=e();return x(()=>r().map(a=>a.id))},selectAll:()=>e(),selectTotal:()=>{let r=e();return x(()=>r().length)},clear:()=>{let r=e();t(r,[])}}}function Q(d={}){let{enabled:i=!0}=d;return function(t){return i?Object.assign(t,{entities(a){return G(t,a)}}):t}}function J(d,i){if(d&1){let e=w();o(0,"div",32),h("click",function(){let r=p(e).$implicit,a=f();return u(a.selectUser(r.id))})("keyup.enter",function(){let r=p(e).$implicit,a=f();return u(a.selectUser(r.id))})("keyup.space",function(){let r=p(e).$implicit,a=f();return u(a.selectUser(r.id))}),s(1," > "),o(2,"div",33),P(3,"img",34),o(4,"div")(5,"div",35),s(6),n(),o(7,"div",36),s(8),n()()()()}if(d&2){let e=i.$implicit,t=f();M(t.getUserClass(e.id)),l(3),g("src",e.avatar,C)("alt",e.name),l(3),y(e.name),l(2),y(e.email)}}function X(d,i){d&1&&(o(0,"div",37),s(1," No users found "),n())}function Z(d,i){if(d&1&&(o(0,"span",38),s(1),n()),d&2){let e,t=f();l(),c(" by ",(e=t.selectedUser())==null?null:e.name," ")}}function K(d,i){if(d&1&&(o(0,"span",45),s(1),n()),d&2){let e=i.$implicit;l(),c(" ",e," ")}}function ee(d,i){if(d&1&&(o(0,"div",39)(1,"h3",40),s(2),n(),o(3,"p",41),s(4),n(),o(5,"div",42)(6,"span"),s(7),n(),o(8,"span"),s(9),n()(),o(10,"div",43),b(11,K,2,1,"span",44),n()()),d&2){let e,t=i.$implicit,r=f();l(2),y(t.title),l(2),y(t.content),l(3),y(((e=r.getPostAuthor(t.authorId))==null?null:e.name)||"Unknown"),l(2),c("",t.likes," likes"),l(2),g("ngForOf",t.tags)}}function te(d,i){d&1&&(o(0,"div",37),s(1," No posts found "),n())}function ie(d,i){if(d&1&&(o(0,"div")(1,"div")(2,"strong"),s(3,"Name:"),n(),s(4),n(),o(5,"div")(6,"strong"),s(7,"Email:"),n(),s(8),n(),o(9,"div")(10,"strong"),s(11,"Posts:"),n(),s(12),n(),o(13,"div")(14,"strong"),s(15,"Total Likes:"),n(),s(16),n()()),d&2){let e,t,r=f();l(4),c(" ",(e=r.selectedUser())==null?null:e.name),l(4),c(" ",(t=r.selectedUser())==null?null:t.email),l(4),c(" ",r.userPosts().length),l(4),c(" ",r.userTotalLikes()," ")}}function ne(d,i){d&1&&(o(0,"div",46),s(1,"No user selected"),n())}var Y=class d{store=q({users:[],posts:[],selectedUserId:null,searchTerm:""}).with(Q());userHelpers=this.store.entities("users");postHelpers=this.store.entities("posts");searchTerm="";lastOperation="None";operationCount=0;newUserName="";newUserEmail="";userCount=this.userHelpers.selectTotal();postCount=this.postHelpers.selectTotal();allUsers=this.userHelpers.selectAll();allPosts=this.postHelpers.selectAll();selectedUser=x(()=>{let i=this.store.$.selectedUserId();return i?this.userHelpers.selectById(i)():null});filteredUsers=x(()=>{let i=this.allUsers(),e=this.searchTerm.toLowerCase();return e?i.filter(t=>t.name.toLowerCase().includes(e)||t.email.toLowerCase().includes(e)):i});userPosts=x(()=>{let i=this.store.$.selectedUserId();return i?this.store.$.posts().filter(e=>e.authorId===i):[]});displayedPosts=x(()=>{let i=this.store.$.selectedUserId(),e=this.store.$.posts();return i?e.filter(t=>t.authorId===i):e.slice(0,20)});userTotalLikes=x(()=>this.userPosts().reduce((i,e)=>i+e.likes,0));trackOperation(i){this.lastOperation=i,this.operationCount++}loadUsers(){let i=U(50);this.userHelpers.clear(),i.forEach(e=>this.userHelpers.add(e)),this.trackOperation("Load Users")}loadPosts(){let i=this.userCount();i===0&&this.loadUsers();let e=k(200,Math.max(i,50));this.postHelpers.clear(),e.forEach(t=>this.postHelpers.add(t)),this.trackOperation("Load Posts")}addRandomUser(){let i=U(1,Date.now())[0],e=this.store.$.users(),t=Math.max(0,...e.map(r=>r.id));i.id=t+1,this.userHelpers.add(i),this.trackOperation("Add User")}addRandomPost(){let i=this.store.$.users();if(i.length===0)return;let e=k(1,i.length,Date.now())[0],t=this.store.$.posts(),r=Math.max(0,...t.map(a=>a.id));e.id=r+1,e.authorId=i[Math.floor(Math.random()*i.length)].id,this.postHelpers.add(e),this.trackOperation("Add Post")}selectUser(i){this.store.$.selectedUserId.set(this.store.$.selectedUserId()===i?null:i),this.trackOperation("Select User")}updateSearchTerm(i){let e=i.target;this.searchTerm=e.value,this.trackOperation("Search")}bulkUpdatePosts(){this.store.$.posts.update(i=>i.map(e=>T(_({},e),{likes:e.likes+10}))),this.trackOperation("Bulk Update Posts")}removeInactivePosts(){this.store.$.posts.update(i=>i.filter(e=>e.likes>=20)),this.trackOperation("Remove Inactive Posts")}getPostAuthor(i){return this.store.$.users().find(e=>e.id===i)}getUserClass(i){return this.store.$.selectedUserId()===i?"bg-blue-100 border-2 border-blue-300":"bg-gray-50 hover:bg-gray-100 border-2 border-transparent"}trackUser(i,e){return e.id}trackPost(i,e){return e.id}addUser(){if(!this.newUserName||!this.newUserEmail)return;let i=this.store.$.users(),t={id:Math.max(0,...i.map(r=>r.id))+1,name:this.newUserName,email:this.newUserEmail,avatar:`https://i.pravatar.cc/150?u=${this.newUserEmail}`};this.userHelpers.add(t),this.newUserName="",this.newUserEmail="",this.trackOperation("Add User")}updateUser(i,e){this.userHelpers.update(i,e),this.trackOperation("Update User")}deleteUser(i){this.userHelpers.remove(i),this.trackOperation("Delete User")}users(){return this.allUsers()}static \u0275fac=function(e){return new(e||d)};static \u0275cmp=I({type:d,selectors:[["app-entities-demo"]],decls:111,vars:22,consts:[["noUser",""],[1,"container","mx-auto","p-6"],[1,"text-3xl","font-bold","mb-6"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-6"],[1,"bg-white","rounded-lg","shadow","p-6"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-xl","font-semibold"],[1,"px-3","py-1","bg-blue-500","text-white","rounded","text-sm","hover:bg-blue-600",3,"click"],[1,"mb-4"],["type","text","placeholder","Search users...",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","input","ngModel"],[1,"space-y-2","max-h-64","overflow-y-auto"],["class","p-3 rounded-md cursor-pointer transition-colors","tabindex","0","role","button",3,"class","click","keyup.enter","keyup.space",4,"ngFor","ngForOf","ngForTrackBy"],["class","text-center text-gray-500 py-4",4,"ngIf"],[1,"mt-4","pt-4","border-t"],[1,"w-full","px-3","py-2","bg-green-500","text-white","rounded","hover:bg-green-600",3,"click"],["class","text-sm text-gray-500",4,"ngIf"],[1,"space-y-3","max-h-80","overflow-y-auto"],["class","p-3 bg-gray-50 rounded-md",4,"ngFor","ngForOf","ngForTrackBy"],[1,"w-full","px-3","py-2","bg-green-500","text-white","rounded","hover:bg-green-600","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"text-xl","font-semibold","mb-4"],[1,"space-y-4"],[1,"font-medium","text-gray-700","mb-2"],[1,"bg-gray-50","p-3","rounded","text-sm","space-y-1"],[1,"bg-gray-50","p-3","rounded","text-sm"],[4,"ngIf","ngIfElse"],[1,"space-y-2"],[1,"w-full","px-3","py-2","bg-purple-500","text-white","rounded","text-sm","hover:bg-purple-600","disabled:opacity-50",3,"click","disabled"],[1,"w-full","px-3","py-2","bg-red-500","text-white","rounded","text-sm","hover:bg-red-600","disabled:opacity-50",3,"click","disabled"],[1,"mt-8","bg-green-50","rounded-lg","p-6"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"font-medium","text-green-800","mb-2"],[1,"text-sm","text-green-700"],["tabindex","0","role","button",1,"p-3","rounded-md","cursor-pointer","transition-colors",3,"click","keyup.enter","keyup.space"],[1,"flex","items-center","gap-3"],[1,"w-8","h-8","rounded-full",3,"src","alt"],[1,"font-medium","text-sm"],[1,"text-xs","text-gray-500"],[1,"text-center","text-gray-500","py-4"],[1,"text-sm","text-gray-500"],[1,"p-3","bg-gray-50","rounded-md"],[1,"font-medium","text-sm","mb-1"],[1,"text-xs","text-gray-600","mb-2"],[1,"flex","justify-between","items-center","text-xs","text-gray-500"],[1,"flex","gap-1","mt-2"],["class","px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs",4,"ngFor","ngForOf"],[1,"px-2","py-1","bg-blue-100","text-blue-700","rounded","text-xs"],[1,"text-gray-500"]],template:function(e,t){if(e&1){let r=w();o(0,"div",1)(1,"h1",2),s(2,"SignalTree Entities Demo"),n(),o(3,"div",3)(4,"div",4)(5,"div",5)(6,"h2",6),s(7),n(),o(8,"button",7),h("click",function(){return p(r),u(t.loadUsers())}),s(9," Load Users "),n()(),o(10,"div",8)(11,"input",9),$("ngModelChange",function(m){return p(r),V(t.searchTerm,m)||(t.searchTerm=m),u(m)}),h("input",function(m){return p(r),u(t.updateSearchTerm(m))}),n()(),o(12,"div",10),b(13,J,9,6,"div",11)(14,X,2,0,"div",12),n(),o(15,"div",13)(16,"button",14),h("click",function(){return p(r),u(t.addRandomUser())}),s(17," Add Random User "),n()()(),o(18,"div",4)(19,"div",5)(20,"h2",6),s(21," Posts "),b(22,Z,2,1,"span",15),s(23),n(),o(24,"button",7),h("click",function(){return p(r),u(t.loadPosts())}),s(25," Load Posts "),n()(),o(26,"div",16),b(27,ee,12,5,"div",17)(28,te,2,0,"div",12),n(),o(29,"div",13)(30,"button",18),h("click",function(){return p(r),u(t.addRandomPost())}),s(31," Add Random Post "),n()()(),o(32,"div",4)(33,"h2",19),s(34,"Entity Statistics"),n(),o(35,"div",20)(36,"div")(37,"h3",21),s(38,"Counts"),n(),o(39,"div",22)(40,"div")(41,"strong"),s(42,"Total Users:"),n(),s(43),n(),o(44,"div")(45,"strong"),s(46,"Filtered Users:"),n(),s(47),n(),o(48,"div")(49,"strong"),s(50,"Total Posts:"),n(),s(51),n(),o(52,"div")(53,"strong"),s(54,"User's Posts:"),n(),s(55),n()()(),o(56,"div")(57,"h3",21),s(58,"Selected User"),n(),o(59,"div",23),b(60,ie,17,4,"div",24)(61,ne,2,0,"ng-template",null,0,H),n()(),o(63,"div")(64,"h3",21),s(65,"Performance"),n(),o(66,"div",22)(67,"div")(68,"strong"),s(69,"Last Operation:"),n(),s(70),n(),o(71,"div")(72,"strong"),s(73,"Operations:"),n(),s(74),n(),o(75,"div")(76,"strong"),s(77,"Search Active:"),n(),s(78),n()()(),o(79,"div")(80,"h3",21),s(81,"Entity Operations"),n(),o(82,"div",25)(83,"button",26),h("click",function(){return p(r),u(t.bulkUpdatePosts())}),s(84," Bulk Update Posts (+10 likes) "),n(),o(85,"button",27),h("click",function(){return p(r),u(t.removeInactivePosts())}),s(86," Remove Low-Engagement Posts "),n()()()()()(),o(87,"div",28)(88,"h2",19),s(89,"Entity Features Demonstrated"),n(),o(90,"div",29)(91,"div")(92,"h3",30),s(93,"Normalized State"),n(),o(94,"p",31),s(95," Entities are stored as arrays with reactive updates through SignalTree. This example shows CRUD operations, filtering, and "),n()(),o(96,"div")(97,"h3",30),s(98,"Relational Queries"),n(),o(99,"p",31),s(100," Complex queries across related entities (users and their posts) are computed efficiently. "),n()(),o(101,"div")(102,"h3",30),s(103,"Filtered Views"),n(),o(104,"p",31),s(105," Search and filtering maintain reactivity while preserving performance. "),n()(),o(106,"div")(107,"h3",30),s(108,"Bulk Operations"),n(),o(109,"p",31),s(110," Efficient bulk updates and deletions with minimal re-computation. "),n()()()()()}if(e&2){let r=D(62);l(7),c("Users (",t.userCount(),")"),l(4),O("ngModel",t.searchTerm),l(2),g("ngForOf",t.filteredUsers())("ngForTrackBy",t.trackUser),l(),g("ngIf",t.filteredUsers().length===0),l(8),g("ngIf",t.selectedUser()),l(),c(" (",t.displayedPosts().length,") "),l(4),g("ngForOf",t.displayedPosts())("ngForTrackBy",t.trackPost),l(),g("ngIf",t.displayedPosts().length===0),l(2),g("disabled",t.userCount()===0),l(13),c(" ",t.userCount()),l(4),c(" ",t.filteredUsers().length," "),l(4),c(" ",t.postCount()),l(4),c(" ",t.userPosts().length," "),l(5),g("ngIf",t.selectedUser())("ngIfElse",r),l(10),c(" ",t.lastOperation),l(4),c(" ",t.operationCount),l(4),c(" ",t.searchTerm.length>0?"Yes":"No"," "),l(5),g("disabled",t.postCount()===0),l(2),g("disabled",t.postCount()===0)}},dependencies:[A,N,F,W,L,B,R],encapsulation:2})};export{Y as EntitiesDemoComponent};
